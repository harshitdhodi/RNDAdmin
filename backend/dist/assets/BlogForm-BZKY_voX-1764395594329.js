import{a as q,f as F,r as m,bR as L,bS as R,bT as T,aw as U,j as e,J as v,I as g,B as w}from"./index-hVri1bw9-1764395594329.js";import{R as M}from"./index-Cu6WweBG-1764395594329.js";import"./isEqual-asQVdY7h-1764395594329.js";const I=l=>l.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"");function Q(){const{id:l}=q(),u=F(),[i,d]=m.useState({title:"",date:"",details:"",image:[],alt:[],imageTitle:[],slug:"",postedBy:"",visits:0,metatitle:"",metadescription:"",metakeywords:"",metacanonical:"",metalanguage:"",metaschema:"",otherMeta:"",url:"",priority:0,changeFreq:"",lastmod:new Date,status:"",category:"",createdAt:new Date,updatedAt:new Date}),[p,y]=m.useState([]),{data:t,isLoading:C,error:j}=L(l,{skip:!l}),[N,{isLoading:B}]=R(),[D,{isLoading:E}]=T(),{data:x}=U(),[c,b]=m.useState({}),h=a=>{const{name:s,value:o}=a.target;b(r=>({...r,[s]:""})),d(r=>{const n={...r,[s]:o};return s==="title"&&(n.slug=I(o)),n})},k=a=>{d(s=>({...s,details:a}))},A=a=>{const s=Array.from(a.target.files||[]);d(r=>({...r,image:s}));const o=s.map(r=>URL.createObjectURL(r));y(o)},S=async a=>{a.preventDefault();const s={};if(i.title.trim()||(s.title="Title is required"),i.category||(s.category="Category is required"),i.date||(s.date="Date is required"),i.details.trim()||(s.details="Details are required"),Object.keys(s).length>0){b(s);return}const o=new FormData;Object.entries(i).forEach(([r,n])=>{r==="image"?n.forEach(f=>{o.append("image",f)}):Array.isArray(n)?n.forEach(f=>{o.append(r,f)}):o.append(r,n.toString())}),l&&o.append("id",l);try{l?(await D({id:l,formData:o}).unwrap(),console.log("Blog updated successfully")):(await N(o).unwrap(),console.log("Blog created successfully")),u("/blog-table")}catch(r){console.error("Error submitting blog:",r)}};return m.useEffect(()=>{var a;t&&(d({title:t.title||"",date:t.date||"",details:t.details||"",image:[],alt:t.alt||[],imageTitle:t.imageTitle||[],slug:t.slug||"",postedBy:t.postedBy||"",visits:t.visits||0,metatitle:t.metatitle||"",metadescription:t.metadescription||"",metakeywords:t.metakeywords||"",metacanonical:t.metacanonical||"",metalanguage:t.metalanguage||"",metaschema:t.metaschema||"",otherMeta:t.otherMeta||"",url:t.url||"",priority:t.priority||0,changeFreq:t.changeFreq||"",lastmod:t.lastmod||new Date,status:t.status||"",category:((a=t.category)==null?void 0:a._id)||"",createdAt:t.createdAt||new Date,updatedAt:t.updatedAt||new Date}),t.image&&Array.isArray(t.image)&&y(t.image.map(s=>`/api/image/download/${s}`)))},[t]),m.useEffect(()=>()=>{p.forEach(a=>URL.revokeObjectURL(a))},[p]),l&&C?e.jsx("div",{children:"Loading..."}):j?e.jsxs("div",{children:["Error: ",j.message||"An error occurred"]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-sm",children:[e.jsx("span",{onClick:()=>u("/dashboard"),className:"cursor-pointer hover:text-primary",children:"Dashboard"}),e.jsx(v,{className:"h-4 w-4"}),e.jsx("span",{onClick:()=>u("/blog-table"),className:"cursor-pointer hover:text-primary",children:"Blogs"}),e.jsx(v,{className:"h-4 w-4"}),e.jsx("span",{className:"text-muted-foreground",children:l?"Edit Blog":"Create Blog"})]}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Blog Category"}),e.jsxs("select",{name:"category",value:i.category,onChange:a=>d(s=>({...s,category:a.target.value})),className:`w-full rounded-md border ${c.category?"border-red-500":"border-gray-300"} p-2`,required:!0,children:[e.jsx("option",{value:"",children:"Select a category"}),x==null?void 0:x.map(a=>e.jsx("option",{value:a._id,children:a.category},a._id))]}),c.category&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:c.category})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Title"}),e.jsx(g,{name:"title",value:i.title,onChange:h,placeholder:"Enter blog title",required:!0,className:c.title?"border-red-500":""}),c.title&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:c.title})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Date"}),e.jsx(g,{type:"date",name:"date",value:i.date,onChange:h,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Details"}),e.jsx(M,{theme:"snow",value:i.details,onChange:k,placeholder:"Enter blog details"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Images"}),e.jsx(g,{type:"file",multiple:!0,onChange:A}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:p.map((a,s)=>e.jsx("img",{src:a,alt:`Preview ${s+1}`,className:"h-16 w-16 object-cover rounded"},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Slug"}),e.jsx(g,{name:"slug",value:i.slug,onChange:h,placeholder:"Slug will be generated automatically",readOnly:!0})]},"slug"),["alt","imageTitle","postedBy","metatitle","metadescription","metakeywords","metacanonical","metalanguage","metaschema","otherMeta","priority","status"].map(a=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:a.charAt(0).toUpperCase()+a.slice(1)}),e.jsx(g,{name:a,value:i[a],onChange:h,placeholder:`Enter ${a}`})]},a)),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(w,{type:"button",variant:"ghost",onClick:()=>u("/blogs"),children:"Cancel"}),e.jsx(w,{type:"submit",disabled:B||E,children:l?"Update Blog":"Create Blog"})]})]})]})}export{Q as default};
