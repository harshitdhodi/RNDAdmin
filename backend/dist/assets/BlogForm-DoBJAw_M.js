import{bw as q,bx as F,by as L,ai as R,j as e,I as m,B as b}from"./main-D1Nesbqm.js";import{i as U,f as T,c as g}from"./vendor-CxfDVdnA.js";import{R as M}from"./index-CSXG-3Bq.js";import{C as v}from"./chevron-right-DVgf73fY.js";import"./isEqual-D12pi9da.js";const I=i=>i.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"");function G(){const{id:i}=U(),u=T(),[l,d]=g.useState({title:"",date:"",details:"",image:[],alt:[],imageTitle:[],slug:"",postedBy:"",visits:0,metatitle:"",metadescription:"",metakeywords:"",metacanonical:"",metalanguage:"",metaschema:"",otherMeta:"",url:"",priority:0,changeFreq:"",lastmod:new Date,status:"",category:"",createdAt:new Date,updatedAt:new Date}),[p,f]=g.useState([]),{data:t,isLoading:w,error:y}=q(i,{skip:!i}),[C,{isLoading:N}]=F(),[B,{isLoading:D}]=L(),{data:E}=R(),[c,j]=g.useState({}),h=a=>{const{name:s,value:o}=a.target;j(r=>({...r,[s]:""})),d(r=>{const n={...r,[s]:o};return s==="title"&&(n.slug=I(o)),n})},k=a=>{d(s=>({...s,details:a}))},A=a=>{const s=Array.from(a.target.files||[]);d(r=>({...r,image:s}));const o=s.map(r=>URL.createObjectURL(r));f(o)},S=async a=>{a.preventDefault();const s={};if(l.title.trim()||(s.title="Title is required"),l.category||(s.category="Category is required"),l.date||(s.date="Date is required"),l.details.trim()||(s.details="Details are required"),Object.keys(s).length>0){j(s);return}const o=new FormData;Object.entries(l).forEach(([r,n])=>{r==="image"?n.forEach(x=>{o.append("image",x)}):Array.isArray(n)?n.forEach(x=>{o.append(r,x)}):o.append(r,n.toString())}),i&&o.append("id",i);try{i?(await B({id:i,formData:o}).unwrap(),console.log("Blog updated successfully")):(await C(o).unwrap(),console.log("Blog created successfully")),u("/blog-table")}catch(r){console.error("Error submitting blog:",r)}};return g.useEffect(()=>{t&&(d({title:t.title||"",date:t.date||"",details:t.details||"",image:[],alt:t.alt||[],imageTitle:t.imageTitle||[],slug:t.slug||"",postedBy:t.postedBy||"",visits:t.visits||0,metatitle:t.metatitle||"",metadescription:t.metadescription||"",metakeywords:t.metakeywords||"",metacanonical:t.metacanonical||"",metalanguage:t.metalanguage||"",metaschema:t.metaschema||"",otherMeta:t.otherMeta||"",url:t.url||"",priority:t.priority||0,changeFreq:t.changeFreq||"",lastmod:t.lastmod||new Date,status:t.status||"",category:t.category?._id||"",createdAt:t.createdAt||new Date,updatedAt:t.updatedAt||new Date}),t.image&&Array.isArray(t.image)&&f(t.image.map(a=>`/api/image/download/${a}`)))},[t]),g.useEffect(()=>()=>{p.forEach(a=>URL.revokeObjectURL(a))},[p]),i&&w?e.jsx("div",{children:"Loading..."}):y?e.jsxs("div",{children:["Error: ",y.message||"An error occurred"]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-sm",children:[e.jsx("span",{onClick:()=>u("/dashboard"),className:"cursor-pointer hover:text-primary",children:"Dashboard"}),e.jsx(v,{className:"h-4 w-4"}),e.jsx("span",{onClick:()=>u("/blog-table"),className:"cursor-pointer hover:text-primary",children:"Blogs"}),e.jsx(v,{className:"h-4 w-4"}),e.jsx("span",{className:"text-muted-foreground",children:i?"Edit Blog":"Create Blog"})]}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Blog Category"}),e.jsxs("select",{name:"category",value:l.category,onChange:a=>d(s=>({...s,category:a.target.value})),className:`w-full rounded-md border ${c.category?"border-red-500":"border-gray-300"} p-2`,required:!0,children:[e.jsx("option",{value:"",children:"Select a category"}),E?.map(a=>e.jsx("option",{value:a._id,children:a.category},a._id))]}),c.category&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:c.category})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Title"}),e.jsx(m,{name:"title",value:l.title,onChange:h,placeholder:"Enter blog title",required:!0,className:c.title?"border-red-500":""}),c.title&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:c.title})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Date"}),e.jsx(m,{type:"date",name:"date",value:l.date,onChange:h,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Details"}),e.jsx(M,{theme:"snow",value:l.details,onChange:k,placeholder:"Enter blog details"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Images"}),e.jsx(m,{type:"file",multiple:!0,onChange:A}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:p.map((a,s)=>e.jsx("img",{src:a,alt:`Preview ${s+1}`,className:"h-16 w-16 object-cover rounded"},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Slug"}),e.jsx(m,{name:"slug",value:l.slug,onChange:h,placeholder:"Slug will be generated automatically",readOnly:!0})]},"slug"),["alt","imageTitle","postedBy","metatitle","metadescription","metakeywords","metacanonical","metalanguage","metaschema","otherMeta","priority","status"].map(a=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:a.charAt(0).toUpperCase()+a.slice(1)}),e.jsx(m,{name:a,value:l[a],onChange:h,placeholder:`Enter ${a}`})]},a)),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(b,{type:"button",variant:"ghost",onClick:()=>u("/blogs"),children:"Cancel"}),e.jsx(b,{type:"submit",disabled:N||D,children:i?"Update Blog":"Create Blog"})]})]})]})}export{G as default};
