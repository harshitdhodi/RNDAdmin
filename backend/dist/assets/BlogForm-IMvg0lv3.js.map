{"version":3,"file":"BlogForm-IMvg0lv3.js","sources":["../../src/blog/BlogForm.jsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useEffect, useState } from 'react';\r\nimport { useNavigate, useParams } from 'react-router-dom';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Button } from '@/components/ui/button';\r\nimport { useCreateBlogMutation, useGetBlogByIdQuery, useUpdateBlogMutation } from '@/slice/blog/blog';\r\nimport ReactQuill from 'react-quill';\r\nimport { useGetAllCategoriesQuery } from '@/slice/blog/blogCategory';\r\nimport { ChevronRight } from 'lucide-react';\r\nconst generateSlug = (title) => {\r\n  return title\r\n    .toLowerCase()\r\n    .replace(/[^a-z0-9]+/g, '-')\r\n    .replace(/^-+|-+$/g, '');\r\n};  \r\n\r\nexport default function BlogForm() {\r\n  const { id } = useParams();\r\n  const navigate = useNavigate();\r\n\r\n  const [formData, setFormData] = useState({\r\n    title: '',\r\n    date: '',\r\n    details: '',\r\n    image: [],\r\n    alt: [],\r\n    imageTitle: [],\r\n    slug: '',\r\n    postedBy: '',\r\n    visits: 0,\r\n    metatitle: '',\r\n    metadescription: '',\r\n    metakeywords: '',\r\n    metacanonical: '',\r\n    metalanguage: '',\r\n    metaschema: '',\r\n    otherMeta: '',\r\n    url: '',\r\n    priority: 0,\r\n    changeFreq: '',\r\n    lastmod: new Date(),\r\n    status: '',\r\n    category: '',\r\n    createdAt: new Date(),\r\n    updatedAt: new Date()\r\n  });\r\n\r\n  const [imagePreviews, setImagePreviews] = useState([]);\r\n\r\n  const { data: blog, isLoading: isFetching, error: fetchError } = useGetBlogByIdQuery(id, {\r\n    skip: !id,\r\n  });\r\n  const [createBlog, { isLoading: isCreating }] = useCreateBlogMutation();\r\n  const [updateBlog, { isLoading: isUpdating }] = useUpdateBlogMutation();\r\n\r\n  const { data: categories } = useGetAllCategoriesQuery();\r\n\r\n  const [formErrors, setFormErrors] = useState({});\r\n\r\n  const handleChange = (e) => {\r\n    const { name, value } = e.target;\r\n    // Clear error for the field being changed\r\n    setFormErrors(prev => ({ ...prev, [name]: '' }));\r\n    \r\n    setFormData((prev) => {\r\n      const newData = {\r\n        ...prev,\r\n        [name]: value,\r\n      };\r\n      if (name === 'title') {\r\n        newData.slug = generateSlug(value);\r\n      }\r\n      return newData;\r\n    });\r\n  };\r\n\r\n  const handleDetailsChange = (value) => {\r\n    setFormData((prev) => ({\r\n      ...prev,\r\n      details: value,\r\n    }));\r\n  };\r\n\r\n  const handleFileChange = (e) => {\r\n    const files = Array.from(e.target.files || []);\r\n    setFormData((prev) => ({\r\n      ...prev,\r\n      image: files,\r\n    }));\r\n\r\n    // Create image previews\r\n    const newPreviews = files.map((file) => URL.createObjectURL(file));\r\n    setImagePreviews(newPreviews);\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n  \r\n    // Validate form\r\n    const errors = {};\r\n    if (!formData.title.trim()) errors.title = 'Title is required';\r\n    if (!formData.category) errors.category = 'Category is required';\r\n    if (!formData.date) errors.date = 'Date is required';\r\n    if (!formData.details.trim()) errors.details = 'Details are required';\r\n\r\n    if (Object.keys(errors).length > 0) {\r\n      setFormErrors(errors);\r\n      return;\r\n    }\r\n\r\n    const formDataToSubmit = new FormData();\r\n    Object.entries(formData).forEach(([key, value]) => {\r\n      if (key === 'image') {\r\n        value.forEach((file) => {\r\n          formDataToSubmit.append('image', file);\r\n        });\r\n      } else if (Array.isArray(value)) {\r\n        value.forEach((item) => {\r\n          formDataToSubmit.append(key, item);\r\n        });\r\n      } else {\r\n        formDataToSubmit.append(key, value.toString());\r\n      }\r\n    });\r\n\r\n    if (id) {\r\n      formDataToSubmit.append('id', id);\r\n    }\r\n\r\n    try {\r\n      if (id) {\r\n        await updateBlog({ id, formData: formDataToSubmit }).unwrap();\r\n        console.log('Blog updated successfully');\r\n      } else {\r\n        await createBlog(formDataToSubmit).unwrap();\r\n        console.log('Blog created successfully');\r\n      }\r\n      navigate('/blog-table');\r\n    } catch (error) {\r\n      console.error('Error submitting blog:', error);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (blog) {\r\n      setFormData({\r\n        title: blog.title || '',\r\n        date: blog.date || '',\r\n        details: blog.details || '',\r\n        image: [],\r\n        alt: blog.alt || [],\r\n        imageTitle: blog.imageTitle || [],\r\n        slug: blog.slug || '',\r\n        postedBy: blog.postedBy || '',\r\n        visits: blog.visits || 0,\r\n        metatitle: blog.metatitle || '',\r\n        metadescription: blog.metadescription || '',\r\n        metakeywords: blog.metakeywords || '',\r\n        metacanonical: blog.metacanonical || '',\r\n        metalanguage: blog.metalanguage || '',\r\n        metaschema: blog.metaschema || '',\r\n        otherMeta: blog.otherMeta || '',\r\n        url: blog.url || '',\r\n        priority: blog.priority || 0,\r\n        changeFreq: blog.changeFreq || '',\r\n        lastmod: blog.lastmod || new Date(),\r\n        status: blog.status || '',\r\n        category: blog.category?._id || '',\r\n        createdAt: blog.createdAt || new Date(),\r\n        updatedAt: blog.updatedAt || new Date()\r\n      });\r\n\r\n      // Set image previews for existing images\r\n      if (blog.image && Array.isArray(blog.image)) {\r\n        setImagePreviews(blog.image.map((img) => `/api/image/download/${img}`));\r\n      }\r\n    }\r\n  }, [blog]);\r\n\r\n  useEffect(() => {\r\n    // Cleanup function to revoke object URLs\r\n    return () => {\r\n      imagePreviews.forEach((preview) => URL.revokeObjectURL(preview));\r\n    };\r\n  }, [imagePreviews]);\r\n\r\n  if (id && isFetching) return <div>Loading...</div>;\r\n  if (fetchError) return <div>Error: {fetchError.message || 'An error occurred'}</div>;\r\n\r\n  return (\r\n    <>\r\n      <div className=\"flex items-center gap-2 mb-4 text-sm\">\r\n        <span \r\n          onClick={() => navigate('/dashboard')} \r\n          className=\"cursor-pointer hover:text-primary\"\r\n        >\r\n          Dashboard\r\n        </span>\r\n        <ChevronRight className=\"h-4 w-4\" />\r\n        <span \r\n          onClick={() => navigate('/blog-table')} \r\n          className=\"cursor-pointer hover:text-primary\"\r\n        >\r\n          Blogs\r\n        </span>\r\n        <ChevronRight className=\"h-4 w-4\" />\r\n        <span className=\"text-muted-foreground\">\r\n          {id ? 'Edit Blog' : 'Create Blog'}\r\n        </span>\r\n      </div>\r\n\r\n      <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n      <div>\r\n            <label className=\"block text-sm font-medium\">Blog Category</label>\r\n            <select\r\n                name=\"category\"\r\n                value={formData.category}\r\n                onChange={(e) => setFormData(prev => ({\r\n                    ...prev,\r\n                    category: e.target.value\r\n                }))}\r\n                className={`w-full rounded-md border ${\r\n                    formErrors.category ? \"border-red-500\" : \"border-gray-300\"\r\n                } p-2`}\r\n                required\r\n            >\r\n                <option value=\"\">Select a category</option>\r\n                {categories?.map(cat => (\r\n                    <option key={cat._id} value={cat._id}>\r\n                        {cat.category}\r\n                    </option>\r\n                ))}\r\n            </select>\r\n            {formErrors.category && (\r\n                <p className=\"text-red-500 text-sm mt-1\">{formErrors.category}</p>\r\n            )}\r\n        </div>\r\n        <div>\r\n          <label className=\"block text-sm font-medium\">Title</label>\r\n          <Input\r\n            name=\"title\"\r\n            value={formData.title}\r\n            onChange={handleChange}\r\n            placeholder=\"Enter blog title\"\r\n            required\r\n            className={formErrors.title ? 'border-red-500' : ''}\r\n          />\r\n          {formErrors.title && (\r\n            <p className=\"text-red-500 text-sm mt-1\">{formErrors.title}</p>\r\n          )}\r\n        </div>\r\n\r\n        <div>\r\n          <label className=\"block text-sm font-medium\">Date</label>\r\n          <Input\r\n            type=\"date\"\r\n            name=\"date\"\r\n            value={formData.date}\r\n            onChange={handleChange}\r\n            required\r\n          />\r\n        </div>\r\n\r\n        <div>\r\n          <label className=\"block text-sm font-medium\">Details</label>\r\n          <ReactQuill\r\n            theme=\"snow\"\r\n            value={formData.details}\r\n            onChange={handleDetailsChange}\r\n            placeholder=\"Enter blog details\"\r\n          />\r\n        </div>\r\n\r\n        <div>\r\n          <label className=\"block text-sm font-medium\">Images</label>\r\n          <Input type=\"file\" multiple onChange={handleFileChange} />\r\n          <div className=\"mt-2 flex flex-wrap gap-2\">\r\n            {imagePreviews.map((preview, index) => (\r\n              <img\r\n                key={index}\r\n                src={preview}\r\n                alt={`Preview ${index + 1}`}\r\n                className=\"h-16 w-16 object-cover rounded\"\r\n              />\r\n            ))}\r\n          </div>\r\n        </div>\r\n\r\n        <div key=\"slug\">\r\n          <label className=\"block text-sm font-medium\">Slug</label>\r\n          <Input\r\n            name=\"slug\"\r\n            value={formData.slug}\r\n            onChange={handleChange}\r\n            placeholder=\"Slug will be generated automatically\"\r\n            readOnly\r\n          />\r\n        </div>\r\n\r\n        {['alt', 'imageTitle', 'postedBy', 'metatitle', 'metadescription', 'metakeywords', 'metacanonical', 'metalanguage', 'metaschema', 'otherMeta', 'priority', 'status'].map((field) => (\r\n          <div key={field}>\r\n            <label className=\"block text-sm font-medium\">{field.charAt(0).toUpperCase() + field.slice(1)}</label>\r\n            <Input\r\n              name={field}\r\n              value={formData[field]}\r\n              onChange={handleChange}\r\n              placeholder={`Enter ${field}`}\r\n            />\r\n          </div>\r\n        ))}\r\n\r\n        <div className=\"flex justify-end space-x-4\">\r\n          <Button type=\"button\" variant=\"ghost\" onClick={() => navigate('/blogs')}>\r\n            Cancel\r\n          </Button>\r\n          <Button type=\"submit\" disabled={isCreating || isUpdating}>\r\n            {id ? 'Update Blog' : 'Create Blog'}\r\n          </Button>\r\n        </div>\r\n      </form>\r\n    </>\r\n  );\r\n}\r\n\r\n"],"names":["BlogForm","id","useParams","navigate","useNavigate","formData","setFormData","useState","title","date","details","image","alt","imageTitle","slug","postedBy","visits","metatitle","metadescription","metakeywords","metacanonical","metalanguage","metaschema","otherMeta","url","priority","changeFreq","lastmod","Date","status","category","createdAt","updatedAt","imagePreviews","setImagePreviews","data","blog","isLoading","isFetching","error","fetchError","useGetBlogByIdQuery","skip","createBlog","isCreating","useCreateBlogMutation","updateBlog","isUpdating","useUpdateBlogMutation","categories","useGetAllCategoriesQuery","formErrors","setFormErrors","handleChange","e","name","value","target","prev","newData","toLowerCase","replace","useEffect","_id","Array","isArray","map","img","forEach","preview","URL","revokeObjectURL","jsx","children","jsxs","message","Fragment","className","onClick","ChevronRight","onSubmit","async","preventDefault","errors","trim","Object","keys","length","formDataToSubmit","FormData","entries","key","file","append","item","toString","unwrap","onChange","required","cat","Input","placeholder","type","ReactQuill","theme","multiple","files","from","newPreviews","createObjectURL","index","src","readOnly","field","charAt","toUpperCase","slice","Button","variant","disabled"],"mappings":"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"}