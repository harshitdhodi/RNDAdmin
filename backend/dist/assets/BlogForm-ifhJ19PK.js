import{r as d,j as e}from"./react-DKICu8bO.js";import{aG as q,aH as F,aI as L,a0 as R,I as g,B as v}from"./index-Bbo1zcj1.js";import{R as U}from"./react-quill-BTfuOY7l.js";import{l as w}from"./lucide-D7hRWJEP.js";import{b as T,a as I}from"./react-router-B9QVkYva.js";import"./classnames-Bv6oJzD9.js";import"./react-dom-BBS6HuAW.js";import"./scheduler-CKyTKYc2.js";import"./react-redux-BrRfTdeB.js";import"./use-sync-external-store-D0ivhzzy.js";import"./@reduxjs-B5J9SSA5.js";import"./redux-DITMfSWq.js";import"./immer-fBqQtvEc.js";import"./redux-thunk-ClJT1hhx.js";import"./reselect-C27TLnWV.js";import"./js-cookie-Cz0CWeBA.js";import"./@radix-ui-BlrBCj0C.js";import"./aria-hidden-DQ5UC2Eg.js";import"./react-remove-scroll-fXbmorz6.js";import"./tslib-CDuPK5Eb.js";import"./react-remove-scroll-bar-C9fmXXva.js";import"./react-style-singleton-DKBZmuKg.js";import"./get-nonce-C-Z93AgS.js";import"./use-sidecar-C10EJNOT.js";import"./use-callback-ref-BoKxM4XI.js";import"./@floating-ui-8J-daYO3.js";import"./class-variance-authority-Dp3B9jqt.js";import"./clsx-B-dksMZM.js";import"./tailwind-merge-D696Ktp4.js";import"./axios-DXsv3KKR.js";import"./@syncfusion-BIAkhmGL.js";import"./cookie--_YQFYBD.js";import"./lodash-BLBAyiDt.js";import"./quill-BGoone1_.js";const M=i=>i.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"");function je(){const{id:i}=T(),p=I(),[o,c]=d.useState({title:"",date:"",details:"",image:[],alt:[],imageTitle:[],slug:"",postedBy:"",visits:0,metatitle:"",metadescription:"",metakeywords:"",metacanonical:"",metalanguage:"",metaschema:"",otherMeta:"",url:"",priority:0,changeFreq:"",lastmod:new Date,status:"",category:"",createdAt:new Date,updatedAt:new Date}),[h,y]=d.useState([]),{data:t,isLoading:C,error:j}=q(i,{skip:!i}),[N,{isLoading:B}]=F(),[D,{isLoading:E}]=L(),{data:x}=R(),[m,b]=d.useState({}),u=a=>{const{name:r,value:l}=a.target;b(s=>({...s,[r]:""})),c(s=>{const n={...s,[r]:l};return r==="title"&&(n.slug=M(l)),n})},k=a=>{c(r=>({...r,details:a}))},A=a=>{const r=Array.from(a.target.files||[]);c(s=>({...s,image:r}));const l=r.map(s=>URL.createObjectURL(s));y(l)},S=async a=>{a.preventDefault();const r={};if(o.title.trim()||(r.title="Title is required"),o.category||(r.category="Category is required"),o.date||(r.date="Date is required"),o.details.trim()||(r.details="Details are required"),Object.keys(r).length>0){b(r);return}const l=new FormData;Object.entries(o).forEach(([s,n])=>{s==="image"?n.forEach(f=>{l.append("image",f)}):Array.isArray(n)?n.forEach(f=>{l.append(s,f)}):l.append(s,n.toString())}),i&&l.append("id",i);try{i?(await D({id:i,formData:l}).unwrap(),console.log("Blog updated successfully")):(await N(l).unwrap(),console.log("Blog created successfully")),p("/blog-table")}catch(s){console.error("Error submitting blog:",s)}};return d.useEffect(()=>{var a;t&&(c({title:t.title||"",date:t.date||"",details:t.details||"",image:[],alt:t.alt||[],imageTitle:t.imageTitle||[],slug:t.slug||"",postedBy:t.postedBy||"",visits:t.visits||0,metatitle:t.metatitle||"",metadescription:t.metadescription||"",metakeywords:t.metakeywords||"",metacanonical:t.metacanonical||"",metalanguage:t.metalanguage||"",metaschema:t.metaschema||"",otherMeta:t.otherMeta||"",url:t.url||"",priority:t.priority||0,changeFreq:t.changeFreq||"",lastmod:t.lastmod||new Date,status:t.status||"",category:((a=t.category)==null?void 0:a._id)||"",createdAt:t.createdAt||new Date,updatedAt:t.updatedAt||new Date}),t.image&&Array.isArray(t.image)&&y(t.image.map(r=>`/api/image/download/${r}`)))},[t]),d.useEffect(()=>()=>{h.forEach(a=>URL.revokeObjectURL(a))},[h]),i&&C?e.jsx("div",{children:"Loading..."}):j?e.jsxs("div",{children:["Error: ",j.message||"An error occurred"]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-sm",children:[e.jsx("span",{onClick:()=>p("/dashboard"),className:"cursor-pointer hover:text-primary",children:"Dashboard"}),e.jsx(w,{className:"h-4 w-4"}),e.jsx("span",{onClick:()=>p("/blog-table"),className:"cursor-pointer hover:text-primary",children:"Blogs"}),e.jsx(w,{className:"h-4 w-4"}),e.jsx("span",{className:"text-muted-foreground",children:i?"Edit Blog":"Create Blog"})]}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Blog Category"}),e.jsxs("select",{name:"category",value:o.category,onChange:a=>c(r=>({...r,category:a.target.value})),className:`w-full rounded-md border ${m.category?"border-red-500":"border-gray-300"} p-2`,required:!0,children:[e.jsx("option",{value:"",children:"Select a category"}),x==null?void 0:x.map(a=>e.jsx("option",{value:a._id,children:a.category},a._id))]}),m.category&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:m.category})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Title"}),e.jsx(g,{name:"title",value:o.title,onChange:u,placeholder:"Enter blog title",required:!0,className:m.title?"border-red-500":""}),m.title&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:m.title})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Date"}),e.jsx(g,{type:"date",name:"date",value:o.date,onChange:u,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Details"}),e.jsx(U,{theme:"snow",value:o.details,onChange:k,placeholder:"Enter blog details"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Images"}),e.jsx(g,{type:"file",multiple:!0,onChange:A}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:h.map((a,r)=>e.jsx("img",{src:a,alt:`Preview ${r+1}`,className:"h-16 w-16 object-cover rounded"},r))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Slug"}),e.jsx(g,{name:"slug",value:o.slug,onChange:u,placeholder:"Slug will be generated automatically",readOnly:!0})]},"slug"),["alt","imageTitle","postedBy","metatitle","metadescription","metakeywords","metacanonical","metalanguage","metaschema","otherMeta","priority","status"].map(a=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:a.charAt(0).toUpperCase()+a.slice(1)}),e.jsx(g,{name:a,value:o[a],onChange:u,placeholder:`Enter ${a}`})]},a)),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(v,{type:"button",variant:"ghost",onClick:()=>p("/blogs"),children:"Cancel"}),e.jsx(v,{type:"submit",disabled:B||E,children:i?"Update Blog":"Create Blog"})]})]})]})}export{je as default};
