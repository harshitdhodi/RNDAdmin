import{r as i,as as w,j as e,I as N,B as I,c as A,ax as _,bb as k,bc as M,bd as B,be as L,bf as P,R as v}from"./index-s1lMi29O-1770008093946.js";import{M as R}from"./index-kgIDmFTL-1770008093946.js";import"./index-Coq7tTkU-1770008093946.js";import"./Skeleton-BPYue-2v-1770008093946.js";function D({selectedSupplier:r,onAddChemical:m}){const[g,c]=i.useState(""),[d,a]=i.useState(""),[h,u]=i.useState(null),[o,l]=i.useState([]),[p,x]=i.useState(!1),f=async s=>{if(s){x(!0);try{const t=await A.get(`/api/chemical/getChemicalByCategoryAndAlphabet?alphabet=${s}`);l(t.data)}catch(t){console.error("Error fetching chemicals:",t),l([])}finally{x(!1)}}},y=s=>{const t=s.target.value;c(t),t.trim()?(a(t),f(t.charAt(0))):(a(""),l([]))},[C,{isLoading:n}]=w(),S=s=>{u(s),c(s.name),a("")},b=async()=>{if(!h||!r){console.error("No chemical or supplier selected");return}try{const s=h._id,t=r._id;await C({supplierId:t,chemical_ids:[s]}).unwrap(),u(null),c(""),m&&m()}catch(s){alert(`Failed to add chemical: ${s.message||"Unknown error occurred"}`)}};return e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(N,{placeholder:"Search Chemical",value:g,onChange:y,className:"w-full mb-4",disabled:!r}),p&&e.jsx("div",{className:"absolute top-2 right-4 text-sm text-gray-500",children:"Loading..."})]}),d&&(o==null?void 0:o.length)>0&&e.jsx("ul",{className:"border bg-white rounded max-h-40 overflow-y-auto",children:o.map(s=>e.jsx("li",{onClick:()=>S(s),className:"p-2 hover:bg-gray-200 cursor-pointer border-b last:border-b-0",children:s.name},s._id))}),(o==null?void 0:o.length)===0&&!p&&d&&e.jsx("div",{className:"p-2 text-gray-500",children:"No chemicals found"}),e.jsx(I,{onClick:b,disabled:n||!h||!r,className:`mt-4 w-fit py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600 ${n?"opacity-50 cursor-not-allowed":""}`,children:n?"Adding...":"Add Chemical"})]})}function E({chemicals:r,refetch:m,supplierId:g,onRemoveChemical:c}){const[d,a]=i.useState(1),[h,u]=i.useState(10),[o]=_(),[l,p]=i.useState(null),[x,f]=i.useState(!1),y=t=>{p(t),f(!0)},C=async()=>{if(!(!g||!l))try{await o({supplierId:g,chemicalId:l._id}),c(l),m(),f(!1),p(null),b.length===1&&d>1&&a(1)}catch(t){console.error("Error removing chemical:",t)}};Math.ceil(r.length/h);const n=(d-1)*h,S=n+h,b=r.slice(n,S),s=[{title:"Action",dataIndex:"action",render:(t,j)=>e.jsx(B,{danger:!0,size:"small",onClick:()=>y(j),children:"Delete"})},{title:"Chemical Name",dataIndex:"name"},{title:"CAS Number",dataIndex:"cas_number"}];return e.jsxs("div",{className:"border rounded-md mt-4 p-4",children:[e.jsx(k,{dataSource:b,columns:s,rowKey:"_id",pagination:!1}),e.jsx(M,{current:d,total:r.length,pageSize:h,onChange:t=>a(t),showSizeChanger:!0,onShowSizeChange:(t,j)=>u(j),className:"mt-4 float-end pt-5"}),e.jsx(R,{title:"Confirm Deletion",open:x,onCancel:()=>f(!1),onOk:C,okText:"Delete",okButtonProps:{danger:!0},children:e.jsxs("p",{children:['Are you sure you want to delete "',l==null?void 0:l.name,'"?']})})]})}function F({onSelectSupplier:r}){const[m,g]=i.useState(""),[c,d]=i.useState(""),[a,h]=i.useState(null),{data:u,isLoading:o}=L(c.charAt(0),{skip:c.length===0}),{data:l,refetch:p,isFetching:x}=P(a==null?void 0:a._id,{skip:!a});i.useEffect(()=>{l&&!x&&(h(l),typeof r=="function"&&r(l))},[l,x,r]);const f=n=>{h(n),g(n.name),d(""),typeof r=="function"&&r(n)},y=n=>{const S=n.target.value;g(S),d(S)},C=()=>{p()};return e.jsxs("div",{className:"mt-4",children:[e.jsx(N,{placeholder:"Search Supplier",value:m,onChange:y,className:"w-full mb-4"}),o?e.jsx("div",{children:"Loading..."}):c&&u&&u.length>0&&e.jsx("ul",{className:"border bg-white rounded max-h-40 overflow-y-auto",children:u.map(n=>e.jsx("li",{onClick:()=>f(n),className:"p-2 hover:bg-gray-200 cursor-pointer",children:n.name},n.id))}),(u==null?void 0:u.length)===0&&!o&&c&&e.jsx("div",{className:"p-2 text-gray-500",children:"No Supplier found"}),x&&e.jsx("div",{className:"p-2 text-gray-500",children:"Refreshing supplier data..."}),e.jsx(D,{selectedSupplier:a,onAddChemical:C}),e.jsx("div",{className:"mt-4",children:e.jsx(E,{chemicals:(a==null?void 0:a.chemical_ids)||[],refetch:p,onRemoveChemical:C,supplierId:a==null?void 0:a._id})})]})}function O(){const[r,m]=v.useState(null),[g,c]=v.useState([]),d=a=>{m(a),c([])};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-purple-700",children:"Assign Chemicals to Supplier"}),e.jsx("div",{className:"space-y-4",children:e.jsx(F,{onSelectCustomer:d})})]})}export{O as default};
