import{r as h,j as e,bb as w,bk as I,bl as A,bd as S,aR as _,at as k,I as N,B,h as b,bm as P,bg as L,aB as R,R as f}from"./index-Bx7n1Wn1-1770007580750.js";import{B as F}from"./BreadCrumb-BIpbs7Xd-1770007580750.js";function M({chemicals:a,onRemoveChemical:g}){const[n,r]=h.useState(1),[l,t]=h.useState(10),d=Math.ceil(((a==null?void 0:a.length)||0)/l),c=(n-1)*l,i=c+l,C=a==null?void 0:a.slice(c,i),x=[{title:"Action",dataIndex:"action",render:(u,p)=>e.jsx(S,{type:"primary",danger:!0,size:"small",onClick:()=>g(p),children:"Delete"})},{title:"Chemical Name",dataIndex:"name"},{title:"CAS Number",dataIndex:"cas_number"}];return e.jsxs("div",{className:"border rounded-md mt-4 p-4",children:[e.jsx(w,{columns:x,dataSource:C,rowKey:"_id",pagination:!1}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Items per page:"," ",e.jsx(I,{value:l,onChange:u=>{t(u),r(1)},options:[{value:10,label:"10"},{value:20,label:"20"},{value:50,label:"50"}],className:"w-20"})]}),e.jsxs(A,{children:[e.jsx(S,{type:"default",size:"small",onClick:()=>r(n-1),disabled:n===1,children:"Previous"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[c+1," - ",Math.min(i,(a==null?void 0:a.length)||0)," of"," ",(a==null?void 0:a.length)||0]}),e.jsx(S,{type:"default",size:"small",onClick:()=>r(n+1),disabled:n===d,children:"Next"})]})]})]})}function Q({selectedCustomer:a,refetchCustomer:g}){const[n,r]=h.useState(""),[l,t]=h.useState(""),[d,c]=h.useState(null),{data:i,isLoading:C}=_(l.charAt(0),{skip:l.length===0}),[x,{isLoading:u}]=k(),p=s=>{const m=s.target.value;r(m),t(m)},v=s=>{c(s),r(s.name),t("")},j=async()=>{if(!d||!a){b.error("Please select both customer and chemical");return}try{const s=d.id||d._id,m=a._id;await x({customerId:m,chemicalId:s}).unwrap(),r(""),c(null),await g(),b.success("Chemical added successfully")}catch(s){b.error(s.message||"Failed to add chemical")}};return e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(N,{placeholder:"Search Chemical",value:n,onChange:p,className:"w-full mb-4",disabled:!a}),C&&e.jsx("div",{className:"absolute top-2 right-4 text-sm text-gray-500",children:"Loading..."})]}),l&&(i==null?void 0:i.length)>0&&e.jsx("ul",{className:"border bg-white rounded max-h-40 overflow-y-auto",children:i.map(s=>e.jsx("li",{onClick:()=>v(s),className:"p-2 hover:bg-gray-200 cursor-pointer",children:s.name},s._id))}),e.jsx(B,{onClick:j,disabled:u||!d||!a,className:"mt-4 w-[10%] py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600",children:u?"Adding...":"Add "})]})}function T({onSelectCustomer:a}){const[g,n]=h.useState(""),[r,l]=h.useState(""),[t,d]=h.useState(null),{data:c,isLoading:i,refetch:C}=P(r.charAt(0),{skip:r.length===0}),{data:x,refetch:u}=L(t==null?void 0:t._id,{skip:!(t!=null&&t._id)}),[p]=R(),v=o=>{d(o),n(o.name),l(""),a(o)},j=o=>{const y=o.target.value;n(y),l(y)},s=async o=>{try{await p({customerId:t._id,chemicalId:o._id}).unwrap(),await Promise.all([u(),C()]),b.success("Chemical removed successfully")}catch(y){console.error("Error removing chemical:",y),b.error("Failed to remove chemical")}},m=(x==null?void 0:x.data)||t;return e.jsxs("div",{className:"mt-4",children:[e.jsx(N,{placeholder:"Search Customer",value:g,onChange:j,className:"w-full mb-4"}),i?e.jsx("div",{children:"Loading..."}):r&&c&&c.length>0&&e.jsx("ul",{className:"border bg-white rounded max-h-40 overflow-y-auto",children:c.map(o=>e.jsx("li",{onClick:()=>v(o),className:"p-2 hover:bg-gray-200 cursor-pointer",children:o.name},o._id))}),e.jsx(Q,{selectedCustomer:m,refetchCustomer:async()=>{await Promise.all([u(),C()])}}),m&&e.jsx(M,{chemicals:m.chemicalId||[],onRemoveChemical:s})]})}const z=[{label:"Dashboard",href:"/dashboard"},{label:"Chemical Mapping",href:null}];function q(){const[a,g]=f.useState(null),[n,r]=f.useState([]),l=t=>{g(t),r([])};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"ml-1",children:e.jsx(F,{items:z})}),e.jsxs("div",{className:"py-4 space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-purple-700",children:"Assign Chemicals to Customer"}),e.jsx("div",{className:"space-y-4",children:e.jsx(T,{onSelectCustomer:l})})]})]})}export{q as default};
