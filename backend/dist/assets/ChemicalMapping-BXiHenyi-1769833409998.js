import{r as i,at as w,j as e,I as N,B as I,c as A,ay as _,bc as k,bd as M,be as B,bf as L,bg as P,R as v}from"./index-Bz9LGQy6-1769833409998.js";import{M as R}from"./index-BpD1LNwa-1769833409998.js";import"./index-BuqdDRZy-1769833409998.js";import"./Skeleton-CWCPivzC-1769833409998.js";function D({selectedSupplier:r,onAddChemical:m}){const[g,c]=i.useState(""),[d,t]=i.useState(""),[h,u]=i.useState(null),[o,l]=i.useState([]),[p,f]=i.useState(!1),x=async s=>{if(s){f(!0);try{const a=await A.get(`/api/chemical/getChemicalByCategoryAndAlphabet?alphabet=${s}`);l(a.data)}catch(a){console.error("Error fetching chemicals:",a),l([])}finally{f(!1)}}},y=s=>{const a=s.target.value;c(a),a.trim()?(t(a),x(a.charAt(0))):(t(""),l([]))},[C,{isLoading:n}]=w(),S=s=>{u(s),c(s.name),t("")},b=async()=>{if(!h||!r){console.error("No chemical or supplier selected");return}try{const s=h._id,a=r._id;await C({supplierId:a,chemical_ids:[s]}).unwrap(),u(null),c(""),m&&m()}catch(s){alert(`Failed to add chemical: ${s.message||"Unknown error occurred"}`)}};return e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(N,{placeholder:"Search Chemical",value:g,onChange:y,className:"w-full mb-4",disabled:!r}),p&&e.jsx("div",{className:"absolute top-2 right-4 text-sm text-gray-500",children:"Loading..."})]}),d&&(o==null?void 0:o.length)>0&&e.jsx("ul",{className:"border bg-white rounded max-h-40 overflow-y-auto",children:o.map(s=>e.jsx("li",{onClick:()=>S(s),className:"p-2 hover:bg-gray-200 cursor-pointer border-b last:border-b-0",children:s.name},s._id))}),(o==null?void 0:o.length)===0&&!p&&d&&e.jsx("div",{className:"p-2 text-gray-500",children:"No chemicals found"}),e.jsx(I,{onClick:b,disabled:n||!h||!r,className:`mt-4 w-fit py-2 bg-blue-500 text-white rounded hover:bg-blue-600 ${n?"opacity-50 cursor-not-allowed":""}`,children:n?"Adding...":"Add Chemical"})]})}function E({chemicals:r,refetch:m,supplierId:g,onRemoveChemical:c}){const[d,t]=i.useState(1),[h,u]=i.useState(10),[o]=_(),[l,p]=i.useState(null),[f,x]=i.useState(!1),y=a=>{p(a),x(!0)},C=async()=>{if(!(!g||!l))try{await o({supplierId:g,chemicalId:l._id}),c(l),m(),x(!1),p(null),b.length===1&&d>1&&t(1)}catch(a){console.error("Error removing chemical:",a)}};Math.ceil(r.length/h);const n=(d-1)*h,S=n+h,b=r.slice(n,S),s=[{title:"Action",dataIndex:"action",render:(a,j)=>e.jsx(B,{danger:!0,size:"small",onClick:()=>y(j),children:"Delete"})},{title:"Chemical Name",dataIndex:"name"},{title:"CAS Number",dataIndex:"cas_number"}];return e.jsxs("div",{className:"border rounded-md mt-4 p-4",children:[e.jsx(k,{dataSource:b,columns:s,rowKey:"_id",pagination:!1}),e.jsx(M,{current:d,total:r.length,pageSize:h,onChange:a=>t(a),showSizeChanger:!0,onShowSizeChange:(a,j)=>u(j),className:"mt-4 float-end pt-5"}),e.jsx(R,{title:"Confirm Deletion",open:f,onCancel:()=>x(!1),onOk:C,okText:"Delete",okButtonProps:{danger:!0},children:e.jsxs("p",{children:['Are you sure you want to delete "',l==null?void 0:l.name,'"?']})})]})}function F({onSelectSupplier:r}){const[m,g]=i.useState(""),[c,d]=i.useState(""),[t,h]=i.useState(null),{data:u,isLoading:o}=L(c.charAt(0),{skip:c.length===0}),{data:l,refetch:p,isFetching:f}=P(t==null?void 0:t._id,{skip:!t});i.useEffect(()=>{l&&!f&&(h(l),typeof r=="function"&&r(l))},[l,f,r]);const x=n=>{h(n),g(n.name),d(""),typeof r=="function"&&r(n)},y=n=>{const S=n.target.value;g(S),d(S)},C=()=>{p()};return e.jsxs("div",{className:"mt-4",children:[e.jsx(N,{placeholder:"Search Supplier",value:m,onChange:y,className:"w-full mb-4"}),o?e.jsx("div",{children:"Loading..."}):c&&u&&u.length>0&&e.jsx("ul",{className:"border bg-white rounded max-h-40 overflow-y-auto",children:u.map(n=>e.jsx("li",{onClick:()=>x(n),className:"p-2 hover:bg-gray-200 cursor-pointer",children:n.name},n.id))}),(u==null?void 0:u.length)===0&&!o&&c&&e.jsx("div",{className:"p-2 text-gray-500",children:"No Supplier found"}),f&&e.jsx("div",{className:"p-2 text-gray-500",children:"Refreshing supplier data..."}),e.jsx(D,{selectedSupplier:t,onAddChemical:C}),e.jsx("div",{className:"mt-4",children:e.jsx(E,{chemicals:(t==null?void 0:t.chemical_ids)||[],refetch:p,onRemoveChemical:C,supplierId:t==null?void 0:t._id})})]})}function O(){const[r,m]=v.useState(null),[g,c]=v.useState([]),d=t=>{m(t),c([])};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-purple-700",children:"Assign Chemicals to Supplier"}),e.jsx("div",{className:"space-y-4",children:e.jsx(F,{onSelectCustomer:d})})]})}export{O as default};
