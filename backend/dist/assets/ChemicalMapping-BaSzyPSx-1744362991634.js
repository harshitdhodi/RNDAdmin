import{j as e,K as w,q as I,I as N,B as A,ab as _,a8 as B,x as P}from"./main-4qLjs9DC-1744362991634.js";import{c as u,R as j}from"./vendor-C9iLKeEQ-1744362991634.js";import{F as k}from"./Table-Ddh5rBZI-1744362991634.js";import{S as F}from"./index-NTQ2_5ui-1744362991634.js";import{S as L}from"./index-N-Zr9Q_--1744362991634.js";import{B as f}from"./index-KVtzR29S-1744362991634.js";import{B as b}from"./react-toastify.esm-Bl8YeLep-1744362991634.js";import{B as R}from"./BreadCrumb-DOoKuDJk-1744362991634.js";import"./toArray-Bbgf03cS-1744362991634.js";import"./addEventListener-C3Vjj2Sc-1744362991634.js";import"./dropdown-D-MlIyxB-1744362991634.js";import"./EllipsisOutlined-BU33D6Nw-1744362991634.js";import"./useForceUpdate-D5st5PaX-1744362991634.js";import"./TextArea-CI-mQ3ZF-1744362991634.js";import"./index-BdDOn4RF-1744362991634.js";import"./index-BsE1OYP1-1744362991634.js";import"./CheckOutlined-BpOl7NFo-1744362991634.js";import"./chevron-right-D59bkzT9-1744362991634.js";function M({chemicals:r,onRemoveChemical:h}){const[l,s]=u.useState(1),[a,c]=u.useState(10),n=Math.ceil((r?.length||0)/a),i=(l-1)*a,p=i+a,C=r?.slice(i,p),x=[{title:"Action",dataIndex:"action",render:(m,g)=>e.jsx(f,{type:"primary",danger:!0,size:"small",onClick:()=>h(g),children:"Delete"})},{title:"Chemical Name",dataIndex:"name"},{title:"CAS Number",dataIndex:"cas_number"}];return e.jsxs("div",{className:"border rounded-md mt-4 p-4",children:[e.jsx(k,{columns:x,dataSource:C,rowKey:"_id",pagination:!1}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Items per page:"," ",e.jsx(F,{value:a,onChange:m=>{c(m),s(1)},options:[{value:10,label:"10"},{value:20,label:"20"},{value:50,label:"50"}],style:{width:80}})]}),e.jsxs(L,{children:[e.jsx(f,{type:"default",size:"small",onClick:()=>s(l-1),disabled:l===1,children:"Previous"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[i+1," - ",Math.min(p,r?.length||0)," of"," ",r?.length||0]}),e.jsx(f,{type:"default",size:"small",onClick:()=>s(l+1),disabled:l===n,children:"Next"})]})]})]})}function Q({selectedCustomer:r,refetchCustomer:h}){const[l,s]=u.useState(""),[a,c]=u.useState(""),[n,i]=u.useState(null),{data:p,isLoading:C}=w(a.charAt(0),{skip:a.length===0}),[x,{isLoading:m}]=I(),g=t=>{const d=t.target.value;s(d),c(d)},v=t=>{i(t),s(t.name),c("")},y=async()=>{if(!n||!r){b.error("Please select both customer and chemical");return}try{const t=n.id||n._id,d=r._id;await x({customerId:d,chemicalId:t}).unwrap(),s(""),i(null),await h(),b.success("Chemical added successfully")}catch(t){b.error(t.message||"Failed to add chemical")}};return e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(N,{placeholder:"Search Chemical",value:l,onChange:g,className:"w-full mb-4",disabled:!r}),C&&e.jsx("div",{className:"absolute top-2 right-4 text-sm text-gray-500",children:"Loading..."})]}),a&&p?.length>0&&e.jsx("ul",{className:"border bg-white rounded max-h-40 overflow-y-auto",children:p.map(t=>e.jsx("li",{onClick:()=>v(t),className:"p-2 hover:bg-gray-200 cursor-pointer",children:t.name},t._id))}),e.jsx(A,{onClick:y,disabled:m||!n||!r,className:"mt-4 w-[10%] py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:m?"Adding...":"Add "})]})}function D({onSelectCustomer:r}){const[h,l]=u.useState(""),[s,a]=u.useState(""),[c,n]=u.useState(null),{data:i,isLoading:p,refetch:C}=_(s.charAt(0),{skip:s.length===0}),{data:x,refetch:m}=B(c?._id,{skip:!c?._id}),[g]=P(),v=o=>{n(o),l(o.name),a(""),r(o)},y=o=>{const S=o.target.value;l(S),a(S)},t=async o=>{try{await g({customerId:c._id,chemicalId:o._id}).unwrap(),await Promise.all([m(),C()]),b.success("Chemical removed successfully")}catch(S){console.error("Error removing chemical:",S),b.error("Failed to remove chemical")}},d=x?.data||c;return e.jsxs("div",{className:"mt-4",children:[e.jsx(N,{placeholder:"Search Customer",value:h,onChange:y,className:"w-full mb-4"}),p?e.jsx("div",{children:"Loading..."}):s&&i&&i.length>0&&e.jsx("ul",{className:"border bg-white rounded max-h-40 overflow-y-auto",children:i.map(o=>e.jsx("li",{onClick:()=>v(o),className:"p-2 hover:bg-gray-200 cursor-pointer",children:o.name},o._id))}),e.jsx(Q,{selectedCustomer:d,refetchCustomer:async()=>{await Promise.all([m(),C()])}}),d&&e.jsx(M,{chemicals:d.chemicalId||[],onRemoveChemical:t})]})}const T=[{label:"Dashboard",href:"/dashboard"},{label:"Chemical Mapping",href:null}];function ae(){const[r,h]=j.useState(null),[l,s]=j.useState([]),a=c=>{h(c),s([])};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"ml-1",children:e.jsx(R,{items:T})}),e.jsxs("div",{className:"py-4 space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-purple-700",children:"Assign Chemicals to Customer"}),e.jsx("div",{className:"space-y-4",children:e.jsx(D,{onSelectCustomer:a})})]})]})}export{ae as default};
