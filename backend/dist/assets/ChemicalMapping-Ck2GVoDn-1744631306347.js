import{r as o,v as w,j as e,I as N,B as I,c as A,z as _,ad as k,ae as B,R as b}from"./index-CJvB1EYs-1744631306347.js";import{F as M,P}from"./Table-Dpf6Zbey-1744631306347.js";import{M as L}from"./index-CrNgV6Bq-1744631306347.js";import{B as R}from"./index-CFtph3W4-1744631306347.js";import"./toArray-Bbgf03cS-1744631306347.js";import"./addEventListener-BuhQEGQl-1744631306347.js";import"./index-CIj4GrAY-1744631306347.js";import"./EllipsisOutlined-D6B7hJyL-1744631306347.js";import"./dropdown-C4AE3AZ--1744631306347.js";import"./TextArea-IiQVstN--1744631306347.js";import"./CheckOutlined-DfUEdl7S-1744631306347.js";import"./index-BVP8k6Gz-1744631306347.js";import"./index-ByZRmmuu-1744631306347.js";import"./useForceUpdate-eUU72kId-1744631306347.js";import"./index-BcIucBg6-1744631306347.js";import"./CheckCircleFilled-CBoTj7pG-1744631306347.js";import"./ExclamationCircleFilled-C-gsRSbp-1744631306347.js";import"./InfoCircleFilled-DCFdY5gM-1744631306347.js";import"./ActionButton-19otM778-1744631306347.js";import"./index-Cr4JArcy-1744631306347.js";import"./fade-CoeXGO9K-1744631306347.js";import"./Skeleton-C7P0qmVJ-1744631306347.js";function F({selectedSupplier:n,onAddChemical:u}){const[p,l]=o.useState(""),[d,t]=o.useState(""),[m,h]=o.useState(null),[c,i]=o.useState([]),[g,f]=o.useState(!1),x=async s=>{if(s){f(!0);try{const a=await A.get(`/api/chemical/getChemicalByCategoryAndAlphabet?alphabet=${s}`);i(a.data)}catch(a){console.error("Error fetching chemicals:",a),i([])}finally{f(!1)}}},y=s=>{const a=s.target.value;l(a),a.trim()?(t(a),x(a.charAt(0))):(t(""),i([]))},[C,{isLoading:r}]=w(),S=s=>{h(s),l(s.name),t("")},j=async()=>{if(!m||!n){console.error("No chemical or supplier selected");return}try{const s=m._id,a=n._id;await C({supplierId:a,chemical_ids:[s]}).unwrap(),h(null),l(""),u&&u()}catch(s){alert(`Failed to add chemical: ${s.message||"Unknown error occurred"}`)}};return e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(N,{placeholder:"Search Chemical",value:p,onChange:y,className:"w-full mb-4",disabled:!n}),g&&e.jsx("div",{className:"absolute top-2 right-4 text-sm text-gray-500",children:"Loading..."})]}),d&&(c==null?void 0:c.length)>0&&e.jsx("ul",{className:"border bg-white rounded max-h-40 overflow-y-auto",children:c.map(s=>e.jsx("li",{onClick:()=>S(s),className:"p-2 hover:bg-gray-200 cursor-pointer border-b last:border-b-0",children:s.name},s._id))}),(c==null?void 0:c.length)===0&&!g&&d&&e.jsx("div",{className:"p-2 text-gray-500",children:"No chemicals found"}),e.jsx(I,{onClick:j,disabled:r||!m||!n,className:`mt-4 w-fit py-2 bg-blue-500 text-white rounded hover:bg-blue-600 ${r?"opacity-50 cursor-not-allowed":""}`,children:r?"Adding...":"Add Chemical"})]})}function z({chemicals:n,refetch:u,supplierId:p,onRemoveChemical:l}){const[d,t]=o.useState(1),[m,h]=o.useState(10),[c]=_(),[i,g]=o.useState(null),[f,x]=o.useState(!1),y=a=>{g(a),x(!0)},C=async()=>{if(!(!p||!i))try{await c({supplierId:p,chemicalId:i._id}),l(i),u(),x(!1),g(null),j.length===1&&d>1&&t(1)}catch(a){console.error("Error removing chemical:",a)}};Math.ceil(n.length/m);const r=(d-1)*m,S=r+m,j=n.slice(r,S),s=[{title:"Action",dataIndex:"action",render:(a,v)=>e.jsx(R,{danger:!0,size:"small",onClick:()=>y(v),children:"Delete"})},{title:"Chemical Name",dataIndex:"name"},{title:"CAS Number",dataIndex:"cas_number"}];return e.jsxs("div",{className:"border rounded-md mt-4 p-4",children:[e.jsx(M,{dataSource:j,columns:s,rowKey:"_id",pagination:!1}),e.jsx(P,{current:d,total:n.length,pageSize:m,onChange:a=>t(a),showSizeChanger:!0,onShowSizeChange:(a,v)=>h(v),className:"mt-4 float-end pt-5"}),e.jsx(L,{title:"Confirm Deletion",open:f,onCancel:()=>x(!1),onOk:C,okText:"Delete",okButtonProps:{danger:!0},children:e.jsxs("p",{children:['Are you sure you want to delete "',i==null?void 0:i.name,'"?']})})]})}function D({onSelectSupplier:n}){const[u,p]=o.useState(""),[l,d]=o.useState(""),[t,m]=o.useState(null),{data:h,isLoading:c}=k(l.charAt(0),{skip:l.length===0}),{data:i,refetch:g,isFetching:f}=B(t==null?void 0:t._id,{skip:!t});o.useEffect(()=>{i&&!f&&(m(i),typeof n=="function"&&n(i))},[i,f,n]);const x=r=>{m(r),p(r.name),d(""),typeof n=="function"&&n(r)},y=r=>{const S=r.target.value;p(S),d(S)},C=()=>{g()};return e.jsxs("div",{className:"mt-4",children:[e.jsx(N,{placeholder:"Search Supplier",value:u,onChange:y,className:"w-full mb-4"}),c?e.jsx("div",{children:"Loading..."}):l&&h&&h.length>0&&e.jsx("ul",{className:"border bg-white rounded max-h-40 overflow-y-auto",children:h.map(r=>e.jsx("li",{onClick:()=>x(r),className:"p-2 hover:bg-gray-200 cursor-pointer",children:r.name},r.id))}),(h==null?void 0:h.length)===0&&!c&&l&&e.jsx("div",{className:"p-2 text-gray-500",children:"No Supplier found"}),f&&e.jsx("div",{className:"p-2 text-gray-500",children:"Refreshing supplier data..."}),e.jsx(F,{selectedSupplier:t,onAddChemical:C}),e.jsx("div",{className:"mt-4",children:e.jsx(z,{chemicals:(t==null?void 0:t.chemical_ids)||[],refetch:g,onRemoveChemical:C,supplierId:t==null?void 0:t._id})})]})}function ie(){const[n,u]=b.useState(null),[p,l]=b.useState([]),d=t=>{u(t),l([])};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-purple-700",children:"Assign Chemicals to Supplier"}),e.jsx("div",{className:"space-y-4",children:e.jsx(D,{onSelectCustomer:d})})]})}export{ie as default};
