import{r as n,j as e,a as v}from"./react-DKICu8bO.js";import{l as w,I as N,B as I,p as A,P as _,Q as k}from"./index-Bbo1zcj1.js";import{a as P}from"./axios-DXsv3KKR.js";import{F as B,P as M,M as L,B as F}from"./antd-mtWlDmqY.js";import"./classnames-Bv6oJzD9.js";import"./react-dom-BBS6HuAW.js";import"./scheduler-CKyTKYc2.js";import"./react-redux-BrRfTdeB.js";import"./use-sync-external-store-D0ivhzzy.js";import"./@reduxjs-B5J9SSA5.js";import"./redux-DITMfSWq.js";import"./immer-fBqQtvEc.js";import"./redux-thunk-ClJT1hhx.js";import"./reselect-C27TLnWV.js";import"./js-cookie-Cz0CWeBA.js";import"./react-router-B9QVkYva.js";import"./cookie--_YQFYBD.js";import"./@radix-ui-BlrBCj0C.js";import"./aria-hidden-DQ5UC2Eg.js";import"./react-remove-scroll-fXbmorz6.js";import"./tslib-CDuPK5Eb.js";import"./react-remove-scroll-bar-C9fmXXva.js";import"./react-style-singleton-DKBZmuKg.js";import"./get-nonce-C-Z93AgS.js";import"./use-sidecar-C10EJNOT.js";import"./use-callback-ref-BoKxM4XI.js";import"./@floating-ui-8J-daYO3.js";import"./class-variance-authority-Dp3B9jqt.js";import"./clsx-B-dksMZM.js";import"./tailwind-merge-D696Ktp4.js";import"./lucide-D7hRWJEP.js";import"./@syncfusion-BIAkhmGL.js";import"./@ant-design-jkdqJqTn.js";import"./rc-util-C9ihiQ8l.js";import"./@babel-C_xKm-6V.js";import"./react-is-NfUKNnIv.js";import"./@emotion-CW87jbl0.js";import"./stylis-OW4gUFyn.js";import"./@ctrl-DOFZgDuz.js";import"./rc-motion-D0k58WYE.js";import"./@rc-component-DJY3KRXL.js";import"./rc-resize-observer-h7CJ_t66.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./ant-design-icons-CNhZ1eT-.js";import"./rc-dialog-CfVZmZCG.js";import"./rc-table-BJAsEMDh.js";import"./rc-virtual-list-OMMR-gr8.js";import"./rc-tree-aGCJh_41.js";import"./rc-checkbox-nRYcjTPl.js";import"./rc-pagination-ZKXeAm0h.js";import"./rc-select-RmeC3WgB.js";import"./rc-overflow-DEivB5rv.js";import"./throttle-debounce-CUWDS_la.js";import"./rc-input-CIUXRVU8.js";import"./rc-tooltip-Oavn6yow.js";import"./rc-notification-0md6QYDj.js";import"./rc-image-ClDwiN-j.js";import"./rc-textarea-CijmdGy3.js";import"./copy-to-clipboard-0rP7DRqq.js";import"./toggle-selection-DGa8lynz.js";import"./rc-upload-DlrdHvh1.js";import"./rc-progress-BVn0ZmF4.js";import"./rc-dropdown-D4AwxsUk.js";import"./rc-menu-MHhKtfoG.js";import"./rc-field-form-CVOtFEQA.js";import"./scroll-into-view-if-needed-BZeNfFF0.js";import"./compute-scroll-into-view-DWa9QgjM.js";import"./rc-picker-D0kXf0IF.js";import"./rc-tabs-XmQY-w_1.js";function R({selectedSupplier:o,onAddChemical:h}){const[u,l]=n.useState(""),[m,t]=n.useState(""),[d,p]=n.useState(null),[c,s]=n.useState([]),[g,f]=n.useState(!1),x=async a=>{if(a){f(!0);try{const r=await P.get(`/api/chemical/getChemicalByCategoryAndAlphabet?alphabet=${a}`);s(r.data)}catch(r){console.error("Error fetching chemicals:",r),s([])}finally{f(!1)}}},y=a=>{const r=a.target.value;l(r),r.trim()?(t(r),x(r.charAt(0))):(t(""),s([]))},[C,{isLoading:i}]=w(),S=a=>{p(a),l(a.name),t("")},j=async()=>{if(!d||!o){console.error("No chemical or supplier selected");return}try{const a=d._id,r=o._id;await C({supplierId:r,chemical_ids:[a]}).unwrap(),p(null),l(""),h&&h()}catch(a){alert(`Failed to add chemical: ${a.message||"Unknown error occurred"}`)}};return e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(N,{placeholder:"Search Chemical",value:u,onChange:y,className:"w-full mb-4",disabled:!o}),g&&e.jsx("div",{className:"absolute top-2 right-4 text-sm text-gray-500",children:"Loading..."})]}),m&&(c==null?void 0:c.length)>0&&e.jsx("ul",{className:"border bg-white rounded max-h-40 overflow-y-auto",children:c.map(a=>e.jsx("li",{onClick:()=>S(a),className:"p-2 hover:bg-gray-200 cursor-pointer border-b last:border-b-0",children:a.name},a._id))}),(c==null?void 0:c.length)===0&&!g&&m&&e.jsx("div",{className:"p-2 text-gray-500",children:"No chemicals found"}),e.jsx(I,{onClick:j,disabled:i||!d||!o,className:`mt-4 w-fit py-2 bg-blue-500 text-white rounded hover:bg-blue-600 ${i?"opacity-50 cursor-not-allowed":""}`,children:i?"Adding...":"Add Chemical"})]})}function D({chemicals:o,refetch:h,supplierId:u,onRemoveChemical:l}){const[m,t]=n.useState(1),[d,p]=n.useState(10),[c]=A(),[s,g]=n.useState(null),[f,x]=n.useState(!1),y=r=>{g(r),x(!0)},C=async()=>{if(!(!u||!s))try{await c({supplierId:u,chemicalId:s._id}),l(s),h(),x(!1),g(null),j.length===1&&m>1&&t(1)}catch(r){console.error("Error removing chemical:",r)}};Math.ceil(o.length/d);const i=(m-1)*d,S=i+d,j=o.slice(i,S),a=[{title:"Action",dataIndex:"action",render:(r,b)=>e.jsx(F,{danger:!0,size:"small",onClick:()=>y(b),children:"Delete"})},{title:"Chemical Name",dataIndex:"name"},{title:"CAS Number",dataIndex:"cas_number"}];return e.jsxs("div",{className:"border rounded-md mt-4 p-4",children:[e.jsx(B,{dataSource:j,columns:a,rowKey:"_id",pagination:!1}),e.jsx(M,{current:m,total:o.length,pageSize:d,onChange:r=>t(r),showSizeChanger:!0,onShowSizeChange:(r,b)=>p(b),className:"mt-4 float-end pt-5"}),e.jsx(L,{title:"Confirm Deletion",open:f,onCancel:()=>x(!1),onOk:C,okText:"Delete",okButtonProps:{danger:!0},children:e.jsxs("p",{children:['Are you sure you want to delete "',s==null?void 0:s.name,'"?']})})]})}function E({onSelectSupplier:o}){const[h,u]=n.useState(""),[l,m]=n.useState(""),[t,d]=n.useState(null),{data:p,isLoading:c}=_(l.charAt(0),{skip:l.length===0}),{data:s,refetch:g,isFetching:f}=k(t==null?void 0:t._id,{skip:!t});n.useEffect(()=>{s&&!f&&(d(s),typeof o=="function"&&o(s))},[s,f,o]);const x=i=>{d(i),u(i.name),m(""),typeof o=="function"&&o(i)},y=i=>{const S=i.target.value;u(S),m(S)},C=()=>{g()};return e.jsxs("div",{className:"mt-4",children:[e.jsx(N,{placeholder:"Search Supplier",value:h,onChange:y,className:"w-full mb-4"}),c?e.jsx("div",{children:"Loading..."}):l&&p&&p.length>0&&e.jsx("ul",{className:"border bg-white rounded max-h-40 overflow-y-auto",children:p.map(i=>e.jsx("li",{onClick:()=>x(i),className:"p-2 hover:bg-gray-200 cursor-pointer",children:i.name},i.id))}),(p==null?void 0:p.length)===0&&!c&&l&&e.jsx("div",{className:"p-2 text-gray-500",children:"No Supplier found"}),f&&e.jsx("div",{className:"p-2 text-gray-500",children:"Refreshing supplier data..."}),e.jsx(R,{selectedSupplier:t,onAddChemical:C}),e.jsx("div",{className:"mt-4",children:e.jsx(D,{chemicals:(t==null?void 0:t.chemical_ids)||[],refetch:g,onRemoveChemical:C,supplierId:t==null?void 0:t._id})})]})}function Ze(){const[o,h]=v.useState(null),[u,l]=v.useState([]),m=t=>{h(t),l([])};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-purple-700",children:"Assign Chemicals to Supplier"}),e.jsx("div",{className:"space-y-4",children:e.jsx(E,{onSelectCustomer:m})})]})}export{Ze as default};
