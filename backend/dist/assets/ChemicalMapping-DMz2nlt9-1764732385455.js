import{r as o,an as w,j as e,I as N,B as I,c as A,as as _,b4 as k,b5 as M,b6 as P,R as v}from"./index-2kbH1bBb-1764732385455.js";import{F as B,P as L}from"./Table-CXa6pF8F-1764732385455.js";import{M as R}from"./index-Ds4_l4Fv-1764732385455.js";import"./addEventListener-BTA357JE-1764732385455.js";import"./index-BZgmf3ak-1764732385455.js";import"./TextArea-BKy-nqO8-1764732385455.js";import"./CheckOutlined-6aSt04rk-1764732385455.js";import"./index-g1DPuVnD-1764732385455.js";import"./index-BkTORYxx-1764732385455.js";import"./useForceUpdate-CWyNYTn2-1764732385455.js";import"./index-CDypFe6E-1764732385455.js";import"./ActionButton-CR2XpLJz-1764732385455.js";import"./index-8HW-l2LE-1764732385455.js";import"./fade-D_zzDYw_-1764732385455.js";import"./Skeleton-BCFltOJl-1764732385455.js";function F({selectedSupplier:r,onAddChemical:u}){const[p,l]=o.useState(""),[d,t]=o.useState(""),[h,m]=o.useState(null),[c,i]=o.useState([]),[g,f]=o.useState(!1),x=async s=>{if(s){f(!0);try{const a=await A.get(`/api/chemical/getChemicalByCategoryAndAlphabet?alphabet=${s}`);i(a.data)}catch(a){console.error("Error fetching chemicals:",a),i([])}finally{f(!1)}}},y=s=>{const a=s.target.value;l(a),a.trim()?(t(a),x(a.charAt(0))):(t(""),i([]))},[C,{isLoading:n}]=w(),S=s=>{m(s),l(s.name),t("")},b=async()=>{if(!h||!r){console.error("No chemical or supplier selected");return}try{const s=h._id,a=r._id;await C({supplierId:a,chemical_ids:[s]}).unwrap(),m(null),l(""),u&&u()}catch(s){alert(`Failed to add chemical: ${s.message||"Unknown error occurred"}`)}};return e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(N,{placeholder:"Search Chemical",value:p,onChange:y,className:"w-full mb-4",disabled:!r}),g&&e.jsx("div",{className:"absolute top-2 right-4 text-sm text-gray-500",children:"Loading..."})]}),d&&(c==null?void 0:c.length)>0&&e.jsx("ul",{className:"border bg-white rounded max-h-40 overflow-y-auto",children:c.map(s=>e.jsx("li",{onClick:()=>S(s),className:"p-2 hover:bg-gray-200 cursor-pointer border-b last:border-b-0",children:s.name},s._id))}),(c==null?void 0:c.length)===0&&!g&&d&&e.jsx("div",{className:"p-2 text-gray-500",children:"No chemicals found"}),e.jsx(I,{onClick:b,disabled:n||!h||!r,className:`mt-4 w-fit py-2 bg-blue-500 text-white rounded hover:bg-blue-600 ${n?"opacity-50 cursor-not-allowed":""}`,children:n?"Adding...":"Add Chemical"})]})}function D({chemicals:r,refetch:u,supplierId:p,onRemoveChemical:l}){const[d,t]=o.useState(1),[h,m]=o.useState(10),[c]=_(),[i,g]=o.useState(null),[f,x]=o.useState(!1),y=a=>{g(a),x(!0)},C=async()=>{if(!(!p||!i))try{await c({supplierId:p,chemicalId:i._id}),l(i),u(),x(!1),g(null),b.length===1&&d>1&&t(1)}catch(a){console.error("Error removing chemical:",a)}};Math.ceil(r.length/h);const n=(d-1)*h,S=n+h,b=r.slice(n,S),s=[{title:"Action",dataIndex:"action",render:(a,j)=>e.jsx(k,{danger:!0,size:"small",onClick:()=>y(j),children:"Delete"})},{title:"Chemical Name",dataIndex:"name"},{title:"CAS Number",dataIndex:"cas_number"}];return e.jsxs("div",{className:"border rounded-md mt-4 p-4",children:[e.jsx(B,{dataSource:b,columns:s,rowKey:"_id",pagination:!1}),e.jsx(L,{current:d,total:r.length,pageSize:h,onChange:a=>t(a),showSizeChanger:!0,onShowSizeChange:(a,j)=>m(j),className:"mt-4 float-end pt-5"}),e.jsx(R,{title:"Confirm Deletion",open:f,onCancel:()=>x(!1),onOk:C,okText:"Delete",okButtonProps:{danger:!0},children:e.jsxs("p",{children:['Are you sure you want to delete "',i==null?void 0:i.name,'"?']})})]})}function E({onSelectSupplier:r}){const[u,p]=o.useState(""),[l,d]=o.useState(""),[t,h]=o.useState(null),{data:m,isLoading:c}=M(l.charAt(0),{skip:l.length===0}),{data:i,refetch:g,isFetching:f}=P(t==null?void 0:t._id,{skip:!t});o.useEffect(()=>{i&&!f&&(h(i),typeof r=="function"&&r(i))},[i,f,r]);const x=n=>{h(n),p(n.name),d(""),typeof r=="function"&&r(n)},y=n=>{const S=n.target.value;p(S),d(S)},C=()=>{g()};return e.jsxs("div",{className:"mt-4",children:[e.jsx(N,{placeholder:"Search Supplier",value:u,onChange:y,className:"w-full mb-4"}),c?e.jsx("div",{children:"Loading..."}):l&&m&&m.length>0&&e.jsx("ul",{className:"border bg-white rounded max-h-40 overflow-y-auto",children:m.map(n=>e.jsx("li",{onClick:()=>x(n),className:"p-2 hover:bg-gray-200 cursor-pointer",children:n.name},n.id))}),(m==null?void 0:m.length)===0&&!c&&l&&e.jsx("div",{className:"p-2 text-gray-500",children:"No Supplier found"}),f&&e.jsx("div",{className:"p-2 text-gray-500",children:"Refreshing supplier data..."}),e.jsx(F,{selectedSupplier:t,onAddChemical:C}),e.jsx("div",{className:"mt-4",children:e.jsx(D,{chemicals:(t==null?void 0:t.chemical_ids)||[],refetch:g,onRemoveChemical:C,supplierId:t==null?void 0:t._id})})]})}function Z(){const[r,u]=v.useState(null),[p,l]=v.useState([]),d=t=>{u(t),l([])};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-purple-700",children:"Assign Chemicals to Supplier"}),e.jsx("div",{className:"space-y-4",children:e.jsx(E,{onSelectCustomer:d})})]})}export{Z as default};
