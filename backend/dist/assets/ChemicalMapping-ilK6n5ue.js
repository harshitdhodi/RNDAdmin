import{p as w,j as e,I as N,B as I,b as A,t as _,a6 as k,a7 as B}from"./main-B_OYodTY.js";import{c as n,R as v}from"./vendor-CxfDVdnA.js";import{F as M,P}from"./Table-iSV2HsTa.js";import{M as L}from"./index-BF9-4VX_.js";import{B as R}from"./index-BYtgbzGG.js";import"./toArray-Bbgf03cS.js";import"./addEventListener-9okJYLam.js";import"./index-BPgn9bJi.js";import"./EllipsisOutlined-6allWJRk.js";import"./dropdown-ttkTMcA6.js";import"./TextArea-DlzOlFOd.js";import"./CheckOutlined-B2I8pZ-f.js";import"./index-CRTB1A7p.js";import"./index-Br7MFb4i.js";import"./useForceUpdate-Ur6SoUHK.js";import"./index-Df6TdCDZ.js";import"./CheckCircleFilled-CljqfpQt.js";import"./ExclamationCircleFilled-Be2YqnNu.js";import"./InfoCircleFilled-Dj_rmDLl.js";import"./ActionButton-CzvVJ5_l.js";import"./index-BrYfVdm7.js";import"./fade-CVKMVZ78.js";import"./Skeleton-Bvzsay45.js";function F({selectedSupplier:r,onAddChemical:h}){const[u,c]=n.useState(""),[o,i]=n.useState(""),[d,m]=n.useState(null),[p,l]=n.useState([]),[g,f]=n.useState(!1),x=async a=>{if(a){f(!0);try{const t=await A.get(`/api/chemical/getChemicalByCategoryAndAlphabet?alphabet=${a}`);l(t.data)}catch(t){console.error("Error fetching chemicals:",t),l([])}finally{f(!1)}}},y=a=>{const t=a.target.value;c(t),t.trim()?(i(t),x(t.charAt(0))):(i(""),l([]))},[S,{isLoading:s}]=w(),C=a=>{m(a),c(a.name),i("")},j=async()=>{if(!d||!r){console.error("No chemical or supplier selected");return}try{const a=d._id,t=r._id;await S({supplierId:t,chemical_ids:[a]}).unwrap(),m(null),c(""),h&&h()}catch(a){alert(`Failed to add chemical: ${a.message||"Unknown error occurred"}`)}};return e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(N,{placeholder:"Search Chemical",value:u,onChange:y,className:"w-full mb-4",disabled:!r}),g&&e.jsx("div",{className:"absolute top-2 right-4 text-sm text-gray-500",children:"Loading..."})]}),o&&p?.length>0&&e.jsx("ul",{className:"border bg-white rounded max-h-40 overflow-y-auto",children:p.map(a=>e.jsx("li",{onClick:()=>C(a),className:"p-2 hover:bg-gray-200 cursor-pointer border-b last:border-b-0",children:a.name},a._id))}),p?.length===0&&!g&&o&&e.jsx("div",{className:"p-2 text-gray-500",children:"No chemicals found"}),e.jsx(I,{onClick:j,disabled:s||!d||!r,className:`mt-4 w-fit py-2 bg-blue-500 text-white rounded hover:bg-blue-600 ${s?"opacity-50 cursor-not-allowed":""}`,children:s?"Adding...":"Add Chemical"})]})}function D({chemicals:r,refetch:h,supplierId:u,onRemoveChemical:c}){const[o,i]=n.useState(1),[d,m]=n.useState(10),[p]=_(),[l,g]=n.useState(null),[f,x]=n.useState(!1),y=t=>{g(t),x(!0)},S=async()=>{if(!(!u||!l))try{await p({supplierId:u,chemicalId:l._id}),c(l),h(),x(!1),g(null),j.length===1&&o>1&&i(1)}catch(t){console.error("Error removing chemical:",t)}};Math.ceil(r.length/d);const s=(o-1)*d,C=s+d,j=r.slice(s,C),a=[{title:"Action",dataIndex:"action",render:(t,b)=>e.jsx(R,{danger:!0,size:"small",onClick:()=>y(b),children:"Delete"})},{title:"Chemical Name",dataIndex:"name"},{title:"CAS Number",dataIndex:"cas_number"}];return e.jsxs("div",{className:"border rounded-md mt-4 p-4",children:[e.jsx(M,{dataSource:j,columns:a,rowKey:"_id",pagination:!1}),e.jsx(P,{current:o,total:r.length,pageSize:d,onChange:t=>i(t),showSizeChanger:!0,onShowSizeChange:(t,b)=>m(b),className:"mt-4 float-end pt-5"}),e.jsx(L,{title:"Confirm Deletion",open:f,onCancel:()=>x(!1),onOk:S,okText:"Delete",okButtonProps:{danger:!0},children:e.jsxs("p",{children:['Are you sure you want to delete "',l?.name,'"?']})})]})}function E({onSelectSupplier:r}){const[h,u]=n.useState(""),[c,o]=n.useState(""),[i,d]=n.useState(null),{data:m,isLoading:p}=k(c.charAt(0),{skip:c.length===0}),{data:l,refetch:g,isFetching:f}=B(i?._id,{skip:!i});n.useEffect(()=>{l&&!f&&(d(l),typeof r=="function"&&r(l))},[l,f,r]);const x=s=>{d(s),u(s.name),o(""),typeof r=="function"&&r(s)},y=s=>{const C=s.target.value;u(C),o(C)},S=()=>{g()};return e.jsxs("div",{className:"mt-4",children:[e.jsx(N,{placeholder:"Search Supplier",value:h,onChange:y,className:"w-full mb-4"}),p?e.jsx("div",{children:"Loading..."}):c&&m&&m.length>0&&e.jsx("ul",{className:"border bg-white rounded max-h-40 overflow-y-auto",children:m.map(s=>e.jsx("li",{onClick:()=>x(s),className:"p-2 hover:bg-gray-200 cursor-pointer",children:s.name},s.id))}),m?.length===0&&!p&&c&&e.jsx("div",{className:"p-2 text-gray-500",children:"No Supplier found"}),f&&e.jsx("div",{className:"p-2 text-gray-500",children:"Refreshing supplier data..."}),e.jsx(F,{selectedSupplier:i,onAddChemical:S}),e.jsx("div",{className:"mt-4",children:e.jsx(D,{chemicals:i?.chemical_ids||[],refetch:g,onRemoveChemical:S,supplierId:i?._id})})]})}function ne(){const[r,h]=v.useState(null),[u,c]=v.useState([]),o=i=>{h(i),c([])};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-purple-700",children:"Assign Chemicals to Supplier"}),e.jsx("div",{className:"space-y-4",children:e.jsx(E,{onSelectCustomer:o})})]})}export{ne as default};
