import{ae as Le,r as a,af as Te,j as e,ag as G,ah as Fe,B as C,ai as ke,aj as H,ak as te,al as re,I as U,am as De,an as Ee,ao as Me,ap as ie,aq as _e,ar as ne,as as Pe,at as Y,au as ce,av as Ie,aw as Be,ax as $e,ay as Re,az as ze,aA as Oe,f as Qe,c as ae,L as Ge,aB as He,aC as Ue}from"./index-2kbH1bBb-1764732385455.js";import{T as J,a as W,b as L,c as n,d as K,e as c}from"./table-DRpdyDSO-1764732385455.js";import{S as oe,a as de,b as he,c as me,d as _}from"./select-D0c-eU7j-1764732385455.js";import{D as Ve,a as qe,b as Ye,c as Q}from"./dropdown-menu-C_8HXjx9-1764732385455.js";import{C as ue}from"./checkbox-BfXksq0a-1764732385455.js";import"./textarea-BjZ0QaAB-1764732385455.js";import{S as z}from"./sweetalert2.esm.all-CIewtpap-1764732385455.js";import{A as Je,a as We,b as Ke,c as Xe,d as Ze,e as es,f as ss,g as as}from"./alert-dialog-BEYA5QPz-1764732385455.js";import{P as xe}from"./plus-Co79WuO4-1764732385455.js";import{C as ls}from"./circle-plus-eaptdlAN-1764732385455.js";import{E as ts}from"./ellipsis-vertical-C5tVG7sw-1764732385455.js";import"./Combination-Dnkj1Sd1-1764732385455.js";import"./index-Dz_4HeFl-1764732385455.js";import"./check-DDxB_Ky9-1764732385455.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=Le("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),je=({selectedSupplier:D,supplier:h,email:f,name:j,type:m,chemicalName:N})=>{var w,A;console.log("Type:",m),console.log("Supplier Array:",h),console.log("Supplier Email:",(w=h[0])==null?void 0:w.email),console.log("Condition Check:",m==="Customer",h.length>0);const[r,x]=a.useState(""),[b,y]=a.useState(""),[p,F]=a.useState(!1),[g,T]=a.useState(null),{data:u,isLoading:E,error:v}=Te(),t=(u==null?void 0:u.data)||[],o=m==="Customer"&&Array.isArray(h)&&((A=h[0])!=null&&A.email)?h[0].email:f;console.log("Recipient Email:",o),a.useEffect(()=>{console.log("Supplier updated:",h)},[h]);const k=async()=>{try{F(!0);const d={subject:b,message:r,recipients:Array.isArray(o)?o:[o],chemicalNames:Array.isArray(N)?N:[N]},l=await fetch("/api/chemicalMail/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}),S=await l.json();if(!l.ok)throw new Error(S.message||"Failed to send email");alert("Email sent successfully!"),x(""),y("")}catch(d){console.log("Error sending email:",d),alert("Failed to send email: "+d.message)}finally{F(!1)}},M=d=>{const l=t.find(S=>S._id===d);T(l),x((l==null?void 0:l.body)||""),y((l==null?void 0:l.subject)||"")};return e.jsx("div",{children:e.jsxs(G,{children:[e.jsx(Fe,{asChild:!0,children:e.jsxs(C,{variant:"secondary",children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"Send Email (",D.length,")"]})}),e.jsxs(H,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[e.jsx(te,{children:e.jsx(re,{children:"Send Email to Selected Suppliers"})}),e.jsxs("div",{className:"grid gap-4 ",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2 text-sm font-medium",children:"Selected Suppliers"}),e.jsx("div",{className:"p-2 border rounded-lg max-h-[100px] overflow-y-auto",children:o})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2 text-sm font-medium",children:"Selected Chemicals"}),e.jsx("div",{className:"p-2 border rounded-lg max-h-[100px] overflow-y-auto",children:e.jsx("div",{className:"text-sm py-1",children:N})})]})]}),e.jsxs(oe,{onValueChange:M,children:[e.jsx(de,{children:e.jsx(he,{placeholder:"Select email template"})}),e.jsx(me,{children:E?e.jsx(_,{value:"",disabled:!0,children:"Loading..."}):v?e.jsx(_,{value:"",disabled:!0,children:"Error loading templates"}):t.map(d=>e.jsx(_,{value:d._id,children:d.name},d._id))})]}),e.jsx(U,{placeholder:"Subject",value:b,onChange:d=>y(d.target.value)}),e.jsx("div",{className:"max-h-[300px] overflow-y-auto",children:e.jsx(De,{value:r,onChange:x,placeholder:"Write your message here...",theme:"snow",className:"bg-white rounded-lg"})}),e.jsx(C,{className:"bg-[#304a8a] hover:bg-purple-700",onClick:k,disabled:p,children:p?"Sending...":"Send Email"})]})]})]})})},X=({refetch:D,open:h,onClose:f,chemicalName:j,fetchChemicals:m,chemicalId:N,supplier:r,onAddSupplier:x=[]})=>{const[b,y]=a.useState(""),[p,F]=a.useState(null);a.useEffect(()=>{h&&(y(""),F(null))},[h]);const[g,{isLoading:T}]=r==="Supplier"?Ee():Me(),u=Array.isArray(x)?x.filter(t=>{var o;return(o=t.name)==null?void 0:o.toLowerCase().includes(b.toLowerCase())}):[],E=async()=>{if(!p){console.log("No supplier or customer selected");return}try{let t;r==="Supplier"?t=await g({chemical_ids:[j._id],supplierId:p._id}).unwrap():t=await g({chemicalId:[j._id],customerId:p._id}).unwrap(),console.log(`${r} ${p.name} added to ${j.name}`),await D(),m(),f()}catch(t){console.error(`Failed to add ${r.toLowerCase()}:`,t),alert(`Failed to add ${r.toLowerCase()}. Please try again.`)}},v=t=>{F(t),y(t.name)};return e.jsx(G,{open:h,onOpenChange:t=>!t&&f(),children:e.jsxs(H,{className:"max-w-lg p-6",children:[e.jsx(te,{children:e.jsxs(re,{className:"text-lg font-semibold text-[#304a8a]",children:["Add ",r," for ",j.name]})}),e.jsxs("div",{className:"mt-4",children:[e.jsx(U,{placeholder:`Search ${r}`,value:b,onChange:t=>y(t.target.value),className:"w-full mb-2"}),b&&!p&&e.jsx("div",{className:"bg-white border border-gray-300 rounded shadow max-h-40 overflow-y-auto",children:u.length>0?u.map(t=>e.jsx("div",{onClick:()=>v(t),className:"p-2 cursor-pointer hover:bg-gray-100",children:t.name},t.id)):e.jsxs("div",{className:"p-2 text-gray-500",children:["No matching ",r.toLowerCase(),"s"]})}),e.jsxs("div",{className:"flex justify-between mt-4",children:[e.jsx(C,{onClick:E,className:"bg-[#304a8a] hover:bg-purple-700",disabled:T||!p,children:T?"Adding...":"+ Add"}),e.jsx(C,{onClick:f,className:"bg-red-600 hover:bg-red-700",children:"Cancel"})]})]})]})})};function rs({chemicalName:D,supplier:h,fetchChemicals:f,chemicalId:j}){console.log(j);const[m,N]=a.useState([]),[r,x]=a.useState(!1),[b,y]=a.useState(""),[p,F]=a.useState(""),[g,T]=a.useState(""),[u,E]=a.useState(""),[v,t]=a.useState(null),{selectedItem:o}=a.useContext(ie),{data:k=[],isLoading:M,error:w,refetch:A}=_e(j),{data:d}=ne(),[l,{isLoading:S}]=Pe(),B=k.filter(i=>i.name.toLowerCase().includes(b.toLowerCase())&&i.email.toLowerCase().includes(p.toLowerCase())&&i.mobile.toLowerCase().includes(g.toLowerCase())&&i.country.toLowerCase().includes(u.toLowerCase())),Z=i=>{N(O=>O.includes(i)?O.filter(q=>q!==i):[...O,i])},ee=i=>{t(i)},V=async()=>{if(v)try{await l({supplierId:v,chemicalId:j}).unwrap(),A()}catch(i){console.error("Failed to delete chemical:",i),alert("Failed to delete chemical")}t(null)};return e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h1",{className:"text-xl font-semibold text-[#304a8a]",children:[h," for ",(o==null?void 0:o.name)||"Chemical"]}),e.jsxs(C,{className:"bg-[#304a8a] hover:bg-purple-700",onClick:()=>x(!0),children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Add Supplier"]}),D&&e.jsx(X,{open:r,onClose:()=>x(!1),chemicalName:o||"Unknown Chemical",supplier:"Supplier",onAddSupplier:d,chemicalId:j,refetch:A,fetchChemicals:f})]}),m.length>0&&e.jsx("div",{className:"p-4 border-b",children:e.jsx(je,{selectedSupplier:m,supplier:k,email:k.filter(i=>m.includes(i._id)).map(i=>i.email).join(", "),name:k.filter(i=>m.includes(i._id)).map(i=>i.name).join(", "),chemicalName:o==null?void 0:o.name})}),e.jsxs(J,{children:[e.jsx(W,{children:e.jsxs(L,{children:[e.jsx(n,{className:"w-12"}),e.jsx(n,{children:"Name"}),e.jsx(n,{children:"Email"}),e.jsx(n,{children:"Mobile"}),e.jsx(n,{children:"Action"})]})}),e.jsxs(K,{children:[M&&e.jsx(L,{children:e.jsx(c,{colSpan:6,className:"text-center py-8",children:"Loading suppliers..."})}),w&&e.jsx(L,{children:e.jsx(c,{colSpan:6,className:"text-center py-8 text-red-500/60",children:"No suppliers available."})}),!M&&!w&&B.map(i=>e.jsxs(L,{children:[e.jsx(c,{children:e.jsx(ue,{checked:m.includes(i._id),onCheckedChange:()=>Z(i._id)})}),e.jsx(c,{children:i.name}),e.jsx(c,{children:i.email}),e.jsx(c,{children:i.mobile}),e.jsx(c,{children:e.jsx(C,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-600",onClick:()=>ee(i._id),disabled:S,children:e.jsx(Y,{className:"w-4 h-4"})})})]},i._id))]})]}),e.jsx(Je,{open:!!v,onOpenChange:()=>t(null),children:e.jsxs(We,{children:[e.jsxs(Ke,{children:[e.jsx(Xe,{children:"Are you sure?"}),e.jsx(Ze,{children:"This action cannot be undone. This will permanently delete the supplier from this chemical."})]}),e.jsxs(es,{children:[e.jsx(ss,{children:"Cancel"}),e.jsx(as,{onClick:V,children:"Delete"})]})]})})]})}function is({chemicalName:D,supplier:h}){const[f,j]=a.useState([]),{selectedItem:m}=a.useContext(ie),[N,r]=a.useState(!1),[x,b]=a.useState(""),[y,p]=a.useState(""),[F,g]=a.useState(""),[T,u]=a.useState(""),{data:E=[]}=ce(),{data:v=[],isLoading:t,error:o,refetch:k}=Ie(m._id),[M]=Be(),w=v.filter(l=>l.name.toLowerCase().includes(x.toLowerCase())&&l.email.toLowerCase().includes(y.toLowerCase())&&l.mobile.toLowerCase().includes(F.toLowerCase())&&l.country.toLowerCase().includes(T.toLowerCase())),A=l=>{j(S=>S.includes(l)?S.filter(B=>B!==l):[...S,l])};console.log(f);const d=async l=>{try{await M({customerId:l,chemicalId:m._id})}catch(S){console.error("Failed to remove customer:",S)}};return e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h1",{className:"text-xl font-semibold text-[#304a8a]",children:[h," for ",m.name]}),e.jsxs(C,{className:"bg-[#304a8a] hover:bg-purple-700",onClick:()=>r(!0),children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Add Customer"]})]}),e.jsx(X,{open:N,onClose:()=>r(!1),chemicalName:m,supplier:"Customer",onAddSupplier:E,refetch:k}),f.length>0&&e.jsx("div",{className:"p-4 border-b",children:e.jsx(je,{selectedSupplier:f,supplier:v,chemicalName:D.name,type:h})}),e.jsxs("div",{className:"border rounded-lg",children:[e.jsxs(J,{children:[e.jsx(W,{children:e.jsxs(L,{children:[e.jsx(n,{className:"w-12"}),e.jsx(n,{children:"Name"}),e.jsx(n,{children:"Email"}),e.jsx(n,{children:"Mobile"}),e.jsx(n,{children:"Country"}),e.jsx(n,{children:"Action"})]})}),e.jsxs(K,{children:[t&&e.jsx(L,{children:e.jsx(c,{colSpan:6,className:"text-center py-8",children:"Loading customers..."})}),o&&e.jsx(L,{children:e.jsx(c,{colSpan:6,className:"text-center py-8 text-red-500",children:"Error loading customers."})}),!t&&!o&&w.length===0&&e.jsx(L,{children:e.jsx(c,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No Data Found"})}),!t&&!o&&w.map(l=>e.jsxs(L,{children:[e.jsx(c,{children:e.jsx(ue,{checked:f.includes(l.id),onCheckedChange:()=>A(l.id)})}),e.jsx(c,{children:l.name}),e.jsx(c,{children:l.email}),e.jsx(c,{children:l.mobile}),e.jsx(c,{children:l.country}),e.jsx(c,{children:e.jsx(C,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-600",onClick:()=>d(l._id),children:e.jsx(Y,{className:"w-4 h-4"})})})]},l.id))]})]}),e.jsxs("div",{className:"flex items-center justify-between border-t p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{children:"Items per page: 10"}),e.jsxs("span",{children:["1 - ",w.length," of ",w.length]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{variant:"outline",size:"icon",disabled:!0,children:e.jsx($e,{className:"w-4 h-4"})}),e.jsx(C,{variant:"outline",size:"icon",disabled:!0,children:e.jsx(Re,{className:"w-4 h-4"})})]})]})]})]})}function ws(){const{selectedChemicalName:D,setChemicalName:h}=ze(),[f,j]=a.useState(!1),[m,N]=a.useState(!1),[r,x]=a.useState(null),[b,y]=a.useState(""),[p,F]=a.useState(""),[g,T]=a.useState(1),[u,E]=a.useState(20),[v,t]=a.useState(!1),[o,k]=a.useState(null),[M,w]=a.useState(!1),[A,d]=a.useState(null),[l,S]=a.useState([]),{data:B=[],isLoading:Z,error:ee}=ne(),{data:V=[],isLoading2:i,error2:O}=ce();Oe(r==null?void 0:r._id);const q=Qe(),[pe,se]=a.useState(0);a.useEffect(()=>{P()},[pe]);const P=async()=>{try{const s=await ae.get("/api/chemical/get");S(s.data)}catch(s){console.error("Error fetching chemicals:",s)}},$=l.filter(s=>{const I=s.name||"",R=s.casNumber||"";return I.toLowerCase().includes(b.toLowerCase())&&R.includes(p)}),ge=$.slice((g-1)*u,g*u),Ce=()=>{g*u<$.length&&T(s=>s+1)},fe=()=>{g>1&&T(s=>s-1)},Se=s=>{E(Number(s)),T(1)},we=s=>{console.log("Edit",s),q(`/edit-chemical-form/${s._id}`)},Ne=s=>{x(s),t(!0),d("supplier")},be=s=>{x(s),w(!0),d("customer")},ye=async s=>{try{if((await z.fire({title:"Are you sure?",text:"This action cannot be undone!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed){const R=await ae.delete(`/api/chemical/delete?id=${s._id}`);if(R.data.success||R.data.message==="Chemical deleted successfully")S(ve=>ve.filter(Ae=>Ae._id!==s._id)),await P(),await z.fire({title:"Deleted!",text:"The chemical has been deleted.",icon:"success",timer:2e3,showConfirmButton:!1});else throw new Error(R.data.message||"Failed to delete the chemical")}else z.fire({title:"Cancelled",text:"Your chemical is safe!",icon:"info",timer:1500,showConfirmButton:!1})}catch(I){console.error("Error deleting chemical:",I),I.message==="Chemical deleted successfully"?z.fire({title:"Deleted!",text:"The chemical has been deleted.",icon:"success",timer:2e3,showConfirmButton:!1}):z.fire({title:"Error!",text:I.message||"An error occurred while deleting the chemical.",icon:"error",confirmButtonText:"Ok"})}};return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-5",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-lg font-bold text-[#304a8a]",children:"Chemical List"})}),e.jsx("div",{children:e.jsx(Ge,{to:"/chemical-form",children:e.jsxs(C,{className:"bg-[#304a8a] hover:bg-[#2a1664]",children:[e.jsx(ls,{})," Add Chemical"]})})})]}),e.jsx("div",{className:"mb-5",children:e.jsx("hr",{})}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(J,{children:[e.jsxs(W,{children:[e.jsxs(L,{children:[e.jsx(n,{className:"w-[50px]"}),e.jsx(n,{children:"Name"}),e.jsx(n,{children:"CAS Number"}),e.jsx(n,{children:"Molecular Formula"}),e.jsx(n,{children:"Suppliers"}),e.jsx(n,{children:"Customers"}),e.jsx(n,{children:"Unit Name"})]}),e.jsxs(L,{children:[e.jsx(n,{className:"w-[50px]"}),e.jsx(n,{children:e.jsx(U,{placeholder:"Filter by Name",value:b,onChange:s=>y(s.target.value)})}),e.jsx(n,{children:e.jsx(U,{placeholder:"Filter by CAS Number",value:p,onChange:s=>F(s.target.value)})}),e.jsx(n,{}),e.jsx(n,{}),e.jsx(n,{}),e.jsx(n,{})]})]}),e.jsx(K,{children:ge.map(s=>e.jsxs(L,{children:[e.jsx(c,{children:e.jsxs(Ve,{children:[e.jsx(qe,{asChild:!0,children:e.jsx("button",{className:"p-3",children:e.jsx(ts,{className:"h-4 w-4"})})}),e.jsxs(Ye,{children:[e.jsxs(Q,{onClick:()=>we(s),children:[e.jsx(He,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(Q,{onClick:()=>Ne(s),children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Add Supplier"]}),e.jsxs(Q,{onClick:()=>be(s),children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Add Customer"]}),e.jsxs(Q,{onClick:()=>ye(s),children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})}),e.jsx(c,{children:s.name}),e.jsx(c,{children:s.cas_number}),e.jsx(c,{children:s.molecular_formula}),e.jsx(c,{children:e.jsxs(C,{variant:"default",className:"bg-[#304a8a] hover:bg-[#304a8a]",onClick:()=>{x(s),j(!0)},children:["Suppliers (",s.supplierCount,")"]})}),e.jsx(c,{children:e.jsxs(C,{variant:"default",className:"bg-[#304a8a] hover:bg-[#304a8a]",onClick:()=>{x(s),N(!0)},children:["Customers(",s.customerCount,")"]})}),e.jsx(c,{children:s.unit})]},s.id))}),r&&e.jsx(X,{open:A==="supplier"?v:M,onClose:()=>{A==="supplier"?t(!1):w(!1),d(null),se(s=>s+1),P()},chemicalName:r.name,supplier:A==="supplier"?"Supplier":"Customer",onAddSupplier:A==="supplier"?B:V,chemicalId:r._id,fetchChemicals:P})]})}),e.jsxs("div",{className:"flex items-center justify-between space-x-2 py-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Items per page:"}),e.jsxs(oe,{defaultValue:u.toString(),onValueChange:Se,children:[e.jsx(de,{className:"w-[70px]",children:e.jsx(he,{placeholder:u.toString()})}),e.jsxs(me,{children:[e.jsx(_,{value:"10",children:"10"}),e.jsx(_,{value:"20",children:"20"}),e.jsx(_,{value:"30",children:"30"}),e.jsx(_,{value:"40",children:"40"}),e.jsx(_,{value:"50",children:"50"})]})]}),e.jsx("div",{className:"text-sm font-medium",children:`${(g-1)*u+1} - ${Math.min(g*u,$.length)} of ${$.length}`})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{variant:"outline",size:"icon",onClick:fe,disabled:g===1,children:"<"}),e.jsx(C,{variant:"outline",size:"icon",onClick:Ce,disabled:g*u>=$.length,children:">"})]})]}),e.jsx(Ue,{selectedItem:r,children:r&&e.jsxs(e.Fragment,{children:[e.jsx(G,{open:f,onOpenChange:j,children:e.jsx(H,{className:"max-w-6xl",children:e.jsx(rs,{chemicalName:r,chemicalId:r._id,supplier:"Supplier",fetchChemicals:P})})}),e.jsx(G,{open:m,onOpenChange:N,children:e.jsx(H,{className:"max-w-6xl",children:e.jsx(is,{selectedItems:r,supplier:"Customer",chemicalName:r,chemicalId:r._id,onUpdate:()=>{P(),se(s=>s+1)}})})})]})})]})}export{ws as default};
