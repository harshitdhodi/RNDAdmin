import{r as e,j as s}from"./react-BfBsRgn0.js";import{T as a,a as l,b as i,c as r,d as t,e as c}from"./table-C5KT2_Ve.js";import{g as n,D as d,h as o,B as m,i as h,j as x,k as u,I as j,l as p,m as f,C as g,n as b,o as N,p as v,q as C,r as w,s as S,t as y,v as L,w as k}from"./index-mCSb4W1J.js";import{S as A,a as _,b as I,c as E,d as F}from"./select-BjvvJv_x.js";import{D as T,a as B,b as $,c as z}from"./dropdown-menu-BSEIa4ap.js";import{C as D}from"./checkbox-B-Aja2U0.js";import{S as O}from"./sweetalert2-R4CIEh_k.js";import{R as M}from"./react-quill-O9LY_HeH.js";import{i as q,h as U,j as V,k as Y,l as P,m as W,E as J,e as R,n as Z}from"./lucide-D6BDVLHE.js";import{A as G,a as H,b as K,c as Q,d as X,e as ee,f as se,g as ae}from"./alert-dialog-CsAXk-6Q.js";import{a as le}from"./axios-BoylL8Pu.js";import{a as ie,L as re}from"./react-router-DUJjWq5j.js";import"./classnames-C3ovBj6j.js";import"./react-dom-DwrudmHt.js";import"./scheduler-BFk34ZWe.js";import"./react-redux-DbBiFgqA.js";import"./use-sync-external-store-DdeJV4gQ.js";import"./@reduxjs-UCSEaN3g.js";import"./redux-C5Huw2aR.js";import"./immer-DgfQkf_7.js";import"./redux-thunk-B3S1iNVp.js";import"./reselect-BSOs5pU1.js";import"./js-cookie-BXEMiIsG.js";import"./@radix-ui-BWjeGzol.js";import"./aria-hidden-BHUiN-rI.js";import"./react-remove-scroll-yauc81_r.js";import"./tslib-Bc9CN1Ef.js";import"./react-remove-scroll-bar-BcxDecei.js";import"./react-style-singleton-C1QVuB2c.js";import"./get-nonce-BYiZHLe3.js";import"./use-sidecar-BA4C4RS7.js";import"./use-callback-ref-Cvx1xcTX.js";import"./@floating-ui-BSChQBl3.js";import"./class-variance-authority-DeOWI0hf.js";import"./clsx-BeLtu-UY.js";import"./tailwind-merge-D2VJQb_v.js";import"./cookie-BUTH-fPQ.js";import"./lodash-CtK3uT03.js";import"./quill-CMG--X-K.js";const te=({selectedSupplier:a,supplier:l,email:i,name:r,type:t,chemicalName:c})=>{var p;const[f,g]=e.useState(""),[b,N]=e.useState(""),[v,C]=e.useState(!1),[w,S]=e.useState(null),{data:y,isLoading:L,error:k}=n(),T=(null==y?void 0:y.data)||[],B="Customer"===t&&Array.isArray(l)&&(null==(p=l[0])?void 0:p.email)?l[0].email:i;e.useEffect((()=>{}),[l]);return s.jsx("div",{children:s.jsxs(d,{children:[s.jsx(o,{asChild:!0,children:s.jsxs(m,{variant:"secondary",children:[s.jsx(q,{className:"w-4 h-4 mr-2"}),"Send Email (",a.length,")"]})}),s.jsxs(h,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[s.jsx(x,{children:s.jsx(u,{children:"Send Email to Selected Suppliers"})}),s.jsxs("div",{className:"grid gap-4 ",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"mb-2 text-sm font-medium",children:"Selected Suppliers"}),s.jsx("div",{className:"p-2 border rounded-lg max-h-[100px] overflow-y-auto",children:B})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"mb-2 text-sm font-medium",children:"Selected Chemicals"}),s.jsx("div",{className:"p-2 border rounded-lg max-h-[100px] overflow-y-auto",children:s.jsx("div",{className:"text-sm py-1",children:c})})]})]}),s.jsxs(A,{onValueChange:e=>{const s=T.find((s=>s._id===e));S(s),g((null==s?void 0:s.body)||""),N((null==s?void 0:s.subject)||"")},children:[s.jsx(_,{children:s.jsx(I,{placeholder:"Select email template"})}),s.jsx(E,{children:L?s.jsx(F,{value:"",disabled:!0,children:"Loading..."}):k?s.jsx(F,{value:"",disabled:!0,children:"Error loading templates"}):T.map((e=>s.jsx(F,{value:e._id,children:e.name},e._id)))})]}),s.jsx(j,{placeholder:"Subject",value:b,onChange:e=>N(e.target.value)}),s.jsx("div",{className:"max-h-[300px] overflow-y-auto",children:s.jsx(M,{value:f,onChange:g,placeholder:"Write your message here...",theme:"snow",className:"bg-white rounded-lg"})}),s.jsx(m,{className:"bg-[#3b1f91] hover:bg-purple-700",onClick:async()=>{try{C(!0);const e={subject:b,message:f,recipients:Array.isArray(B)?B:[B],chemicalNames:Array.isArray(c)?c:[c]},s=await fetch("/api/chemicalMail/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await s.json();if(!s.ok)throw new Error(a.message||"Failed to send email");alert("Email sent successfully!"),g(""),N("")}catch(e){alert("Failed to send email: "+e.message)}finally{C(!1)}},disabled:v,children:v?"Sending...":"Send Email"})]})]})]})})},ce=({refetch:a,open:l,onClose:i,chemicalName:r,fetchChemicals:t,chemicalId:c,supplier:n,onAddSupplier:o=[]})=>{const[g,b]=e.useState(""),[N,v]=e.useState(null);e.useEffect((()=>{l&&(b(""),v(null))}),[l]);const[C,{isLoading:w}]="Supplier"===n?p():f(),S=Array.isArray(o)?o.filter((e=>{var s;return null==(s=e.name)?void 0:s.toLowerCase().includes(g.toLowerCase())})):[];return s.jsx(d,{open:l,onOpenChange:e=>!e&&i(),children:s.jsxs(h,{className:"max-w-lg p-6",children:[s.jsx(x,{children:s.jsxs(u,{className:"text-lg font-semibold text-[#3b1f91]",children:["Add ",n," for ",r.name]})}),s.jsxs("div",{className:"mt-4",children:[s.jsx(j,{placeholder:`Search ${n}`,value:g,onChange:e=>b(e.target.value),className:"w-full mb-2"}),g&&!N&&s.jsx("div",{className:"bg-white border border-gray-300 rounded shadow max-h-40 overflow-y-auto",children:S.length>0?S.map((e=>s.jsx("div",{onClick:()=>(e=>{v(e),b(e.name)})(e),className:"p-2 cursor-pointer hover:bg-gray-100",children:e.name},e.id))):s.jsxs("div",{className:"p-2 text-gray-500",children:["No matching ",n.toLowerCase(),"s"]})}),s.jsxs("div",{className:"flex justify-between mt-4",children:[s.jsx(m,{onClick:async()=>{if(N)try{let e;e="Supplier"===n?await C({chemical_ids:[r._id],supplierId:N._id}).unwrap():await C({chemicalId:[r._id],customerId:N._id}).unwrap(),await a(),t(),i()}catch(e){alert(`Failed to add ${n.toLowerCase()}. Please try again.`)}},className:"bg-[#3b1f91] hover:bg-purple-700",disabled:w||!N,children:w?"Adding...":"+ Add"}),s.jsx(m,{onClick:i,className:"bg-red-600 hover:bg-red-700",children:"Cancel"})]})]})]})})};function ne({chemicalName:n,supplier:d,fetchChemicals:o,chemicalId:h}){const[x,u]=e.useState([]),[j,p]=e.useState(!1),[f,C]=e.useState(""),[w,S]=e.useState(""),[y,L]=e.useState(""),[k,A]=e.useState(""),[_,I]=e.useState(null),{selectedItem:E}=e.useContext(g),{data:F=[],isLoading:T,error:B,refetch:$}=b(h),{data:z}=N(),[O,{isLoading:M}]=v(),q=F.filter((e=>e.name.toLowerCase().includes(f.toLowerCase())&&e.email.toLowerCase().includes(w.toLowerCase())&&e.mobile.toLowerCase().includes(y.toLowerCase())&&e.country.toLowerCase().includes(k.toLowerCase())));return s.jsxs("div",{className:"p-4 space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("h1",{className:"text-xl font-semibold text-[#3b1f91]",children:[d," for ",(null==E?void 0:E.name)||"Chemical"]}),s.jsxs(m,{className:"bg-[#3b1f91] hover:bg-purple-700",onClick:()=>p(!0),children:[s.jsx(U,{className:"w-4 h-4 mr-2"}),"Add Supplier"]}),n&&s.jsx(ce,{open:j,onClose:()=>p(!1),chemicalName:E||"Unknown Chemical",supplier:"Supplier",onAddSupplier:z,chemicalId:h,refetch:$,fetchChemicals:o})]}),x.length>0&&s.jsx("div",{className:"p-4 border-b",children:s.jsx(te,{selectedSupplier:x,supplier:F,email:F.filter((e=>x.includes(e._id))).map((e=>e.email)).join(", "),name:F.filter((e=>x.includes(e._id))).map((e=>e.name)).join(", "),chemicalName:null==E?void 0:E.name})}),s.jsxs(a,{children:[s.jsx(l,{children:s.jsxs(i,{children:[s.jsx(r,{className:"w-12"}),s.jsx(r,{children:"Name"}),s.jsx(r,{children:"Email"}),s.jsx(r,{children:"Mobile"}),s.jsx(r,{children:"Action"})]})}),s.jsxs(t,{children:[T&&s.jsx(i,{children:s.jsx(c,{colSpan:6,className:"text-center py-8",children:"Loading suppliers..."})}),B&&s.jsx(i,{children:s.jsx(c,{colSpan:6,className:"text-center py-8 text-red-500/60",children:"No suppliers available."})}),!T&&!B&&q.map((e=>s.jsxs(i,{children:[s.jsx(c,{children:s.jsx(D,{checked:x.includes(e._id),onCheckedChange:()=>{return s=e._id,void u((e=>e.includes(s)?e.filter((e=>e!==s)):[...e,s]));var s}})}),s.jsx(c,{children:e.name}),s.jsx(c,{children:e.email}),s.jsx(c,{children:e.mobile}),s.jsx(c,{children:s.jsx(m,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-600",onClick:()=>{return s=e._id,void I(s);var s},disabled:M,children:s.jsx(V,{className:"w-4 h-4"})})})]},e._id)))]})]}),s.jsx(G,{open:!!_,onOpenChange:()=>I(null),children:s.jsxs(H,{children:[s.jsxs(K,{children:[s.jsx(Q,{children:"Are you sure?"}),s.jsx(X,{children:"This action cannot be undone. This will permanently delete the supplier from this chemical."})]}),s.jsxs(ee,{children:[s.jsx(se,{children:"Cancel"}),s.jsx(ae,{onClick:async()=>{if(_)try{await O({supplierId:_,chemicalId:h}).unwrap(),$()}catch(e){alert("Failed to delete chemical")}I(null)},children:"Delete"})]})]})})]})}function de({chemicalName:n,supplier:d}){const[o,h]=e.useState([]),{selectedItem:x}=e.useContext(g),[u,j]=e.useState(!1),[p,f]=e.useState(""),[b,N]=e.useState(""),[v,y]=e.useState(""),[L,k]=e.useState(""),{data:A=[]}=C(),{data:_=[],isLoading:I,error:E,refetch:F}=w(x._id),[T]=S(),B=_.filter((e=>e.name.toLowerCase().includes(p.toLowerCase())&&e.email.toLowerCase().includes(b.toLowerCase())&&e.mobile.toLowerCase().includes(v.toLowerCase())&&e.country.toLowerCase().includes(L.toLowerCase())));return s.jsxs("div",{className:"p-4 space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("h1",{className:"text-xl font-semibold text-[#3b1f91]",children:[d," for ",x.name]}),s.jsxs(m,{className:"bg-[#3b1f91] hover:bg-purple-700",onClick:()=>j(!0),children:[s.jsx(U,{className:"w-4 h-4 mr-2"}),"Add Customer"]})]}),s.jsx(ce,{open:u,onClose:()=>j(!1),chemicalName:x,supplier:"Customer",onAddSupplier:A,refetch:F}),o.length>0&&s.jsx("div",{className:"p-4 border-b",children:s.jsx(te,{selectedSupplier:o,supplier:_,chemicalName:n.name,type:d})}),s.jsxs("div",{className:"border rounded-lg",children:[s.jsxs(a,{children:[s.jsx(l,{children:s.jsxs(i,{children:[s.jsx(r,{className:"w-12"}),s.jsx(r,{children:"Name"}),s.jsx(r,{children:"Email"}),s.jsx(r,{children:"Mobile"}),s.jsx(r,{children:"Country"}),s.jsx(r,{children:"Action"})]})}),s.jsxs(t,{children:[I&&s.jsx(i,{children:s.jsx(c,{colSpan:6,className:"text-center py-8",children:"Loading customers..."})}),E&&s.jsx(i,{children:s.jsx(c,{colSpan:6,className:"text-center py-8 text-red-500",children:"Error loading customers."})}),!I&&!E&&0===B.length&&s.jsx(i,{children:s.jsx(c,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No Data Found"})}),!I&&!E&&B.map((e=>s.jsxs(i,{children:[s.jsx(c,{children:s.jsx(D,{checked:o.includes(e.id),onCheckedChange:()=>{return s=e.id,void h((e=>e.includes(s)?e.filter((e=>e!==s)):[...e,s]));var s}})}),s.jsx(c,{children:e.name}),s.jsx(c,{children:e.email}),s.jsx(c,{children:e.mobile}),s.jsx(c,{children:e.country}),s.jsx(c,{children:s.jsx(m,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-600",onClick:()=>(async e=>{try{await T({customerId:e,chemicalId:x._id})}catch(s){}})(e._id),children:s.jsx(V,{className:"w-4 h-4"})})})]},e.id)))]})]}),s.jsxs("div",{className:"flex items-center justify-between border-t p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[s.jsx("span",{children:"Items per page: 10"}),s.jsxs("span",{children:["1 - ",B.length," of ",B.length]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(m,{variant:"outline",size:"icon",disabled:!0,children:s.jsx(Y,{className:"w-4 h-4"})}),s.jsx(m,{variant:"outline",size:"icon",disabled:!0,children:s.jsx(P,{className:"w-4 h-4"})})]})]})]})]})}function oe(){y();const[n,o]=e.useState(!1),[x,u]=e.useState(!1),[p,f]=e.useState(null),[g,b]=e.useState(""),[v,w]=e.useState(""),[S,D]=e.useState(1),[M,q]=e.useState(20),[U,Y]=e.useState(!1);e.useState(null);const[P,G]=e.useState(!1),[H,K]=e.useState(null),[Q,X]=e.useState([]),{data:ee=[],isLoading:se,error:ae}=N(),{data:te=[],isLoading2:oe,error2:me}=C();L(null==p?void 0:p._id);const he=ie(),[xe,ue]=e.useState(0);e.useEffect((()=>{je()}),[xe]);const je=async()=>{try{const e=await le.get("/api/chemical/get");X(e.data)}catch(e){}},pe=Q.filter((e=>{const s=e.name||"",a=e.casNumber||"";return s.toLowerCase().includes(g.toLowerCase())&&a.includes(v)})),fe=pe.slice((S-1)*M,S*M);return s.jsxs("div",{className:"w-full",children:[s.jsxs("div",{className:"flex justify-between items-center mb-5",children:[s.jsx("div",{children:s.jsx("h2",{className:"text-lg font-bold text-[#3b1f91]",children:"Chemical List"})}),s.jsx("div",{children:s.jsx(re,{to:"/chemical-form",children:s.jsxs(m,{className:"bg-[#3b1f91] hover:bg-[#2a1664]",children:[s.jsx(W,{})," Add Chemical"]})})})]}),s.jsx("div",{className:"mb-5",children:s.jsx("hr",{})}),s.jsx("div",{className:"rounded-md border",children:s.jsxs(a,{children:[s.jsxs(l,{children:[s.jsxs(i,{children:[s.jsx(r,{className:"w-[50px]"}),s.jsx(r,{children:"Name"}),s.jsx(r,{children:"CAS Number"}),s.jsx(r,{children:"Molecular Formula"}),s.jsx(r,{children:"Suppliers"}),s.jsx(r,{children:"Customers"}),s.jsx(r,{children:"Unit Name"})]}),s.jsxs(i,{children:[s.jsx(r,{className:"w-[50px]"}),s.jsx(r,{children:s.jsx(j,{placeholder:"Filter by Name",value:g,onChange:e=>b(e.target.value)})}),s.jsx(r,{children:s.jsx(j,{placeholder:"Filter by CAS Number",value:v,onChange:e=>w(e.target.value)})}),s.jsx(r,{}),s.jsx(r,{}),s.jsx(r,{}),s.jsx(r,{})]})]}),s.jsx(t,{children:fe.map((e=>s.jsxs(i,{children:[s.jsx(c,{children:s.jsxs(T,{children:[s.jsx(B,{asChild:!0,children:s.jsx("button",{className:"p-3",children:s.jsx(J,{className:"h-4 w-4"})})}),s.jsxs($,{children:[s.jsxs(z,{onClick:()=>(e=>{he(`/edit-chemical-form/${e._id}`)})(e),children:[s.jsx(R,{className:"mr-2 h-4 w-4"}),"Edit"]}),s.jsxs(z,{onClick:()=>(e=>{f(e),Y(!0),K("supplier")})(e),children:[s.jsx(Z,{className:"mr-2 h-4 w-4"}),"Add Supplier"]}),s.jsxs(z,{onClick:()=>(e=>{f(e),G(!0),K("customer")})(e),children:[s.jsx(Z,{className:"mr-2 h-4 w-4"}),"Add Customer"]}),s.jsxs(z,{onClick:()=>(async e=>{try{if((await O.fire({title:"Are you sure?",text:"This action cannot be undone!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed){const s=await le.delete(`/api/chemical/delete?id=${e._id}`);if(!s.data.success&&"Chemical deleted successfully"!==s.data.message)throw new Error(s.data.message||"Failed to delete the chemical");X((s=>s.filter((s=>s._id!==e._id)))),await je(),await O.fire({title:"Deleted!",text:"The chemical has been deleted.",icon:"success",timer:2e3,showConfirmButton:!1})}else O.fire({title:"Cancelled",text:"Your chemical is safe!",icon:"info",timer:1500,showConfirmButton:!1})}catch(s){"Chemical deleted successfully"===s.message?O.fire({title:"Deleted!",text:"The chemical has been deleted.",icon:"success",timer:2e3,showConfirmButton:!1}):O.fire({title:"Error!",text:s.message||"An error occurred while deleting the chemical.",icon:"error",confirmButtonText:"Ok"})}})(e),children:[s.jsx(V,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})}),s.jsx(c,{children:e.name}),s.jsx(c,{children:e.cas_number}),s.jsx(c,{children:e.molecular_formula}),s.jsx(c,{children:s.jsxs(m,{variant:"default",className:"bg-[#3b1f91] hover:bg-[#3b1f91]",onClick:()=>{f(e),o(!0)},children:["Suppliers (",e.supplierCount,")"]})}),s.jsx(c,{children:s.jsxs(m,{variant:"default",className:"bg-[#3b1f91] hover:bg-[#3b1f91]",onClick:()=>{f(e),u(!0)},children:["Customers(",e.customerCount,")"]})}),s.jsx(c,{children:e.unit})]},e.id)))}),p&&s.jsx(ce,{open:"supplier"===H?U:P,onClose:()=>{"supplier"===H?Y(!1):G(!1),K(null),ue((e=>e+1)),je()},chemicalName:p.name,supplier:"supplier"===H?"Supplier":"Customer",onAddSupplier:"supplier"===H?ee:te,chemicalId:p._id,fetchChemicals:je})]})}),s.jsxs("div",{className:"flex items-center justify-between space-x-2 py-4",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("p",{className:"text-sm font-medium",children:"Items per page:"}),s.jsxs(A,{defaultValue:M.toString(),onValueChange:e=>{q(Number(e)),D(1)},children:[s.jsx(_,{className:"w-[70px]",children:s.jsx(I,{placeholder:M.toString()})}),s.jsxs(E,{children:[s.jsx(F,{value:"10",children:"10"}),s.jsx(F,{value:"20",children:"20"}),s.jsx(F,{value:"30",children:"30"}),s.jsx(F,{value:"40",children:"40"}),s.jsx(F,{value:"50",children:"50"})]})]}),s.jsx("div",{className:"text-sm font-medium",children:`${(S-1)*M+1} - ${Math.min(S*M,pe.length)} of ${pe.length}`})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(m,{variant:"outline",size:"icon",onClick:()=>{S>1&&D((e=>e-1))},disabled:1===S,children:"<"}),s.jsx(m,{variant:"outline",size:"icon",onClick:()=>{S*M<pe.length&&D((e=>e+1))},disabled:S*M>=pe.length,children:">"})]})]}),s.jsx(k,{selectedItem:p,children:p&&s.jsxs(s.Fragment,{children:[s.jsx(d,{open:n,onOpenChange:o,children:s.jsx(h,{className:"max-w-6xl",children:s.jsx(ne,{chemicalName:p,chemicalId:p._id,supplier:"Supplier",fetchChemicals:je})})}),s.jsx(d,{open:x,onOpenChange:u,children:s.jsx(h,{className:"max-w-6xl",children:s.jsx(de,{selectedItems:p,supplier:"Customer",chemicalName:p,chemicalId:p._id,onUpdate:()=>{je(),ue((e=>e+1))}})})})]})})]})}export{oe as default};
