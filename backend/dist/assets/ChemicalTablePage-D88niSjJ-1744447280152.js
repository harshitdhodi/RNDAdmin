import{h as Le,i as Te,j as e,D as G,k as Fe,B as C,l as H,m as te,n as re,I as U,o as ke,p as De,C as ie,q as Ee,r as ne,s as Me,t as oe,v as _e,w as Ie,x as Pe,y as Be,b as le,S as Re,z as $e}from"./main-CuiBl65R-1744447280152.js";import{c as l,f as ze,L as Oe}from"./vendor-C9iLKeEQ-1744447280152.js";import{T as Y,a as J,b as v,c as i,d as W,e as c}from"./table-DEEIn3Z8-1744447280152.js";import{S as ce,a as de,b as me,c as he,d as _}from"./select-JUTv4TS8-1744447280152.js";import{D as Qe,a as Ge,b as He,c as Q}from"./dropdown-menu-Dy13ioSe-1744447280152.js";import{C as ue}from"./checkbox-B5_yOwYf-1744447280152.js";import"./textarea-ClfLiGoW-1744447280152.js";import{S as z}from"./sweetalert2.esm.all-CIewtpap-1744447280152.js";import{R as Ue}from"./index-Ve9l27Y6-1744447280152.js";/* empty css                                 */import{M as Ve}from"./mail-CymchXVW-1744447280152.js";import{A as qe,a as Ye,b as Je,c as We,d as Ke,e as Xe,f as Ze,g as es}from"./alert-dialog-BSU-kIVb-1744447280152.js";import{P as xe}from"./plus-RwApb5mw-1744447280152.js";import{T as K}from"./trash-2-DK8t8ry9-1744447280152.js";import{C as ss}from"./chevron-left-BQ_HqSSP-1744447280152.js";import{C as ls}from"./chevron-right-BX97q6Zj-1744447280152.js";import{C as as}from"./circle-plus-VZDHV4oK-1744447280152.js";import{E as ts}from"./ellipsis-vertical-BJz3sKir-1744447280152.js";import"./Combination-DyKxFJA2-1744447280152.js";import"./index-CQ9A5EyY-1744447280152.js";import"./check-BB3Iq3Th-1744447280152.js";import"./chevron-up-BYb3Nwr--1744447280152.js";import"./isEqual-C-PdR2G0-1744447280152.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=Le("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),je=({selectedSupplier:D,supplier:d,email:f,name:j,type:m,chemicalName:b})=>{console.log("Type:",m),console.log("Supplier Array:",d),console.log("Supplier Email:",d[0]?.email),console.log("Condition Check:",m==="Customer",d.length>0);const[r,h]=l.useState(""),[w,N]=l.useState(""),[p,T]=l.useState(!1),[g,A]=l.useState(null),{data:u,isLoading:E,error:y}=Te(),a=u?.data||[],S=m==="Customer"&&Array.isArray(d)&&d[0]?.email?d[0].email:f;console.log("Recipient Email:",S),l.useEffect(()=>{console.log("Supplier updated:",d)},[d]);const k=async()=>{try{T(!0);const n={subject:w,message:r,recipients:Array.isArray(S)?S:[S],chemicalNames:Array.isArray(b)?b:[b]},x=await fetch("/api/chemicalMail/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),L=await x.json();if(!x.ok)throw new Error(L.message||"Failed to send email");alert("Email sent successfully!"),h(""),N("")}catch(n){console.log("Error sending email:",n),alert("Failed to send email: "+n.message)}finally{T(!1)}},M=n=>{const x=a.find(L=>L._id===n);A(x),h(x?.body||""),N(x?.subject||"")};return e.jsx("div",{children:e.jsxs(G,{children:[e.jsx(Fe,{asChild:!0,children:e.jsxs(C,{variant:"secondary",children:[e.jsx(Ve,{className:"w-4 h-4 mr-2"}),"Send Email (",D.length,")"]})}),e.jsxs(H,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[e.jsx(te,{children:e.jsx(re,{children:"Send Email to Selected Suppliers"})}),e.jsxs("div",{className:"grid gap-4 ",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2 text-sm font-medium",children:"Selected Suppliers"}),e.jsx("div",{className:"p-2 border rounded-lg max-h-[100px] overflow-y-auto",children:S})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2 text-sm font-medium",children:"Selected Chemicals"}),e.jsx("div",{className:"p-2 border rounded-lg max-h-[100px] overflow-y-auto",children:e.jsx("div",{className:"text-sm py-1",children:b})})]})]}),e.jsxs(ce,{onValueChange:M,children:[e.jsx(de,{children:e.jsx(me,{placeholder:"Select email template"})}),e.jsx(he,{children:E?e.jsx(_,{value:"",disabled:!0,children:"Loading..."}):y?e.jsx(_,{value:"",disabled:!0,children:"Error loading templates"}):a.map(n=>e.jsx(_,{value:n._id,children:n.name},n._id))})]}),e.jsx(U,{placeholder:"Subject",value:w,onChange:n=>N(n.target.value)}),e.jsx("div",{className:"max-h-[300px] overflow-y-auto",children:e.jsx(Ue,{value:r,onChange:h,placeholder:"Write your message here...",theme:"snow",className:"bg-white rounded-lg"})}),e.jsx(C,{className:"bg-[#3b1f91] hover:bg-purple-700",onClick:k,disabled:p,children:p?"Sending...":"Send Email"})]})]})]})})},X=({refetch:D,open:d,onClose:f,chemicalName:j,fetchChemicals:m,chemicalId:b,supplier:r,onAddSupplier:h=[]})=>{const[w,N]=l.useState(""),[p,T]=l.useState(null);l.useEffect(()=>{d&&(N(""),T(null))},[d]);const[g,{isLoading:A}]=r==="Supplier"?ke():De(),u=Array.isArray(h)?h.filter(a=>a.name?.toLowerCase().includes(w.toLowerCase())):[],E=async()=>{if(!p){console.log("No supplier or customer selected");return}try{let a;r==="Supplier"?a=await g({chemical_ids:[j._id],supplierId:p._id}).unwrap():a=await g({chemicalId:[j._id],customerId:p._id}).unwrap(),console.log(`${r} ${p.name} added to ${j.name}`),await D(),m(),f()}catch(a){console.error(`Failed to add ${r.toLowerCase()}:`,a),alert(`Failed to add ${r.toLowerCase()}. Please try again.`)}},y=a=>{T(a),N(a.name)};return e.jsx(G,{open:d,onOpenChange:a=>!a&&f(),children:e.jsxs(H,{className:"max-w-lg p-6",children:[e.jsx(te,{children:e.jsxs(re,{className:"text-lg font-semibold text-[#3b1f91]",children:["Add ",r," for ",j.name]})}),e.jsxs("div",{className:"mt-4",children:[e.jsx(U,{placeholder:`Search ${r}`,value:w,onChange:a=>N(a.target.value),className:"w-full mb-2"}),w&&!p&&e.jsx("div",{className:"bg-white border border-gray-300 rounded shadow max-h-40 overflow-y-auto",children:u.length>0?u.map(a=>e.jsx("div",{onClick:()=>y(a),className:"p-2 cursor-pointer hover:bg-gray-100",children:a.name},a.id)):e.jsxs("div",{className:"p-2 text-gray-500",children:["No matching ",r.toLowerCase(),"s"]})}),e.jsxs("div",{className:"flex justify-between mt-4",children:[e.jsx(C,{onClick:E,className:"bg-[#3b1f91] hover:bg-purple-700",disabled:A||!p,children:A?"Adding...":"+ Add"}),e.jsx(C,{onClick:f,className:"bg-red-600 hover:bg-red-700",children:"Cancel"})]})]})]})})};function rs({chemicalName:D,supplier:d,fetchChemicals:f,chemicalId:j}){console.log(j);const[m,b]=l.useState([]),[r,h]=l.useState(!1),[w,N]=l.useState(""),[p,T]=l.useState(""),[g,A]=l.useState(""),[u,E]=l.useState(""),[y,a]=l.useState(null),{selectedItem:S}=l.useContext(ie),{data:k=[],isLoading:M,error:n,refetch:x}=Ee(j),{data:L}=ne(),[o,{isLoading:F}]=Me(),B=k.filter(t=>t.name.toLowerCase().includes(w.toLowerCase())&&t.email.toLowerCase().includes(p.toLowerCase())&&t.mobile.toLowerCase().includes(g.toLowerCase())&&t.country.toLowerCase().includes(u.toLowerCase())),Z=t=>{b(O=>O.includes(t)?O.filter(q=>q!==t):[...O,t])},ee=t=>{a(t)},V=async()=>{if(y)try{await o({supplierId:y,chemicalId:j}).unwrap(),x()}catch(t){console.error("Failed to delete chemical:",t),alert("Failed to delete chemical")}a(null)};return e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h1",{className:"text-xl font-semibold text-[#3b1f91]",children:[d," for ",S?.name||"Chemical"]}),e.jsxs(C,{className:"bg-[#3b1f91] hover:bg-purple-700",onClick:()=>h(!0),children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Add Supplier"]}),D&&e.jsx(X,{open:r,onClose:()=>h(!1),chemicalName:S||"Unknown Chemical",supplier:"Supplier",onAddSupplier:L,chemicalId:j,refetch:x,fetchChemicals:f})]}),m.length>0&&e.jsx("div",{className:"p-4 border-b",children:e.jsx(je,{selectedSupplier:m,supplier:k,email:k.filter(t=>m.includes(t._id)).map(t=>t.email).join(", "),name:k.filter(t=>m.includes(t._id)).map(t=>t.name).join(", "),chemicalName:S?.name})}),e.jsxs(Y,{children:[e.jsx(J,{children:e.jsxs(v,{children:[e.jsx(i,{className:"w-12"}),e.jsx(i,{children:"Name"}),e.jsx(i,{children:"Email"}),e.jsx(i,{children:"Mobile"}),e.jsx(i,{children:"Action"})]})}),e.jsxs(W,{children:[M&&e.jsx(v,{children:e.jsx(c,{colSpan:6,className:"text-center py-8",children:"Loading suppliers..."})}),n&&e.jsx(v,{children:e.jsx(c,{colSpan:6,className:"text-center py-8 text-red-500/60",children:"No suppliers available."})}),!M&&!n&&B.map(t=>e.jsxs(v,{children:[e.jsx(c,{children:e.jsx(ue,{checked:m.includes(t._id),onCheckedChange:()=>Z(t._id)})}),e.jsx(c,{children:t.name}),e.jsx(c,{children:t.email}),e.jsx(c,{children:t.mobile}),e.jsx(c,{children:e.jsx(C,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-600",onClick:()=>ee(t._id),disabled:F,children:e.jsx(K,{className:"w-4 h-4"})})})]},t._id))]})]}),e.jsx(qe,{open:!!y,onOpenChange:()=>a(null),children:e.jsxs(Ye,{children:[e.jsxs(Je,{children:[e.jsx(We,{children:"Are you sure?"}),e.jsx(Ke,{children:"This action cannot be undone. This will permanently delete the supplier from this chemical."})]}),e.jsxs(Xe,{children:[e.jsx(Ze,{children:"Cancel"}),e.jsx(es,{onClick:V,children:"Delete"})]})]})})]})}function is({chemicalName:D,supplier:d}){const[f,j]=l.useState([]),{selectedItem:m}=l.useContext(ie),[b,r]=l.useState(!1),[h,w]=l.useState(""),[N,p]=l.useState(""),[T,g]=l.useState(""),[A,u]=l.useState(""),{data:E=[]}=oe(),{data:y=[],isLoading:a,error:S,refetch:k}=_e(m._id),[M]=Ie(),n=y.filter(o=>o.name.toLowerCase().includes(h.toLowerCase())&&o.email.toLowerCase().includes(N.toLowerCase())&&o.mobile.toLowerCase().includes(T.toLowerCase())&&o.country.toLowerCase().includes(A.toLowerCase())),x=o=>{j(F=>F.includes(o)?F.filter(B=>B!==o):[...F,o])};console.log(f);const L=async o=>{try{await M({customerId:o,chemicalId:m._id})}catch(F){console.error("Failed to remove customer:",F)}};return e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h1",{className:"text-xl font-semibold text-[#3b1f91]",children:[d," for ",m.name]}),e.jsxs(C,{className:"bg-[#3b1f91] hover:bg-purple-700",onClick:()=>r(!0),children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Add Customer"]})]}),e.jsx(X,{open:b,onClose:()=>r(!1),chemicalName:m,supplier:"Customer",onAddSupplier:E,refetch:k}),f.length>0&&e.jsx("div",{className:"p-4 border-b",children:e.jsx(je,{selectedSupplier:f,supplier:y,chemicalName:D.name,type:d})}),e.jsxs("div",{className:"border rounded-lg",children:[e.jsxs(Y,{children:[e.jsx(J,{children:e.jsxs(v,{children:[e.jsx(i,{className:"w-12"}),e.jsx(i,{children:"Name"}),e.jsx(i,{children:"Email"}),e.jsx(i,{children:"Mobile"}),e.jsx(i,{children:"Country"}),e.jsx(i,{children:"Action"})]})}),e.jsxs(W,{children:[a&&e.jsx(v,{children:e.jsx(c,{colSpan:6,className:"text-center py-8",children:"Loading customers..."})}),S&&e.jsx(v,{children:e.jsx(c,{colSpan:6,className:"text-center py-8 text-red-500",children:"Error loading customers."})}),!a&&!S&&n.length===0&&e.jsx(v,{children:e.jsx(c,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No Data Found"})}),!a&&!S&&n.map(o=>e.jsxs(v,{children:[e.jsx(c,{children:e.jsx(ue,{checked:f.includes(o.id),onCheckedChange:()=>x(o.id)})}),e.jsx(c,{children:o.name}),e.jsx(c,{children:o.email}),e.jsx(c,{children:o.mobile}),e.jsx(c,{children:o.country}),e.jsx(c,{children:e.jsx(C,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-600",onClick:()=>L(o._id),children:e.jsx(K,{className:"w-4 h-4"})})})]},o.id))]})]}),e.jsxs("div",{className:"flex items-center justify-between border-t p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{children:"Items per page: 10"}),e.jsxs("span",{children:["1 - ",n.length," of ",n.length]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{variant:"outline",size:"icon",disabled:!0,children:e.jsx(ss,{className:"w-4 h-4"})}),e.jsx(C,{variant:"outline",size:"icon",disabled:!0,children:e.jsx(ls,{className:"w-4 h-4"})})]})]})]})]})}function ks(){const{selectedChemicalName:D,setChemicalName:d}=Pe(),[f,j]=l.useState(!1),[m,b]=l.useState(!1),[r,h]=l.useState(null),[w,N]=l.useState(""),[p,T]=l.useState(""),[g,A]=l.useState(1),[u,E]=l.useState(20),[y,a]=l.useState(!1),[S,k]=l.useState(null),[M,n]=l.useState(!1),[x,L]=l.useState(null),[o,F]=l.useState([]),{data:B=[],isLoading:Z,error:ee}=ne(),{data:V=[],isLoading2:t,error2:O}=oe();Be(r?._id);const q=ze(),[pe,se]=l.useState(0);l.useEffect(()=>{I()},[pe]);const I=async()=>{try{const s=await le.get("/api/chemical/get");F(s.data)}catch(s){console.error("Error fetching chemicals:",s)}},R=o.filter(s=>{const P=s.name||"",$=s.casNumber||"";return P.toLowerCase().includes(w.toLowerCase())&&$.includes(p)}),ge=R.slice((g-1)*u,g*u),Ce=()=>{g*u<R.length&&A(s=>s+1)},fe=()=>{g>1&&A(s=>s-1)},Se=s=>{E(Number(s)),A(1)},be=s=>{console.log("Edit",s),q(`/edit-chemical-form/${s._id}`)},we=s=>{h(s),a(!0),L("supplier")},Ne=s=>{h(s),n(!0),L("customer")},ye=async s=>{try{if((await z.fire({title:"Are you sure?",text:"This action cannot be undone!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed){const $=await le.delete(`/api/chemical/delete?id=${s._id}`);if($.data.success||$.data.message==="Chemical deleted successfully")F(ve=>ve.filter(Ae=>Ae._id!==s._id)),await I(),await z.fire({title:"Deleted!",text:"The chemical has been deleted.",icon:"success",timer:2e3,showConfirmButton:!1});else throw new Error($.data.message||"Failed to delete the chemical")}else z.fire({title:"Cancelled",text:"Your chemical is safe!",icon:"info",timer:1500,showConfirmButton:!1})}catch(P){console.error("Error deleting chemical:",P),P.message==="Chemical deleted successfully"?z.fire({title:"Deleted!",text:"The chemical has been deleted.",icon:"success",timer:2e3,showConfirmButton:!1}):z.fire({title:"Error!",text:P.message||"An error occurred while deleting the chemical.",icon:"error",confirmButtonText:"Ok"})}};return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-5",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-lg font-bold text-[#3b1f91]",children:"Chemical List"})}),e.jsx("div",{children:e.jsx(Oe,{to:"/chemical-form",children:e.jsxs(C,{className:"bg-[#3b1f91] hover:bg-[#2a1664]",children:[e.jsx(as,{})," Add Chemical"]})})})]}),e.jsx("div",{className:"mb-5",children:e.jsx("hr",{})}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(Y,{children:[e.jsxs(J,{children:[e.jsxs(v,{children:[e.jsx(i,{className:"w-[50px]"}),e.jsx(i,{children:"Name"}),e.jsx(i,{children:"CAS Number"}),e.jsx(i,{children:"Molecular Formula"}),e.jsx(i,{children:"Suppliers"}),e.jsx(i,{children:"Customers"}),e.jsx(i,{children:"Unit Name"})]}),e.jsxs(v,{children:[e.jsx(i,{className:"w-[50px]"}),e.jsx(i,{children:e.jsx(U,{placeholder:"Filter by Name",value:w,onChange:s=>N(s.target.value)})}),e.jsx(i,{children:e.jsx(U,{placeholder:"Filter by CAS Number",value:p,onChange:s=>T(s.target.value)})}),e.jsx(i,{}),e.jsx(i,{}),e.jsx(i,{}),e.jsx(i,{})]})]}),e.jsx(W,{children:ge.map(s=>e.jsxs(v,{children:[e.jsx(c,{children:e.jsxs(Qe,{children:[e.jsx(Ge,{asChild:!0,children:e.jsx("button",{className:"p-3",children:e.jsx(ts,{className:"h-4 w-4"})})}),e.jsxs(He,{children:[e.jsxs(Q,{onClick:()=>be(s),children:[e.jsx(Re,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(Q,{onClick:()=>we(s),children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Add Supplier"]}),e.jsxs(Q,{onClick:()=>Ne(s),children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Add Customer"]}),e.jsxs(Q,{onClick:()=>ye(s),children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})}),e.jsx(c,{children:s.name}),e.jsx(c,{children:s.cas_number}),e.jsx(c,{children:s.molecular_formula}),e.jsx(c,{children:e.jsxs(C,{variant:"default",className:"bg-[#3b1f91] hover:bg-[#3b1f91]",onClick:()=>{h(s),j(!0)},children:["Suppliers (",s.supplierCount,")"]})}),e.jsx(c,{children:e.jsxs(C,{variant:"default",className:"bg-[#3b1f91] hover:bg-[#3b1f91]",onClick:()=>{h(s),b(!0)},children:["Customers(",s.customerCount,")"]})}),e.jsx(c,{children:s.unit})]},s.id))}),r&&e.jsx(X,{open:x==="supplier"?y:M,onClose:()=>{x==="supplier"?a(!1):n(!1),L(null),se(s=>s+1),I()},chemicalName:r.name,supplier:x==="supplier"?"Supplier":"Customer",onAddSupplier:x==="supplier"?B:V,chemicalId:r._id,fetchChemicals:I})]})}),e.jsxs("div",{className:"flex items-center justify-between space-x-2 py-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Items per page:"}),e.jsxs(ce,{defaultValue:u.toString(),onValueChange:Se,children:[e.jsx(de,{className:"w-[70px]",children:e.jsx(me,{placeholder:u.toString()})}),e.jsxs(he,{children:[e.jsx(_,{value:"10",children:"10"}),e.jsx(_,{value:"20",children:"20"}),e.jsx(_,{value:"30",children:"30"}),e.jsx(_,{value:"40",children:"40"}),e.jsx(_,{value:"50",children:"50"})]})]}),e.jsx("div",{className:"text-sm font-medium",children:`${(g-1)*u+1} - ${Math.min(g*u,R.length)} of ${R.length}`})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{variant:"outline",size:"icon",onClick:fe,disabled:g===1,children:"<"}),e.jsx(C,{variant:"outline",size:"icon",onClick:Ce,disabled:g*u>=R.length,children:">"})]})]}),e.jsx($e,{selectedItem:r,children:r&&e.jsxs(e.Fragment,{children:[e.jsx(G,{open:f,onOpenChange:j,children:e.jsx(H,{className:"max-w-6xl",children:e.jsx(rs,{chemicalName:r,chemicalId:r._id,supplier:"Supplier",fetchChemicals:I})})}),e.jsx(G,{open:m,onOpenChange:b,children:e.jsx(H,{className:"max-w-6xl",children:e.jsx(is,{selectedItems:r,supplier:"Customer",chemicalName:r,chemicalId:r._id,onUpdate:()=>{I(),se(s=>s+1)}})})})]})})]})}export{ks as default};
