import{o as Le,r as l,p as Te,j as e,D as Q,q as Fe,B as C,M as ke,s as H,t as te,v as re,I as U,w as De,x as Ee,C as ie,y as Me,z as ne,A as _e,E as oe,F as Pe,G as Ie,H as Be,J as $e,f as Re,c as le,L as ze,S as Ge,K as Oe}from"./index-DeUnCYiZ-1764236035821.js";import{T as J,a as Y,b as L,c as n,d as K,e as o}from"./table-B8AArkC8-1764236035821.js";import{S as ce,a as de,b as me,c as he,d as _}from"./select-BLEE-4if-1764236035821.js";import{D as Qe,a as He,b as Ue,c as O}from"./dropdown-menu-BhCLsm0f-1764236035821.js";import{C as ue}from"./checkbox-B3QG8Gyl-1764236035821.js";import"./textarea-wxM16PxC-1764236035821.js";import{S as z}from"./sweetalert2.esm.all-CIewtpap-1764236035821.js";import{R as Ve}from"./index-P1HeUIJq-1764236035821.js";/* empty css                                 */import{A as qe,a as Je,b as Ye,c as Ke,d as We,e as Xe,f as Ze,g as es}from"./alert-dialog-D8ZLw6k5-1764236035821.js";import{P as xe}from"./plus-DMj3wh7u-1764236035821.js";import{T as W}from"./trash-2-CW9y4mUD-1764236035821.js";import{C as ss}from"./chevron-left-CnTX05X1-1764236035821.js";import{C as ls}from"./chevron-right-uKWrW_Xh-1764236035821.js";import{C as as}from"./circle-plus-CFmVsuhx-1764236035821.js";import{E as ts}from"./ellipsis-vertical-BQvT45OD-1764236035821.js";import"./Combination-Dg033hOD-1764236035821.js";import"./index-BtYf-_gF-1764236035821.js";import"./check-rXQb8L03-1764236035821.js";import"./chevron-up-DGQxz8wR-1764236035821.js";import"./isEqual-DAz0JtPz-1764236035821.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=Le("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),je=({selectedSupplier:D,supplier:m,email:f,name:j,type:h,chemicalName:N})=>{var w,A;console.log("Type:",h),console.log("Supplier Array:",m),console.log("Supplier Email:",(w=m[0])==null?void 0:w.email),console.log("Condition Check:",h==="Customer",m.length>0);const[r,x]=l.useState(""),[b,y]=l.useState(""),[p,F]=l.useState(!1),[g,T]=l.useState(null),{data:u,isLoading:E,error:v}=Te(),t=(u==null?void 0:u.data)||[],c=h==="Customer"&&Array.isArray(m)&&((A=m[0])!=null&&A.email)?m[0].email:f;console.log("Recipient Email:",c),l.useEffect(()=>{console.log("Supplier updated:",m)},[m]);const k=async()=>{try{F(!0);const d={subject:b,message:r,recipients:Array.isArray(c)?c:[c],chemicalNames:Array.isArray(N)?N:[N]},a=await fetch("/api/chemicalMail/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}),S=await a.json();if(!a.ok)throw new Error(S.message||"Failed to send email");alert("Email sent successfully!"),x(""),y("")}catch(d){console.log("Error sending email:",d),alert("Failed to send email: "+d.message)}finally{F(!1)}},M=d=>{const a=t.find(S=>S._id===d);T(a),x((a==null?void 0:a.body)||""),y((a==null?void 0:a.subject)||"")};return e.jsx("div",{children:e.jsxs(Q,{children:[e.jsx(Fe,{asChild:!0,children:e.jsxs(C,{variant:"secondary",children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"Send Email (",D.length,")"]})}),e.jsxs(H,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[e.jsx(te,{children:e.jsx(re,{children:"Send Email to Selected Suppliers"})}),e.jsxs("div",{className:"grid gap-4 ",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2 text-sm font-medium",children:"Selected Suppliers"}),e.jsx("div",{className:"p-2 border rounded-lg max-h-[100px] overflow-y-auto",children:c})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2 text-sm font-medium",children:"Selected Chemicals"}),e.jsx("div",{className:"p-2 border rounded-lg max-h-[100px] overflow-y-auto",children:e.jsx("div",{className:"text-sm py-1",children:N})})]})]}),e.jsxs(ce,{onValueChange:M,children:[e.jsx(de,{children:e.jsx(me,{placeholder:"Select email template"})}),e.jsx(he,{children:E?e.jsx(_,{value:"",disabled:!0,children:"Loading..."}):v?e.jsx(_,{value:"",disabled:!0,children:"Error loading templates"}):t.map(d=>e.jsx(_,{value:d._id,children:d.name},d._id))})]}),e.jsx(U,{placeholder:"Subject",value:b,onChange:d=>y(d.target.value)}),e.jsx("div",{className:"max-h-[300px] overflow-y-auto",children:e.jsx(Ve,{value:r,onChange:x,placeholder:"Write your message here...",theme:"snow",className:"bg-white rounded-lg"})}),e.jsx(C,{className:"bg-[#304a8a] hover:bg-purple-700",onClick:k,disabled:p,children:p?"Sending...":"Send Email"})]})]})]})})},X=({refetch:D,open:m,onClose:f,chemicalName:j,fetchChemicals:h,chemicalId:N,supplier:r,onAddSupplier:x=[]})=>{const[b,y]=l.useState(""),[p,F]=l.useState(null);l.useEffect(()=>{m&&(y(""),F(null))},[m]);const[g,{isLoading:T}]=r==="Supplier"?De():Ee(),u=Array.isArray(x)?x.filter(t=>{var c;return(c=t.name)==null?void 0:c.toLowerCase().includes(b.toLowerCase())}):[],E=async()=>{if(!p){console.log("No supplier or customer selected");return}try{let t;r==="Supplier"?t=await g({chemical_ids:[j._id],supplierId:p._id}).unwrap():t=await g({chemicalId:[j._id],customerId:p._id}).unwrap(),console.log(`${r} ${p.name} added to ${j.name}`),await D(),h(),f()}catch(t){console.error(`Failed to add ${r.toLowerCase()}:`,t),alert(`Failed to add ${r.toLowerCase()}. Please try again.`)}},v=t=>{F(t),y(t.name)};return e.jsx(Q,{open:m,onOpenChange:t=>!t&&f(),children:e.jsxs(H,{className:"max-w-lg p-6",children:[e.jsx(te,{children:e.jsxs(re,{className:"text-lg font-semibold text-[#304a8a]",children:["Add ",r," for ",j.name]})}),e.jsxs("div",{className:"mt-4",children:[e.jsx(U,{placeholder:`Search ${r}`,value:b,onChange:t=>y(t.target.value),className:"w-full mb-2"}),b&&!p&&e.jsx("div",{className:"bg-white border border-gray-300 rounded shadow max-h-40 overflow-y-auto",children:u.length>0?u.map(t=>e.jsx("div",{onClick:()=>v(t),className:"p-2 cursor-pointer hover:bg-gray-100",children:t.name},t.id)):e.jsxs("div",{className:"p-2 text-gray-500",children:["No matching ",r.toLowerCase(),"s"]})}),e.jsxs("div",{className:"flex justify-between mt-4",children:[e.jsx(C,{onClick:E,className:"bg-[#304a8a] hover:bg-purple-700",disabled:T||!p,children:T?"Adding...":"+ Add"}),e.jsx(C,{onClick:f,className:"bg-red-600 hover:bg-red-700",children:"Cancel"})]})]})]})})};function rs({chemicalName:D,supplier:m,fetchChemicals:f,chemicalId:j}){console.log(j);const[h,N]=l.useState([]),[r,x]=l.useState(!1),[b,y]=l.useState(""),[p,F]=l.useState(""),[g,T]=l.useState(""),[u,E]=l.useState(""),[v,t]=l.useState(null),{selectedItem:c}=l.useContext(ie),{data:k=[],isLoading:M,error:w,refetch:A}=Me(j),{data:d}=ne(),[a,{isLoading:S}]=_e(),B=k.filter(i=>i.name.toLowerCase().includes(b.toLowerCase())&&i.email.toLowerCase().includes(p.toLowerCase())&&i.mobile.toLowerCase().includes(g.toLowerCase())&&i.country.toLowerCase().includes(u.toLowerCase())),Z=i=>{N(G=>G.includes(i)?G.filter(q=>q!==i):[...G,i])},ee=i=>{t(i)},V=async()=>{if(v)try{await a({supplierId:v,chemicalId:j}).unwrap(),A()}catch(i){console.error("Failed to delete chemical:",i),alert("Failed to delete chemical")}t(null)};return e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h1",{className:"text-xl font-semibold text-[#304a8a]",children:[m," for ",(c==null?void 0:c.name)||"Chemical"]}),e.jsxs(C,{className:"bg-[#304a8a] hover:bg-purple-700",onClick:()=>x(!0),children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Add Supplier"]}),D&&e.jsx(X,{open:r,onClose:()=>x(!1),chemicalName:c||"Unknown Chemical",supplier:"Supplier",onAddSupplier:d,chemicalId:j,refetch:A,fetchChemicals:f})]}),h.length>0&&e.jsx("div",{className:"p-4 border-b",children:e.jsx(je,{selectedSupplier:h,supplier:k,email:k.filter(i=>h.includes(i._id)).map(i=>i.email).join(", "),name:k.filter(i=>h.includes(i._id)).map(i=>i.name).join(", "),chemicalName:c==null?void 0:c.name})}),e.jsxs(J,{children:[e.jsx(Y,{children:e.jsxs(L,{children:[e.jsx(n,{className:"w-12"}),e.jsx(n,{children:"Name"}),e.jsx(n,{children:"Email"}),e.jsx(n,{children:"Mobile"}),e.jsx(n,{children:"Action"})]})}),e.jsxs(K,{children:[M&&e.jsx(L,{children:e.jsx(o,{colSpan:6,className:"text-center py-8",children:"Loading suppliers..."})}),w&&e.jsx(L,{children:e.jsx(o,{colSpan:6,className:"text-center py-8 text-red-500/60",children:"No suppliers available."})}),!M&&!w&&B.map(i=>e.jsxs(L,{children:[e.jsx(o,{children:e.jsx(ue,{checked:h.includes(i._id),onCheckedChange:()=>Z(i._id)})}),e.jsx(o,{children:i.name}),e.jsx(o,{children:i.email}),e.jsx(o,{children:i.mobile}),e.jsx(o,{children:e.jsx(C,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-600",onClick:()=>ee(i._id),disabled:S,children:e.jsx(W,{className:"w-4 h-4"})})})]},i._id))]})]}),e.jsx(qe,{open:!!v,onOpenChange:()=>t(null),children:e.jsxs(Je,{children:[e.jsxs(Ye,{children:[e.jsx(Ke,{children:"Are you sure?"}),e.jsx(We,{children:"This action cannot be undone. This will permanently delete the supplier from this chemical."})]}),e.jsxs(Xe,{children:[e.jsx(Ze,{children:"Cancel"}),e.jsx(es,{onClick:V,children:"Delete"})]})]})})]})}function is({chemicalName:D,supplier:m}){const[f,j]=l.useState([]),{selectedItem:h}=l.useContext(ie),[N,r]=l.useState(!1),[x,b]=l.useState(""),[y,p]=l.useState(""),[F,g]=l.useState(""),[T,u]=l.useState(""),{data:E=[]}=oe(),{data:v=[],isLoading:t,error:c,refetch:k}=Pe(h._id),[M]=Ie(),w=v.filter(a=>a.name.toLowerCase().includes(x.toLowerCase())&&a.email.toLowerCase().includes(y.toLowerCase())&&a.mobile.toLowerCase().includes(F.toLowerCase())&&a.country.toLowerCase().includes(T.toLowerCase())),A=a=>{j(S=>S.includes(a)?S.filter(B=>B!==a):[...S,a])};console.log(f);const d=async a=>{try{await M({customerId:a,chemicalId:h._id})}catch(S){console.error("Failed to remove customer:",S)}};return e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h1",{className:"text-xl font-semibold text-[#304a8a]",children:[m," for ",h.name]}),e.jsxs(C,{className:"bg-[#304a8a] hover:bg-purple-700",onClick:()=>r(!0),children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Add Customer"]})]}),e.jsx(X,{open:N,onClose:()=>r(!1),chemicalName:h,supplier:"Customer",onAddSupplier:E,refetch:k}),f.length>0&&e.jsx("div",{className:"p-4 border-b",children:e.jsx(je,{selectedSupplier:f,supplier:v,chemicalName:D.name,type:m})}),e.jsxs("div",{className:"border rounded-lg",children:[e.jsxs(J,{children:[e.jsx(Y,{children:e.jsxs(L,{children:[e.jsx(n,{className:"w-12"}),e.jsx(n,{children:"Name"}),e.jsx(n,{children:"Email"}),e.jsx(n,{children:"Mobile"}),e.jsx(n,{children:"Country"}),e.jsx(n,{children:"Action"})]})}),e.jsxs(K,{children:[t&&e.jsx(L,{children:e.jsx(o,{colSpan:6,className:"text-center py-8",children:"Loading customers..."})}),c&&e.jsx(L,{children:e.jsx(o,{colSpan:6,className:"text-center py-8 text-red-500",children:"Error loading customers."})}),!t&&!c&&w.length===0&&e.jsx(L,{children:e.jsx(o,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No Data Found"})}),!t&&!c&&w.map(a=>e.jsxs(L,{children:[e.jsx(o,{children:e.jsx(ue,{checked:f.includes(a.id),onCheckedChange:()=>A(a.id)})}),e.jsx(o,{children:a.name}),e.jsx(o,{children:a.email}),e.jsx(o,{children:a.mobile}),e.jsx(o,{children:a.country}),e.jsx(o,{children:e.jsx(C,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-600",onClick:()=>d(a._id),children:e.jsx(W,{className:"w-4 h-4"})})})]},a.id))]})]}),e.jsxs("div",{className:"flex items-center justify-between border-t p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{children:"Items per page: 10"}),e.jsxs("span",{children:["1 - ",w.length," of ",w.length]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{variant:"outline",size:"icon",disabled:!0,children:e.jsx(ss,{className:"w-4 h-4"})}),e.jsx(C,{variant:"outline",size:"icon",disabled:!0,children:e.jsx(ls,{className:"w-4 h-4"})})]})]})]})]})}function Ts(){const{selectedChemicalName:D,setChemicalName:m}=Be(),[f,j]=l.useState(!1),[h,N]=l.useState(!1),[r,x]=l.useState(null),[b,y]=l.useState(""),[p,F]=l.useState(""),[g,T]=l.useState(1),[u,E]=l.useState(20),[v,t]=l.useState(!1),[c,k]=l.useState(null),[M,w]=l.useState(!1),[A,d]=l.useState(null),[a,S]=l.useState([]),{data:B=[],isLoading:Z,error:ee}=ne(),{data:V=[],isLoading2:i,error2:G}=oe();$e(r==null?void 0:r._id);const q=Re(),[pe,se]=l.useState(0);l.useEffect(()=>{P()},[pe]);const P=async()=>{try{const s=await le.get("/api/chemical/get");S(s.data)}catch(s){console.error("Error fetching chemicals:",s)}},$=a.filter(s=>{const I=s.name||"",R=s.casNumber||"";return I.toLowerCase().includes(b.toLowerCase())&&R.includes(p)}),ge=$.slice((g-1)*u,g*u),Ce=()=>{g*u<$.length&&T(s=>s+1)},fe=()=>{g>1&&T(s=>s-1)},Se=s=>{E(Number(s)),T(1)},we=s=>{console.log("Edit",s),q(`/edit-chemical-form/${s._id}`)},Ne=s=>{x(s),t(!0),d("supplier")},be=s=>{x(s),w(!0),d("customer")},ye=async s=>{try{if((await z.fire({title:"Are you sure?",text:"This action cannot be undone!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed){const R=await le.delete(`/api/chemical/delete?id=${s._id}`);if(R.data.success||R.data.message==="Chemical deleted successfully")S(ve=>ve.filter(Ae=>Ae._id!==s._id)),await P(),await z.fire({title:"Deleted!",text:"The chemical has been deleted.",icon:"success",timer:2e3,showConfirmButton:!1});else throw new Error(R.data.message||"Failed to delete the chemical")}else z.fire({title:"Cancelled",text:"Your chemical is safe!",icon:"info",timer:1500,showConfirmButton:!1})}catch(I){console.error("Error deleting chemical:",I),I.message==="Chemical deleted successfully"?z.fire({title:"Deleted!",text:"The chemical has been deleted.",icon:"success",timer:2e3,showConfirmButton:!1}):z.fire({title:"Error!",text:I.message||"An error occurred while deleting the chemical.",icon:"error",confirmButtonText:"Ok"})}};return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-5",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-lg font-bold text-[#304a8a]",children:"Chemical List"})}),e.jsx("div",{children:e.jsx(ze,{to:"/chemical-form",children:e.jsxs(C,{className:"bg-[#304a8a] hover:bg-[#2a1664]",children:[e.jsx(as,{})," Add Chemical"]})})})]}),e.jsx("div",{className:"mb-5",children:e.jsx("hr",{})}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(J,{children:[e.jsxs(Y,{children:[e.jsxs(L,{children:[e.jsx(n,{className:"w-[50px]"}),e.jsx(n,{children:"Name"}),e.jsx(n,{children:"CAS Number"}),e.jsx(n,{children:"Molecular Formula"}),e.jsx(n,{children:"Suppliers"}),e.jsx(n,{children:"Customers"}),e.jsx(n,{children:"Unit Name"})]}),e.jsxs(L,{children:[e.jsx(n,{className:"w-[50px]"}),e.jsx(n,{children:e.jsx(U,{placeholder:"Filter by Name",value:b,onChange:s=>y(s.target.value)})}),e.jsx(n,{children:e.jsx(U,{placeholder:"Filter by CAS Number",value:p,onChange:s=>F(s.target.value)})}),e.jsx(n,{}),e.jsx(n,{}),e.jsx(n,{}),e.jsx(n,{})]})]}),e.jsx(K,{children:ge.map(s=>e.jsxs(L,{children:[e.jsx(o,{children:e.jsxs(Qe,{children:[e.jsx(He,{asChild:!0,children:e.jsx("button",{className:"p-3",children:e.jsx(ts,{className:"h-4 w-4"})})}),e.jsxs(Ue,{children:[e.jsxs(O,{onClick:()=>we(s),children:[e.jsx(Ge,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(O,{onClick:()=>Ne(s),children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Add Supplier"]}),e.jsxs(O,{onClick:()=>be(s),children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Add Customer"]}),e.jsxs(O,{onClick:()=>ye(s),children:[e.jsx(W,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})}),e.jsx(o,{children:s.name}),e.jsx(o,{children:s.cas_number}),e.jsx(o,{children:s.molecular_formula}),e.jsx(o,{children:e.jsxs(C,{variant:"default",className:"bg-[#304a8a] hover:bg-[#304a8a]",onClick:()=>{x(s),j(!0)},children:["Suppliers (",s.supplierCount,")"]})}),e.jsx(o,{children:e.jsxs(C,{variant:"default",className:"bg-[#304a8a] hover:bg-[#304a8a]",onClick:()=>{x(s),N(!0)},children:["Customers(",s.customerCount,")"]})}),e.jsx(o,{children:s.unit})]},s.id))}),r&&e.jsx(X,{open:A==="supplier"?v:M,onClose:()=>{A==="supplier"?t(!1):w(!1),d(null),se(s=>s+1),P()},chemicalName:r.name,supplier:A==="supplier"?"Supplier":"Customer",onAddSupplier:A==="supplier"?B:V,chemicalId:r._id,fetchChemicals:P})]})}),e.jsxs("div",{className:"flex items-center justify-between space-x-2 py-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Items per page:"}),e.jsxs(ce,{defaultValue:u.toString(),onValueChange:Se,children:[e.jsx(de,{className:"w-[70px]",children:e.jsx(me,{placeholder:u.toString()})}),e.jsxs(he,{children:[e.jsx(_,{value:"10",children:"10"}),e.jsx(_,{value:"20",children:"20"}),e.jsx(_,{value:"30",children:"30"}),e.jsx(_,{value:"40",children:"40"}),e.jsx(_,{value:"50",children:"50"})]})]}),e.jsx("div",{className:"text-sm font-medium",children:`${(g-1)*u+1} - ${Math.min(g*u,$.length)} of ${$.length}`})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{variant:"outline",size:"icon",onClick:fe,disabled:g===1,children:"<"}),e.jsx(C,{variant:"outline",size:"icon",onClick:Ce,disabled:g*u>=$.length,children:">"})]})]}),e.jsx(Oe,{selectedItem:r,children:r&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{open:f,onOpenChange:j,children:e.jsx(H,{className:"max-w-6xl",children:e.jsx(rs,{chemicalName:r,chemicalId:r._id,supplier:"Supplier",fetchChemicals:P})})}),e.jsx(Q,{open:h,onOpenChange:N,children:e.jsx(H,{className:"max-w-6xl",children:e.jsx(is,{selectedItems:r,supplier:"Customer",chemicalName:r,chemicalId:r._id,onUpdate:()=>{P(),se(s=>s+1)}})})})]})})]})}export{Ts as default};
