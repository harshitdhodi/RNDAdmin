import{h as e,k as s,j as a,D as l,l as i,B as r,m as c,n as t,o as n,I as d,p as o,q as m,C as h,r as x,s as u,t as j,v as p,w as f,x as g,y as C,z as N,S as b,A as v}from"./main-BQqr2_19.js";import{r as w,d as y,L as S}from"./vendor-router-DoRotgOs.js";import{T as L,a as k,b as A,c as _,d as I,e as E}from"./table-C7XKYQT1.js";import{S as T,a as F,b as B,c as M,d as $}from"./select-DFtFguEc.js";import{D as z,a as D,b as O,c as P}from"./dropdown-menu-B0iK7WzX.js";import{C as U}from"./checkbox-BXm1ESgR.js";import"./textarea-tez6YR4q.js";import{S as q}from"./sweetalert2.esm.all-D2QuJ--x.js";import{R as V}from"./index-BEyUZcsN.js";/* empty css                   */import{M as Y}from"./mail-BX5nEYrp.js";import{A as H,a as J,b as W,c as G,d as K,e as R,f as X,g as Z}from"./alert-dialog-DKDaLIss.js";import{P as Q}from"./plus-C_FNkNo2.js";import{T as ee}from"./trash-2-CkYKnG3D.js";import{C as se}from"./chevron-left-C0_ThF1d.js";import{C as ae}from"./chevron-right-DHWU52ll.js";import{a as le}from"./vendor-utils-CfKmydC0.js";import{C as ie}from"./circle-plus-DQFd-uOw.js";import{E as re}from"./ellipsis-vertical-DeriUaLO.js";import"./vendor-react-DD_RYU77.js";import"./index-BYajCL7Y.js";import"./index-LwoRh43N.js";import"./check-C21vIO_I.js";import"./chevron-up-CiFYhtWl.js";import"./isEqual-DwlFmuh_.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=e("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),te=({selectedSupplier:e,supplier:o,email:m,name:h,type:x,chemicalName:u})=>{const[j,p]=w.useState(""),[f,g]=w.useState(""),[C,N]=w.useState(!1),[b,v]=w.useState(null),{data:y,isLoading:S,error:L}=s(),k=y?.data||[],A="Customer"===x&&Array.isArray(o)&&o[0]?.email?o[0].email:m;w.useEffect((()=>{}),[o]);return a.jsx("div",{children:a.jsxs(l,{children:[a.jsx(i,{asChild:!0,children:a.jsxs(r,{variant:"secondary",children:[a.jsx(Y,{className:"w-4 h-4 mr-2"}),"Send Email (",e.length,")"]})}),a.jsxs(c,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[a.jsx(t,{children:a.jsx(n,{children:"Send Email to Selected Suppliers"})}),a.jsxs("div",{className:"grid gap-4 ",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"mb-2 text-sm font-medium",children:"Selected Suppliers"}),a.jsx("div",{className:"p-2 border rounded-lg max-h-[100px] overflow-y-auto",children:A})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"mb-2 text-sm font-medium",children:"Selected Chemicals"}),a.jsx("div",{className:"p-2 border rounded-lg max-h-[100px] overflow-y-auto",children:a.jsx("div",{className:"text-sm py-1",children:u})})]})]}),a.jsxs(T,{onValueChange:e=>{const s=k.find((s=>s._id===e));v(s),p(s?.body||""),g(s?.subject||"")},children:[a.jsx(F,{children:a.jsx(B,{placeholder:"Select email template"})}),a.jsx(M,{children:S?a.jsx($,{value:"",disabled:!0,children:"Loading..."}):L?a.jsx($,{value:"",disabled:!0,children:"Error loading templates"}):k.map((e=>a.jsx($,{value:e._id,children:e.name},e._id)))})]}),a.jsx(d,{placeholder:"Subject",value:f,onChange:e=>g(e.target.value)}),a.jsx("div",{className:"max-h-[300px] overflow-y-auto",children:a.jsx(V,{value:j,onChange:p,placeholder:"Write your message here...",theme:"snow",className:"bg-white rounded-lg"})}),a.jsx(r,{className:"bg-[#3b1f91] hover:bg-purple-700",onClick:async()=>{try{N(!0);const e={subject:f,message:j,recipients:Array.isArray(A)?A:[A],chemicalNames:Array.isArray(u)?u:[u]},s=await fetch("/api/chemicalMail/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await s.json();if(!s.ok)throw new Error(a.message||"Failed to send email");alert("Email sent successfully!"),p(""),g("")}catch(e){alert("Failed to send email: "+e.message)}finally{N(!1)}},disabled:C,children:C?"Sending...":"Send Email"})]})]})]})})},ne=({refetch:e,open:s,onClose:i,chemicalName:h,fetchChemicals:x,chemicalId:u,supplier:j,onAddSupplier:p=[]})=>{const[f,g]=w.useState(""),[C,N]=w.useState(null);w.useEffect((()=>{s&&(g(""),N(null))}),[s]);const[b,{isLoading:v}]="Supplier"===j?o():m(),y=Array.isArray(p)?p.filter((e=>e.name?.toLowerCase().includes(f.toLowerCase()))):[];return a.jsx(l,{open:s,onOpenChange:e=>!e&&i(),children:a.jsxs(c,{className:"max-w-lg p-6",children:[a.jsx(t,{children:a.jsxs(n,{className:"text-lg font-semibold text-[#3b1f91]",children:["Add ",j," for ",h.name]})}),a.jsxs("div",{className:"mt-4",children:[a.jsx(d,{placeholder:`Search ${j}`,value:f,onChange:e=>g(e.target.value),className:"w-full mb-2"}),f&&!C&&a.jsx("div",{className:"bg-white border border-gray-300 rounded shadow max-h-40 overflow-y-auto",children:y.length>0?y.map((e=>a.jsx("div",{onClick:()=>(e=>{N(e),g(e.name)})(e),className:"p-2 cursor-pointer hover:bg-gray-100",children:e.name},e.id))):a.jsxs("div",{className:"p-2 text-gray-500",children:["No matching ",j.toLowerCase(),"s"]})}),a.jsxs("div",{className:"flex justify-between mt-4",children:[a.jsx(r,{onClick:async()=>{if(C)try{let s;s="Supplier"===j?await b({chemical_ids:[h._id],supplierId:C._id}).unwrap():await b({chemicalId:[h._id],customerId:C._id}).unwrap(),await e(),x(),i()}catch(s){alert(`Failed to add ${j.toLowerCase()}. Please try again.`)}},className:"bg-[#3b1f91] hover:bg-purple-700",disabled:v||!C,children:v?"Adding...":"+ Add"}),a.jsx(r,{onClick:i,className:"bg-red-600 hover:bg-red-700",children:"Cancel"})]})]})]})})};function de({chemicalName:e,supplier:s,fetchChemicals:l,chemicalId:i}){const[c,t]=w.useState([]),[n,d]=w.useState(!1),[o,m]=w.useState(""),[p,f]=w.useState(""),[g,C]=w.useState(""),[N,b]=w.useState(""),[v,y]=w.useState(null),{selectedItem:S}=w.useContext(h),{data:T=[],isLoading:F,error:B,refetch:M}=x(i),{data:$}=u(),[z,{isLoading:D}]=j(),O=T.filter((e=>e.name.toLowerCase().includes(o.toLowerCase())&&e.email.toLowerCase().includes(p.toLowerCase())&&e.mobile.toLowerCase().includes(g.toLowerCase())&&e.country.toLowerCase().includes(N.toLowerCase())));return a.jsxs("div",{className:"p-4 space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("h1",{className:"text-xl font-semibold text-[#3b1f91]",children:[s," for ",S?.name||"Chemical"]}),a.jsxs(r,{className:"bg-[#3b1f91] hover:bg-purple-700",onClick:()=>d(!0),children:[a.jsx(Q,{className:"w-4 h-4 mr-2"}),"Add Supplier"]}),e&&a.jsx(ne,{open:n,onClose:()=>d(!1),chemicalName:S||"Unknown Chemical",supplier:"Supplier",onAddSupplier:$,chemicalId:i,refetch:M,fetchChemicals:l})]}),c.length>0&&a.jsx("div",{className:"p-4 border-b",children:a.jsx(te,{selectedSupplier:c,supplier:T,email:T.filter((e=>c.includes(e._id))).map((e=>e.email)).join(", "),name:T.filter((e=>c.includes(e._id))).map((e=>e.name)).join(", "),chemicalName:S?.name})}),a.jsxs(L,{children:[a.jsx(k,{children:a.jsxs(A,{children:[a.jsx(_,{className:"w-12"}),a.jsx(_,{children:"Name"}),a.jsx(_,{children:"Email"}),a.jsx(_,{children:"Mobile"}),a.jsx(_,{children:"Action"})]})}),a.jsxs(I,{children:[F&&a.jsx(A,{children:a.jsx(E,{colSpan:6,className:"text-center py-8",children:"Loading suppliers..."})}),B&&a.jsx(A,{children:a.jsx(E,{colSpan:6,className:"text-center py-8 text-red-500/60",children:"No suppliers available."})}),!F&&!B&&O.map((e=>a.jsxs(A,{children:[a.jsx(E,{children:a.jsx(U,{checked:c.includes(e._id),onCheckedChange:()=>{return s=e._id,void t((e=>e.includes(s)?e.filter((e=>e!==s)):[...e,s]));var s}})}),a.jsx(E,{children:e.name}),a.jsx(E,{children:e.email}),a.jsx(E,{children:e.mobile}),a.jsx(E,{children:a.jsx(r,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-600",onClick:()=>{return s=e._id,void y(s);var s},disabled:D,children:a.jsx(ee,{className:"w-4 h-4"})})})]},e._id)))]})]}),a.jsx(H,{open:!!v,onOpenChange:()=>y(null),children:a.jsxs(J,{children:[a.jsxs(W,{children:[a.jsx(G,{children:"Are you sure?"}),a.jsx(K,{children:"This action cannot be undone. This will permanently delete the supplier from this chemical."})]}),a.jsxs(R,{children:[a.jsx(X,{children:"Cancel"}),a.jsx(Z,{onClick:async()=>{if(v)try{await z({supplierId:v,chemicalId:i}).unwrap(),M()}catch(e){alert("Failed to delete chemical")}y(null)},children:"Delete"})]})]})})]})}function oe({chemicalName:e,supplier:s}){const[l,i]=w.useState([]),{selectedItem:c}=w.useContext(h),[t,n]=w.useState(!1),[d,o]=w.useState(""),[m,x]=w.useState(""),[u,j]=w.useState(""),[C,N]=w.useState(""),{data:b=[]}=p(),{data:v=[],isLoading:y,error:S,refetch:T}=f(c._id),[F]=g(),B=v.filter((e=>e.name.toLowerCase().includes(d.toLowerCase())&&e.email.toLowerCase().includes(m.toLowerCase())&&e.mobile.toLowerCase().includes(u.toLowerCase())&&e.country.toLowerCase().includes(C.toLowerCase())));return a.jsxs("div",{className:"p-4 space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("h1",{className:"text-xl font-semibold text-[#3b1f91]",children:[s," for ",c.name]}),a.jsxs(r,{className:"bg-[#3b1f91] hover:bg-purple-700",onClick:()=>n(!0),children:[a.jsx(Q,{className:"w-4 h-4 mr-2"}),"Add Customer"]})]}),a.jsx(ne,{open:t,onClose:()=>n(!1),chemicalName:c,supplier:"Customer",onAddSupplier:b,refetch:T}),l.length>0&&a.jsx("div",{className:"p-4 border-b",children:a.jsx(te,{selectedSupplier:l,supplier:v,chemicalName:e.name,type:s})}),a.jsxs("div",{className:"border rounded-lg",children:[a.jsxs(L,{children:[a.jsx(k,{children:a.jsxs(A,{children:[a.jsx(_,{className:"w-12"}),a.jsx(_,{children:"Name"}),a.jsx(_,{children:"Email"}),a.jsx(_,{children:"Mobile"}),a.jsx(_,{children:"Country"}),a.jsx(_,{children:"Action"})]})}),a.jsxs(I,{children:[y&&a.jsx(A,{children:a.jsx(E,{colSpan:6,className:"text-center py-8",children:"Loading customers..."})}),S&&a.jsx(A,{children:a.jsx(E,{colSpan:6,className:"text-center py-8 text-red-500",children:"Error loading customers."})}),!y&&!S&&0===B.length&&a.jsx(A,{children:a.jsx(E,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No Data Found"})}),!y&&!S&&B.map((e=>a.jsxs(A,{children:[a.jsx(E,{children:a.jsx(U,{checked:l.includes(e.id),onCheckedChange:()=>{return s=e.id,void i((e=>e.includes(s)?e.filter((e=>e!==s)):[...e,s]));var s}})}),a.jsx(E,{children:e.name}),a.jsx(E,{children:e.email}),a.jsx(E,{children:e.mobile}),a.jsx(E,{children:e.country}),a.jsx(E,{children:a.jsx(r,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-600",onClick:()=>(async e=>{try{await F({customerId:e,chemicalId:c._id})}catch(s){}})(e._id),children:a.jsx(ee,{className:"w-4 h-4"})})})]},e.id)))]})]}),a.jsxs("div",{className:"flex items-center justify-between border-t p-4",children:[a.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[a.jsx("span",{children:"Items per page: 10"}),a.jsxs("span",{children:["1 - ",B.length," of ",B.length]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(r,{variant:"outline",size:"icon",disabled:!0,children:a.jsx(se,{className:"w-4 h-4"})}),a.jsx(r,{variant:"outline",size:"icon",disabled:!0,children:a.jsx(ae,{className:"w-4 h-4"})})]})]})]})]})}function me(){const{selectedChemicalName:e,setChemicalName:s}=C(),[i,t]=w.useState(!1),[n,o]=w.useState(!1),[m,h]=w.useState(null),[x,j]=w.useState(""),[f,g]=w.useState(""),[U,V]=w.useState(1),[Y,H]=w.useState(20),[J,W]=w.useState(!1),[G,K]=w.useState(null),[R,X]=w.useState(!1),[Z,Q]=w.useState(null),[se,ae]=w.useState([]),{data:te=[],isLoading:me,error:he}=u(),{data:xe=[],isLoading2:ue,error2:je}=p();N(m?._id);const pe=y(),[fe,ge]=w.useState(0);w.useEffect((()=>{Ce()}),[fe]);const Ce=async()=>{try{const e=await le.get("/api/chemical/get");ae(e.data)}catch(e){}},Ne=se.filter((e=>{const s=e.name||"",a=e.casNumber||"";return s.toLowerCase().includes(x.toLowerCase())&&a.includes(f)})),be=Ne.slice((U-1)*Y,U*Y);return a.jsxs("div",{className:"w-full",children:[a.jsxs("div",{className:"flex justify-between items-center mb-5",children:[a.jsx("div",{children:a.jsx("h2",{className:"text-lg font-bold text-[#3b1f91]",children:"Chemical List"})}),a.jsx("div",{children:a.jsx(S,{to:"/chemical-form",children:a.jsxs(r,{className:"bg-[#3b1f91] hover:bg-[#2a1664]",children:[a.jsx(ie,{})," Add Chemical"]})})})]}),a.jsx("div",{className:"mb-5",children:a.jsx("hr",{})}),a.jsx("div",{className:"rounded-md border",children:a.jsxs(L,{children:[a.jsxs(k,{children:[a.jsxs(A,{children:[a.jsx(_,{className:"w-[50px]"}),a.jsx(_,{children:"Name"}),a.jsx(_,{children:"CAS Number"}),a.jsx(_,{children:"Molecular Formula"}),a.jsx(_,{children:"Suppliers"}),a.jsx(_,{children:"Customers"}),a.jsx(_,{children:"Unit Name"})]}),a.jsxs(A,{children:[a.jsx(_,{className:"w-[50px]"}),a.jsx(_,{children:a.jsx(d,{placeholder:"Filter by Name",value:x,onChange:e=>j(e.target.value)})}),a.jsx(_,{children:a.jsx(d,{placeholder:"Filter by CAS Number",value:f,onChange:e=>g(e.target.value)})}),a.jsx(_,{}),a.jsx(_,{}),a.jsx(_,{}),a.jsx(_,{})]})]}),a.jsx(I,{children:be.map((e=>a.jsxs(A,{children:[a.jsx(E,{children:a.jsxs(z,{children:[a.jsx(D,{asChild:!0,children:a.jsx("button",{className:"p-3",children:a.jsx(re,{className:"h-4 w-4"})})}),a.jsxs(O,{children:[a.jsxs(P,{onClick:()=>(e=>{pe(`/edit-chemical-form/${e._id}`)})(e),children:[a.jsx(b,{className:"mr-2 h-4 w-4"}),"Edit"]}),a.jsxs(P,{onClick:()=>(e=>{h(e),W(!0),Q("supplier")})(e),children:[a.jsx(ce,{className:"mr-2 h-4 w-4"}),"Add Supplier"]}),a.jsxs(P,{onClick:()=>(e=>{h(e),X(!0),Q("customer")})(e),children:[a.jsx(ce,{className:"mr-2 h-4 w-4"}),"Add Customer"]}),a.jsxs(P,{onClick:()=>(async e=>{try{if((await q.fire({title:"Are you sure?",text:"This action cannot be undone!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed){const s=await le.delete(`/api/chemical/delete?id=${e._id}`);if(!s.data.success&&"Chemical deleted successfully"!==s.data.message)throw new Error(s.data.message||"Failed to delete the chemical");ae((s=>s.filter((s=>s._id!==e._id)))),await Ce(),await q.fire({title:"Deleted!",text:"The chemical has been deleted.",icon:"success",timer:2e3,showConfirmButton:!1})}else q.fire({title:"Cancelled",text:"Your chemical is safe!",icon:"info",timer:1500,showConfirmButton:!1})}catch(s){"Chemical deleted successfully"===s.message?q.fire({title:"Deleted!",text:"The chemical has been deleted.",icon:"success",timer:2e3,showConfirmButton:!1}):q.fire({title:"Error!",text:s.message||"An error occurred while deleting the chemical.",icon:"error",confirmButtonText:"Ok"})}})(e),children:[a.jsx(ee,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})}),a.jsx(E,{children:e.name}),a.jsx(E,{children:e.cas_number}),a.jsx(E,{children:e.molecular_formula}),a.jsx(E,{children:a.jsxs(r,{variant:"default",className:"bg-[#3b1f91] hover:bg-[#3b1f91]",onClick:()=>{h(e),t(!0)},children:["Suppliers (",e.supplierCount,")"]})}),a.jsx(E,{children:a.jsxs(r,{variant:"default",className:"bg-[#3b1f91] hover:bg-[#3b1f91]",onClick:()=>{h(e),o(!0)},children:["Customers(",e.customerCount,")"]})}),a.jsx(E,{children:e.unit})]},e.id)))}),m&&a.jsx(ne,{open:"supplier"===Z?J:R,onClose:()=>{"supplier"===Z?W(!1):X(!1),Q(null),ge((e=>e+1)),Ce()},chemicalName:m.name,supplier:"supplier"===Z?"Supplier":"Customer",onAddSupplier:"supplier"===Z?te:xe,chemicalId:m._id,fetchChemicals:Ce})]})}),a.jsxs("div",{className:"flex items-center justify-between space-x-2 py-4",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("p",{className:"text-sm font-medium",children:"Items per page:"}),a.jsxs(T,{defaultValue:Y.toString(),onValueChange:e=>{H(Number(e)),V(1)},children:[a.jsx(F,{className:"w-[70px]",children:a.jsx(B,{placeholder:Y.toString()})}),a.jsxs(M,{children:[a.jsx($,{value:"10",children:"10"}),a.jsx($,{value:"20",children:"20"}),a.jsx($,{value:"30",children:"30"}),a.jsx($,{value:"40",children:"40"}),a.jsx($,{value:"50",children:"50"})]})]}),a.jsx("div",{className:"text-sm font-medium",children:`${(U-1)*Y+1} - ${Math.min(U*Y,Ne.length)} of ${Ne.length}`})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(r,{variant:"outline",size:"icon",onClick:()=>{U>1&&V((e=>e-1))},disabled:1===U,children:"<"}),a.jsx(r,{variant:"outline",size:"icon",onClick:()=>{U*Y<Ne.length&&V((e=>e+1))},disabled:U*Y>=Ne.length,children:">"})]})]}),a.jsx(v,{selectedItem:m,children:m&&a.jsxs(a.Fragment,{children:[a.jsx(l,{open:i,onOpenChange:t,children:a.jsx(c,{className:"max-w-6xl",children:a.jsx(de,{chemicalName:m,chemicalId:m._id,supplier:"Supplier",fetchChemicals:Ce})})}),a.jsx(l,{open:n,onOpenChange:o,children:a.jsx(c,{className:"max-w-6xl",children:a.jsx(oe,{selectedItems:m,supplier:"Customer",chemicalName:m,chemicalId:m._id,onUpdate:()=>{Ce(),ge((e=>e+1))}})})})]})})]})}export{me as default};
//# sourceMappingURL=ChemicalTablePage-WBKofueC.js.map
