import{i as Ne,k as ye,j as e,D as Q,l as ve,B as p,m as G,n as se,o as le,I as H,p as Ae,q as Le,C as ae,r as Te,s as te,t as Fe,v as re,w as ke,x as De,y as Ee,z as Me,b as Z,S as _e,A as Ie}from"./main-CHwjN9ww.js";import{c as l,f as Pe,L as Be}from"./vendor-CgeupRFx.js";import{T as q,a as Y,b as A,c as i,d as J,e as o}from"./table-DGz3_gET.js";import{S as ie,a as ne,b as oe,c as ce,d as I}from"./select-C1q_biY9.js";import{D as Re,a as $e,b as ze,c as O}from"./dropdown-menu-0a0mVlUH.js";import{C as de}from"./checkbox-BTFFWEzA.js";import"./textarea-ODpBufAV.js";import{S as $}from"./sweetalert2.esm.all-CIewtpap.js";import{R as Oe}from"./index-BV0thCfA.js";/* empty css                   */import{M as Qe}from"./mail-BH-q4zKg.js";import{A as Ge,a as He,b as Ue,c as Ve,d as qe,e as Ye,f as Je,g as We}from"./alert-dialog-BnHNubXc.js";import{P as me}from"./plus-BZbZkXNM.js";import{T as W}from"./trash-2-BAd3O4QY.js";import{C as Ke}from"./chevron-left-C2jrQRj4.js";import{C as Xe}from"./chevron-right-CVtm6TB0.js";import{C as Ze}from"./circle-plus-rsK7Iqew.js";import{E as es}from"./ellipsis-vertical-D_kNUZep.js";import"./Combination-ChaMfiN7.js";import"./index-B5vaD5iM.js";import"./chevron-up-C-eY3GQC.js";import"./check-CYzfL35a.js";import"./isEqual-D1PYm16U.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=Ne("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),he=({selectedSupplier:T,supplier:m,email:g,name:x,type:r,chemicalName:f})=>{console.log("Type:",r),console.log("Supplier Array:",m),console.log("Supplier Email:",m[0]?.email),console.log("Condition Check:",r==="Customer",m.length>0);const[h,C]=l.useState(""),[b,w]=l.useState(""),[d,N]=l.useState(!1),[j,F]=l.useState(null),{data:k,isLoading:D,error:y}=ye(),a=k?.data||[],u=r==="Customer"&&Array.isArray(m)&&m[0]?.email?m[0].email:g;console.log("Recipient Email:",u),l.useEffect(()=>{console.log("Supplier updated:",m)},[m]);const v=async()=>{try{N(!0);const n={subject:b,message:h,recipients:Array.isArray(u)?u:[u],chemicalNames:Array.isArray(f)?f:[f]},S=await fetch("/api/chemicalMail/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),_=await S.json();if(!S.ok)throw new Error(_.message||"Failed to send email");alert("Email sent successfully!"),C(""),w("")}catch(n){console.log("Error sending email:",n),alert("Failed to send email: "+n.message)}finally{N(!1)}},M=n=>{const S=a.find(_=>_._id===n);F(S),C(S?.body||""),w(S?.subject||"")};return e.jsx("div",{children:e.jsxs(Q,{children:[e.jsx(ve,{asChild:!0,children:e.jsxs(p,{variant:"secondary",children:[e.jsx(Qe,{className:"w-4 h-4 mr-2"}),"Send Email (",T.length,")"]})}),e.jsxs(G,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[e.jsx(se,{children:e.jsx(le,{children:"Send Email to Selected Suppliers"})}),e.jsxs("div",{className:"grid gap-4 ",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2 text-sm font-medium",children:"Selected Suppliers"}),e.jsx("div",{className:"p-2 border rounded-lg max-h-[100px] overflow-y-auto",children:u})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2 text-sm font-medium",children:"Selected Chemicals"}),e.jsx("div",{className:"p-2 border rounded-lg max-h-[100px] overflow-y-auto",children:e.jsx("div",{className:"text-sm py-1",children:f})})]})]}),e.jsxs(ie,{onValueChange:M,children:[e.jsx(ne,{children:e.jsx(oe,{placeholder:"Select email template"})}),e.jsx(ce,{children:D?e.jsx(I,{value:"",disabled:!0,children:"Loading..."}):y?e.jsx(I,{value:"",disabled:!0,children:"Error loading templates"}):a.map(n=>e.jsx(I,{value:n._id,children:n.name},n._id))})]}),e.jsx(H,{placeholder:"Subject",value:b,onChange:n=>w(n.target.value)}),e.jsx("div",{className:"max-h-[300px] overflow-y-auto",children:e.jsx(Oe,{value:h,onChange:C,placeholder:"Write your message here...",theme:"snow",className:"bg-white rounded-lg"})}),e.jsx(p,{className:"bg-[#3b1f91] hover:bg-purple-700",onClick:v,disabled:d,children:d?"Sending...":"Send Email"})]})]})]})})},K=({refetch:T,open:m,onClose:g,chemicalName:x,fetchChemicals:r,chemicalId:f,supplier:h,onAddSupplier:C=[]})=>{const[b,w]=l.useState(""),[d,N]=l.useState(null);l.useEffect(()=>{m&&(w(""),N(null))},[m]);const[j,{isLoading:F}]=h==="Supplier"?Ae():Le(),k=Array.isArray(C)?C.filter(a=>a.name?.toLowerCase().includes(b.toLowerCase())):[],D=async()=>{if(!d){console.log("No supplier or customer selected");return}try{let a;h==="Supplier"?a=await j({chemical_ids:[x._id],supplierId:d._id}).unwrap():a=await j({chemicalId:[x._id],customerId:d._id}).unwrap(),console.log(`${h} ${d.name} added to ${x.name}`),await T(),r(),g()}catch(a){console.error(`Failed to add ${h.toLowerCase()}:`,a),alert(`Failed to add ${h.toLowerCase()}. Please try again.`)}},y=a=>{N(a),w(a.name)};return e.jsx(Q,{open:m,onOpenChange:a=>!a&&g(),children:e.jsxs(G,{className:"max-w-lg p-6",children:[e.jsx(se,{children:e.jsxs(le,{className:"text-lg font-semibold text-[#3b1f91]",children:["Add ",h," for ",x.name]})}),e.jsxs("div",{className:"mt-4",children:[e.jsx(H,{placeholder:`Search ${h}`,value:b,onChange:a=>w(a.target.value),className:"w-full mb-2"}),b&&!d&&e.jsx("div",{className:"bg-white border border-gray-300 rounded shadow max-h-40 overflow-y-auto",children:k.length>0?k.map(a=>e.jsx("div",{onClick:()=>y(a),className:"p-2 cursor-pointer hover:bg-gray-100",children:a.name},a.id)):e.jsxs("div",{className:"p-2 text-gray-500",children:["No matching ",h.toLowerCase(),"s"]})}),e.jsxs("div",{className:"flex justify-between mt-4",children:[e.jsx(p,{onClick:D,className:"bg-[#3b1f91] hover:bg-purple-700",disabled:F||!d,children:F?"Adding...":"+ Add"}),e.jsx(p,{onClick:g,className:"bg-red-600 hover:bg-red-700",children:"Cancel"})]})]})]})})};function ss({chemicalName:T,supplier:m,fetchChemicals:g,chemicalId:x}){console.log(x);const[r,f]=l.useState([]),[h,C]=l.useState(!1),[b,w]=l.useState(""),[d,N]=l.useState(""),[j,F]=l.useState(""),[k,D]=l.useState(""),[y,a]=l.useState(null),{selectedItem:u}=l.useContext(ae),{data:v=[],isLoading:M,error:n,refetch:S}=Te(x),{data:_}=te(),[c,{isLoading:E}]=Fe(),z=v.filter(t=>t.name.toLowerCase().includes(b.toLowerCase())&&t.email.toLowerCase().includes(d.toLowerCase())&&t.mobile.toLowerCase().includes(j.toLowerCase())&&t.country.toLowerCase().includes(k.toLowerCase())),X=t=>{f(L=>L.includes(t)?L.filter(P=>P!==t):[...L,t])},U=t=>{a(t)},V=async()=>{if(y)try{await c({supplierId:y,chemicalId:x}).unwrap(),S()}catch(t){console.error("Failed to delete chemical:",t),alert("Failed to delete chemical")}a(null)};return e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h1",{className:"text-xl font-semibold text-[#3b1f91]",children:[m," for ",u?.name||"Chemical"]}),e.jsxs(p,{className:"bg-[#3b1f91] hover:bg-purple-700",onClick:()=>C(!0),children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Add Supplier"]}),T&&e.jsx(K,{open:h,onClose:()=>C(!1),chemicalName:u||"Unknown Chemical",supplier:"Supplier",onAddSupplier:_,chemicalId:x,refetch:S,fetchChemicals:g})]}),r.length>0&&e.jsx("div",{className:"p-4 border-b",children:e.jsx(he,{selectedSupplier:r,supplier:v,email:v.filter(t=>r.includes(t._id)).map(t=>t.email).join(", "),name:v.filter(t=>r.includes(t._id)).map(t=>t.name).join(", "),chemicalName:u?.name})}),e.jsxs(q,{children:[e.jsx(Y,{children:e.jsxs(A,{children:[e.jsx(i,{className:"w-12"}),e.jsx(i,{children:"Name"}),e.jsx(i,{children:"Email"}),e.jsx(i,{children:"Mobile"}),e.jsx(i,{children:"Action"})]})}),e.jsxs(J,{children:[M&&e.jsx(A,{children:e.jsx(o,{colSpan:6,className:"text-center py-8",children:"Loading suppliers..."})}),n&&e.jsx(A,{children:e.jsx(o,{colSpan:6,className:"text-center py-8 text-red-500/60",children:"No suppliers available."})}),!M&&!n&&z.map(t=>e.jsxs(A,{children:[e.jsx(o,{children:e.jsx(de,{checked:r.includes(t._id),onCheckedChange:()=>X(t._id)})}),e.jsx(o,{children:t.name}),e.jsx(o,{children:t.email}),e.jsx(o,{children:t.mobile}),e.jsx(o,{children:e.jsx(p,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-600",onClick:()=>U(t._id),disabled:E,children:e.jsx(W,{className:"w-4 h-4"})})})]},t._id))]})]}),e.jsx(Ge,{open:!!y,onOpenChange:()=>a(null),children:e.jsxs(He,{children:[e.jsxs(Ue,{children:[e.jsx(Ve,{children:"Are you sure?"}),e.jsx(qe,{children:"This action cannot be undone. This will permanently delete the supplier from this chemical."})]}),e.jsxs(Ye,{children:[e.jsx(Je,{children:"Cancel"}),e.jsx(We,{onClick:V,children:"Delete"})]})]})})]})}function ls({chemicalName:T,supplier:m}){const[g,x]=l.useState([]),{selectedItem:r}=l.useContext(ae),[f,h]=l.useState(!1),[C,b]=l.useState(""),[w,d]=l.useState(""),[N,j]=l.useState(""),[F,k]=l.useState(""),{data:D=[]}=re(),{data:y=[],isLoading:a,error:u,refetch:v}=ke(r._id),[M]=De(),n=y.filter(c=>c.name.toLowerCase().includes(C.toLowerCase())&&c.email.toLowerCase().includes(w.toLowerCase())&&c.mobile.toLowerCase().includes(N.toLowerCase())&&c.country.toLowerCase().includes(F.toLowerCase())),S=c=>{x(E=>E.includes(c)?E.filter(z=>z!==c):[...E,c])};console.log(g);const _=async c=>{try{await M({customerId:c,chemicalId:r._id})}catch(E){console.error("Failed to remove customer:",E)}};return e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h1",{className:"text-xl font-semibold text-[#3b1f91]",children:[m," for ",r.name]}),e.jsxs(p,{className:"bg-[#3b1f91] hover:bg-purple-700",onClick:()=>h(!0),children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Add Customer"]})]}),e.jsx(K,{open:f,onClose:()=>h(!1),chemicalName:r,supplier:"Customer",onAddSupplier:D,refetch:v}),g.length>0&&e.jsx("div",{className:"p-4 border-b",children:e.jsx(he,{selectedSupplier:g,supplier:y,chemicalName:T.name,type:m})}),e.jsxs("div",{className:"border rounded-lg",children:[e.jsxs(q,{children:[e.jsx(Y,{children:e.jsxs(A,{children:[e.jsx(i,{className:"w-12"}),e.jsx(i,{children:"Name"}),e.jsx(i,{children:"Email"}),e.jsx(i,{children:"Mobile"}),e.jsx(i,{children:"Country"}),e.jsx(i,{children:"Action"})]})}),e.jsxs(J,{children:[a&&e.jsx(A,{children:e.jsx(o,{colSpan:6,className:"text-center py-8",children:"Loading customers..."})}),u&&e.jsx(A,{children:e.jsx(o,{colSpan:6,className:"text-center py-8 text-red-500",children:"Error loading customers."})}),!a&&!u&&n.length===0&&e.jsx(A,{children:e.jsx(o,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No Data Found"})}),!a&&!u&&n.map(c=>e.jsxs(A,{children:[e.jsx(o,{children:e.jsx(de,{checked:g.includes(c.id),onCheckedChange:()=>S(c.id)})}),e.jsx(o,{children:c.name}),e.jsx(o,{children:c.email}),e.jsx(o,{children:c.mobile}),e.jsx(o,{children:c.country}),e.jsx(o,{children:e.jsx(p,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-600",onClick:()=>_(c._id),children:e.jsx(W,{className:"w-4 h-4"})})})]},c.id))]})]}),e.jsxs("div",{className:"flex items-center justify-between border-t p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{children:"Items per page: 10"}),e.jsxs("span",{children:["1 - ",n.length," of ",n.length]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{variant:"outline",size:"icon",disabled:!0,children:e.jsx(Ke,{className:"w-4 h-4"})}),e.jsx(p,{variant:"outline",size:"icon",disabled:!0,children:e.jsx(Xe,{className:"w-4 h-4"})})]})]})]})]})}function As(){Ee();const[T,m]=l.useState(!1),[g,x]=l.useState(!1),[r,f]=l.useState(null),[h,C]=l.useState(""),[b,w]=l.useState(""),[d,N]=l.useState(1),[j,F]=l.useState(20),[k,D]=l.useState(!1);l.useState(null);const[y,a]=l.useState(!1),[u,v]=l.useState(null),[M,n]=l.useState([]),{data:S=[],isLoading:_,error:c}=te(),{data:E=[],isLoading2:z,error2:X}=re();Me(r?._id);const U=Pe(),[V,t]=l.useState(0);l.useEffect(()=>{L()},[V]);const L=async()=>{try{const s=await Z.get("/api/chemical/get");n(s.data)}catch(s){console.error("Error fetching chemicals:",s)}},P=M.filter(s=>{const B=s.name||"",R=s.casNumber||"";return B.toLowerCase().includes(h.toLowerCase())&&R.includes(b)}),ue=P.slice((d-1)*j,d*j),xe=()=>{d*j<P.length&&N(s=>s+1)},je=()=>{d>1&&N(s=>s-1)},pe=s=>{F(Number(s)),N(1)},ge=s=>{console.log("Edit",s),U(`/edit-chemical-form/${s._id}`)},fe=s=>{f(s),D(!0),v("supplier")},Ce=s=>{f(s),a(!0),v("customer")},Se=async s=>{try{if((await $.fire({title:"Are you sure?",text:"This action cannot be undone!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed){const R=await Z.delete(`/api/chemical/delete?id=${s._id}`);if(R.data.success||R.data.message==="Chemical deleted successfully")n(be=>be.filter(we=>we._id!==s._id)),await L(),await $.fire({title:"Deleted!",text:"The chemical has been deleted.",icon:"success",timer:2e3,showConfirmButton:!1});else throw new Error(R.data.message||"Failed to delete the chemical")}else $.fire({title:"Cancelled",text:"Your chemical is safe!",icon:"info",timer:1500,showConfirmButton:!1})}catch(B){console.error("Error deleting chemical:",B),B.message==="Chemical deleted successfully"?$.fire({title:"Deleted!",text:"The chemical has been deleted.",icon:"success",timer:2e3,showConfirmButton:!1}):$.fire({title:"Error!",text:B.message||"An error occurred while deleting the chemical.",icon:"error",confirmButtonText:"Ok"})}};return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-5",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-lg font-bold text-[#3b1f91]",children:"Chemical List"})}),e.jsx("div",{children:e.jsx(Be,{to:"/chemical-form",children:e.jsxs(p,{className:"bg-[#3b1f91] hover:bg-[#2a1664]",children:[e.jsx(Ze,{})," Add Chemical"]})})})]}),e.jsx("div",{className:"mb-5",children:e.jsx("hr",{})}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(q,{children:[e.jsxs(Y,{children:[e.jsxs(A,{children:[e.jsx(i,{className:"w-[50px]"}),e.jsx(i,{children:"Name"}),e.jsx(i,{children:"CAS Number"}),e.jsx(i,{children:"Molecular Formula"}),e.jsx(i,{children:"Suppliers"}),e.jsx(i,{children:"Customers"}),e.jsx(i,{children:"Unit Name"})]}),e.jsxs(A,{children:[e.jsx(i,{className:"w-[50px]"}),e.jsx(i,{children:e.jsx(H,{placeholder:"Filter by Name",value:h,onChange:s=>C(s.target.value)})}),e.jsx(i,{children:e.jsx(H,{placeholder:"Filter by CAS Number",value:b,onChange:s=>w(s.target.value)})}),e.jsx(i,{}),e.jsx(i,{}),e.jsx(i,{}),e.jsx(i,{})]})]}),e.jsx(J,{children:ue.map(s=>e.jsxs(A,{children:[e.jsx(o,{children:e.jsxs(Re,{children:[e.jsx($e,{asChild:!0,children:e.jsx("button",{className:"p-3",children:e.jsx(es,{className:"h-4 w-4"})})}),e.jsxs(ze,{children:[e.jsxs(O,{onClick:()=>ge(s),children:[e.jsx(_e,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(O,{onClick:()=>fe(s),children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),"Add Supplier"]}),e.jsxs(O,{onClick:()=>Ce(s),children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),"Add Customer"]}),e.jsxs(O,{onClick:()=>Se(s),children:[e.jsx(W,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})}),e.jsx(o,{children:s.name}),e.jsx(o,{children:s.cas_number}),e.jsx(o,{children:s.molecular_formula}),e.jsx(o,{children:e.jsxs(p,{variant:"default",className:"bg-[#3b1f91] hover:bg-[#3b1f91]",onClick:()=>{f(s),m(!0)},children:["Suppliers (",s.supplierCount,")"]})}),e.jsx(o,{children:e.jsxs(p,{variant:"default",className:"bg-[#3b1f91] hover:bg-[#3b1f91]",onClick:()=>{f(s),x(!0)},children:["Customers(",s.customerCount,")"]})}),e.jsx(o,{children:s.unit})]},s.id))}),r&&e.jsx(K,{open:u==="supplier"?k:y,onClose:()=>{u==="supplier"?D(!1):a(!1),v(null),t(s=>s+1),L()},chemicalName:r.name,supplier:u==="supplier"?"Supplier":"Customer",onAddSupplier:u==="supplier"?S:E,chemicalId:r._id,fetchChemicals:L})]})}),e.jsxs("div",{className:"flex items-center justify-between space-x-2 py-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Items per page:"}),e.jsxs(ie,{defaultValue:j.toString(),onValueChange:pe,children:[e.jsx(ne,{className:"w-[70px]",children:e.jsx(oe,{placeholder:j.toString()})}),e.jsxs(ce,{children:[e.jsx(I,{value:"10",children:"10"}),e.jsx(I,{value:"20",children:"20"}),e.jsx(I,{value:"30",children:"30"}),e.jsx(I,{value:"40",children:"40"}),e.jsx(I,{value:"50",children:"50"})]})]}),e.jsx("div",{className:"text-sm font-medium",children:`${(d-1)*j+1} - ${Math.min(d*j,P.length)} of ${P.length}`})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(p,{variant:"outline",size:"icon",onClick:je,disabled:d===1,children:"<"}),e.jsx(p,{variant:"outline",size:"icon",onClick:xe,disabled:d*j>=P.length,children:">"})]})]}),e.jsx(Ie,{selectedItem:r,children:r&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{open:T,onOpenChange:m,children:e.jsx(G,{className:"max-w-6xl",children:e.jsx(ss,{chemicalName:r,chemicalId:r._id,supplier:"Supplier",fetchChemicals:L})})}),e.jsx(Q,{open:g,onOpenChange:x,children:e.jsx(G,{className:"max-w-6xl",children:e.jsx(ls,{selectedItems:r,supplier:"Customer",chemicalName:r,chemicalId:r._id,onUpdate:()=>{L(),t(s=>s+1)}})})})]})})]})}export{As as default};
