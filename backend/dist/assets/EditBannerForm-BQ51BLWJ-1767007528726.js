import{a as R,f as C,dN as l,r as m,dZ as U,d_ as _,j as a,dR as g,L as f,dX as D,bl as S,R as N,dT as T,be as I,dU as $,dS as c,as as V,c as O,dm as r}from"./index-DgWUCWkU-1767007528726.js";const{Option:u}=S,Q=()=>{const{id:p}=R(),F=C(),[d]=l.useForm(),[o,y]=m.useState(!1),[L,b]=m.useState([]),[B,E]=m.useState(!0),{data:e,isLoading:P}=U(p),[w]=_();m.useEffect(()=>{(async()=>{try{const s=await O.get("/api/menulist/get-menu");s.data.success?b(s.data.data):r.error("Failed to load menu list")}catch(s){console.error("Error fetching menu list:",s),r.error("Error fetching menu list")}finally{E(!1)}})()},[]),m.useEffect(()=>{e&&d.setFieldsValue({title:e.title,altName:e.altName,details:e.details,imgName:e.imgName,pageSlug:e.pageSlug||"",image:e.image?[{name:e.imgName,url:`/api/image/download/${e.image}`}]:[]})},[e,d]);const q=t=>{y(!0),d.setFieldsValue({imgName:t.file.name,image:t.fileList})},M=async t=>{var s,n,h,x,j;try{if(!((s=t.title)!=null&&s.trim())){r.error("Title is required");return}if(!((n=t.altName)!=null&&n.trim())){r.error("Alt Name is required");return}if(!t.pageSlug){r.error("Page Slug is required");return}const i=new FormData;o&&((x=(h=t.image)==null?void 0:h[0])!=null&&x.originFileObj)?(i.append("image",t.image[0].originFileObj),i.append("imgName",t.image[0].name)):i.append("imgName",t.imgName||e.imgName),i.append("title",t.title.trim()),i.append("altName",t.altName.trim()),i.append("details",((j=t.details)==null?void 0:j.trim())||""),i.append("pageSlug",t.pageSlug),await w({id:p,bannerData:i}),r.success("Banner updated successfully"),F("/banner-table")}catch(i){console.error(i),r.error("Failed to update banner")}};return P?a.jsx("div",{children:"Loading..."}):a.jsxs("div",{children:[a.jsxs(g,{className:"px-4 py-6",children:[a.jsx(g.Item,{children:a.jsxs(f,{to:"/dashboard",children:[a.jsx(D,{})," Dashboard"]})}),a.jsx(g.Item,{children:a.jsx(f,{to:"/banner-table",children:"Banner Management"})}),a.jsx(g.Item,{children:"Edit Banner"})]}),a.jsxs("div",{className:"p-6",children:[a.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Edit Banner"}),a.jsxs(l,{form:d,layout:"vertical",onFinish:M,initialValues:{title:(e==null?void 0:e.title)||"",altName:(e==null?void 0:e.altName)||"",details:(e==null?void 0:e.details)||"",imgName:(e==null?void 0:e.imgName)||"",pageSlug:(e==null?void 0:e.pageSlug)||"",image:e!=null&&e.image?[{name:e.imgName,url:`/api/image/download/${e.image}`}]:[]},children:[a.jsx(l.Item,{name:"pageSlug",label:"Page Slug",rules:[{required:!0,message:"Please select a page slug!"}],children:a.jsx(S,{placeholder:"Select a menu item",loading:B,children:L.map(t=>a.jsxs(N.Fragment,{children:[a.jsx(u,{value:t.parent.path,className:"font-bold",children:t.parent.name},`${t._id}-parent`),t.children&&t.children.map(s=>a.jsxs(N.Fragment,{children:[a.jsxs(u,{value:s.path,className:"pl-5",children:[a.jsx("span",{children:" ├── "}),s.name]},s._id),s.subChildren&&s.subChildren.map(n=>a.jsxs(u,{value:n.path,className:"pl-10",children:[a.jsx("span",{children:"├────"})," ",n.name]},n._id))]},s._id))]},t._id))})}),a.jsx(l.Item,{name:"image",label:"Banner Image",valuePropName:"fileList",getValueFromEvent:t=>t&&t.fileList,children:a.jsx(T,{maxCount:1,listType:"picture",beforeUpload:()=>!1,onChange:q,defaultFileList:e!=null&&e.image?[{name:e.imgName,url:`/api/image/download/${e.image}`}]:[],children:a.jsx(I,{icon:a.jsx($,{}),children:o?"Change Image":"Upload New Image"})})}),a.jsx(l.Item,{name:"imgName",label:"Image Name",rules:[{required:!0,message:"Please input image name!"}],children:a.jsx(c,{disabled:o})}),a.jsx(l.Item,{name:"title",label:"Title",rules:[{required:!0,message:"Please input title!"}],children:a.jsx(c,{})}),a.jsx(l.Item,{name:"altName",label:"Alt Name",rules:[{required:!0,message:"Please input alt name!"}],children:a.jsx(c,{})}),a.jsx(l.Item,{name:"details",label:"Details",rules:[{message:"Please input details!"}],children:a.jsx(V,{theme:"snow"})}),a.jsx(l.Item,{children:a.jsx(I,{type:"primary",htmlType:"submit",children:"Update"})})]})]})]})};export{Q as default};
