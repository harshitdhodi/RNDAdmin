import{a as E,f as P,dP as s,r as o,d$ as R,e0 as $,j as e,dT as p,L as I,dZ as U,bl as b,R as y,dV as A,be as g,dW as D,dU as m,dm as x,as as O,c as V,dp as c}from"./index-DYP9jOq_-1769085494578.js";import{R as j}from"./MinusCircleOutlined-D6sOaqvE-1769085494578.js";const{Option:f}=b,{TextArea:_}=m,Q=()=>{const{id:N}=E(),k=P(),[u]=s.useForm(),[h,S]=o.useState(!1),[L,q]=o.useState([]),[F,B]=o.useState(!0),{data:a,isLoading:C}=R(N),[T]=$();o.useEffect(()=>{(async()=>{try{const t=await V.get("/api/menulist/get-menu");t.data.success?q(t.data.data):c.error("Failed to load menu list")}catch(t){console.error("Error fetching menu list:",t),c.error("Error fetching menu list")}finally{B(!1)}})()},[]),o.useEffect(()=>{a&&u.setFieldsValue({title:a.title||[],altName:a.altName,details:a.details,imgName:a.imgName,pageSlug:a.pageSlug||"",heading:a.heading||[],subheading:a.subheading,description:a.description,marque:a.marque,link:a.link||[],image:a.image?[{name:a.imgName,url:`/api/image/download/${a.image}`}]:[]})},[a,u]);const M=i=>{S(!0),u.setFieldsValue({imgName:i.file.name,image:i.fileList})},w=async i=>{var t,n,r,d;try{if(!i.title||i.title.length===0){c.error("Title is required");return}if(!((t=i.altName)!=null&&t.trim())){c.error("Alt Name is required");return}if(!i.pageSlug){c.error("Page Slug is required");return}const l=new FormData;h&&((r=(n=i.image)==null?void 0:n[0])!=null&&r.originFileObj)?(l.append("image",i.image[0].originFileObj),l.append("imgName",i.image[0].name)):l.append("imgName",i.imgName||a.imgName),l.append("title",JSON.stringify(i.title)),l.append("altName",i.altName.trim()),l.append("details",((d=i.details)==null?void 0:d.trim())||""),l.append("pageSlug",i.pageSlug),l.append("heading",JSON.stringify(i.heading||[])),l.append("subheading",i.subheading||""),l.append("description",i.description||""),l.append("marque",i.marque||""),l.append("link",JSON.stringify(i.link||[])),await T({id:N,bannerData:l}),c.success("Banner updated successfully"),k("/banner-table")}catch(l){console.error(l),c.error("Failed to update banner")}};return C?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{children:[e.jsxs(p,{className:"px-4 py-6",children:[e.jsx(p.Item,{children:e.jsxs(I,{to:"/dashboard",children:[e.jsx(U,{})," Dashboard"]})}),e.jsx(p.Item,{children:e.jsx(I,{to:"/banner-table",children:"Banner Management"})}),e.jsx(p.Item,{children:"Edit Banner"})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Edit Banner"}),e.jsxs(s,{form:u,layout:"vertical",onFinish:w,initialValues:{title:(a==null?void 0:a.title)||[],altName:(a==null?void 0:a.altName)||"",details:(a==null?void 0:a.details)||"",imgName:(a==null?void 0:a.imgName)||"",pageSlug:(a==null?void 0:a.pageSlug)||"",heading:(a==null?void 0:a.heading)||[],subheading:(a==null?void 0:a.subheading)||"",description:(a==null?void 0:a.description)||"",marque:(a==null?void 0:a.marque)||"",link:(a==null?void 0:a.link)||[],image:a!=null&&a.image?[{name:a.imgName,url:`/api/image/download/${a.image}`}]:[]},children:[e.jsx(s.Item,{name:"pageSlug",label:"Page Slug",rules:[{required:!0,message:"Please select a page slug!"}],children:e.jsx(b,{placeholder:"Select a menu item",loading:F,children:L.map(i=>e.jsxs(y.Fragment,{children:[e.jsx(f,{value:i.parent.path,className:"font-bold",children:i.parent.name},`${i._id}-parent`),i.children&&i.children.map(t=>e.jsxs(y.Fragment,{children:[e.jsxs(f,{value:t.path,className:"pl-5",children:[e.jsx("span",{children:" ├── "}),t.name]},t._id),t.subChildren&&t.subChildren.map(n=>e.jsxs(f,{value:n.path,className:"pl-10",children:[e.jsx("span",{children:"├────"})," ",n.name]},n._id))]},t._id))]},i._id))})}),e.jsx(s.Item,{name:"image",label:"Banner Image",valuePropName:"fileList",getValueFromEvent:i=>i&&i.fileList,children:e.jsx(A,{maxCount:1,listType:"picture",beforeUpload:()=>!1,onChange:M,defaultFileList:a!=null&&a.image?[{name:a.imgName,url:`/api/image/download/${a.image}`}]:[],children:e.jsx(g,{icon:e.jsx(D,{}),children:h?"Change Image":"Upload New Image"})})}),e.jsx(s.Item,{name:"imgName",label:"Image Name",rules:[{required:!0,message:"Please input image name!"}],children:e.jsx(m,{disabled:h})}),e.jsx(s.List,{name:"title",children:(i,{add:t,remove:n})=>e.jsxs(e.Fragment,{children:[i.map((r,d)=>e.jsx(s.Item,{label:d===0?"Title":"",required:!1,children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(s.Item,{...r,validateTrigger:["onChange","onBlur"],rules:[{required:!0,whitespace:!0,message:"Please input title or delete this field."}],noStyle:!0,children:e.jsx(m,{placeholder:"Title"})}),e.jsx(j,{className:"dynamic-delete-button",onClick:()=>n(r.name)})]})},r.key)),e.jsx(s.Item,{label:i.length===0?"Title":"",children:e.jsx(g,{type:"dashed",onClick:()=>t(),block:!0,icon:e.jsx(x,{}),children:"Add Title"})})]})}),e.jsx(s.Item,{name:"altName",label:"Alt Name",rules:[{required:!0,message:"Please input alt name!"}],children:e.jsx(m,{})}),e.jsx(s.List,{name:"heading",children:(i,{add:t,remove:n})=>e.jsxs(e.Fragment,{children:[i.map((r,d)=>e.jsx(s.Item,{label:d===0?"Heading":"",required:!1,children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(s.Item,{...r,validateTrigger:["onChange","onBlur"],noStyle:!0,children:e.jsx(m,{placeholder:"Heading"})}),e.jsx(j,{className:"dynamic-delete-button",onClick:()=>n(r.name)})]})},r.key)),e.jsx(s.Item,{label:i.length===0?"Heading":"",children:e.jsx(g,{type:"dashed",onClick:()=>t(),block:!0,icon:e.jsx(x,{}),children:"Add Heading"})})]})}),e.jsx(s.Item,{name:"subheading",label:"Subheading",children:e.jsx(m,{})}),e.jsx(s.Item,{name:"marque",label:"Marque Text",children:e.jsx(m,{})}),e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Social Media Links"}),e.jsx(s.List,{name:"link",children:(i,{add:t,remove:n})=>e.jsxs(e.Fragment,{children:[i.map(({key:r,name:d,...l})=>e.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"8px",alignItems:"center"},children:[e.jsx(s.Item,{...l,name:[d,"name"],rules:[{required:!0,message:"Missing name"}],style:{marginBottom:0,flex:1},children:e.jsx(m,{placeholder:"Link Name (e.g. Facebook)"})}),e.jsx(s.Item,{...l,name:[d,"url"],rules:[{required:!0,message:"Missing url"}],style:{marginBottom:0,flex:2},children:e.jsx(m,{placeholder:"URL"})}),e.jsx(j,{onClick:()=>n(d)})]},r)),e.jsx(s.Item,{children:e.jsx(g,{type:"dashed",onClick:()=>t(),block:!0,icon:e.jsx(x,{}),children:"Add Social Link"})})]})}),e.jsx(s.Item,{name:"description",label:"Description",children:e.jsx(_,{rows:4})}),e.jsx(s.Item,{name:"details",label:"Details",rules:[{message:"Please input details!"}],children:e.jsx(O,{theme:"snow"})}),e.jsx(s.Item,{children:e.jsx(g,{type:"primary",htmlType:"submit",children:"Update"})})]})]})]})};export{Q as default};
