import{r as e,j as s}from"./react-BfBsRgn0.js";import{c as a}from"./react-hook-form-Dn0Bw783.js";import{t}from"./@hookform-DBV5tMOk.js";import{o as l,s as i,a as r,b as m}from"./zod-CO6CETVj.js";import{ad as c,g as d,an as o,I as n,B as j}from"./index-mCSb4W1J.js";import{S as p,a as x,b as u,c as h,d as g}from"./select-BjvvJv_x.js";import{C as f,a as b}from"./card--g8pM1Dm.js";import{R as y}from"./react-quill-O9LY_HeH.js";import{X as N,G as v}from"./lucide-D6BDVLHE.js";import"./classnames-C3ovBj6j.js";import"./react-dom-DwrudmHt.js";import"./scheduler-BFk34ZWe.js";import"./react-redux-DbBiFgqA.js";import"./use-sync-external-store-DdeJV4gQ.js";import"./@reduxjs-UCSEaN3g.js";import"./redux-C5Huw2aR.js";import"./immer-DgfQkf_7.js";import"./redux-thunk-B3S1iNVp.js";import"./reselect-BSOs5pU1.js";import"./js-cookie-BXEMiIsG.js";import"./react-router-DUJjWq5j.js";import"./cookie-BUTH-fPQ.js";import"./@radix-ui-BWjeGzol.js";import"./aria-hidden-BHUiN-rI.js";import"./react-remove-scroll-yauc81_r.js";import"./tslib-Bc9CN1Ef.js";import"./react-remove-scroll-bar-BcxDecei.js";import"./react-style-singleton-C1QVuB2c.js";import"./get-nonce-BYiZHLe3.js";import"./use-sidecar-BA4C4RS7.js";import"./use-callback-ref-Cvx1xcTX.js";import"./@floating-ui-BSChQBl3.js";import"./class-variance-authority-DeOWI0hf.js";import"./clsx-BeLtu-UY.js";import"./tailwind-merge-D2VJQb_v.js";import"./axios-BoylL8Pu.js";import"./lodash-CtK3uT03.js";import"./quill-CMG--X-K.js";const w=l({category:i().min(1,"Please select a category"),template:i().min(1,"Please select a template"),email:i().min(1,"To field is required").email("Invalid email format"),cc_email:r(i()).optional(),subject:i().min(1,"Subject is required"),body:i().min(1,"Body is required"),attachment:m().optional()});function S({defaultTo:l="",onSuccess:i}){const[r,m]=e.useState(!1),{data:S,isLoading:C}=c(),{data:F,isLoading:k}=d(),[E,{isLoading:_}]=o(),[q,z]=e.useState(null),[L,T]=e.useState([]),[B,P]=e.useState([]),{register:I,handleSubmit:V,formState:{errors:D},reset:R,watch:A,setValue:G}=a({resolver:t(w)}),W=A("category"),Y=A("template"),Z=A("body");e.useEffect((()=>{if(Y&&(null==F?void 0:F.data)){const e=F.data.find((e=>e._id===Y));e&&(G("subject",e.subject),G("body",e.body))}}),[Y,F,G]),e.useEffect((()=>{l&&G("email",l)}),[l,G]);return e.useEffect((()=>{if(W&&(null==F?void 0:F.data)){const e=F.data.filter((e=>{var s;return(null==(s=e.category)?void 0:s.emailCategory)===W}));P(e),G("template","")}}),[W,F,G]),s.jsx(f,{className:"w-full mx-auto max-h-[80vh] flex flex-col",children:s.jsx(b,{className:"p-6 overflow-y-auto",children:s.jsxs("form",{onSubmit:V((async e=>{const s=new FormData;s.append("email",e.email),s.append("cc_email",L),s.append("subject",e.subject),s.append("body",e.body),q&&s.append("attachment",q),m(!0);try{await E(s).unwrap(),alert("Email sent successfully!"),R(),z(null),T([]),null==i||i()}catch(a){alert("Failed to send email. Please try again.")}finally{m(!1)}})),className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{htmlFor:"category",className:"text-sm font-medium",children:"Select Category"}),s.jsxs(p,{onValueChange:e=>G("category",e),children:[s.jsx(x,{id:"category",children:s.jsx(u,{placeholder:"Select Category"})}),s.jsx(h,{children:C?s.jsx(g,{disabled:!0,children:"Loading categories..."}):S&&S.length>0?S.map((e=>s.jsx(g,{value:e.emailCategory,children:e.emailCategory},e._id))):s.jsx(g,{disabled:!0,children:"No categories available"})})]}),D.category&&s.jsx("p",{className:"text-sm text-red-500",children:D.category.message})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{htmlFor:"template",className:"text-sm font-medium",children:"Select Email Template"}),s.jsxs(p,{onValueChange:e=>G("template",e),disabled:!W,children:[s.jsx(x,{id:"template",children:s.jsx(u,{placeholder:W?"Select Email Template":"Please select a category first"})}),s.jsx(h,{children:k?s.jsx(g,{disabled:!0,children:"Loading templates..."}):0===B.length?s.jsx(g,{disabled:!0,children:"No templates in this category"}):B.map((e=>s.jsx(g,{value:e._id,children:e.name},e._id)))})]}),D.template&&s.jsx("p",{className:"text-sm text-red-500",children:D.template.message})]})]}),s.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{htmlFor:"email",className:"text-sm font-medium",children:"To*"}),s.jsx(n,{id:"email",type:"text",placeholder:"Recipient email",...I("email"),"aria-invalid":D.email?"true":"false"}),D.email&&s.jsx("p",{className:"text-sm text-red-500",children:D.email.message})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{htmlFor:"cc_email",className:"text-sm font-medium",children:"CC"}),s.jsxs("div",{className:"relative",children:[s.jsx(n,{id:"cc_email",type:"text",placeholder:"Enter CC email",onBlur:e=>{var s;(s=e.target.value)&&!L.includes(s)&&T((e=>[...e,s])),e.target.value=""}}),L.length>0&&s.jsx("div",{className:"absolute top-full mt-1 z-10 bg-white border rounded-md p-2 w-full shadow-sm",children:L.map(((e,a)=>s.jsxs("div",{className:"flex items-center justify-between py-1",children:[s.jsx("span",{className:"text-sm",children:e}),s.jsx(j,{type:"button",variant:"ghost",size:"sm",onClick:()=>(e=>{T((s=>s.filter(((s,a)=>a!==e))))})(a),children:s.jsx(N,{className:"h-3 w-3"})})]},a)))})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{htmlFor:"subject",className:"text-sm font-medium",children:"Subject*"}),s.jsx(n,{id:"subject",type:"text",placeholder:"Subject",...I("subject"),"aria-invalid":D.subject?"true":"false"}),D.subject&&s.jsx("p",{className:"text-sm text-red-500",children:D.subject.message})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{htmlFor:"body",className:"text-sm font-medium",children:"Body*"}),s.jsx(y,{value:Z||"",onChange:e=>G("body",e),className:"bg-white"}),D.body&&s.jsx("p",{className:"text-sm text-red-500",children:D.body.message})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{htmlFor:"file-upload",className:"text-sm font-medium",children:"Attachments"}),s.jsxs("div",{className:"border-2 border-dashed rounded-lg p-6 text-center",children:[s.jsx("input",{type:"file",onChange:e=>{const s=e.target.files[0];z(s)},className:"hidden",id:"file-upload"}),s.jsxs("label",{htmlFor:"file-upload",className:"cursor-pointer",children:[s.jsx(v,{className:"mx-auto h-12 w-12 text-gray-400"}),s.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Drag and drop files here or click to browse"})]})]}),q&&s.jsx("div",{className:"mt-2",children:s.jsxs("div",{className:"flex items-center justify-between bg-gray-100 p-2 rounded",children:[s.jsx("span",{className:"text-sm truncate",children:q.name}),s.jsx(j,{type:"button",variant:"ghost",size:"sm",onClick:()=>{z(null)},children:s.jsx(N,{className:"h-4 w-4"})})]})})]}),s.jsx(j,{type:"submit",className:"w-full",disabled:r||_,children:r||_?"Sending...":"Send Email"})]})})})}export{S as default};
