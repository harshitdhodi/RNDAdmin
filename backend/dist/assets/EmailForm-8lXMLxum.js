import{i as H,b2 as X,k as J,bc as K,j as e,I as y,B as b,X as w}from"./main-B_OYodTY.js";import{c}from"./vendor-CxfDVdnA.js";import{b as O}from"./index.esm-BeVsDzK4.js";import{t as W,o as Y,a as Z,s as r,b as $}from"./index-BS-ryoxO.js";import{S as F,a as T,b as _,c as L,d as m}from"./select-DTlpTADM.js";import{C as ee,a as se}from"./card-DsLLaLCA.js";/* empty css                   */import{R as ae}from"./index-CSXG-3Bq.js";import"./Combination-DgqiAUoz.js";import"./index-BIwstZJs.js";import"./check-DEVVPDR5.js";import"./chevron-up-EpGLJbSm.js";import"./isEqual-D12pi9da.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=H("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),le=Y({category:r().min(1,"Please select a category"),template:r().min(1,"Please select a template"),email:r().min(1,"To field is required").email("Invalid email format"),cc_email:$(r()).optional(),subject:r().min(1,"Subject is required"),body:r().min(1,"Body is required"),attachment:Z().optional()});function ye({defaultTo:p="",onSuccess:k}){const[f,N]=c.useState(!1),{data:h,isLoading:I}=X(),{data:i,isLoading:B}=J(),[A,{isLoading:v}]=K(),[n,x]=c.useState(null),[o,u]=c.useState([]),[S,P]=c.useState([]);console.log(i.data);const{register:C,handleSubmit:R,formState:{errors:t},reset:V,watch:j,setValue:l}=O({resolver:W(le)}),d=j("category"),g=j("template"),q=j("body");c.useEffect(()=>{if(g&&i?.data){const s=i.data.find(a=>a._id===g);s&&(l("subject",s.subject),l("body",s.body))}},[g,i,l]),c.useEffect(()=>{p&&l("email",p)},[p,l]);const z=s=>{const a=s.target.files[0];x(a)},D=()=>{x(null)},Q=s=>{s&&!o.includes(s)&&u(a=>[...a,s])},G=s=>{u(a=>a.filter((E,U)=>U!==s))},M=async s=>{const a=new FormData;a.append("email",s.email),a.append("cc_email",o),a.append("subject",s.subject),a.append("body",s.body),n&&a.append("attachment",n),N(!0);try{await A(a).unwrap(),alert("Email sent successfully!"),V(),x(null),u([]),k?.()}catch(E){console.error("Error sending email:",E),alert("Failed to send email. Please try again.")}finally{N(!1)}};return c.useEffect(()=>{if(d&&i?.data){const s=i.data.filter(a=>a.category?.emailCategory===d);P(s),l("template","")}},[d,i,l]),e.jsx(ee,{className:"w-full mx-auto max-h-[80vh] flex flex-col",children:e.jsx(se,{className:"p-6 overflow-y-auto",children:e.jsxs("form",{onSubmit:R(M),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"category",className:"text-sm font-medium",children:"Select Category"}),e.jsxs(F,{onValueChange:s=>l("category",s),children:[e.jsx(T,{id:"category",children:e.jsx(_,{placeholder:"Select Category"})}),e.jsx(L,{children:I?e.jsx(m,{disabled:!0,children:"Loading categories..."}):h&&h.length>0?h.map(s=>e.jsx(m,{value:s.emailCategory,children:s.emailCategory},s._id)):e.jsx(m,{disabled:!0,children:"No categories available"})})]}),t.category&&e.jsx("p",{className:"text-sm text-red-500",children:t.category.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"template",className:"text-sm font-medium",children:"Select Email Template"}),e.jsxs(F,{onValueChange:s=>l("template",s),disabled:!d,children:[e.jsx(T,{id:"template",children:e.jsx(_,{placeholder:d?"Select Email Template":"Please select a category first"})}),e.jsx(L,{children:B?e.jsx(m,{disabled:!0,children:"Loading templates..."}):S.length===0?e.jsx(m,{disabled:!0,children:"No templates in this category"}):S.map(s=>e.jsx(m,{value:s._id,children:s.name},s._id))})]}),t.template&&e.jsx("p",{className:"text-sm text-red-500",children:t.template.message})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"email",className:"text-sm font-medium",children:"To*"}),e.jsx(y,{id:"email",type:"text",placeholder:"Recipient email",...C("email"),"aria-invalid":t.email?"true":"false"}),t.email&&e.jsx("p",{className:"text-sm text-red-500",children:t.email.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"cc_email",className:"text-sm font-medium",children:"CC"}),e.jsxs("div",{className:"relative",children:[e.jsx(y,{id:"cc_email",type:"text",placeholder:"Enter CC email",onBlur:s=>{Q(s.target.value),s.target.value=""}}),o.length>0&&e.jsx("div",{className:"absolute top-full mt-1 z-10 bg-white border rounded-md p-2 w-full shadow-sm",children:o.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsx("span",{className:"text-sm",children:s}),e.jsx(b,{type:"button",variant:"ghost",size:"sm",onClick:()=>G(a),children:e.jsx(w,{className:"h-3 w-3"})})]},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"subject",className:"text-sm font-medium",children:"Subject*"}),e.jsx(y,{id:"subject",type:"text",placeholder:"Subject",...C("subject"),"aria-invalid":t.subject?"true":"false"}),t.subject&&e.jsx("p",{className:"text-sm text-red-500",children:t.subject.message})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"body",className:"text-sm font-medium",children:"Body*"}),e.jsx(ae,{value:q||"",onChange:s=>l("body",s),className:"bg-white"}),t.body&&e.jsx("p",{className:"text-sm text-red-500",children:t.body.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"file-upload",className:"text-sm font-medium",children:"Attachments"}),e.jsxs("div",{className:"border-2 border-dashed rounded-lg p-6 text-center",children:[e.jsx("input",{type:"file",onChange:z,className:"hidden",id:"file-upload"}),e.jsxs("label",{htmlFor:"file-upload",className:"cursor-pointer",children:[e.jsx(te,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Drag and drop files here or click to browse"})]})]}),n&&e.jsx("div",{className:"mt-2",children:e.jsxs("div",{className:"flex items-center justify-between bg-gray-100 p-2 rounded",children:[e.jsx("span",{className:"text-sm truncate",children:n.name}),e.jsx(b,{type:"button",variant:"ghost",size:"sm",onClick:D,children:e.jsx(w,{className:"h-4 w-4"})})]})})]}),e.jsx(b,{type:"submit",className:"w-full",disabled:f||v,children:f||v?"Sending...":"Send Email"})]})})})}export{ye as default};
