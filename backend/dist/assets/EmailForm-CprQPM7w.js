import{h as e,b1 as s,i as a,bb as t,j as l,I as i,B as r,X as c}from"./main-DeRxjK88.js";import{r as d}from"./vendor-router-Bu4EHm1B.js";import{b as m}from"./index.esm-C1PzQRG-.js";import{t as n,o,a as x,s as h,b as p}from"./index-Db_ZYzj8.js";import{S as j,a as u,b,c as y,d as g}from"./select-Dqodnixf.js";import{C as f,a as N}from"./card-RXDLfuok.js";/* empty css                   */import{R as v}from"./index-CJo0JxI7.js";import"./vendor-react-CI5aWZjI.js";import"./vendor-utils-BfOc9lHv.js";import"./Combination-CNfQ0noH.js";import"./index-Kj7Vjsi3.js";import"./check-CVm68GV7.js";import"./chevron-up-3rt5hBY6.js";import"./isEqual-DOH0BpiM.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=e("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),S=o({category:h().min(1,"Please select a category"),template:h().min(1,"Please select a template"),email:h().min(1,"To field is required").email("Invalid email format"),cc_email:p(h()).optional(),subject:h().min(1,"Subject is required"),body:h().min(1,"Body is required"),attachment:x().optional()});function C({defaultTo:e="",onSuccess:o}){const[x,h]=d.useState(!1),{data:p,isLoading:C}=s(),{data:F,isLoading:E}=a(),[_,{isLoading:k}]=t(),[q,L]=d.useState(null),[T,B]=d.useState([]),[P,z]=d.useState([]),{register:I,handleSubmit:V,formState:{errors:A},reset:D,watch:H,setValue:R}=m({resolver:n(S)}),G=H("category"),J=H("template"),M=H("body");d.useEffect((()=>{if(J&&F?.data){const e=F.data.find((e=>e._id===J));e&&(R("subject",e.subject),R("body",e.body))}}),[J,F,R]),d.useEffect((()=>{e&&R("email",e)}),[e,R]);return d.useEffect((()=>{if(G&&F?.data){const e=F.data.filter((e=>e.category?.emailCategory===G));z(e),R("template","")}}),[G,F,R]),l.jsx(f,{className:"w-full mx-auto max-h-[80vh] flex flex-col",children:l.jsx(N,{className:"p-6 overflow-y-auto",children:l.jsxs("form",{onSubmit:V((async e=>{const s=new FormData;s.append("email",e.email),s.append("cc_email",T),s.append("subject",e.subject),s.append("body",e.body),q&&s.append("attachment",q),h(!0);try{await _(s).unwrap(),alert("Email sent successfully!"),D(),L(null),B([]),o?.()}catch(a){alert("Failed to send email. Please try again.")}finally{h(!1)}})),className:"space-y-4",children:[l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{htmlFor:"category",className:"text-sm font-medium",children:"Select Category"}),l.jsxs(j,{onValueChange:e=>R("category",e),children:[l.jsx(u,{id:"category",children:l.jsx(b,{placeholder:"Select Category"})}),l.jsx(y,{children:C?l.jsx(g,{disabled:!0,children:"Loading categories..."}):p&&p.length>0?p.map((e=>l.jsx(g,{value:e.emailCategory,children:e.emailCategory},e._id))):l.jsx(g,{disabled:!0,children:"No categories available"})})]}),A.category&&l.jsx("p",{className:"text-sm text-red-500",children:A.category.message})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{htmlFor:"template",className:"text-sm font-medium",children:"Select Email Template"}),l.jsxs(j,{onValueChange:e=>R("template",e),disabled:!G,children:[l.jsx(u,{id:"template",children:l.jsx(b,{placeholder:G?"Select Email Template":"Please select a category first"})}),l.jsx(y,{children:E?l.jsx(g,{disabled:!0,children:"Loading templates..."}):0===P.length?l.jsx(g,{disabled:!0,children:"No templates in this category"}):P.map((e=>l.jsx(g,{value:e._id,children:e.name},e._id)))})]}),A.template&&l.jsx("p",{className:"text-sm text-red-500",children:A.template.message})]})]}),l.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{htmlFor:"email",className:"text-sm font-medium",children:"To*"}),l.jsx(i,{id:"email",type:"text",placeholder:"Recipient email",...I("email"),"aria-invalid":A.email?"true":"false"}),A.email&&l.jsx("p",{className:"text-sm text-red-500",children:A.email.message})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{htmlFor:"cc_email",className:"text-sm font-medium",children:"CC"}),l.jsxs("div",{className:"relative",children:[l.jsx(i,{id:"cc_email",type:"text",placeholder:"Enter CC email",onBlur:e=>{var s;(s=e.target.value)&&!T.includes(s)&&B((e=>[...e,s])),e.target.value=""}}),T.length>0&&l.jsx("div",{className:"absolute top-full mt-1 z-10 bg-white border rounded-md p-2 w-full shadow-sm",children:T.map(((e,s)=>l.jsxs("div",{className:"flex items-center justify-between py-1",children:[l.jsx("span",{className:"text-sm",children:e}),l.jsx(r,{type:"button",variant:"ghost",size:"sm",onClick:()=>(e=>{B((s=>s.filter(((s,a)=>a!==e))))})(s),children:l.jsx(c,{className:"h-3 w-3"})})]},s)))})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{htmlFor:"subject",className:"text-sm font-medium",children:"Subject*"}),l.jsx(i,{id:"subject",type:"text",placeholder:"Subject",...I("subject"),"aria-invalid":A.subject?"true":"false"}),A.subject&&l.jsx("p",{className:"text-sm text-red-500",children:A.subject.message})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{htmlFor:"body",className:"text-sm font-medium",children:"Body*"}),l.jsx(v,{value:M||"",onChange:e=>R("body",e),className:"bg-white"}),A.body&&l.jsx("p",{className:"text-sm text-red-500",children:A.body.message})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{htmlFor:"file-upload",className:"text-sm font-medium",children:"Attachments"}),l.jsxs("div",{className:"border-2 border-dashed rounded-lg p-6 text-center",children:[l.jsx("input",{type:"file",onChange:e=>{const s=e.target.files[0];L(s)},className:"hidden",id:"file-upload"}),l.jsxs("label",{htmlFor:"file-upload",className:"cursor-pointer",children:[l.jsx(w,{className:"mx-auto h-12 w-12 text-gray-400"}),l.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Drag and drop files here or click to browse"})]})]}),q&&l.jsx("div",{className:"mt-2",children:l.jsxs("div",{className:"flex items-center justify-between bg-gray-100 p-2 rounded",children:[l.jsx("span",{className:"text-sm truncate",children:q.name}),l.jsx(r,{type:"button",variant:"ghost",size:"sm",onClick:()=>{L(null)},children:l.jsx(c,{className:"h-4 w-4"})})]})})]}),l.jsx(r,{type:"submit",className:"w-full",disabled:x||k,children:x||k?"Sending...":"Send Email"})]})})})}export{C as default};
//# sourceMappingURL=EmailForm-CprQPM7w.js.map
