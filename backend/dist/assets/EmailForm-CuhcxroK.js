import{aX as e,k as s,b5 as a,j as t,I as l,B as i,X as r}from"./main-BcUd3ASm.js";import{r as c}from"./vendor-router-CaZtIe2_.js";import{b as d}from"./index.esm-CJw2PcRb.js";import{S as m,a as n,b as o,c as x,d as j}from"./select-Dc7LnXRO.js";import{C as p,a as h}from"./card-DKPCnjx_.js";/* empty css                   */import{R as u}from"./index-BEyUZcsN.js";import{U as g}from"./upload-CioWvAMz.js";import"./vendor-react-DD_RYU77.js";import"./vendor-utils-CfKmydC0.js";import"./index-CMYgmcqM.js";import"./index-BY97PVuz.js";import"./check-CxfHQWmE.js";import"./chevron-up-BAx2OvKy.js";import"./isEqual-DwlFmuh_.js";function b({defaultTo:b="",onSuccess:y}){const[f,N]=c.useState(!1),{data:v,isLoading:w}=e(),{data:S,isLoading:C}=s(),[E,{isLoading:F}]=a(),[_,L]=c.useState(null),[k,q]=c.useState([]),[T,B]=c.useState([]),{register:P,handleSubmit:V,formState:{errors:z},reset:D,watch:I,setValue:R,setError:U,clearErrors:A}=d({defaultValues:{category:"",template:"",email:"",cc_email:[],subject:"",body:"",attachment:null}}),J=I("category"),K=I("template"),M=I("body");c.useEffect((()=>{if(K&&S?.data){const e=S.data.find((e=>e._id===K));e&&(R("subject",e.subject),R("body",e.body))}}),[K,S,R]),c.useEffect((()=>{b&&R("email",b)}),[b,R]);return c.useEffect((()=>{if(J&&S?.data){const e=S.data.filter((e=>e.category?.emailCategory===J));B(e),R("template","")}}),[J,S,R]),t.jsx(p,{className:"w-full mx-auto max-h-[80vh] flex flex-col",children:t.jsx(h,{className:"p-6 overflow-y-auto",children:t.jsxs("form",{onSubmit:V((async e=>{if(!(e=>{let s=!0;return A(),e.category||(U("category",{message:"Please select a category"}),s=!1),e.template||(U("template",{message:"Please select a template"}),s=!1),e.email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)||(U("email",{message:"Invalid email format"}),s=!1):(U("email",{message:"To field is required"}),s=!1),e.subject.trim()||(U("subject",{message:"Subject is required"}),s=!1),e.body&&"<p><br></p>"!==e.body&&""!==e.body.trim()||(U("body",{message:"Body is required"}),s=!1),s})(e))return;const s=new FormData;s.append("email",e.email),s.append("cc_email",k),s.append("subject",e.subject),s.append("body",e.body),_&&s.append("attachment",_),N(!0);try{await E(s).unwrap(),alert("Email sent successfully!"),D(),L(null),q([]),y?.()}catch(a){alert("Failed to send email. Please try again.")}finally{N(!1)}})),className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{htmlFor:"category",className:"text-sm font-medium",children:"Select Category"}),t.jsxs(m,{onValueChange:e=>R("category",e),children:[t.jsx(n,{id:"category",children:t.jsx(o,{placeholder:"Select Category"})}),t.jsx(x,{children:w?t.jsx(j,{disabled:!0,children:"Loading categories..."}):v&&v.length>0?v.map((e=>t.jsx(j,{value:e.emailCategory,children:e.emailCategory},e._id))):t.jsx(j,{disabled:!0,children:"No categories available"})})]}),z.category&&t.jsx("p",{className:"text-sm text-red-500",children:z.category.message})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{htmlFor:"template",className:"text-sm font-medium",children:"Select Email Template"}),t.jsxs(m,{onValueChange:e=>R("template",e),disabled:!J,children:[t.jsx(n,{id:"template",children:t.jsx(o,{placeholder:J?"Select Email Template":"Please select a category first"})}),t.jsx(x,{children:C?t.jsx(j,{disabled:!0,children:"Loading templates..."}):0===T.length?t.jsx(j,{disabled:!0,children:"No templates in this category"}):T.map((e=>t.jsx(j,{value:e._id,children:e.name},e._id)))})]}),z.template&&t.jsx("p",{className:"text-sm text-red-500",children:z.template.message})]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{htmlFor:"email",className:"text-sm font-medium",children:"To*"}),t.jsx(l,{id:"email",type:"text",placeholder:"Recipient email",...P("email"),"aria-invalid":z.email?"true":"false"}),z.email&&t.jsx("p",{className:"text-sm text-red-500",children:z.email.message})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{htmlFor:"cc_email",className:"text-sm font-medium",children:"CC"}),t.jsxs("div",{className:"relative",children:[t.jsx(l,{id:"cc_email",type:"text",placeholder:"Enter CC email",onBlur:e=>{var s;(s=e.target.value)&&!k.includes(s)&&q((e=>[...e,s])),e.target.value=""}}),k.length>0&&t.jsx("div",{className:"absolute top-full mt-1 z-10 bg-white border rounded-md p-2 w-full shadow-sm",children:k.map(((e,s)=>t.jsxs("div",{className:"flex items-center justify-between py-1",children:[t.jsx("span",{className:"text-sm",children:e}),t.jsx(i,{type:"button",variant:"ghost",size:"sm",onClick:()=>(e=>{q((s=>s.filter(((s,a)=>a!==e))))})(s),children:t.jsx(r,{className:"h-3 w-3"})})]},s)))})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{htmlFor:"subject",className:"text-sm font-medium",children:"Subject*"}),t.jsx(l,{id:"subject",type:"text",placeholder:"Subject",...P("subject"),"aria-invalid":z.subject?"true":"false"}),z.subject&&t.jsx("p",{className:"text-sm text-red-500",children:z.subject.message})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{htmlFor:"body",className:"text-sm font-medium",children:"Body*"}),t.jsx(u,{value:M||"",onChange:e=>R("body",e),className:"bg-white"}),z.body&&t.jsx("p",{className:"text-sm text-red-500",children:z.body.message})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{htmlFor:"file-upload",className:"text-sm font-medium",children:"Attachments"}),t.jsxs("div",{className:"border-2 border-dashed rounded-lg p-6 text-center",children:[t.jsx("input",{type:"file",onChange:e=>{const s=e.target.files[0];L(s)},className:"hidden",id:"file-upload"}),t.jsxs("label",{htmlFor:"file-upload",className:"cursor-pointer",children:[t.jsx(g,{className:"mx-auto h-12 w-12 text-gray-400"}),t.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Drag and drop files here or click to browse"})]})]}),_&&t.jsx("div",{className:"mt-2",children:t.jsxs("div",{className:"flex items-center justify-between bg-gray-100 p-2 rounded",children:[t.jsx("span",{className:"text-sm truncate",children:_.name}),t.jsx(i,{type:"button",variant:"ghost",size:"sm",onClick:()=>{L(null)},children:t.jsx(r,{className:"h-4 w-4"})})]})})]}),t.jsx(i,{type:"submit",className:"w-full",disabled:f||F,children:f||F?"Sending...":"Send Email"})]})})})}export{b as default};
//# sourceMappingURL=EmailForm-CuhcxroK.js.map
