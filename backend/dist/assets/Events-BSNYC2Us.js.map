{"version":3,"file":"Events-BSNYC2Us.js","sources":["../../src/websiteBackend/event/Events.jsx"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\r\nimport axios from 'axios';\r\nimport { Form, Button, message } from 'antd';\r\nimport JoditEditor from 'jodit-react';\r\n\r\nconst EventForm = () => {\r\n  const [form] = Form.useForm();\r\n  const [events, setEvents] = useState('');\r\n  const [eventId, setEventId] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n  \r\n  const editorRef = useRef(null);\r\n   \r\n  const config = {\r\n    uploader: { insertImageAsBase64URI: true },\r\n    toolbarAdaptive: false,\r\n    toolbarSticky: false,\r\n    buttons: [\r\n      'bold',\r\n      'italic',\r\n      'underline',\r\n      'ul',\r\n      'ol',\r\n      'fontsize',\r\n      'paragraph',\r\n      'link',\r\n      'image',\r\n      'video',\r\n      'table',\r\n      'align',\r\n      'undo',\r\n      'redo',\r\n    ],\r\n  };\r\n\r\n  const fetchEvent = async () => {\r\n    try {\r\n      setLoading(true);\r\n      // Add timestamp to prevent caching\r\n      const response = await axios.get(`/api/events/getEvent?t=${new Date().getTime()}`);\r\n      const eventData = response.data[0];\r\n      setEventId(eventData._id);\r\n      setEvents(eventData.events);\r\n      form.setFieldsValue({ events: eventData.events });\r\n    } catch (error) {\r\n      console.error('Failed to fetch event:', error);\r\n      message.error('Failed to fetch event.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchEvent();\r\n  }, [form]); // Keep form in dependencies\r\n\r\n  const onFinish = async () => {\r\n    try {\r\n      if (!eventId) {\r\n        message.error('No event ID available');\r\n        return;\r\n      }\r\n\r\n      setLoading(true);\r\n      await axios.put(`/api/events/editEvent/${eventId}`, {\r\n        events: events,\r\n      });\r\n      message.success('Event updated successfully!');\r\n      \r\n      // Refetch data after successful update\r\n      await fetchEvent();\r\n    } catch (error) {\r\n      console.error('Failed to update event:', error);\r\n      message.error('Failed to update event.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Form \r\n      form={form} \r\n      layout=\"vertical\" \r\n      onFinish={onFinish}\r\n      name=\"event_form\"\r\n    >\r\n      <Form.Item\r\n        name=\"events\"\r\n        label=\"Event Description\"\r\n        rules={[{ required: true, message: 'Please input the event details!' }]}\r\n      >\r\n        <JoditEditor \r\n          ref={editorRef} \r\n          value={events} \r\n          config={config} \r\n          onChange={(newContent) => {\r\n            setEvents(newContent);\r\n            form.setFieldsValue({ events: newContent });\r\n          }}\r\n        />\r\n      </Form.Item>\r\n\r\n      <Form.Item>\r\n        <Button type=\"primary\" htmlType=\"submit\" loading={loading}>\r\n          Update Event\r\n        </Button>\r\n        <Button \r\n          onClick={fetchEvent} \r\n          style={{ marginLeft: 8 }} \r\n          loading={loading}\r\n        >\r\n          Refresh Data\r\n        </Button>\r\n      </Form.Item>\r\n    </Form>\r\n  );\r\n};\r\n\r\nexport default EventForm;"],"names":["EventForm","form","Form","useForm","events","setEvents","useState","eventId","setEventId","loading","setLoading","editorRef","useRef","fetchEvent","async","eventData","axios","get","Date","getTime","data","_id","setFieldsValue","error","message","useEffect","jsxs","layout","onFinish","put","success","name","children","jsx","Item","label","rules","required","JoditEditor","ref","value","config","uploader","insertImageAsBase64URI","toolbarAdaptive","toolbarSticky","buttons","onChange","newContent","Button","type","htmlType","onClick","style","marginLeft"],"mappings":"sgBAKA,MAAMA,EAAY,KAChB,MAAOC,GAAQC,EAAKC,WACbC,EAAQC,GAAaC,EAAAA,SAAS,KAC9BC,EAASC,GAAcF,EAAAA,SAAS,OAChCG,EAASC,GAAcJ,EAAAA,UAAS,GAEjCK,EAAYC,SAAO,MAwBnBC,EAAaC,UACb,IACFJ,GAAW,GAEL,MACAK,SADiBC,EAAMC,IAAI,2BAAA,IAA8BC,MAAOC,cAC3CC,KAAK,GAChCZ,EAAWO,EAAUM,KACrBhB,EAAUU,EAAUX,QACpBH,EAAKqB,eAAe,CAAElB,OAAQW,EAAUX,eACjCmB,GAEPC,EAAQD,MAAM,yBAAwB,CACtC,QACAb,GAAW,EAAK,GAIpBe,EAAAA,WAAU,KACGZ,GAAA,GACV,CAACZ,IA0BF,OAAAyB,EAAAA,KAACxB,EAAA,CACCD,OACA0B,OAAO,WACPC,SA3Bad,UACX,IACF,IAAKP,EAEH,YADAiB,EAAQD,MAAM,yBAIhBb,GAAW,SACLM,EAAMa,IAAI,yBAAyBtB,IAAW,CAClDH,WAEFoB,EAAQM,QAAQ,qCAGVjB,UACCU,GAEPC,EAAQD,MAAM,0BAAyB,CACvC,QACAb,GAAW,EAAK,GAShBqB,KAAK,aAELC,SAAA,CAAAC,EAAAA,IAAC/B,EAAKgC,KAAL,CACCH,KAAK,SACLI,MAAM,oBACNC,MAAO,CAAC,CAAEC,UAAU,EAAMb,QAAS,oCAEnCQ,SAAAC,EAAAA,IAACK,EAAA,CACCC,IAAK5B,EACL6B,MAAOpC,EACPqC,OAjFO,CACbC,SAAU,CAAEC,wBAAwB,GACpCC,iBAAiB,EACjBC,eAAe,EACfC,QAAS,CACP,OACA,SACA,YACA,KACA,KACA,WACA,YACA,OACA,QACA,QACA,QACA,QACA,OACA,SAgEIC,SAAWC,IACT3C,EAAU2C,GACV/C,EAAKqB,eAAe,CAAElB,OAAQ4C,GAAY,MAKhDtB,EAAAA,KAACxB,EAAKgC,KAAL,CACCF,SAAA,CAAAC,MAACgB,GAAOC,KAAK,UAAUC,SAAS,SAAS1C,UAAkBuB,SAE3D,iBACAC,EAAAA,IAACgB,EAAA,CACCG,QAASvC,EACTwC,MAAO,CAAEC,WAAY,GACrB7C,UACDuB,SAAA,sBAIL"}