import{h as e,a_ as s,e as a,j as l,D as t,m as n,n as i,o as r,L as d,I as c,B as o,a$ as h,b0 as x,b1 as m,b2 as j,l as u,f as p,b3 as g,b4 as f}from"./main-BQqr2_19.js";import{r as N,L as v}from"./vendor-router-DoRotgOs.js";import{S as w,a as b,b as C,c as y,d as S}from"./select-DFtFguEc.js";import{T as k,a as L,b as F,c as D,d as U,e as M}from"./table-C7XKYQT1.js";import{A,a as E,b as I,c as _,d as P,e as $,f as O,g as q}from"./alert-dialog-DKDaLIss.js";import{P as T,a as V,b as z,c as H,d as B,f as Y,e as G}from"./pagination-BRV4tKr6.js";import{P as J}from"./pencil-C2uD4Ipu.js";import{T as K}from"./trash-2-CkYKnG3D.js";import{T as Q}from"./textarea-tez6YR4q.js";import{B as W}from"./badge-PmpCGIgF.js";import{D as X,a as Z,b as R,c as ee}from"./dropdown-menu-B0iK7WzX.js";import{C as se}from"./checkbox-BXm1ESgR.js";import ae from"./EmailForm-DY5s-fSx.js";import{P as le}from"./plus-C_FNkNo2.js";import{E as te}from"./ellipsis-vertical-DeriUaLO.js";import"./vendor-react-DD_RYU77.js";import"./vendor-utils-CfKmydC0.js";import"./index-BYajCL7Y.js";import"./index-LwoRh43N.js";import"./check-C21vIO_I.js";import"./chevron-up-CiFYhtWl.js";import"./chevron-left-C0_ThF1d.js";import"./chevron-right-DHWU52ll.js";import"./index.esm-CSDyVtrl.js";import"./card-CPQ_AIkA.js";/* empty css                   */import"./index-BEyUZcsN.js";import"./isEqual-DwlFmuh_.js";import"./upload-BBhkcclE.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=e("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);function ie({followUps:e,onEdit:t,onDelete:n,currentPage:i,totalPages:r,onPageChange:d}){const[c,o]=N.useState(!1),[h,x]=N.useState(null),[m]=s(),{refetch:j}=a(),u=(e,s)=>{(async(e,s)=>{try{await m({id:e,...s}).unwrap(),await j()}catch(a){}})(e,{status:s})};return l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"rounded-md border",children:l.jsxs(k,{children:[l.jsx(L,{children:l.jsxs(F,{children:[l.jsx(D,{children:"Date"}),l.jsx(D,{children:"Message"}),l.jsx(D,{children:"Status"}),l.jsx(D,{children:"Action"})]})}),l.jsx(U,{children:e.map((e=>l.jsxs(F,{children:[l.jsx(M,{children:new Date(e.date).toLocaleDateString()}),l.jsx(M,{children:e.message}),l.jsx(M,{children:l.jsxs(w,{value:e.status||"New",onValueChange:s=>u(e._id,s),children:[l.jsx(b,{className:"w-[180px]",children:l.jsx(C,{placeholder:e.status||"New"})}),l.jsxs(y,{children:[l.jsx(S,{value:"New",children:"New"}),l.jsx(S,{value:"In Progress",children:"In Progress"}),l.jsx(S,{value:"Completed",children:"Completed"})]})]})}),l.jsx(M,{children:l.jsxs("div",{className:"flex gap-2",children:[l.jsx("button",{onClick:()=>t(e._id),className:"p-2 bg-blue-700 text-white rounded-full hover:bg-blue-800",children:l.jsx(J,{className:"h-4 w-4"})}),l.jsx("button",{onClick:()=>{return s=e._id,x(s),void o(!0);var s},className:"p-2 bg-red-600 text-white rounded-full hover:bg-red-700",children:l.jsx(K,{className:"h-4 w-4"})})]})})]},e._id)))})]})}),r>1&&l.jsx("div",{className:"mt-4",children:l.jsx(T,{children:l.jsx(V,{children:(()=>{const e=[];let s=Math.max(1,i-Math.floor(2.5)),a=Math.min(r,s+5-1);a===r&&(s=Math.max(1,a-5+1)),e.push(l.jsx(z,{children:l.jsx(H,{onClick:()=>d(Math.max(1,i-1)),className:1===i?"pointer-events-none opacity-50":"cursor-pointer"})},"prev")),s>1&&(e.push(l.jsx(z,{children:l.jsx(B,{onClick:()=>d(1),children:"1"})},"start-ellipsis")),s>2&&e.push(l.jsx(z,{children:l.jsx(Y,{})},"ellipsis-1")));for(let t=s;t<=a;t++)e.push(l.jsx(z,{children:l.jsx(B,{onClick:()=>d(t),isActive:i===t,children:t})},t));return a<r&&(a<r-1&&e.push(l.jsx(z,{children:l.jsx(Y,{})},"ellipsis-2")),e.push(l.jsx(z,{children:l.jsx(B,{onClick:()=>d(r),children:r})},"end-page"))),e.push(l.jsx(z,{children:l.jsx(G,{onClick:()=>d(Math.min(r,i+1)),className:i===r?"pointer-events-none opacity-50":"cursor-pointer"})},"next")),e})()})})}),l.jsx(A,{open:c,onOpenChange:o,children:l.jsxs(E,{children:[l.jsxs(I,{children:[l.jsx(_,{children:"Confirm Delete"}),l.jsx(P,{children:"Are you sure you want to delete this follow-up?"})]}),l.jsxs($,{children:[l.jsx(O,{children:"Cancel"}),l.jsx(q,{onClick:async()=>{h&&(await n(h),await j(),1===e.length&&i>1?d(i-1):j(),o(!1),x(null))},className:"bg-red-600 hover:bg-red-700",children:"Yes, delete"})]})]})})]})}function re({isOpen:e,onClose:s,onAddFollowUp:a}){const[h,x]=N.useState({date:"",message:""});return l.jsx(t,{open:e,onOpenChange:s,children:l.jsxs(n,{className:"sm:max-w-[425px]",children:[l.jsx(i,{children:l.jsx(r,{children:"Add Follow Up"})}),l.jsxs("div",{className:"grid gap-4 py-4",children:[l.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[l.jsx(d,{htmlFor:"date",className:"text-right",children:"Date"}),l.jsx(c,{className:" w-auto md:w-[4cm]",id:"date",type:"date",value:h.date?new Date(h.date).toISOString().slice(0,10):"",onChange:e=>x({...h,date:e.target.value})})]}),l.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[l.jsx(d,{htmlFor:"message",className:"text-right",children:"Message"}),l.jsx(Q,{id:"message",value:h.message,onChange:e=>x({...h,message:e.target.value}),className:"col-span-3"})]})]}),l.jsxs("div",{className:"flex justify-end space-x-2",children:[l.jsx(o,{className:"bg-red-600",variant:"outline",onClick:s,children:"Cancel"}),l.jsx(o,{onClick:()=>{a(h),x({date:"",message:""})},children:"Add"})]})]})})}function de({isOpen:e,onClose:a,followUpId:x,onSave:m}){const[j,u]=N.useState({date:"",message:""}),{data:p,isLoading:g,error:f}=h(x,{skip:!e||!x}),[v,{isLoading:w,error:b}]=s();N.useEffect((()=>{if(p){u({date:(e=>{const s=new Date(e);return`${String(s.getMonth()+1).padStart(2,"0")}/${String(s.getDate()).padStart(2,"0")}/${s.getFullYear()}`})(p?.data?.date||""),message:p?.data?.message||""})}}),[p]);return N.useEffect((()=>{f&&alert(`Fetch Error: ${f.message}`),b&&alert(`Update Error: ${b.message}`)}),[f,b]),e?l.jsx(t,{open:e,onOpenChange:a,children:l.jsxs(n,{className:"sm:max-w-[425px]",children:[l.jsx(i,{children:l.jsx(r,{children:"Edit Follow Up"})}),g?l.jsx("div",{children:"Loading..."}):l.jsxs("div",{className:"grid gap-4 py-4",children:[l.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[l.jsx(d,{htmlFor:"edit-date",className:"text-right",children:"Date"}),l.jsx(c,{id:"edit-date",type:"text",placeholder:"mm/dd/yyyy",value:j.date,onChange:e=>u({...j,date:e.target.value}),className:"col-span-3"})]}),l.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[l.jsx(d,{htmlFor:"edit-message",className:"text-right",children:"Message"}),l.jsx(Q,{id:"edit-message",value:j.message,onChange:e=>u({...j,message:e.target.value}),className:"col-span-3"})]}),l.jsxs("div",{className:"flex justify-end gap-2",children:[l.jsx(o,{variant:"outline",onClick:a,disabled:w,className:"bg-red-600",children:"Cancel"}),l.jsxs(o,{onClick:async()=>{if(j.date)if(j.message)try{await v({message:j.message,date:new Date(j.date).toISOString().split("T")[0],id:x}).unwrap();m({...p?.data,date:j.date,message:j.message}),a()}catch(e){alert(`Update failed: ${e.message||"Unknown error"}`)}else alert("Please enter a message.");else alert("Please select a date.")},disabled:w,children:[l.jsx(ne,{className:"mr-2 h-4 w-4"})," ",w?"Saving...":"Save"]})]})]})]})}):null}function ce({inquiry:e,onFollowUpAdded:s}){const[a,d]=N.useState(!1),[c,h]=N.useState(!1),[p,g]=N.useState(!1),[f,v]=N.useState(null),[w,b]=N.useState(1),{data:C,error:y,isLoading:S,refetch:k}=x(e._id);N.useEffect((()=>{}),[y]);const L=C?.data||[],F=L.length,D=Math.ceil(F/5),U=5*w,M=U-5,A=L.slice(M,U),[E,{isLoading:I}]=m(),[_,{isLoading:P}]=j();return l.jsxs(l.Fragment,{children:[l.jsxs(t,{open:a,onOpenChange:e=>{d(e),e&&k()},children:[l.jsx(u,{asChild:!0,children:l.jsxs(o,{variant:"outline",className:"text-right bg-[#3b1f91] text-white",children:["Follow Up",l.jsx(W,{variant:"outline",className:"bg-[#ffffff] text-black",children:F})]})}),l.jsx(n,{className:"sm:max-w-[60%] h-auto",children:l.jsxs("div",{className:"grid gap-4",children:[l.jsxs("div",{className:"flex justify-between items-center mt-5 mb-4",children:[l.jsx(i,{children:l.jsxs(r,{children:["Follow Up - ",e.firstName," ",e.lastName]})}),l.jsx(o,{onClick:()=>h(!0),className:"flex items-center gap-2",children:"Add Follow Up"})]}),l.jsx(ie,{followUps:A,onEdit:e=>{v(e),g(!0)},onDelete:async a=>{try{await _(a).unwrap(),k(),s(e,F-1)}catch(l){}},currentPage:w,totalPages:D,onPageChange:e=>{e>0&&e<=D&&b(e)}})]})})]}),l.jsx(re,{isOpen:c,onClose:()=>h(!1),onAddFollowUp:async a=>{if(a.date&&a.message){const t={inquiryId:e._id,date:a.date,message:a.message};try{await E(t).unwrap(),k(),s(e,F+1),h(!1)}catch(l){}}}}),l.jsx(de,{isOpen:p,onClose:()=>g(!1),followUpId:f,onSave:()=>{k(),g(!1)}})]})}function oe(){const{data:e=[],isLoading:s,isError:a}=p(),[d,h]=N.useState(15),[x,m]=N.useState(e),[j]=g(),{data:u,isLoading:T}=f(),[V,z]=N.useState(""),[H,B]=N.useState(null),[Y,G]=N.useState(null),[J,K]=N.useState(null),[Q,W]=N.useState(""),[ne,ie]=N.useState(""),[re,de]=N.useState(""),[oe,he]=N.useState([]),[xe,me]=N.useState(!1),[je,ue]=N.useState(!1),[pe,ge]=N.useState(null),fe=e.filter((e=>(""===V||e.organisation.toLowerCase().includes(V.toLowerCase()))&&(null===H||e.status===H)&&(null===Y||e.source===Y)&&(null===J||`${e.firstName} ${e.lastName}`.toLowerCase().includes(J.toLowerCase()))&&(""===Q||e.email.toLowerCase().includes(Q.toLowerCase()))&&(""===ne||e.phone.toLowerCase().includes(ne.toLowerCase())))),Ne=fe?.filter((e=>oe.includes(e._id)))?.map((e=>e.email))?.join(", "),ve=(e,s)=>{m((a=>a.map((a=>a.companyName===e.companyName?{...a,totalTasks:s}:a))))};return l.jsxs("div",{className:"p-4",children:[oe.length>0&&l.jsx("div",{className:"mb-4",children:l.jsxs(o,{onClick:()=>me(!0),className:"bg-[#3b1f91] hover:bg-purple-700",children:["Send Email to Selected (",oe.length,")"]})}),l.jsx(t,{open:xe,onOpenChange:me,children:l.jsxs(n,{className:"max-w-4xl",children:[l.jsx(i,{children:l.jsx(r,{children:"Send Email to Selected Inquiries"})}),l.jsx(ae,{defaultTo:Ne,onSuccess:()=>{me(!1),he([])}})]})}),l.jsx(A,{open:je,onOpenChange:ue,children:l.jsxs(E,{children:[l.jsxs(I,{children:[l.jsx(_,{children:"Are you sure you want to delete this inquiry?"}),l.jsx(P,{children:"This action cannot be undone."})]}),l.jsxs($,{children:[l.jsx(O,{children:"Cancel"}),l.jsx(q,{onClick:async()=>{try{await j(pe),m((e=>e.filter((e=>e._id!==pe))))}catch(e){}finally{ue(!1),ge(null)}},className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})}),l.jsxs("div",{className:"flex justify-between items-center mb-4",children:[l.jsx("h1",{className:"text-xl font-semibold",children:"Inquiry List"}),l.jsx(v,{to:"/add-inquiry",children:l.jsxs(o,{className:"gap-2",children:[l.jsx(le,{className:"h-4 w-4"}),"Add Inquiry"]})})]}),l.jsxs(k,{className:"border",children:[l.jsxs(L,{children:[l.jsxs(F,{className:"border-b bg-gray-100",children:[l.jsx(D,{className:"w-12"}),l.jsx(D,{className:"lg:w-[100px] w-[50px] sticky left-0 bg-background z-50",children:"Date"}),l.jsx(D,{className:"text-left",children:"Info"}),l.jsx(D,{className:"text-left",children:"Message"}),l.jsx(D,{className:"text-left",children:"Follow Up"}),l.jsx(D,{className:"w-[80px] text-left",children:"Actions"})]}),l.jsxs(F,{className:"border-b",children:[l.jsx(D,{}),l.jsx(D,{}),l.jsx(D,{children:l.jsx(c,{placeholder:"Search Info",className:"w-[200px]",value:J||"",onChange:e=>K(e.target.value)})}),l.jsx(D,{children:l.jsx(w,{value:H||"reset",onValueChange:e=>B("reset"===e?null:e),children:l.jsxs(y,{children:[l.jsx(S,{value:"reset",children:"All Statuses"}),u?.data?.map((e=>l.jsx(S,{value:e.status,children:e.status},e._id)))]})})}),l.jsx(D,{}),l.jsx(D,{})]})]}),l.jsx(U,{children:fe.map(((e,s)=>l.jsxs(F,{className:"border-b",children:[l.jsx(M,{className:"p-5",children:l.jsx(se,{checked:oe.includes(e._id),onCheckedChange:()=>{return s=e._id,void he((e=>e.includes(s)?e.filter((e=>e!==s)):[...e,s]));var s}})}),l.jsx(M,{className:"sticky left-0 bg-background",children:e.createdAt.slice(0,10)}),l.jsx(M,{children:l.jsxs("div",{className:"space-y-1",children:[l.jsxs("div",{className:"font-medium",children:[e.firstName," ",e.lastName,","]}),e.organisation," ,",l.jsx("div",{className:"text-sm text-muted-foreground",children:e.email}),l.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.phone," â€¢ ",e.address]})]})}),l.jsx(M,{children:e.message}),l.jsx(M,{className:"text-left",children:l.jsx(ce,{inquiry:e,onFollowUpAdded:ve})}),l.jsx(M,{className:"text-center",children:l.jsxs(X,{children:[l.jsx(Z,{asChild:!0,children:l.jsx("button",{variant:"ghost",size:"icon",className:"h-8 w-8 p-0",children:l.jsx(te,{className:"h-4 w-4"})})}),l.jsxs(R,{align:"end",className:"w-[160px]",children:[l.jsx(v,{to:`/edit-inquiry/${e._id}`,children:l.jsx(ee,{children:"Edit"})}),l.jsx(ee,{onClick:()=>{return s=e._id,ge(s),void ue(!0);var s},children:"Delete"})]})]})})]},s)))})]}),l.jsxs("div",{className:"flex items-center justify-between mt-4",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-sm",children:"Items per page:"}),l.jsxs(w,{value:d.toString(),onValueChange:e=>h(Number(e)),children:[l.jsx(b,{className:"w-[70px]",children:l.jsx(C,{children:d})}),l.jsxs(y,{children:[l.jsx(S,{value:"15",children:"15"}),l.jsx(S,{value:"25",children:"25"}),l.jsx(S,{value:"50",children:"50"}),l.jsx(S,{value:"100",children:"100"})]})]})]}),l.jsx("div",{className:"text-sm text-muted-foreground",children:`1-${Math.min(d,fe.length)} of ${fe.length}`})]})]})}export{oe as default};
//# sourceMappingURL=InquiryTable-5rEBTpVY.js.map
