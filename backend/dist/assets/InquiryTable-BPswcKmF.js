import{F as le,M as se}from"./antd-mtWlDmqY.js";import{r as t,j as e}from"./react-DKICu8bO.js";import{af as te,e as re,D as P,i as $,j as q,k as B,L as _,I as z,T as ae,B as C,ag as oe,ah as ne,ai as ie,aj as de,h as ce,f as me,ak as pe,al as ue}from"./index-Bbo1zcj1.js";import{S as W,c as X,d as k,a as he,b as xe}from"./select-CnTZk46j.js";import{T as ge,a as je,b as Y,c as g,d as fe,e as E}from"./table-nX7BFFdz.js";import{G as Ne,H as we}from"./ant-design-icons-CNhZ1eT-.js";import{D as ye,h as Se,E as ve}from"./lucide-D7hRWJEP.js";import{B as Ce}from"./badge-DMbiZYSq.js";import{D as be,a as Fe,b as Me,c as Z}from"./dropdown-menu-D0AUj5Dk.js";import{C as Ie}from"./checkbox-BTLdfW3y.js";import De from"./EmailForm-eNHfaLyA.js";import{L as ee}from"./react-router-B9QVkYva.js";import"./@ant-design-jkdqJqTn.js";import"./rc-util-C9ihiQ8l.js";import"./@babel-C_xKm-6V.js";import"./react-is-NfUKNnIv.js";import"./react-dom-BBS6HuAW.js";import"./classnames-Bv6oJzD9.js";import"./scheduler-CKyTKYc2.js";import"./@emotion-CW87jbl0.js";import"./stylis-OW4gUFyn.js";import"./@ctrl-DOFZgDuz.js";import"./rc-motion-D0k58WYE.js";import"./@rc-component-DJY3KRXL.js";import"./rc-resize-observer-h7CJ_t66.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./rc-dialog-CfVZmZCG.js";import"./rc-table-BJAsEMDh.js";import"./rc-virtual-list-OMMR-gr8.js";import"./rc-tree-aGCJh_41.js";import"./rc-checkbox-nRYcjTPl.js";import"./rc-pagination-ZKXeAm0h.js";import"./rc-select-RmeC3WgB.js";import"./rc-overflow-DEivB5rv.js";import"./throttle-debounce-CUWDS_la.js";import"./rc-input-CIUXRVU8.js";import"./rc-tooltip-Oavn6yow.js";import"./rc-notification-0md6QYDj.js";import"./rc-image-ClDwiN-j.js";import"./rc-textarea-CijmdGy3.js";import"./copy-to-clipboard-0rP7DRqq.js";import"./toggle-selection-DGa8lynz.js";import"./rc-upload-DlrdHvh1.js";import"./rc-progress-BVn0ZmF4.js";import"./rc-dropdown-D4AwxsUk.js";import"./rc-menu-MHhKtfoG.js";import"./rc-field-form-CVOtFEQA.js";import"./scroll-into-view-if-needed-BZeNfFF0.js";import"./compute-scroll-into-view-DWa9QgjM.js";import"./rc-picker-D0kXf0IF.js";import"./rc-tabs-XmQY-w_1.js";import"./react-redux-BrRfTdeB.js";import"./use-sync-external-store-D0ivhzzy.js";import"./@reduxjs-B5J9SSA5.js";import"./redux-DITMfSWq.js";import"./immer-fBqQtvEc.js";import"./redux-thunk-ClJT1hhx.js";import"./reselect-C27TLnWV.js";import"./js-cookie-Cz0CWeBA.js";import"./@radix-ui-BlrBCj0C.js";import"./aria-hidden-DQ5UC2Eg.js";import"./react-remove-scroll-fXbmorz6.js";import"./tslib-CDuPK5Eb.js";import"./react-remove-scroll-bar-C9fmXXva.js";import"./react-style-singleton-DKBZmuKg.js";import"./get-nonce-C-Z93AgS.js";import"./use-sidecar-C10EJNOT.js";import"./use-callback-ref-BoKxM4XI.js";import"./@floating-ui-8J-daYO3.js";import"./class-variance-authority-Dp3B9jqt.js";import"./clsx-B-dksMZM.js";import"./tailwind-merge-D696Ktp4.js";import"./axios-DXsv3KKR.js";import"./@syncfusion-BIAkhmGL.js";import"./cookie--_YQFYBD.js";import"./react-hook-form-BpvdonxZ.js";import"./@hookform-DUkwi3xb.js";import"./zod-B_haSLVu.js";import"./card-D0ajdvoE.js";import"./react-quill-BTfuOY7l.js";import"./lodash-BLBAyiDt.js";import"./quill-BGoone1_.js";function ke({followUps:o,onEdit:u,onDelete:h,currentPage:n,totalPages:l,onPageChange:p}){const[a,j]=t.useState(!1),[m,b]=t.useState(null),[f]=te(),{refetch:N}=re(),w=async(r,d)=>{try{const S=await f({id:r,...d}).unwrap();await N(),console.log("Update result:",S)}catch(S){console.error(`Failed to update message ID: ${r}`,S)}},i=(r,d)=>{w(r,{status:d})},y=r=>{b(r),j(!0)},U=async()=>{m&&(await h(m),await N(),o.length===1&&n>1?p(n-1):N(),j(!1),b(null))},x=[{title:"Date",dataIndex:"date",key:"date",render:r=>new Date(r).toLocaleDateString()},{title:"Message",dataIndex:"message",key:"message"},{title:"Status",dataIndex:"status",key:"status",render:(r,d)=>e.jsxs("select",{value:r||"New",onChange:S=>i(d._id,S.target.value),className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"New",children:"New"}),e.jsx("option",{value:"In Progress",children:"In Progress"}),e.jsx("option",{value:"Completed",children:"Completed"})]})},{title:"Action",key:"action",render:(r,d)=>e.jsxs("div",{className:"flex gap-4 ",children:[e.jsx(Ne,{className:"cursor-pointer bg-blue-700 text-white p-2 rounded-full",onClick:()=>u(d._id)}),e.jsx(we,{className:"cursor-pointer bg-red-600 text-white p-2 rounded-full",onClick:()=>y(d._id)})]})}];return e.jsxs(e.Fragment,{children:[e.jsx(le,{columns:x,dataSource:o,rowKey:"_id",pagination:{current:n,total:l*10,onChange:p}}),e.jsx(se,{title:"Confirm Delete",open:a,onOk:U,onCancel:()=>j(!1),okText:"Yes, delete",cancelText:"Cancel",className:"mt-16",children:e.jsx("p",{children:"Are you sure you want to delete this follow-up?"})})]})}function Ee({isOpen:o,onClose:u,onAddFollowUp:h}){const[n,l]=t.useState({date:"",message:""}),p=()=>{h(n),l({date:"",message:""})};return e.jsx(P,{open:o,onOpenChange:u,children:e.jsxs($,{className:"sm:max-w-[425px]",children:[e.jsx(q,{children:e.jsx(B,{children:"Add Follow Up"})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(_,{htmlFor:"date",className:"text-right",children:"Date"}),e.jsx(z,{className:" w-auto md:w-[4cm]",id:"date",type:"date",value:n.date?new Date(n.date).toISOString().slice(0,10):"",onChange:a=>l({...n,date:a.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(_,{htmlFor:"message",className:"text-right",children:"Message"}),e.jsx(ae,{id:"message",value:n.message,onChange:a=>l({...n,message:a.target.value}),className:"col-span-3"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(C,{className:"bg-red-600",variant:"outline",onClick:u,children:"Cancel"}),e.jsx(C,{onClick:p,children:"Add"})]})]})})}function Le({isOpen:o,onClose:u,followUpId:h,onSave:n}){const[l,p]=t.useState({date:"",message:""});console.log("Follow Up ID:",h);const{data:a,isLoading:j,error:m}=oe(h,{skip:!o||!h}),[b,{isLoading:f,error:N}]=te();t.useEffect(()=>{var i,y;a&&p({date:(x=>{const r=new Date(x),d=String(r.getMonth()+1).padStart(2,"0"),S=String(r.getDate()).padStart(2,"0"),F=r.getFullYear();return`${d}/${S}/${F}`})(((i=a==null?void 0:a.data)==null?void 0:i.date)||""),message:((y=a==null?void 0:a.data)==null?void 0:y.message)||""})},[a]);const w=async()=>{if(console.log("Saving follow-up:",l),console.log("Follow Up ID in handleSave:",h),!l.date){alert("Please select a date.");return}if(!l.message){alert("Please enter a message.");return}try{console.log("Attempting to update message");const i=await b({message:l.message,date:new Date(l.date).toISOString().split("T")[0],id:h}).unwrap();n({...a==null?void 0:a.data,date:l.date,message:l.message}),u()}catch(i){console.error("Failed to update message:",i),alert(`Update failed: ${i.message||"Unknown error"}`)}};return t.useEffect(()=>{m&&(console.error("Fetch Error:",m),alert(`Fetch Error: ${m.message}`)),N&&(console.error("Update Error:",N),alert(`Update Error: ${N.message}`))},[m,N]),o?e.jsx(P,{open:o,onOpenChange:u,children:e.jsxs($,{className:"sm:max-w-[425px]",children:[e.jsx(q,{children:e.jsx(B,{children:"Edit Follow Up"})}),j?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(_,{htmlFor:"edit-date",className:"text-right",children:"Date"}),e.jsx(z,{id:"edit-date",type:"text",placeholder:"mm/dd/yyyy",value:l.date,onChange:i=>p({...l,date:i.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(_,{htmlFor:"edit-message",className:"text-right",children:"Message"}),e.jsx(ae,{id:"edit-message",value:l.message,onChange:i=>p({...l,message:i.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(C,{variant:"outline",onClick:u,disabled:f,className:"bg-red-600",children:"Cancel"}),e.jsxs(C,{onClick:w,disabled:f,children:[e.jsx(ye,{className:"mr-2 h-4 w-4"})," ",f?"Saving...":"Save"]})]})]})]})}):null}function Te({inquiry:o,onFollowUpAdded:u}){const[h,n]=t.useState(!1),[l,p]=t.useState(!1),[a,j]=t.useState(!1),[m,b]=t.useState(null),[f,N]=t.useState(1),w=5,{data:i,error:y,isLoading:U,refetch:x}=ne(o._id);t.useEffect(()=>{y&&console.error("Error fetching follow-up count:",y)},[y]);const r=(i==null?void 0:i.data)||[],d=r.length,S=Math.ceil(d/w),F=f*w,K=F-w,I=r.slice(K,F),[A,{isLoading:J}]=ie(),[L,{isLoading:M}]=de(),G=c=>{n(c),c&&x()},Q=c=>{c>0&&c<=S&&N(c)},H=async c=>{if(c.date&&c.message){const D={inquiryId:o._id,date:c.date,message:c.message};try{await A(D).unwrap(),x(),u(o,d+1),p(!1)}catch(s){console.error("Failed to add follow-up:",s)}}},R=c=>{b(c),j(!0)},O=async c=>{try{await L(c).unwrap(),x(),u(o,d-1)}catch(D){console.error("Failed to delete follow-up:",D)}};return e.jsxs(e.Fragment,{children:[e.jsxs(P,{open:h,onOpenChange:G,children:[e.jsx(ce,{asChild:!0,children:e.jsxs(C,{variant:"outline",className:"text-right bg-[#3b1f91] text-white",children:["Follow Up",e.jsx(Ce,{variant:"outline",className:"bg-[#ffffff] text-black",children:d})]})}),e.jsx($,{className:"sm:max-w-[60%] h-auto",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"flex justify-between items-center mt-5 mb-4",children:[e.jsx(q,{children:e.jsxs(B,{children:["Follow Up - ",o.firstName," ",o.lastName]})}),e.jsx(C,{onClick:()=>p(!0),className:"flex items-center gap-2",children:"Add Follow Up"})]}),e.jsx(ke,{followUps:I,onEdit:R,onDelete:O,currentPage:f,totalPages:S,onPageChange:Q})]})})]}),e.jsx(Ee,{isOpen:l,onClose:()=>p(!1),onAddFollowUp:H}),e.jsx(Le,{isOpen:a,onClose:()=>j(!1),followUpId:m,onSave:()=>{x(),j(!1)}})]})}function it(){var O,c,D;const{data:o=[],isLoading:u,isError:h}=me();console.log(o);const[n,l]=t.useState(15),[p,a]=t.useState(o),[j]=pe(),{data:m,isLoading:b}=ue();console.log(m);const[f,N]=t.useState(""),[w,i]=t.useState(null),[y,U]=t.useState(null),[x,r]=t.useState(null),[d,S]=t.useState(""),[F,K]=t.useState("");t.useState("");const[I,A]=t.useState([]),[J,L]=t.useState(!1),M=o.filter(s=>(f===""||s.organisation.toLowerCase().includes(f.toLowerCase()))&&(w===null||s.status===w)&&(y===null||s.source===y)&&(x===null||`${s.firstName} ${s.lastName}`.toLowerCase().includes(x.toLowerCase()))&&(d===""||s.email.toLowerCase().includes(d.toLowerCase()))&&(F===""||s.phone.toLowerCase().includes(F.toLowerCase()))),G=(c=(O=M==null?void 0:M.filter(s=>I.includes(s._id)))==null?void 0:O.map(s=>s.email))==null?void 0:c.join(", "),Q=async s=>{se.confirm({title:"Are you sure you want to delete this inquiry?",content:"This action cannot be undone.",okText:"Yes",okType:"danger",cancelText:"No",onOk:async()=>{try{await j(s),a(v=>v.filter(T=>T._id!==s))}catch(v){console.error("Error deleting inquiry:",v)}}})},H=(s,v)=>{a(T=>T.map(V=>V.companyName===s.companyName?{...V,totalTasks:v}:V))},R=s=>{A(v=>v.includes(s)?v.filter(T=>T!==s):[...v,s])};return e.jsxs("div",{className:"p-4",children:[I.length>0&&e.jsx("div",{className:"mb-4",children:e.jsxs(C,{onClick:()=>L(!0),className:"bg-[#3b1f91] hover:bg-purple-700",children:["Send Email to Selected (",I.length,")"]})}),e.jsx(P,{open:J,onOpenChange:L,children:e.jsxs($,{className:"max-w-4xl",children:[e.jsx(q,{children:e.jsx(B,{children:"Send Email to Selected Inquiries"})}),e.jsx(De,{defaultTo:G,onSuccess:()=>{L(!1),A([])}})]})}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Inquiry List"}),e.jsx(ee,{to:"/add-inquiry",children:e.jsxs(C,{className:"gap-2",children:[e.jsx(Se,{className:"h-4 w-4"}),"Add Inquiry"]})})]}),e.jsxs(ge,{className:"border",children:[e.jsxs(je,{children:[e.jsxs(Y,{className:"border-b bg-gray-100",children:[e.jsx(g,{className:"w-12"}),e.jsx(g,{className:"lg:w-[100px] w-[50px] sticky left-0 bg-background z-50",children:"Date"}),e.jsx(g,{className:"text-left",children:"Info"}),e.jsx(g,{className:"text-left",children:"Message"}),e.jsx(g,{className:"text-left",children:"Follow Up"}),e.jsx(g,{className:"w-[80px] text-left",children:"Actions"})]}),e.jsxs(Y,{className:"border-b",children:[e.jsx(g,{}),e.jsx(g,{}),e.jsx(g,{children:e.jsx(z,{placeholder:"Search Info",className:"w-[200px]",value:x||"",onChange:s=>r(s.target.value)})}),e.jsx(g,{children:e.jsx(W,{value:w||"reset",onValueChange:s=>i(s==="reset"?null:s),children:e.jsxs(X,{children:[e.jsx(k,{value:"reset",children:"All Statuses"}),(D=m==null?void 0:m.data)==null?void 0:D.map(s=>e.jsx(k,{value:s.status,children:s.status},s._id))]})})}),e.jsx(g,{}),e.jsx(g,{})]})]}),e.jsx(fe,{children:M.map((s,v)=>e.jsxs(Y,{className:"border-b",children:[e.jsx(E,{className:"p-5",children:e.jsx(Ie,{checked:I.includes(s._id),onCheckedChange:()=>R(s._id)})}),e.jsx(E,{className:"sticky left-0 bg-background",children:s.createdAt.slice(0,10)}),e.jsx(E,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"font-medium",children:[s.firstName," ",s.lastName,","]}),s.organisation," ,",e.jsx("div",{className:"text-sm text-muted-foreground",children:s.email}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.phone," â€¢ ",s.address]})]})}),e.jsx(E,{children:s.message}),e.jsx(E,{className:"text-left",children:e.jsx(Te,{inquiry:s,onFollowUpAdded:H})}),e.jsx(E,{className:"text-center",children:e.jsxs(be,{children:[e.jsx(Fe,{asChild:!0,children:e.jsx("button",{variant:"ghost",size:"icon",className:"h-8 w-8 p-0",children:e.jsx(ve,{className:"h-4 w-4"})})}),e.jsxs(Me,{align:"end",className:"w-[160px]",children:[e.jsx(ee,{to:`/edit-inquiry/${s._id}`,children:e.jsx(Z,{children:"Edit"})}),e.jsx(Z,{onClick:()=>Q(s._id),children:"Delete"})]})]})})]},v))})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"Items per page:"}),e.jsxs(W,{value:n.toString(),onValueChange:s=>l(Number(s)),children:[e.jsx(he,{className:"w-[70px]",children:e.jsx(xe,{children:n})}),e.jsxs(X,{children:[e.jsx(k,{value:"15",children:"15"}),e.jsx(k,{value:"25",children:"25"}),e.jsx(k,{value:"50",children:"50"}),e.jsx(k,{value:"100",children:"100"})]})]})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:`1-${Math.min(n,M.length)} of ${M.length}`})]})]})}export{it as default};
