import{i as se,b5 as X,f as ae,j as e,D as O,m as P,n as _,o as $,L as A,I as H,B as v,b6 as te,b7 as le,b8 as ne,b9 as re,l as oe,g as ie,ba as de,bb as ce}from"./main-CHwjN9ww.js";import{c as t,L as Y}from"./vendor-CgeupRFx.js";import{S as K,c as J,d as M,a as me,b as ue}from"./select-C1q_biY9.js";import{T as he,a as xe,b as G,c as g,d as pe,e as I}from"./table-DGz3_gET.js";import{F as ge}from"./Table-B8QRHymD.js";import{M as Z}from"./index-vhPWqv9o.js";import{R as je}from"./EditOutlined-1uZ5gkuA.js";import{R as fe}from"./DeleteOutlined-_ozR8UtF.js";import{T as ee}from"./textarea-ODpBufAV.js";import{B as we}from"./badge-dVuTi65y.js";import{D as Ne,a as ye,b as Se,c as W}from"./dropdown-menu-0a0mVlUH.js";import{C as be}from"./checkbox-BTFFWEzA.js";import ve from"./EmailForm-YUMErS2M.js";import{P as Ce}from"./plus-BZbZkXNM.js";import{E as Fe}from"./ellipsis-vertical-D_kNUZep.js";import"./Combination-ChaMfiN7.js";import"./index-B5vaD5iM.js";import"./chevron-up-C-eY3GQC.js";import"./check-CYzfL35a.js";import"./toArray-CgZcBx3z.js";import"./index-De2GUwPy.js";import"./addEventListener-nEqpLwOh.js";import"./index-C9OiENjZ.js";import"./EllipsisOutlined-BzZERxSn.js";import"./dropdown-Bq_fBrNG.js";import"./TextArea-BFugBfRY.js";import"./CheckOutlined-DOYjvawT.js";import"./index-b0Fm9FGg.js";import"./index-CEpyVjvn.js";import"./useForceUpdate-EC55elJS.js";import"./index-BsWwVwVg.js";import"./CheckCircleFilled-D61TsFkM.js";import"./ExclamationCircleFilled-C5Y6pk6z.js";import"./InfoCircleFilled-DssNW7a4.js";import"./ActionButton-D79d2rlo.js";import"./index-Cg0qAJ-C.js";import"./fade-RJinsv9K.js";import"./Skeleton-BwsARMn5.js";import"./chevron-right-CVtm6TB0.js";import"./index.esm-CAsSPsEb.js";import"./index-CeMSAAkk.js";import"./card-DM5cUxGx.js";/* empty css                   */import"./index-BV0thCfA.js";import"./isEqual-D1PYm16U.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=se("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);function Me({followUps:n,onEdit:u,onDelete:h,currentPage:r,totalPages:l,onPageChange:m}){const[d,j]=t.useState(!1),[x,C]=t.useState(null),[f]=X(),{refetch:w}=ae(),N=async(o,i)=>{try{const S=await f({id:o,...i}).unwrap();await w(),console.log("Update result:",S)}catch(S){console.error(`Failed to update message ID: ${o}`,S)}},c=(o,i)=>{N(o,{status:i})},y=o=>{C(o),j(!0)},F=async()=>{x&&(await h(x),await w(),n.length===1&&r>1?m(r-1):w(),j(!1),C(null))},p=[{title:"Date",dataIndex:"date",key:"date",render:o=>new Date(o).toLocaleDateString()},{title:"Message",dataIndex:"message",key:"message"},{title:"Status",dataIndex:"status",key:"status",render:(o,i)=>e.jsxs("select",{value:o||"New",onChange:S=>c(i._id,S.target.value),className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"New",children:"New"}),e.jsx("option",{value:"In Progress",children:"In Progress"}),e.jsx("option",{value:"Completed",children:"Completed"})]})},{title:"Action",key:"action",render:(o,i)=>e.jsxs("div",{className:"flex gap-4 ",children:[e.jsx(je,{className:"cursor-pointer bg-blue-700 text-white p-2 rounded-full",onClick:()=>u(i._id)}),e.jsx(fe,{className:"cursor-pointer bg-red-600 text-white p-2 rounded-full",onClick:()=>y(i._id)})]})}];return e.jsxs(e.Fragment,{children:[e.jsx(ge,{columns:p,dataSource:n,rowKey:"_id",pagination:{current:r,total:l*10,onChange:m}}),e.jsx(Z,{title:"Confirm Delete",open:d,onOk:F,onCancel:()=>j(!1),okText:"Yes, delete",cancelText:"Cancel",className:"mt-16",children:e.jsx("p",{children:"Are you sure you want to delete this follow-up?"})})]})}function Ie({isOpen:n,onClose:u,onAddFollowUp:h}){const[r,l]=t.useState({date:"",message:""}),m=()=>{h(r),l({date:"",message:""})};return e.jsx(O,{open:n,onOpenChange:u,children:e.jsxs(P,{className:"sm:max-w-[425px]",children:[e.jsx(_,{children:e.jsx($,{children:"Add Follow Up"})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(A,{htmlFor:"date",className:"text-right",children:"Date"}),e.jsx(H,{className:" w-auto md:w-[4cm]",id:"date",type:"date",value:r.date?new Date(r.date).toISOString().slice(0,10):"",onChange:d=>l({...r,date:d.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(A,{htmlFor:"message",className:"text-right",children:"Message"}),e.jsx(ee,{id:"message",value:r.message,onChange:d=>l({...r,message:d.target.value}),className:"col-span-3"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(v,{className:"bg-red-600",variant:"outline",onClick:u,children:"Cancel"}),e.jsx(v,{onClick:m,children:"Add"})]})]})})}function ke({isOpen:n,onClose:u,followUpId:h,onSave:r}){const[l,m]=t.useState({date:"",message:""});console.log("Follow Up ID:",h);const{data:d,isLoading:j,error:x}=te(h,{skip:!n||!h}),[C,{isLoading:f,error:w}]=X();t.useEffect(()=>{d&&m({date:(y=>{const F=new Date(y),p=String(F.getMonth()+1).padStart(2,"0"),o=String(F.getDate()).padStart(2,"0"),i=F.getFullYear();return`${p}/${o}/${i}`})(d?.data?.date||""),message:d?.data?.message||""})},[d]);const N=async()=>{if(console.log("Saving follow-up:",l),console.log("Follow Up ID in handleSave:",h),!l.date){alert("Please select a date.");return}if(!l.message){alert("Please enter a message.");return}try{console.log("Attempting to update message");const c=await C({message:l.message,date:new Date(l.date).toISOString().split("T")[0],id:h}).unwrap();r({...d?.data,date:l.date,message:l.message}),u()}catch(c){console.error("Failed to update message:",c),alert(`Update failed: ${c.message||"Unknown error"}`)}};return t.useEffect(()=>{x&&(console.error("Fetch Error:",x),alert(`Fetch Error: ${x.message}`)),w&&(console.error("Update Error:",w),alert(`Update Error: ${w.message}`))},[x,w]),n?e.jsx(O,{open:n,onOpenChange:u,children:e.jsxs(P,{className:"sm:max-w-[425px]",children:[e.jsx(_,{children:e.jsx($,{children:"Edit Follow Up"})}),j?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(A,{htmlFor:"edit-date",className:"text-right",children:"Date"}),e.jsx(H,{id:"edit-date",type:"text",placeholder:"mm/dd/yyyy",value:l.date,onChange:c=>m({...l,date:c.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(A,{htmlFor:"edit-message",className:"text-right",children:"Message"}),e.jsx(ee,{id:"edit-message",value:l.message,onChange:c=>m({...l,message:c.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(v,{variant:"outline",onClick:u,disabled:f,className:"bg-red-600",children:"Cancel"}),e.jsxs(v,{onClick:N,disabled:f,children:[e.jsx(De,{className:"mr-2 h-4 w-4"})," ",f?"Saving...":"Save"]})]})]})]})}):null}function Ue({inquiry:n,onFollowUpAdded:u}){const[h,r]=t.useState(!1),[l,m]=t.useState(!1),[d,j]=t.useState(!1),[x,C]=t.useState(null),[f,w]=t.useState(1),N=5,{data:c,error:y,isLoading:F,refetch:p}=le(n._id);t.useEffect(()=>{y&&console.error("Error fetching follow-up count:",y)},[y]);const o=c?.data||[],i=o.length,S=Math.ceil(i/N),k=f*N,Q=k-N,D=o.slice(Q,k),[T,{isLoading:z}]=ne(),[U,{isLoading:E}]=re(),q=a=>{r(a),a&&p()},B=a=>{a>0&&a<=S&&w(a)},R=async a=>{if(a.date&&a.message){const b={inquiryId:n._id,date:a.date,message:a.message};try{await T(b).unwrap(),p(),u(n,i+1),m(!1)}catch(L){console.error("Failed to add follow-up:",L)}}},V=a=>{C(a),j(!0)},s=async a=>{try{await U(a).unwrap(),p(),u(n,i-1)}catch(b){console.error("Failed to delete follow-up:",b)}};return e.jsxs(e.Fragment,{children:[e.jsxs(O,{open:h,onOpenChange:q,children:[e.jsx(oe,{asChild:!0,children:e.jsxs(v,{variant:"outline",className:"text-right bg-[#3b1f91] text-white",children:["Follow Up",e.jsx(we,{variant:"outline",className:"bg-[#ffffff] text-black",children:i})]})}),e.jsx(P,{className:"sm:max-w-[60%] h-auto",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"flex justify-between items-center mt-5 mb-4",children:[e.jsx(_,{children:e.jsxs($,{children:["Follow Up - ",n.firstName," ",n.lastName]})}),e.jsx(v,{onClick:()=>m(!0),className:"flex items-center gap-2",children:"Add Follow Up"})]}),e.jsx(Me,{followUps:D,onEdit:V,onDelete:s,currentPage:f,totalPages:S,onPageChange:B})]})})]}),e.jsx(Ie,{isOpen:l,onClose:()=>m(!1),onAddFollowUp:R}),e.jsx(ke,{isOpen:d,onClose:()=>j(!1),followUpId:x,onSave:()=>{p(),j(!1)}})]})}function bs(){const{data:n=[],isLoading:u,isError:h}=ie();console.log(n);const[r,l]=t.useState(15),[m,d]=t.useState(n),[j]=de(),{data:x,isLoading:C}=ce();console.log(x);const[f,w]=t.useState(""),[N,c]=t.useState(null),[y,F]=t.useState(null),[p,o]=t.useState(null),[i,S]=t.useState(""),[k,Q]=t.useState("");t.useState("");const[D,T]=t.useState([]),[z,U]=t.useState(!1),E=n.filter(s=>(f===""||s.organisation.toLowerCase().includes(f.toLowerCase()))&&(N===null||s.status===N)&&(y===null||s.source===y)&&(p===null||`${s.firstName} ${s.lastName}`.toLowerCase().includes(p.toLowerCase()))&&(i===""||s.email.toLowerCase().includes(i.toLowerCase()))&&(k===""||s.phone.toLowerCase().includes(k.toLowerCase()))),q=E?.filter(s=>D.includes(s._id))?.map(s=>s.email)?.join(", "),B=async s=>{Z.confirm({title:"Are you sure you want to delete this inquiry?",content:"This action cannot be undone.",okText:"Yes",okType:"danger",cancelText:"No",onOk:async()=>{try{await j(s),d(a=>a.filter(b=>b._id!==s))}catch(a){console.error("Error deleting inquiry:",a)}}})},R=(s,a)=>{d(b=>b.map(L=>L.companyName===s.companyName?{...L,totalTasks:a}:L))},V=s=>{T(a=>a.includes(s)?a.filter(b=>b!==s):[...a,s])};return e.jsxs("div",{className:"p-4",children:[D.length>0&&e.jsx("div",{className:"mb-4",children:e.jsxs(v,{onClick:()=>U(!0),className:"bg-[#3b1f91] hover:bg-purple-700",children:["Send Email to Selected (",D.length,")"]})}),e.jsx(O,{open:z,onOpenChange:U,children:e.jsxs(P,{className:"max-w-4xl",children:[e.jsx(_,{children:e.jsx($,{children:"Send Email to Selected Inquiries"})}),e.jsx(ve,{defaultTo:q,onSuccess:()=>{U(!1),T([])}})]})}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Inquiry List"}),e.jsx(Y,{to:"/add-inquiry",children:e.jsxs(v,{className:"gap-2",children:[e.jsx(Ce,{className:"h-4 w-4"}),"Add Inquiry"]})})]}),e.jsxs(he,{className:"border",children:[e.jsxs(xe,{children:[e.jsxs(G,{className:"border-b bg-gray-100",children:[e.jsx(g,{className:"w-12"}),e.jsx(g,{className:"lg:w-[100px] w-[50px] sticky left-0 bg-background z-50",children:"Date"}),e.jsx(g,{className:"text-left",children:"Info"}),e.jsx(g,{className:"text-left",children:"Message"}),e.jsx(g,{className:"text-left",children:"Follow Up"}),e.jsx(g,{className:"w-[80px] text-left",children:"Actions"})]}),e.jsxs(G,{className:"border-b",children:[e.jsx(g,{}),e.jsx(g,{}),e.jsx(g,{children:e.jsx(H,{placeholder:"Search Info",className:"w-[200px]",value:p||"",onChange:s=>o(s.target.value)})}),e.jsx(g,{children:e.jsx(K,{value:N||"reset",onValueChange:s=>c(s==="reset"?null:s),children:e.jsxs(J,{children:[e.jsx(M,{value:"reset",children:"All Statuses"}),x?.data?.map(s=>e.jsx(M,{value:s.status,children:s.status},s._id))]})})}),e.jsx(g,{}),e.jsx(g,{})]})]}),e.jsx(pe,{children:E.map((s,a)=>e.jsxs(G,{className:"border-b",children:[e.jsx(I,{className:"p-5",children:e.jsx(be,{checked:D.includes(s._id),onCheckedChange:()=>V(s._id)})}),e.jsx(I,{className:"sticky left-0 bg-background",children:s.createdAt.slice(0,10)}),e.jsx(I,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"font-medium",children:[s.firstName," ",s.lastName,","]}),s.organisation," ,",e.jsx("div",{className:"text-sm text-muted-foreground",children:s.email}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.phone," â€¢ ",s.address]})]})}),e.jsx(I,{children:s.message}),e.jsx(I,{className:"text-left",children:e.jsx(Ue,{inquiry:s,onFollowUpAdded:R})}),e.jsx(I,{className:"text-center",children:e.jsxs(Ne,{children:[e.jsx(ye,{asChild:!0,children:e.jsx("button",{variant:"ghost",size:"icon",className:"h-8 w-8 p-0",children:e.jsx(Fe,{className:"h-4 w-4"})})}),e.jsxs(Se,{align:"end",className:"w-[160px]",children:[e.jsx(Y,{to:`/edit-inquiry/${s._id}`,children:e.jsx(W,{children:"Edit"})}),e.jsx(W,{onClick:()=>B(s._id),children:"Delete"})]})]})})]},a))})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"Items per page:"}),e.jsxs(K,{value:r.toString(),onValueChange:s=>l(Number(s)),children:[e.jsx(me,{className:"w-[70px]",children:e.jsx(ue,{children:r})}),e.jsxs(J,{children:[e.jsx(M,{value:"15",children:"15"}),e.jsx(M,{value:"25",children:"25"}),e.jsx(M,{value:"50",children:"50"}),e.jsx(M,{value:"100",children:"100"})]})]})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:`1-${Math.min(r,E.length)} of ${E.length}`})]})]})}export{bs as default};
