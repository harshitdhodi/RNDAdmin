import{h as e,b4 as s,e as a,j as t,D as l,l as i,m as n,n as r,L as d,I as o,B as c,b5 as m,b6 as x,b7 as h,b8 as j,k as u,f as p,b9 as g,ba as f}from"./main-DeRxjK88.js";import{r as N,L as w}from"./vendor-router-Bu4EHm1B.js";import{S as v,c as C,d as y,a as b,b as S}from"./select-Dqodnixf.js";import{T as k,a as F,b as L,c as E,d as I,e as A}from"./table-Cj_y_WH9.js";import{F as D}from"./Table-BZaWXI2p.js";import{M as U}from"./index-BeYydUON.js";import{R as O}from"./EditOutlined-hcgcOCju.js";import{R as _}from"./DeleteOutlined-BpoFncVM.js";import{T}from"./textarea-BwEsUAMy.js";import{B as q}from"./badge-lQP7Jiha.js";import{D as M,a as P,b as $,c as V}from"./dropdown-menu-BEoG4Wb8.js";import{C as z}from"./checkbox-BgMhpwnf.js";import B from"./EmailForm-CprQPM7w.js";import{P as H}from"./plus-CYGv-ui8.js";import{E as Y}from"./ellipsis-vertical-DXlju7bG.js";import"./vendor-react-CI5aWZjI.js";import"./vendor-utils-BfOc9lHv.js";import"./Combination-CNfQ0noH.js";import"./index-Kj7Vjsi3.js";import"./check-CVm68GV7.js";import"./chevron-up-3rt5hBY6.js";import"./toArray-DkI11MDQ.js";import"./index-lUiyPlMq.js";import"./addEventListener-BUKQhVN_.js";import"./index-j6PXCaBg.js";import"./EllipsisOutlined-L4j7-ai9.js";import"./dropdown-B7KEEEnN.js";import"./getAllowClear-exXUluB6.js";import"./CheckOutlined-3fI3nOal.js";import"./Input-BufppJmu.js";import"./index-DoSF0nZj.js";import"./index-VFidPMY_.js";import"./CheckCircleFilled-DiSUBvU5.js";import"./ExclamationCircleFilled-DZysw_83.js";import"./InfoCircleFilled-D8dKuFWy.js";import"./ActionButton-xPc0Gc43.js";import"./index-Bz7nO4c4.js";import"./index-DRGG9HZA.js";import"./fade-C0XPHGae.js";import"./Skeleton-3ezOyxdU.js";import"./chevron-right-YTRb9aqn.js";import"./index.esm-C1PzQRG-.js";import"./index-Db_ZYzj8.js";import"./card-RXDLfuok.js";/* empty css                   */import"./index-CJo0JxI7.js";import"./isEqual-DOH0BpiM.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=e("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);function R({followUps:e,onEdit:l,onDelete:i,currentPage:n,totalPages:r,onPageChange:d}){const[o,c]=N.useState(!1),[m,x]=N.useState(null),[h]=s(),{refetch:j}=a(),u=(e,s)=>{(async(e,s)=>{try{await h({id:e,...s}).unwrap(),await j()}catch(a){}})(e,{status:s})},p=[{title:"Date",dataIndex:"date",key:"date",render:e=>new Date(e).toLocaleDateString()},{title:"Message",dataIndex:"message",key:"message"},{title:"Status",dataIndex:"status",key:"status",render:(e,s)=>t.jsxs("select",{value:e||"New",onChange:e=>u(s._id,e.target.value),className:"border rounded px-2 py-1",children:[t.jsx("option",{value:"New",children:"New"}),t.jsx("option",{value:"In Progress",children:"In Progress"}),t.jsx("option",{value:"Completed",children:"Completed"})]})},{title:"Action",key:"action",render:(e,s)=>t.jsxs("div",{className:"flex gap-4 ",children:[t.jsx(O,{className:"cursor-pointer bg-blue-700 text-white p-2 rounded-full",onClick:()=>l(s._id)}),t.jsx(_,{className:"cursor-pointer bg-red-600 text-white p-2 rounded-full",onClick:()=>{return e=s._id,x(e),void c(!0);var e}})]})}];return t.jsxs(t.Fragment,{children:[t.jsx(D,{columns:p,dataSource:e,rowKey:"_id",pagination:{current:n,total:10*r,onChange:d}}),t.jsx(U,{title:"Confirm Delete",open:o,onOk:async()=>{m&&(await i(m),await j(),1===e.length&&n>1?d(n-1):j(),c(!1),x(null))},onCancel:()=>c(!1),okText:"Yes, delete",cancelText:"Cancel",className:"mt-16",children:t.jsx("p",{children:"Are you sure you want to delete this follow-up?"})})]})}function G({isOpen:e,onClose:s,onAddFollowUp:a}){const[m,x]=N.useState({date:"",message:""});return t.jsx(l,{open:e,onOpenChange:s,children:t.jsxs(i,{className:"sm:max-w-[425px]",children:[t.jsx(n,{children:t.jsx(r,{children:"Add Follow Up"})}),t.jsxs("div",{className:"grid gap-4 py-4",children:[t.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[t.jsx(d,{htmlFor:"date",className:"text-right",children:"Date"}),t.jsx(o,{className:" w-auto md:w-[4cm]",id:"date",type:"date",value:m.date?new Date(m.date).toISOString().slice(0,10):"",onChange:e=>x({...m,date:e.target.value})})]}),t.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[t.jsx(d,{htmlFor:"message",className:"text-right",children:"Message"}),t.jsx(T,{id:"message",value:m.message,onChange:e=>x({...m,message:e.target.value}),className:"col-span-3"})]})]}),t.jsxs("div",{className:"flex justify-end space-x-2",children:[t.jsx(c,{className:"bg-red-600",variant:"outline",onClick:s,children:"Cancel"}),t.jsx(c,{onClick:()=>{a(m),x({date:"",message:""})},children:"Add"})]})]})})}function J({isOpen:e,onClose:a,followUpId:x,onSave:h}){const[j,u]=N.useState({date:"",message:""}),{data:p,isLoading:g,error:f}=m(x,{skip:!e||!x}),[w,{isLoading:v,error:C}]=s();N.useEffect((()=>{if(p){u({date:(e=>{const s=new Date(e);return`${String(s.getMonth()+1).padStart(2,"0")}/${String(s.getDate()).padStart(2,"0")}/${s.getFullYear()}`})(p?.data?.date||""),message:p?.data?.message||""})}}),[p]);return N.useEffect((()=>{f&&alert(`Fetch Error: ${f.message}`),C&&alert(`Update Error: ${C.message}`)}),[f,C]),e?t.jsx(l,{open:e,onOpenChange:a,children:t.jsxs(i,{className:"sm:max-w-[425px]",children:[t.jsx(n,{children:t.jsx(r,{children:"Edit Follow Up"})}),g?t.jsx("div",{children:"Loading..."}):t.jsxs("div",{className:"grid gap-4 py-4",children:[t.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[t.jsx(d,{htmlFor:"edit-date",className:"text-right",children:"Date"}),t.jsx(o,{id:"edit-date",type:"text",placeholder:"mm/dd/yyyy",value:j.date,onChange:e=>u({...j,date:e.target.value}),className:"col-span-3"})]}),t.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[t.jsx(d,{htmlFor:"edit-message",className:"text-right",children:"Message"}),t.jsx(T,{id:"edit-message",value:j.message,onChange:e=>u({...j,message:e.target.value}),className:"col-span-3"})]}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx(c,{variant:"outline",onClick:a,disabled:v,className:"bg-red-600",children:"Cancel"}),t.jsxs(c,{onClick:async()=>{if(j.date)if(j.message)try{await w({message:j.message,date:new Date(j.date).toISOString().split("T")[0],id:x}).unwrap();h({...p?.data,date:j.date,message:j.message}),a()}catch(e){alert(`Update failed: ${e.message||"Unknown error"}`)}else alert("Please enter a message.");else alert("Please select a date.")},disabled:v,children:[t.jsx(Q,{className:"mr-2 h-4 w-4"})," ",v?"Saving...":"Save"]})]})]})]})}):null}function K({inquiry:e,onFollowUpAdded:s}){const[a,d]=N.useState(!1),[o,m]=N.useState(!1),[p,g]=N.useState(!1),[f,w]=N.useState(null),[v,C]=N.useState(1),{data:y,error:b,isLoading:S,refetch:k}=x(e._id);N.useEffect((()=>{}),[b]);const F=y?.data||[],L=F.length,E=Math.ceil(L/5),I=5*v,A=I-5,D=F.slice(A,I),[U,{isLoading:O}]=h(),[_,{isLoading:T}]=j();return t.jsxs(t.Fragment,{children:[t.jsxs(l,{open:a,onOpenChange:e=>{d(e),e&&k()},children:[t.jsx(u,{asChild:!0,children:t.jsxs(c,{variant:"outline",className:"text-right bg-[#3b1f91] text-white",children:["Follow Up",t.jsx(q,{variant:"outline",className:"bg-[#ffffff] text-black",children:L})]})}),t.jsx(i,{className:"sm:max-w-[60%] h-auto",children:t.jsxs("div",{className:"grid gap-4",children:[t.jsxs("div",{className:"flex justify-between items-center mt-5 mb-4",children:[t.jsx(n,{children:t.jsxs(r,{children:["Follow Up - ",e.firstName," ",e.lastName]})}),t.jsx(c,{onClick:()=>m(!0),className:"flex items-center gap-2",children:"Add Follow Up"})]}),t.jsx(R,{followUps:D,onEdit:e=>{w(e),g(!0)},onDelete:async a=>{try{await _(a).unwrap(),k(),s(e,L-1)}catch(t){}},currentPage:v,totalPages:E,onPageChange:e=>{e>0&&e<=E&&C(e)}})]})})]}),t.jsx(G,{isOpen:o,onClose:()=>m(!1),onAddFollowUp:async a=>{if(a.date&&a.message){const l={inquiryId:e._id,date:a.date,message:a.message};try{await U(l).unwrap(),k(),s(e,L+1),m(!1)}catch(t){}}}}),t.jsx(J,{isOpen:p,onClose:()=>g(!1),followUpId:f,onSave:()=>{k(),g(!1)}})]})}function W(){const{data:e=[],isLoading:s,isError:a}=p(),[d,m]=N.useState(15),[x,h]=N.useState(e),[j]=g(),{data:u,isLoading:D}=f(),[O,_]=N.useState(""),[T,q]=N.useState(null),[Q,R]=N.useState(null),[G,J]=N.useState(null),[W,X]=N.useState(""),[Z,ee]=N.useState(""),[se,ae]=N.useState(""),[te,le]=N.useState([]),[ie,ne]=N.useState(!1),re=e.filter((e=>(""===O||e.organisation.toLowerCase().includes(O.toLowerCase()))&&(null===T||e.status===T)&&(null===Q||e.source===Q)&&(null===G||`${e.firstName} ${e.lastName}`.toLowerCase().includes(G.toLowerCase()))&&(""===W||e.email.toLowerCase().includes(W.toLowerCase()))&&(""===Z||e.phone.toLowerCase().includes(Z.toLowerCase())))),de=re?.filter((e=>te.includes(e._id)))?.map((e=>e.email))?.join(", "),oe=(e,s)=>{h((a=>a.map((a=>a.companyName===e.companyName?{...a,totalTasks:s}:a))))};return t.jsxs("div",{className:"p-4",children:[te.length>0&&t.jsx("div",{className:"mb-4",children:t.jsxs(c,{onClick:()=>ne(!0),className:"bg-[#3b1f91] hover:bg-purple-700",children:["Send Email to Selected (",te.length,")"]})}),t.jsx(l,{open:ie,onOpenChange:ne,children:t.jsxs(i,{className:"max-w-4xl",children:[t.jsx(n,{children:t.jsx(r,{children:"Send Email to Selected Inquiries"})}),t.jsx(B,{defaultTo:de,onSuccess:()=>{ne(!1),le([])}})]})}),t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h1",{className:"text-xl font-semibold",children:"Inquiry List"}),t.jsx(w,{to:"/add-inquiry",children:t.jsxs(c,{className:"gap-2",children:[t.jsx(H,{className:"h-4 w-4"}),"Add Inquiry"]})})]}),t.jsxs(k,{className:"border",children:[t.jsxs(F,{children:[t.jsxs(L,{className:"border-b bg-gray-100",children:[t.jsx(E,{className:"w-12"}),t.jsx(E,{className:"lg:w-[100px] w-[50px] sticky left-0 bg-background z-50",children:"Date"}),t.jsx(E,{className:"text-left",children:"Info"}),t.jsx(E,{className:"text-left",children:"Message"}),t.jsx(E,{className:"text-left",children:"Follow Up"}),t.jsx(E,{className:"w-[80px] text-left",children:"Actions"})]}),t.jsxs(L,{className:"border-b",children:[t.jsx(E,{}),t.jsx(E,{}),t.jsx(E,{children:t.jsx(o,{placeholder:"Search Info",className:"w-[200px]",value:G||"",onChange:e=>J(e.target.value)})}),t.jsx(E,{children:t.jsx(v,{value:T||"reset",onValueChange:e=>q("reset"===e?null:e),children:t.jsxs(C,{children:[t.jsx(y,{value:"reset",children:"All Statuses"}),u?.data?.map((e=>t.jsx(y,{value:e.status,children:e.status},e._id)))]})})}),t.jsx(E,{}),t.jsx(E,{})]})]}),t.jsx(I,{children:re.map(((e,s)=>t.jsxs(L,{className:"border-b",children:[t.jsx(A,{className:"p-5",children:t.jsx(z,{checked:te.includes(e._id),onCheckedChange:()=>{return s=e._id,void le((e=>e.includes(s)?e.filter((e=>e!==s)):[...e,s]));var s}})}),t.jsx(A,{className:"sticky left-0 bg-background",children:e.createdAt.slice(0,10)}),t.jsx(A,{children:t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"font-medium",children:[e.firstName," ",e.lastName,","]}),e.organisation," ,",t.jsx("div",{className:"text-sm text-muted-foreground",children:e.email}),t.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.phone," â€¢ ",e.address]})]})}),t.jsx(A,{children:e.message}),t.jsx(A,{className:"text-left",children:t.jsx(K,{inquiry:e,onFollowUpAdded:oe})}),t.jsx(A,{className:"text-center",children:t.jsxs(M,{children:[t.jsx(P,{asChild:!0,children:t.jsx("button",{variant:"ghost",size:"icon",className:"h-8 w-8 p-0",children:t.jsx(Y,{className:"h-4 w-4"})})}),t.jsxs($,{align:"end",className:"w-[160px]",children:[t.jsx(w,{to:`/edit-inquiry/${e._id}`,children:t.jsx(V,{children:"Edit"})}),t.jsx(V,{onClick:()=>(async e=>{U.confirm({title:"Are you sure you want to delete this inquiry?",content:"This action cannot be undone.",okText:"Yes",okType:"danger",cancelText:"No",onOk:async()=>{try{await j(e),h((s=>s.filter((s=>s._id!==e))))}catch(s){}}})})(e._id),children:"Delete"})]})]})})]},s)))})]}),t.jsxs("div",{className:"flex items-center justify-between mt-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm",children:"Items per page:"}),t.jsxs(v,{value:d.toString(),onValueChange:e=>m(Number(e)),children:[t.jsx(b,{className:"w-[70px]",children:t.jsx(S,{children:d})}),t.jsxs(C,{children:[t.jsx(y,{value:"15",children:"15"}),t.jsx(y,{value:"25",children:"25"}),t.jsx(y,{value:"50",children:"50"}),t.jsx(y,{value:"100",children:"100"})]})]})]}),t.jsx("div",{className:"text-sm text-muted-foreground",children:`1-${Math.min(d,re.length)} of ${re.length}`})]})]})}export{W as default};
//# sourceMappingURL=InquiryTable-Ch4blJ9I.js.map
