import{i as te,b4 as ee,f as le,j as e,D as O,m as P,n as _,o as $,L as A,I as H,B as v,b5 as ne,b6 as re,b7 as oe,b8 as ie,l as ce,g as de,b9 as me,ba as ue}from"./main-CYNrSTW--1744363659677.js";import{c as a,L as J}from"./vendor-C9iLKeEQ-1744363659677.js";import{S as W,c as X,d as M,a as he,b as xe}from"./select-CJ7EmxJi-1744363659677.js";import{T as pe,a as ge,b as G,c as j,d as je,e as I}from"./table-tNkONjpy-1744363659677.js";import{F as fe}from"./Table-CrVkqMFb-1744363659677.js";import{M as se}from"./index-Bdc85HzM-1744363659677.js";import{R as we}from"./EditOutlined-DhNeNSsD-1744363659677.js";import{R as Ne}from"./DeleteOutlined-BGiX-06U-1744363659677.js";import{T as ae}from"./textarea-3Vx_2fur-1744363659677.js";import{B as ye}from"./badge-De77JiQ4-1744363659677.js";import{D as Se,a as be,b as ve,c as Z}from"./dropdown-menu-DdG5j-6Y-1744363659677.js";import{C as Ce}from"./checkbox-Dx2VEj_E-1744363659677.js";import Fe from"./EmailForm-BhNsxMEF-1744363659677.js";import{P as De}from"./plus-BOy5lyNT-1744363659677.js";import{E as Me}from"./ellipsis-vertical-C4xnbIKN-1744363659677.js";import"./Combination-BxxspTpZ-1744363659677.js";import"./index-BrBKIB9h-1744363659677.js";import"./check-DmwTtl1E-1744363659677.js";import"./chevron-up-B9Fit8uI-1744363659677.js";import"./toArray-Bbgf03cS-1744363659677.js";import"./index-DkmSFnuQ-1744363659677.js";import"./addEventListener-D2WTRJJP-1744363659677.js";import"./index-H-NxSgLh-1744363659677.js";import"./EllipsisOutlined-D8fD8gip-1744363659677.js";import"./dropdown-D2jFphdU-1744363659677.js";import"./TextArea-BdT92n-5-1744363659677.js";import"./CheckOutlined-CDIdsoIE-1744363659677.js";import"./index-D68M3nPv-1744363659677.js";import"./index-CGjTjQck-1744363659677.js";import"./useForceUpdate-CukwmpEq-1744363659677.js";import"./index-BrN1Ia0l-1744363659677.js";import"./CheckCircleFilled-L1JRGpiz-1744363659677.js";import"./ExclamationCircleFilled-CrJgWl4M-1744363659677.js";import"./InfoCircleFilled-lPyD7WkW-1744363659677.js";import"./ActionButton-C2DIefxi-1744363659677.js";import"./index-n4bGR8Ob-1744363659677.js";import"./fade-DrgNSmoV-1744363659677.js";import"./Skeleton-DdAeURtk-1744363659677.js";import"./chevron-right-CnixIIbx-1744363659677.js";import"./index.esm-C94JLnSJ-1744363659677.js";import"./index-DWgNKagA-1744363659677.js";import"./card-CZNY7Upp-1744363659677.js";/* empty css                                 */import"./index-C8OTX8Ey-1744363659677.js";import"./isEqual-CZsbwD47-1744363659677.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=te("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);function ke({followUps:l,onEdit:h,onDelete:x,currentPage:n,totalPages:t,onPageChange:m}){const[c,f]=a.useState(!1),[p,C]=a.useState(null),[w]=ee(),{refetch:N}=le(),y=async(r,o)=>{try{const b=await w({id:r,...o}).unwrap();await N(),console.log("Update result:",b)}catch(b){console.error(`Failed to update message ID: ${r}`,b)}},d=(r,o)=>{y(r,{status:o})},S=r=>{C(r),f(!0)},F=async()=>{p&&(await x(p),await N(),l.length===1&&n>1?m(n-1):N(),f(!1),C(null))},g=[{title:"Date",dataIndex:"date",key:"date",render:r=>new Date(r).toLocaleDateString()},{title:"Message",dataIndex:"message",key:"message"},{title:"Status",dataIndex:"status",key:"status",render:(r,o)=>e.jsxs("select",{value:r||"New",onChange:b=>d(o._id,b.target.value),className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"New",children:"New"}),e.jsx("option",{value:"In Progress",children:"In Progress"}),e.jsx("option",{value:"Completed",children:"Completed"})]})},{title:"Action",key:"action",render:(r,o)=>e.jsxs("div",{className:"flex gap-4 ",children:[e.jsx(we,{className:"cursor-pointer bg-blue-700 text-white p-2 rounded-full",onClick:()=>h(o._id)}),e.jsx(Ne,{className:"cursor-pointer bg-red-600 text-white p-2 rounded-full",onClick:()=>S(o._id)})]})}];return e.jsxs(e.Fragment,{children:[e.jsx(fe,{columns:g,dataSource:l,rowKey:"_id",pagination:{current:n,total:t*10,onChange:m}}),e.jsx(se,{title:"Confirm Delete",open:c,onOk:F,onCancel:()=>f(!1),okText:"Yes, delete",cancelText:"Cancel",className:"mt-16",children:e.jsx("p",{children:"Are you sure you want to delete this follow-up?"})})]})}function Ue({isOpen:l,onClose:h,onAddFollowUp:x}){const[n,t]=a.useState({date:"",message:""}),m=()=>{x(n),t({date:"",message:""})};return e.jsx(O,{open:l,onOpenChange:h,children:e.jsxs(P,{className:"sm:max-w-[425px]",children:[e.jsx(_,{children:e.jsx($,{children:"Add Follow Up"})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(A,{htmlFor:"date",className:"text-right",children:"Date"}),e.jsx(H,{className:" w-auto md:w-[4cm]",id:"date",type:"date",value:n.date?new Date(n.date).toISOString().slice(0,10):"",onChange:c=>t({...n,date:c.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(A,{htmlFor:"message",className:"text-right",children:"Message"}),e.jsx(ae,{id:"message",value:n.message,onChange:c=>t({...n,message:c.target.value}),className:"col-span-3"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(v,{className:"bg-red-600",variant:"outline",onClick:h,children:"Cancel"}),e.jsx(v,{onClick:m,children:"Add"})]})]})})}function Ee({isOpen:l,onClose:h,followUpId:x,onSave:n}){const[t,m]=a.useState({date:"",message:""});console.log("Follow Up ID:",x);const{data:c,isLoading:f,error:p}=ne(x,{skip:!l||!x}),[C,{isLoading:w,error:N}]=ee();a.useEffect(()=>{c&&m({date:(S=>{const F=new Date(S),g=String(F.getMonth()+1).padStart(2,"0"),r=String(F.getDate()).padStart(2,"0"),o=F.getFullYear();return`${g}/${r}/${o}`})(c?.data?.date||""),message:c?.data?.message||""})},[c]);const y=async()=>{if(console.log("Saving follow-up:",t),console.log("Follow Up ID in handleSave:",x),!t.date){alert("Please select a date.");return}if(!t.message){alert("Please enter a message.");return}try{console.log("Attempting to update message");const d=await C({message:t.message,date:new Date(t.date).toISOString().split("T")[0],id:x}).unwrap();n({...c?.data,date:t.date,message:t.message}),h()}catch(d){console.error("Failed to update message:",d),alert(`Update failed: ${d.message||"Unknown error"}`)}};return a.useEffect(()=>{p&&(console.error("Fetch Error:",p),alert(`Fetch Error: ${p.message}`)),N&&(console.error("Update Error:",N),alert(`Update Error: ${N.message}`))},[p,N]),l?e.jsx(O,{open:l,onOpenChange:h,children:e.jsxs(P,{className:"sm:max-w-[425px]",children:[e.jsx(_,{children:e.jsx($,{children:"Edit Follow Up"})}),f?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(A,{htmlFor:"edit-date",className:"text-right",children:"Date"}),e.jsx(H,{id:"edit-date",type:"text",placeholder:"mm/dd/yyyy",value:t.date,onChange:d=>m({...t,date:d.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(A,{htmlFor:"edit-message",className:"text-right",children:"Message"}),e.jsx(ae,{id:"edit-message",value:t.message,onChange:d=>m({...t,message:d.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(v,{variant:"outline",onClick:h,disabled:w,className:"bg-red-600",children:"Cancel"}),e.jsxs(v,{onClick:y,disabled:w,children:[e.jsx(Ie,{className:"mr-2 h-4 w-4"})," ",w?"Saving...":"Save"]})]})]})]})}):null}function Le({inquiry:l,onFollowUpAdded:h}){const[x,n]=a.useState(!1),[t,m]=a.useState(!1),[c,f]=a.useState(!1),[p,C]=a.useState(null),[w,N]=a.useState(1),y=5,{data:d,error:S,isLoading:F,refetch:g}=re(l._id);a.useEffect(()=>{S&&console.error("Error fetching follow-up count:",S)},[S]);const r=d?.data||[],o=r.length,b=Math.ceil(o/y),k=w*y,Q=k-y,z=r.slice(Q,k),[Y,{isLoading:U}]=oe(),[T,{isLoading:K}]=ie(),E=i=>{n(i),i&&g()},D=i=>{i>0&&i<=b&&N(i)},q=async i=>{if(i.date&&i.message){const s={inquiryId:l._id,date:i.date,message:i.message};try{await Y(s).unwrap(),g(),h(l,o+1),m(!1)}catch(u){console.error("Failed to add follow-up:",u)}}},B=i=>{C(i),f(!0)},R=async i=>{try{await T(i).unwrap(),g(),h(l,o-1)}catch(s){console.error("Failed to delete follow-up:",s)}};return e.jsxs(e.Fragment,{children:[e.jsxs(O,{open:x,onOpenChange:E,children:[e.jsx(ce,{asChild:!0,children:e.jsxs(v,{variant:"outline",className:"text-right bg-[#3b1f91] text-white",children:["Follow Up",e.jsx(ye,{variant:"outline",className:"bg-[#ffffff] text-black",children:o})]})}),e.jsx(P,{className:"sm:max-w-[60%] h-auto",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"flex justify-between items-center mt-5 mb-4",children:[e.jsx(_,{children:e.jsxs($,{children:["Follow Up - ",l.firstName," ",l.lastName]})}),e.jsx(v,{onClick:()=>m(!0),className:"flex items-center gap-2",children:"Add Follow Up"})]}),e.jsx(ke,{followUps:z,onEdit:B,onDelete:R,currentPage:w,totalPages:b,onPageChange:D})]})})]}),e.jsx(Ue,{isOpen:t,onClose:()=>m(!1),onAddFollowUp:q}),e.jsx(Ee,{isOpen:c,onClose:()=>f(!1),followUpId:p,onSave:()=>{g(),f(!1)}})]})}function Cs(){const{data:l=[],isLoading:h,isError:x}=de();console.log(l);const[n,t]=a.useState(15),[m,c]=a.useState(l),[f]=me(),{data:p,isLoading:C}=ue();console.log(p);const[w,N]=a.useState(""),[y,d]=a.useState(null),[S,F]=a.useState(null),[g,r]=a.useState(null),[o,b]=a.useState(""),[k,Q]=a.useState(""),[z,Y]=a.useState(""),[U,T]=a.useState([]),[K,E]=a.useState(!1),D=l.filter(s=>(w===""||s.organisation.toLowerCase().includes(w.toLowerCase()))&&(y===null||s.status===y)&&(S===null||s.source===S)&&(g===null||`${s.firstName} ${s.lastName}`.toLowerCase().includes(g.toLowerCase()))&&(o===""||s.email.toLowerCase().includes(o.toLowerCase()))&&(k===""||s.phone.toLowerCase().includes(k.toLowerCase()))),q=D?.filter(s=>U.includes(s._id))?.map(s=>s.email)?.join(", "),B=async s=>{se.confirm({title:"Are you sure you want to delete this inquiry?",content:"This action cannot be undone.",okText:"Yes",okType:"danger",cancelText:"No",onOk:async()=>{try{await f(s),c(u=>u.filter(L=>L._id!==s))}catch(u){console.error("Error deleting inquiry:",u)}}})},R=(s,u)=>{c(L=>L.map(V=>V.companyName===s.companyName?{...V,totalTasks:u}:V))},i=s=>{T(u=>u.includes(s)?u.filter(L=>L!==s):[...u,s])};return e.jsxs("div",{className:"p-4",children:[U.length>0&&e.jsx("div",{className:"mb-4",children:e.jsxs(v,{onClick:()=>E(!0),className:"bg-[#3b1f91] hover:bg-purple-700",children:["Send Email to Selected (",U.length,")"]})}),e.jsx(O,{open:K,onOpenChange:E,children:e.jsxs(P,{className:"max-w-4xl",children:[e.jsx(_,{children:e.jsx($,{children:"Send Email to Selected Inquiries"})}),e.jsx(Fe,{defaultTo:q,onSuccess:()=>{E(!1),T([])}})]})}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Inquiry List"}),e.jsx(J,{to:"/add-inquiry",children:e.jsxs(v,{className:"gap-2",children:[e.jsx(De,{className:"h-4 w-4"}),"Add Inquiry"]})})]}),e.jsxs(pe,{className:"border",children:[e.jsxs(ge,{children:[e.jsxs(G,{className:"border-b bg-gray-100",children:[e.jsx(j,{className:"w-12"}),e.jsx(j,{className:"lg:w-[100px] w-[50px] sticky left-0 bg-background z-50",children:"Date"}),e.jsx(j,{className:"text-left",children:"Info"}),e.jsx(j,{className:"text-left",children:"Message"}),e.jsx(j,{className:"text-left",children:"Follow Up"}),e.jsx(j,{className:"w-[80px] text-left",children:"Actions"})]}),e.jsxs(G,{className:"border-b",children:[e.jsx(j,{}),e.jsx(j,{}),e.jsx(j,{children:e.jsx(H,{placeholder:"Search Info",className:"w-[200px]",value:g||"",onChange:s=>r(s.target.value)})}),e.jsx(j,{children:e.jsx(W,{value:y||"reset",onValueChange:s=>d(s==="reset"?null:s),children:e.jsxs(X,{children:[e.jsx(M,{value:"reset",children:"All Statuses"}),p?.data?.map(s=>e.jsx(M,{value:s.status,children:s.status},s._id))]})})}),e.jsx(j,{}),e.jsx(j,{})]})]}),e.jsx(je,{children:D.map((s,u)=>e.jsxs(G,{className:"border-b",children:[e.jsx(I,{className:"p-5",children:e.jsx(Ce,{checked:U.includes(s._id),onCheckedChange:()=>i(s._id)})}),e.jsx(I,{className:"sticky left-0 bg-background",children:s.createdAt.slice(0,10)}),e.jsx(I,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"font-medium",children:[s.firstName," ",s.lastName,","]}),s.organisation," ,",e.jsx("div",{className:"text-sm text-muted-foreground",children:s.email}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.phone," â€¢ ",s.address]})]})}),e.jsx(I,{children:s.message}),e.jsx(I,{className:"text-left",children:e.jsx(Le,{inquiry:s,onFollowUpAdded:R})}),e.jsx(I,{className:"text-center",children:e.jsxs(Se,{children:[e.jsx(be,{asChild:!0,children:e.jsx("button",{variant:"ghost",size:"icon",className:"h-8 w-8 p-0",children:e.jsx(Me,{className:"h-4 w-4"})})}),e.jsxs(ve,{align:"end",className:"w-[160px]",children:[e.jsx(J,{to:`/edit-inquiry/${s._id}`,children:e.jsx(Z,{children:"Edit"})}),e.jsx(Z,{onClick:()=>B(s._id),children:"Delete"})]})]})})]},u))})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"Items per page:"}),e.jsxs(W,{value:n.toString(),onValueChange:s=>t(Number(s)),children:[e.jsx(he,{className:"w-[70px]",children:e.jsx(xe,{children:n})}),e.jsxs(X,{children:[e.jsx(M,{value:"15",children:"15"}),e.jsx(M,{value:"25",children:"25"}),e.jsx(M,{value:"50",children:"50"}),e.jsx(M,{value:"100",children:"100"})]})]})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:`1-${Math.min(n,D.length)} of ${D.length}`})]})]})}export{Cs as default};
