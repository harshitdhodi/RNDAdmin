import{F as e,M as s}from"./antd-CxduzDaN.js";import{r as a,j as t}from"./react-BfBsRgn0.js";import{ag as r,e as i,D as l,i as n,j as o,k as c,L as d,I as m,T as j,B as p,ah as x,ai as u,aj as h,ak as g,h as f,f as v,al as N,am as w}from"./index-mCSb4W1J.js";import{S as y,c as b,d as C,a as S,b as k}from"./select-BjvvJv_x.js";import{T as F,a as L,b as I,c as D,d as U,e as A}from"./table-C5KT2_Ve.js";import{G as E,H as _}from"./ant-design-icons-DoIDTG1a.js";import{D as O,h as q,E as T}from"./lucide-D6BDVLHE.js";import{B as $}from"./badge-BCgjqnTR.js";import{D as P,a as M,b as z,c as Y}from"./dropdown-menu-BSEIa4ap.js";import{C as B}from"./checkbox-B-Aja2U0.js";import V from"./EmailForm-1H7r2nfg.js";import{L as G}from"./react-router-DUJjWq5j.js";import"./@ant-design-DttPmOfw.js";import"./rc-util-CQtTJgfq.js";import"./@babel-BfC2A0EA.js";import"./react-is-BaRe0U6l.js";import"./react-dom-DwrudmHt.js";import"./classnames-C3ovBj6j.js";import"./scheduler-BFk34ZWe.js";import"./@emotion-Czw0TW3x.js";import"./stylis-IVPcsLSI.js";import"./@ctrl-B2IeE8ye.js";import"./rc-motion-Cs3GDHoo.js";import"./@rc-component-BB24pTyE.js";import"./rc-resize-observer-DUJXZwxn.js";import"./resize-observer-polyfill-CzGuHLZU.js";import"./rc-dialog-BGKNmDMe.js";import"./rc-table-CybQOAzy.js";import"./rc-virtual-list-P8JqKX09.js";import"./rc-tree--ithDbGw.js";import"./rc-checkbox-bMXfL26q.js";import"./rc-pagination-CiqGXVR2.js";import"./rc-select-sVu4PbUz.js";import"./rc-overflow-73VxJI7O.js";import"./throttle-debounce-w9OM8Bxz.js";import"./rc-input-ByOKN0-r.js";import"./rc-tooltip-C1heEwdg.js";import"./rc-notification-D3ebMW8F.js";import"./rc-image-BIQJV_M3.js";import"./rc-textarea-DLkAnH0O.js";import"./copy-to-clipboard-Bgp_G7Oq.js";import"./toggle-selection-DUsDmMsR.js";import"./rc-upload-ClZE7meS.js";import"./rc-progress-bbq4uvV3.js";import"./rc-dropdown-C238bXH-.js";import"./rc-menu-CzbBjnhu.js";import"./rc-field-form-DaYAwFJ8.js";import"./scroll-into-view-if-needed-cNB78-hM.js";import"./compute-scroll-into-view-CJmtT4lq.js";import"./rc-picker-B5UDvhgZ.js";import"./rc-tabs-DG0zBL9k.js";import"./react-redux-DbBiFgqA.js";import"./use-sync-external-store-DdeJV4gQ.js";import"./@reduxjs-UCSEaN3g.js";import"./redux-C5Huw2aR.js";import"./immer-DgfQkf_7.js";import"./redux-thunk-B3S1iNVp.js";import"./reselect-BSOs5pU1.js";import"./js-cookie-BXEMiIsG.js";import"./@radix-ui-BWjeGzol.js";import"./aria-hidden-BHUiN-rI.js";import"./react-remove-scroll-yauc81_r.js";import"./tslib-Bc9CN1Ef.js";import"./react-remove-scroll-bar-BcxDecei.js";import"./react-style-singleton-C1QVuB2c.js";import"./get-nonce-BYiZHLe3.js";import"./use-sidecar-BA4C4RS7.js";import"./use-callback-ref-Cvx1xcTX.js";import"./@floating-ui-BSChQBl3.js";import"./class-variance-authority-DeOWI0hf.js";import"./clsx-BeLtu-UY.js";import"./tailwind-merge-D2VJQb_v.js";import"./axios-BoylL8Pu.js";import"./cookie-BUTH-fPQ.js";import"./react-hook-form-Dn0Bw783.js";import"./@hookform-DBV5tMOk.js";import"./zod-CO6CETVj.js";import"./card--g8pM1Dm.js";import"./react-quill-O9LY_HeH.js";import"./lodash-CtK3uT03.js";import"./quill-CMG--X-K.js";function H({followUps:l,onEdit:n,onDelete:o,currentPage:c,totalPages:d,onPageChange:m}){const[j,p]=a.useState(!1),[x,u]=a.useState(null),[h]=r(),{refetch:g}=i(),f=(e,s)=>{(async(e,s)=>{try{await h({id:e,...s}).unwrap(),await g()}catch(a){}})(e,{status:s})},v=[{title:"Date",dataIndex:"date",key:"date",render:e=>new Date(e).toLocaleDateString()},{title:"Message",dataIndex:"message",key:"message"},{title:"Status",dataIndex:"status",key:"status",render:(e,s)=>t.jsxs("select",{value:e||"New",onChange:e=>f(s._id,e.target.value),className:"border rounded px-2 py-1",children:[t.jsx("option",{value:"New",children:"New"}),t.jsx("option",{value:"In Progress",children:"In Progress"}),t.jsx("option",{value:"Completed",children:"Completed"})]})},{title:"Action",key:"action",render:(e,s)=>t.jsxs("div",{className:"flex gap-4 ",children:[t.jsx(E,{className:"cursor-pointer bg-blue-700 text-white p-2 rounded-full",onClick:()=>n(s._id)}),t.jsx(_,{className:"cursor-pointer bg-red-600 text-white p-2 rounded-full",onClick:()=>{return e=s._id,u(e),void p(!0);var e}})]})}];return t.jsxs(t.Fragment,{children:[t.jsx(e,{columns:v,dataSource:l,rowKey:"_id",pagination:{current:c,total:10*d,onChange:m}}),t.jsx(s,{title:"Confirm Delete",open:j,onOk:async()=>{x&&(await o(x),await g(),1===l.length&&c>1?m(c-1):g(),p(!1),u(null))},onCancel:()=>p(!1),okText:"Yes, delete",cancelText:"Cancel",className:"mt-16",children:t.jsx("p",{children:"Are you sure you want to delete this follow-up?"})})]})}function K({isOpen:e,onClose:s,onAddFollowUp:r}){const[i,x]=a.useState({date:"",message:""});return t.jsx(l,{open:e,onOpenChange:s,children:t.jsxs(n,{className:"sm:max-w-[425px]",children:[t.jsx(o,{children:t.jsx(c,{children:"Add Follow Up"})}),t.jsxs("div",{className:"grid gap-4 py-4",children:[t.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[t.jsx(d,{htmlFor:"date",className:"text-right",children:"Date"}),t.jsx(m,{className:" w-auto md:w-[4cm]",id:"date",type:"date",value:i.date?new Date(i.date).toISOString().slice(0,10):"",onChange:e=>x({...i,date:e.target.value})})]}),t.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[t.jsx(d,{htmlFor:"message",className:"text-right",children:"Message"}),t.jsx(j,{id:"message",value:i.message,onChange:e=>x({...i,message:e.target.value}),className:"col-span-3"})]})]}),t.jsxs("div",{className:"flex justify-end space-x-2",children:[t.jsx(p,{className:"bg-red-600",variant:"outline",onClick:s,children:"Cancel"}),t.jsx(p,{onClick:()=>{r(i),x({date:"",message:""})},children:"Add"})]})]})})}function J({isOpen:e,onClose:s,followUpId:i,onSave:u}){const[h,g]=a.useState({date:"",message:""}),{data:f,isLoading:v,error:N}=x(i,{skip:!e||!i}),[w,{isLoading:y,error:b}]=r();a.useEffect((()=>{var e,s;if(f){g({date:(e=>{const s=new Date(e);return`${String(s.getMonth()+1).padStart(2,"0")}/${String(s.getDate()).padStart(2,"0")}/${s.getFullYear()}`})((null==(e=null==f?void 0:f.data)?void 0:e.date)||""),message:(null==(s=null==f?void 0:f.data)?void 0:s.message)||""})}}),[f]);return a.useEffect((()=>{N&&alert(`Fetch Error: ${N.message}`),b&&alert(`Update Error: ${b.message}`)}),[N,b]),e?t.jsx(l,{open:e,onOpenChange:s,children:t.jsxs(n,{className:"sm:max-w-[425px]",children:[t.jsx(o,{children:t.jsx(c,{children:"Edit Follow Up"})}),v?t.jsx("div",{children:"Loading..."}):t.jsxs("div",{className:"grid gap-4 py-4",children:[t.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[t.jsx(d,{htmlFor:"edit-date",className:"text-right",children:"Date"}),t.jsx(m,{id:"edit-date",type:"text",placeholder:"mm/dd/yyyy",value:h.date,onChange:e=>g({...h,date:e.target.value}),className:"col-span-3"})]}),t.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[t.jsx(d,{htmlFor:"edit-message",className:"text-right",children:"Message"}),t.jsx(j,{id:"edit-message",value:h.message,onChange:e=>g({...h,message:e.target.value}),className:"col-span-3"})]}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx(p,{variant:"outline",onClick:s,disabled:y,className:"bg-red-600",children:"Cancel"}),t.jsxs(p,{onClick:async()=>{if(h.date)if(h.message)try{await w({message:h.message,date:new Date(h.date).toISOString().split("T")[0],id:i}).unwrap();u({...null==f?void 0:f.data,date:h.date,message:h.message}),s()}catch(e){alert(`Update failed: ${e.message||"Unknown error"}`)}else alert("Please enter a message.");else alert("Please select a date.")},disabled:y,children:[t.jsx(O,{className:"mr-2 h-4 w-4"})," ",y?"Saving...":"Save"]})]})]})]})}):null}function Q({inquiry:e,onFollowUpAdded:s}){const[r,i]=a.useState(!1),[d,m]=a.useState(!1),[j,x]=a.useState(!1),[v,N]=a.useState(null),[w,y]=a.useState(1),{data:b,error:C,isLoading:S,refetch:k}=u(e._id);a.useEffect((()=>{}),[C]);const F=(null==b?void 0:b.data)||[],L=F.length,I=Math.ceil(L/5),D=5*w,U=D-5,A=F.slice(U,D),[E,{isLoading:_}]=h(),[O,{isLoading:q}]=g();return t.jsxs(t.Fragment,{children:[t.jsxs(l,{open:r,onOpenChange:e=>{i(e),e&&k()},children:[t.jsx(f,{asChild:!0,children:t.jsxs(p,{variant:"outline",className:"text-right bg-[#3b1f91] text-white",children:["Follow Up",t.jsx($,{variant:"outline",className:"bg-[#ffffff] text-black",children:L})]})}),t.jsx(n,{className:"sm:max-w-[60%] h-auto",children:t.jsxs("div",{className:"grid gap-4",children:[t.jsxs("div",{className:"flex justify-between items-center mt-5 mb-4",children:[t.jsx(o,{children:t.jsxs(c,{children:["Follow Up - ",e.firstName," ",e.lastName]})}),t.jsx(p,{onClick:()=>m(!0),className:"flex items-center gap-2",children:"Add Follow Up"})]}),t.jsx(H,{followUps:A,onEdit:e=>{N(e),x(!0)},onDelete:async a=>{try{await O(a).unwrap(),k(),s(e,L-1)}catch(t){}},currentPage:w,totalPages:I,onPageChange:e=>{e>0&&e<=I&&y(e)}})]})})]}),t.jsx(K,{isOpen:d,onClose:()=>m(!1),onAddFollowUp:async a=>{if(a.date&&a.message){const r={inquiryId:e._id,date:a.date,message:a.message};try{await E(r).unwrap(),k(),s(e,L+1),m(!1)}catch(t){}}}}),t.jsx(J,{isOpen:j,onClose:()=>x(!1),followUpId:v,onSave:()=>{k(),x(!1)}})]})}function R(){var e,r,i;const{data:d=[],isLoading:j,isError:x}=v(),[u,h]=a.useState(15),[g,f]=a.useState(d),[E]=N(),{data:_,isLoading:O}=w(),[$,H]=a.useState(""),[K,J]=a.useState(null),[R,W]=a.useState(null),[Z,X]=a.useState(null),[ee,se]=a.useState(""),[ae,te]=a.useState("");a.useState("");const[re,ie]=a.useState([]),[le,ne]=a.useState(!1),oe=d.filter((e=>(""===$||e.organisation.toLowerCase().includes($.toLowerCase()))&&(null===K||e.status===K)&&(null===R||e.source===R)&&(null===Z||`${e.firstName} ${e.lastName}`.toLowerCase().includes(Z.toLowerCase()))&&(""===ee||e.email.toLowerCase().includes(ee.toLowerCase()))&&(""===ae||e.phone.toLowerCase().includes(ae.toLowerCase())))),ce=null==(r=null==(e=null==oe?void 0:oe.filter((e=>re.includes(e._id))))?void 0:e.map((e=>e.email)))?void 0:r.join(", "),de=(e,s)=>{f((a=>a.map((a=>a.companyName===e.companyName?{...a,totalTasks:s}:a))))};return t.jsxs("div",{className:"p-4",children:[re.length>0&&t.jsx("div",{className:"mb-4",children:t.jsxs(p,{onClick:()=>ne(!0),className:"bg-[#3b1f91] hover:bg-purple-700",children:["Send Email to Selected (",re.length,")"]})}),t.jsx(l,{open:le,onOpenChange:ne,children:t.jsxs(n,{className:"max-w-4xl",children:[t.jsx(o,{children:t.jsx(c,{children:"Send Email to Selected Inquiries"})}),t.jsx(V,{defaultTo:ce,onSuccess:()=>{ne(!1),ie([])}})]})}),t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h1",{className:"text-xl font-semibold",children:"Inquiry List"}),t.jsx(G,{to:"/add-inquiry",children:t.jsxs(p,{className:"gap-2",children:[t.jsx(q,{className:"h-4 w-4"}),"Add Inquiry"]})})]}),t.jsxs(F,{className:"border",children:[t.jsxs(L,{children:[t.jsxs(I,{className:"border-b bg-gray-100",children:[t.jsx(D,{className:"w-12"}),t.jsx(D,{className:"lg:w-[100px] w-[50px] sticky left-0 bg-background z-50",children:"Date"}),t.jsx(D,{className:"text-left",children:"Info"}),t.jsx(D,{className:"text-left",children:"Message"}),t.jsx(D,{className:"text-left",children:"Follow Up"}),t.jsx(D,{className:"w-[80px] text-left",children:"Actions"})]}),t.jsxs(I,{className:"border-b",children:[t.jsx(D,{}),t.jsx(D,{}),t.jsx(D,{children:t.jsx(m,{placeholder:"Search Info",className:"w-[200px]",value:Z||"",onChange:e=>X(e.target.value)})}),t.jsx(D,{children:t.jsx(y,{value:K||"reset",onValueChange:e=>J("reset"===e?null:e),children:t.jsxs(b,{children:[t.jsx(C,{value:"reset",children:"All Statuses"}),null==(i=null==_?void 0:_.data)?void 0:i.map((e=>t.jsx(C,{value:e.status,children:e.status},e._id)))]})})}),t.jsx(D,{}),t.jsx(D,{})]})]}),t.jsx(U,{children:oe.map(((e,a)=>t.jsxs(I,{className:"border-b",children:[t.jsx(A,{className:"p-5",children:t.jsx(B,{checked:re.includes(e._id),onCheckedChange:()=>{return s=e._id,void ie((e=>e.includes(s)?e.filter((e=>e!==s)):[...e,s]));var s}})}),t.jsx(A,{className:"sticky left-0 bg-background",children:e.createdAt.slice(0,10)}),t.jsx(A,{children:t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"font-medium",children:[e.firstName," ",e.lastName,","]}),e.organisation," ,",t.jsx("div",{className:"text-sm text-muted-foreground",children:e.email}),t.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.phone," â€¢ ",e.address]})]})}),t.jsx(A,{children:e.message}),t.jsx(A,{className:"text-left",children:t.jsx(Q,{inquiry:e,onFollowUpAdded:de})}),t.jsx(A,{className:"text-center",children:t.jsxs(P,{children:[t.jsx(M,{asChild:!0,children:t.jsx("button",{variant:"ghost",size:"icon",className:"h-8 w-8 p-0",children:t.jsx(T,{className:"h-4 w-4"})})}),t.jsxs(z,{align:"end",className:"w-[160px]",children:[t.jsx(G,{to:`/edit-inquiry/${e._id}`,children:t.jsx(Y,{children:"Edit"})}),t.jsx(Y,{onClick:()=>(async e=>{s.confirm({title:"Are you sure you want to delete this inquiry?",content:"This action cannot be undone.",okText:"Yes",okType:"danger",cancelText:"No",onOk:async()=>{try{await E(e),f((s=>s.filter((s=>s._id!==e))))}catch(s){}}})})(e._id),children:"Delete"})]})]})})]},a)))})]}),t.jsxs("div",{className:"flex items-center justify-between mt-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm",children:"Items per page:"}),t.jsxs(y,{value:u.toString(),onValueChange:e=>h(Number(e)),children:[t.jsx(S,{className:"w-[70px]",children:t.jsx(k,{children:u})}),t.jsxs(b,{children:[t.jsx(C,{value:"15",children:"15"}),t.jsx(C,{value:"25",children:"25"}),t.jsx(C,{value:"50",children:"50"}),t.jsx(C,{value:"100",children:"100"})]})]})]}),t.jsx("div",{className:"text-sm text-muted-foreground",children:`1-${Math.min(u,oe.length)} of ${oe.length}`})]})]})}export{R as default};
