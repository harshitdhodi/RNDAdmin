import{o as re,r as a,bq as te,l as oe,j as e,D as _,s as q,t as $,v as B,Q as P,I as z,B as C,br as ie,bs as ce,bt as de,bu as me,q as ue,m as he,bv as xe,bw as ge,L as Z}from"./index-DhlDUgTv-1764301063565.js";import{S as ee,c as se,d as k,a as pe,b as je}from"./select-DMJOdBV5-1764301063565.js";import{T as fe,a as Ne,b as H,c as p,d as we,e as D}from"./table-DLlXm8vO-1764301063565.js";import{F as ye}from"./Table-CY5iafG7-1764301063565.js";import{M as le}from"./index-gb91zVjT-1764301063565.js";import{R as ve}from"./EditOutlined-BSS1E4gK-1764301063565.js";import{R as Se}from"./DeleteOutlined-B9TG8paJ-1764301063565.js";import{T as ne}from"./textarea-BGEpChXG-1764301063565.js";import{B as be}from"./badge-C6pddJqb-1764301063565.js";import{D as Ce,a as Fe,b as Me,c as ae}from"./dropdown-menu-BZee1S1A-1764301063565.js";import{C as Ie}from"./checkbox-CGf_103u-1764301063565.js";import ke from"./EmailForm-B7Z1S1uv-1764301063565.js";import{P as De}from"./plus-Yfzk0sGC-1764301063565.js";import{E as Ee}from"./ellipsis-vertical-B2c8b7gU-1764301063565.js";import"./Combination-QVfWENRt-1764301063565.js";import"./index-CFEPn6SB-1764301063565.js";import"./check-MO2flO6M-1764301063565.js";import"./toArray-Bbgf03cS-1764301063565.js";import"./index-CFQQWxYy-1764301063565.js";import"./addEventListener-Cyj38Bhl-1764301063565.js";import"./index-IdbViRz6-1764301063565.js";import"./EllipsisOutlined-BcjcSEK5-1764301063565.js";import"./dropdown-HdJN2mEG-1764301063565.js";import"./TextArea-B5aserUa-1764301063565.js";import"./CheckOutlined-BqDt3qHU-1764301063565.js";import"./index-7AScZwMT-1764301063565.js";import"./index-64d5i-I3-1764301063565.js";import"./useForceUpdate-D2NsB7Yt-1764301063565.js";import"./index-BCjw52sr-1764301063565.js";import"./CheckCircleFilled-DKkBjhiv-1764301063565.js";import"./ExclamationCircleFilled-waTomGWq-1764301063565.js";import"./InfoCircleFilled-DJTYcYRo-1764301063565.js";import"./ActionButton-D7xzi93n-1764301063565.js";import"./index-C35SqloY-1764301063565.js";import"./fade-Cz4rbotr-1764301063565.js";import"./Skeleton-1Fkg7YT9-1764301063565.js";import"./index.esm-CTOLFLIa-1764301063565.js";import"./index-M4QTFQaS-1764301063565.js";import"./card-BjmbNRy0-1764301063565.js";/* empty css                                 */import"./index-B-8cQENb-1764301063565.js";import"./isEqual-BijmyNs6-1764301063565.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=re("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);function Te({followUps:r,onEdit:h,onDelete:x,currentPage:o,totalPages:l,onPageChange:u}){const[t,j]=a.useState(!1),[m,F]=a.useState(null),[f]=te(),{refetch:N}=oe(),w=async(n,c)=>{try{const v=await f({id:n,...c}).unwrap();await N(),console.log("Update result:",v)}catch(v){console.error(`Failed to update message ID: ${n}`,v)}},i=(n,c)=>{w(n,{status:c})},y=n=>{F(n),j(!0)},U=async()=>{m&&(await x(m),await N(),r.length===1&&o>1?u(o-1):N(),j(!1),F(null))},g=[{title:"Date",dataIndex:"date",key:"date",render:n=>new Date(n).toLocaleDateString()},{title:"Message",dataIndex:"message",key:"message"},{title:"Status",dataIndex:"status",key:"status",render:(n,c)=>e.jsxs("select",{value:n||"New",onChange:v=>i(c._id,v.target.value),className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"New",children:"New"}),e.jsx("option",{value:"In Progress",children:"In Progress"}),e.jsx("option",{value:"Completed",children:"Completed"})]})},{title:"Action",key:"action",render:(n,c)=>e.jsxs("div",{className:"flex gap-4 ",children:[e.jsx(ve,{className:"cursor-pointer bg-blue-700 text-white p-2 rounded-full",onClick:()=>h(c._id)}),e.jsx(Se,{className:"cursor-pointer bg-red-600 text-white p-2 rounded-full",onClick:()=>y(c._id)})]})}];return e.jsxs(e.Fragment,{children:[e.jsx(ye,{columns:g,dataSource:r,rowKey:"_id",pagination:{current:o,total:l*10,onChange:u}}),e.jsx(le,{title:"Confirm Delete",open:t,onOk:U,onCancel:()=>j(!1),okText:"Yes, delete",cancelText:"Cancel",className:"mt-16",children:e.jsx("p",{children:"Are you sure you want to delete this follow-up?"})})]})}function Ue({isOpen:r,onClose:h,onAddFollowUp:x}){const[o,l]=a.useState({date:"",message:""}),u=()=>{x(o),l({date:"",message:""})};return e.jsx(_,{open:r,onOpenChange:h,children:e.jsxs(q,{className:"sm:max-w-[425px]",children:[e.jsx($,{children:e.jsx(B,{children:"Add Follow Up"})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(P,{htmlFor:"date",className:"text-right",children:"Date"}),e.jsx(z,{className:" w-auto md:w-[4cm]",id:"date",type:"date",value:o.date?new Date(o.date).toISOString().slice(0,10):"",onChange:t=>l({...o,date:t.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(P,{htmlFor:"message",className:"text-right",children:"Message"}),e.jsx(ne,{id:"message",value:o.message,onChange:t=>l({...o,message:t.target.value}),className:"col-span-3"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(C,{className:"bg-red-600",variant:"outline",onClick:h,children:"Cancel"}),e.jsx(C,{onClick:u,children:"Add"})]})]})})}function Ae({isOpen:r,onClose:h,followUpId:x,onSave:o}){const[l,u]=a.useState({date:"",message:""});console.log("Follow Up ID:",x);const{data:t,isLoading:j,error:m}=ie(x,{skip:!r||!x}),[F,{isLoading:f,error:N}]=te();a.useEffect(()=>{var i,y;t&&u({date:(g=>{const n=new Date(g),c=String(n.getMonth()+1).padStart(2,"0"),v=String(n.getDate()).padStart(2,"0"),M=n.getFullYear();return`${c}/${v}/${M}`})(((i=t==null?void 0:t.data)==null?void 0:i.date)||""),message:((y=t==null?void 0:t.data)==null?void 0:y.message)||""})},[t]);const w=async()=>{if(console.log("Saving follow-up:",l),console.log("Follow Up ID in handleSave:",x),!l.date){alert("Please select a date.");return}if(!l.message){alert("Please enter a message.");return}try{console.log("Attempting to update message");const i=await F({message:l.message,date:new Date(l.date).toISOString().split("T")[0],id:x}).unwrap();o({...t==null?void 0:t.data,date:l.date,message:l.message}),h()}catch(i){console.error("Failed to update message:",i),alert(`Update failed: ${i.message||"Unknown error"}`)}};return a.useEffect(()=>{m&&(console.error("Fetch Error:",m),alert(`Fetch Error: ${m.message}`)),N&&(console.error("Update Error:",N),alert(`Update Error: ${N.message}`))},[m,N]),r?e.jsx(_,{open:r,onOpenChange:h,children:e.jsxs(q,{className:"sm:max-w-[425px]",children:[e.jsx($,{children:e.jsx(B,{children:"Edit Follow Up"})}),j?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(P,{htmlFor:"edit-date",className:"text-right",children:"Date"}),e.jsx(z,{id:"edit-date",type:"text",placeholder:"mm/dd/yyyy",value:l.date,onChange:i=>u({...l,date:i.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(P,{htmlFor:"edit-message",className:"text-right",children:"Message"}),e.jsx(ne,{id:"edit-message",value:l.message,onChange:i=>u({...l,message:i.target.value}),className:"col-span-3"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(C,{variant:"outline",onClick:h,disabled:f,className:"bg-red-600",children:"Cancel"}),e.jsxs(C,{onClick:w,disabled:f,children:[e.jsx(Le,{className:"mr-2 h-4 w-4"})," ",f?"Saving...":"Save"]})]})]})]})}):null}function Oe({inquiry:r,onFollowUpAdded:h}){const[x,o]=a.useState(!1),[l,u]=a.useState(!1),[t,j]=a.useState(!1),[m,F]=a.useState(null),[f,N]=a.useState(1),w=5,{data:i,error:y,isLoading:U,refetch:g}=ce(r._id);a.useEffect(()=>{y&&console.error("Error fetching follow-up count:",y)},[y]);const n=(i==null?void 0:i.data)||[],c=n.length,v=Math.ceil(c/w),M=f*w,Y=M-w,K=n.slice(Y,M),[J,{isLoading:E}]=de(),[A,{isLoading:W}]=me(),L=d=>{o(d),d&&g()},b=d=>{d>0&&d<=v&&N(d)},Q=async d=>{if(d.date&&d.message){const I={inquiryId:r._id,date:d.date,message:d.message};try{await J(I).unwrap(),g(),h(r,c+1),u(!1)}catch(O){console.error("Failed to add follow-up:",O)}}},R=d=>{F(d),j(!0)},V=async d=>{try{await A(d).unwrap(),g(),h(r,c-1)}catch(I){console.error("Failed to delete follow-up:",I)}};return e.jsxs(e.Fragment,{children:[e.jsxs(_,{open:x,onOpenChange:L,children:[e.jsx(ue,{asChild:!0,children:e.jsxs(C,{variant:"outline",className:"text-right bg-[#304a8a] text-white",children:["Follow Up",e.jsx(be,{variant:"outline",className:"bg-[#ffffff] text-black",children:c})]})}),e.jsx(q,{className:"sm:max-w-[60%] h-auto",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"flex justify-between items-center mt-5 mb-4",children:[e.jsx($,{children:e.jsxs(B,{children:["Follow Up - ",r.firstName," ",r.lastName]})}),e.jsx(C,{onClick:()=>u(!0),className:"flex items-center gap-2",children:"Add Follow Up"})]}),e.jsx(Te,{followUps:K,onEdit:R,onDelete:V,currentPage:f,totalPages:v,onPageChange:b})]})})]}),e.jsx(Ue,{isOpen:l,onClose:()=>u(!1),onAddFollowUp:Q}),e.jsx(Ae,{isOpen:t,onClose:()=>j(!1),followUpId:m,onSave:()=>{g(),j(!1)}})]})}function Cs(){var I,O,X;const{data:r=[],isLoading:h,isError:x}=he();console.log(r);const[o,l]=a.useState(15),[u,t]=a.useState(r),[j]=xe(),{data:m,isLoading:F}=ge();console.log(m);const[f,N]=a.useState(""),[w,i]=a.useState(null),[y,U]=a.useState(null),[g,n]=a.useState(null),[c,v]=a.useState(""),[M,Y]=a.useState(""),[K,J]=a.useState(""),[E,A]=a.useState([]),[W,L]=a.useState(!1),b=r.filter(s=>(f===""||s.organisation.toLowerCase().includes(f.toLowerCase()))&&(w===null||s.status===w)&&(y===null||s.source===y)&&(g===null||`${s.firstName} ${s.lastName}`.toLowerCase().includes(g.toLowerCase()))&&(c===""||s.email.toLowerCase().includes(c.toLowerCase()))&&(M===""||s.phone.toLowerCase().includes(M.toLowerCase()))),Q=(O=(I=b==null?void 0:b.filter(s=>E.includes(s._id)))==null?void 0:I.map(s=>s.email))==null?void 0:O.join(", "),R=async s=>{le.confirm({title:"Are you sure you want to delete this inquiry?",content:"This action cannot be undone.",okText:"Yes",okType:"danger",cancelText:"No",onOk:async()=>{try{await j(s),t(S=>S.filter(T=>T._id!==s))}catch(S){console.error("Error deleting inquiry:",S)}}})},V=(s,S)=>{t(T=>T.map(G=>G.companyName===s.companyName?{...G,totalTasks:S}:G))},d=s=>{A(S=>S.includes(s)?S.filter(T=>T!==s):[...S,s])};return e.jsxs("div",{className:"p-4",children:[E.length>0&&e.jsx("div",{className:"mb-4",children:e.jsxs(C,{onClick:()=>L(!0),className:"bg-[#304a8a] hover:bg-purple-700",children:["Send Email to Selected (",E.length,")"]})}),e.jsx(_,{open:W,onOpenChange:L,children:e.jsxs(q,{className:"max-w-4xl",children:[e.jsx($,{children:e.jsx(B,{children:"Send Email to Selected Inquiries"})}),e.jsx(ke,{defaultTo:Q,onSuccess:()=>{L(!1),A([])}})]})}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Inquiry List"}),e.jsx(Z,{to:"/add-inquiry",children:e.jsxs(C,{className:"gap-2",children:[e.jsx(De,{className:"h-4 w-4"}),"Add Inquiry"]})})]}),e.jsxs(fe,{className:"border",children:[e.jsxs(Ne,{children:[e.jsxs(H,{className:"border-b bg-gray-100",children:[e.jsx(p,{className:"w-12"}),e.jsx(p,{className:"lg:w-[100px] w-[50px] sticky left-0 bg-background z-50",children:"Date"}),e.jsx(p,{className:"text-left",children:"Info"}),e.jsx(p,{className:"text-left",children:"Message"}),e.jsx(p,{className:"text-left",children:"Follow Up"}),e.jsx(p,{className:"w-[80px] text-left",children:"Actions"})]}),e.jsxs(H,{className:"border-b",children:[e.jsx(p,{}),e.jsx(p,{}),e.jsx(p,{children:e.jsx(z,{placeholder:"Search Info",className:"w-[200px]",value:g||"",onChange:s=>n(s.target.value)})}),e.jsx(p,{children:e.jsx(ee,{value:w||"reset",onValueChange:s=>i(s==="reset"?null:s),children:e.jsxs(se,{children:[e.jsx(k,{value:"reset",children:"All Statuses"}),(X=m==null?void 0:m.data)==null?void 0:X.map(s=>e.jsx(k,{value:s.status,children:s.status},s._id))]})})}),e.jsx(p,{}),e.jsx(p,{})]})]}),e.jsx(we,{children:b.map((s,S)=>e.jsxs(H,{className:"border-b",children:[e.jsx(D,{className:"p-5",children:e.jsx(Ie,{checked:E.includes(s._id),onCheckedChange:()=>d(s._id)})}),e.jsx(D,{className:"sticky left-0 bg-background",children:s.createdAt.slice(0,10)}),e.jsx(D,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"font-medium",children:[s.firstName," ",s.lastName,","]}),s.organisation," ,",e.jsx("div",{className:"text-sm text-muted-foreground",children:s.email}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.phone," â€¢ ",s.address]})]})}),e.jsx(D,{children:s.message}),e.jsx(D,{className:"text-left",children:e.jsx(Oe,{inquiry:s,onFollowUpAdded:V})}),e.jsx(D,{className:"text-center",children:e.jsxs(Ce,{children:[e.jsx(Fe,{asChild:!0,children:e.jsx("button",{variant:"ghost",size:"icon",className:"h-8 w-8 p-0",children:e.jsx(Ee,{className:"h-4 w-4"})})}),e.jsxs(Me,{align:"end",className:"w-[160px]",children:[e.jsx(Z,{to:`/edit-inquiry/${s._id}`,children:e.jsx(ae,{children:"Edit"})}),e.jsx(ae,{onClick:()=>R(s._id),children:"Delete"})]})]})})]},S))})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"Items per page:"}),e.jsxs(ee,{value:o.toString(),onValueChange:s=>l(Number(s)),children:[e.jsx(pe,{className:"w-[70px]",children:e.jsx(je,{children:o})}),e.jsxs(se,{children:[e.jsx(k,{value:"15",children:"15"}),e.jsx(k,{value:"25",children:"25"}),e.jsx(k,{value:"50",children:"50"}),e.jsx(k,{value:"100",children:"100"})]})]})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:`1-${Math.min(o,b.length)} of ${b.length}`})]})]})}export{Cs as default};
