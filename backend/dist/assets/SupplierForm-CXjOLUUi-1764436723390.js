import{f as V,r as d,z as L,j as e,I as m,B as b,X as O}from"./index--VflTLOD-1764436723390.js";import{b as _}from"./index.esm-DQd4fpPB-1764436723390.js";import{C as D,b as K,c as M,a as W}from"./card-BQ8fPEeC-1764436723390.js";import{F as X,a as n,b as l,c as o,d as c,e as i}from"./form-boUuqBU9-1764436723390.js";import{T as Y}from"./textarea-BAjlMWZX-1764436723390.js";import{B as k}from"./BreadCrumb-C76MEBCV-1764436723390.js";import{S as f}from"./sweetalert2.esm.all-CIewtpap-1764436723390.js";import{S as g,a as S,b as C,c as N,d as w}from"./select-DSmS_Di8-1764436723390.js";import"./Combination-Bwrfy-wX-1764436723390.js";import"./index-DzTwc2QF-1764436723390.js";import"./check--mmsmZLr-1764436723390.js";const z=[{label:"Dashboard",href:"/dashboard"},{label:"Supplier Table",href:"/supplier-table"},{label:"Supplier Form",href:"/supplier-form"}];function ne(){const y=V(),[E,h]=d.useState(!1),[G,j]=d.useState(null),[p,u]=d.useState(null),{refetch:v}=L(),a=_({defaultValues:{supplierName:"",contactPerson:"",email:"",website:"",mobileNumber:"",phoneNumber:"",address:"",country:"",city:"",description:"",image:null}}),[F,I]=d.useState([]),[P,T]=d.useState([]);d.useEffect(()=>{fetch("https://restcountries.com/v3.1/all").then(s=>s.json()).then(s=>{const r=s.map(t=>({name:t.name.common,code:t.cca2})).sort((t,x)=>t.name.localeCompare(x.name));I(r)}).catch(s=>console.error("Error fetching countries:",s))},[]);const A=async s=>{try{const x=(await(await fetch(`https://api.api-ninjas.com/v1/city?country=${s}&limit=30`,{headers:{"X-Api-Key":"YOUR_API_NINJAS_KEY"}})).json()).map(U=>U.name).sort();T(x),a.setValue("city","")}catch(r){console.error("Error fetching cities:",r)}},B=s=>{const r=s.target.files[0];r&&u(URL.createObjectURL(r))};async function R(s){h(!0),j(null);const r=new FormData;Object.keys(s).forEach(t=>{t==="image"&&s.image?r.append("image",s.image[0]):r.append(t,s[t])});try{const t=await fetch("/api/supplier/add",{method:"POST",body:r});if(!t.ok)throw new Error("Failed to submit form");const x=await t.json();await v(),await f.fire({title:"Success!",text:"Supplier added successfully",icon:"success",timer:2e3,showConfirmButton:!1}),y("/supplier-table")}catch(t){console.error("Error submitting form:",t),j("Failed to submit form. Please try again."),f.fire({title:"Error!",text:t.message||"Failed to add supplier",icon:"error"})}finally{h(!1)}}return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"ml-1",children:e.jsx(k,{items:z})}),e.jsxs(D,{className:"max-w-8xl mt-3 mx-auto",children:[e.jsx(K,{children:e.jsx(M,{className:"text-xl font-semibold",children:"Add Supplier"})}),e.jsx(W,{children:e.jsx(X,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(R),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsx(n,{control:a.control,name:"name",render:({field:s})=>e.jsxs(l,{children:[e.jsxs(o,{children:["Supplier Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(c,{children:e.jsx(m,{placeholder:"Enter supplier name",...s})}),e.jsx(i,{})]})}),e.jsx(n,{control:a.control,name:"contact_person",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Contact Person"}),e.jsx(c,{children:e.jsx(m,{placeholder:"Enter contact person",...s})}),e.jsx(i,{})]})}),e.jsx(n,{control:a.control,name:"email",render:({field:s})=>e.jsxs(l,{children:[e.jsxs(o,{children:["Email ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(c,{children:e.jsx(m,{placeholder:"Enter email address",...s})}),e.jsx(i,{})]})}),e.jsx(n,{control:a.control,name:"website",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Website"}),e.jsx(c,{children:e.jsx(m,{placeholder:"Enter website URL",...s})}),e.jsx(i,{})]})}),e.jsx(n,{control:a.control,name:"mobile",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Mobile Number"}),e.jsx(c,{children:e.jsx(m,{placeholder:"Enter mobile number",...s})}),e.jsx(i,{})]})}),e.jsx(n,{control:a.control,name:"country",render:({field:s})=>e.jsxs(l,{children:[e.jsxs(o,{children:["Country ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(g,{onValueChange:r=>{s.onChange(r),A(r)},value:s.value,children:[e.jsx(c,{children:e.jsx(S,{children:e.jsx(C,{placeholder:"Select country"})})}),e.jsx(N,{children:F.map(r=>e.jsx(w,{value:r.name,children:r.name},r.code))})]}),e.jsx(i,{})]})}),e.jsx(n,{control:a.control,name:"city",render:({field:s})=>e.jsxs(l,{children:[e.jsxs(o,{children:["City ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(g,{onValueChange:s.onChange,value:s.value,disabled:!a.watch("country"),children:[e.jsx(c,{children:e.jsx(S,{children:e.jsx(C,{placeholder:"Select city"})})}),e.jsx(N,{children:P.map(r=>e.jsx(w,{value:r,children:r},r))})]}),e.jsx(i,{})]})})]}),e.jsx(n,{control:a.control,name:"address",render:({field:s})=>e.jsxs(l,{children:[e.jsxs(o,{children:["Address ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(c,{children:e.jsx(Y,{placeholder:"Enter address",...s})}),e.jsx(i,{})]})}),e.jsx(n,{control:a.control,name:"image",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Upload Image"}),e.jsx(c,{children:e.jsx(m,{type:"file",...s,onChange:B})}),e.jsx(i,{})]})}),p&&e.jsxs("div",{className:"mt-4",children:[e.jsx("img",{src:p,alt:"Image preview",className:"w-32 h-32 object-cover rounded-lg"}),e.jsx(b,{type:"button",onClick:()=>u(null),className:"absolute top-0 right-0 bg-red-500 text-white p-1 rounded-full",children:e.jsx(O,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex gap-4",children:e.jsx(b,{type:"submit",className:"bg-green-500 w-1/4 font-medium hover:bg-green-600 text-lg",disabled:E,children:"Save"})})]})})})]})]})}export{ne as default};
