import{r as m,j as e}from"./react-DKICu8bO.js";import{c as V}from"./react-hook-form-BpvdonxZ.js";import{o as L,I as d,T as O,B as b}from"./index-CDFtkn6X.js";import{C as _,b as D,c as K,a as M}from"./card-CY6sXsn1.js";import{F as W,a as o,b as n,c as i,d as l,e as c}from"./form-CHW_58Tj.js";import{B as X}from"./BreadCrumb-C1ZZs22B.js";import{S as f}from"./sweetalert2-CIewtpap.js";import{S as g,a as S,b as C,c as N,d as w}from"./select-CdiUu-U-.js";import{X as Y}from"./lucide-D7hRWJEP.js";import{a as k}from"./react-router-B9QVkYva.js";import"./classnames-Bv6oJzD9.js";import"./react-dom-BBS6HuAW.js";import"./scheduler-CKyTKYc2.js";import"./react-redux-BrRfTdeB.js";import"./use-sync-external-store-D0ivhzzy.js";import"./@reduxjs-B5J9SSA5.js";import"./redux-DITMfSWq.js";import"./immer-fBqQtvEc.js";import"./redux-thunk-ClJT1hhx.js";import"./reselect-C27TLnWV.js";import"./js-cookie-Cz0CWeBA.js";import"./@radix-ui-BlrBCj0C.js";import"./aria-hidden-DQ5UC2Eg.js";import"./react-remove-scroll-fXbmorz6.js";import"./tslib-CDuPK5Eb.js";import"./react-remove-scroll-bar-C9fmXXva.js";import"./react-style-singleton-DKBZmuKg.js";import"./get-nonce-C-Z93AgS.js";import"./use-sidecar-C10EJNOT.js";import"./use-callback-ref-BoKxM4XI.js";import"./@floating-ui-8J-daYO3.js";import"./class-variance-authority-Dp3B9jqt.js";import"./clsx-B-dksMZM.js";import"./tailwind-merge-D696Ktp4.js";import"./axios-DXsv3KKR.js";import"./@syncfusion-BIAkhmGL.js";import"./cookie--_YQFYBD.js";const G=[{label:"Dashboard",href:"/dashboard"},{label:"Supplier Table",href:"/supplier-table"},{label:"Supplier Form",href:"/supplier-form"}];function Ae(){const y=k(),[E,x]=m.useState(!1),[H,h]=m.useState(null),[j,u]=m.useState(null),{refetch:v}=L(),a=V({defaultValues:{supplierName:"",contactPerson:"",email:"",website:"",mobileNumber:"",phoneNumber:"",address:"",country:"",city:"",description:"",image:null}}),[F,I]=m.useState([]),[P,T]=m.useState([]);m.useEffect(()=>{fetch("https://restcountries.com/v3.1/all").then(r=>r.json()).then(r=>{const s=r.map(t=>({name:t.name.common,code:t.cca2})).sort((t,p)=>t.name.localeCompare(p.name));I(s)}).catch(r=>console.error("Error fetching countries:",r))},[]);const A=async r=>{try{const p=(await(await fetch(`https://api.api-ninjas.com/v1/city?country=${r}&limit=30`,{headers:{"X-Api-Key":"YOUR_API_NINJAS_KEY"}})).json()).map(U=>U.name).sort();T(p),a.setValue("city","")}catch(s){console.error("Error fetching cities:",s)}},B=r=>{const s=r.target.files[0];s&&u(URL.createObjectURL(s))};async function R(r){x(!0),h(null);const s=new FormData;Object.keys(r).forEach(t=>{t==="image"&&r.image?s.append("image",r.image[0]):s.append(t,r[t])});try{const t=await fetch("/api/supplier/add",{method:"POST",body:s});if(!t.ok)throw new Error("Failed to submit form");const p=await t.json();await v(),await f.fire({title:"Success!",text:"Supplier added successfully",icon:"success",timer:2e3,showConfirmButton:!1}),y("/supplier-table")}catch(t){console.error("Error submitting form:",t),h("Failed to submit form. Please try again."),f.fire({title:"Error!",text:t.message||"Failed to add supplier",icon:"error"})}finally{x(!1)}}return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"ml-1",children:e.jsx(X,{items:G})}),e.jsxs(_,{className:"max-w-8xl mt-3 mx-auto",children:[e.jsx(D,{children:e.jsx(K,{className:"text-xl font-semibold",children:"Add Supplier"})}),e.jsx(M,{children:e.jsx(W,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(R),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsx(o,{control:a.control,name:"name",render:({field:r})=>e.jsxs(n,{children:[e.jsxs(i,{children:["Supplier Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(l,{children:e.jsx(d,{placeholder:"Enter supplier name",...r})}),e.jsx(c,{})]})}),e.jsx(o,{control:a.control,name:"contact_person",render:({field:r})=>e.jsxs(n,{children:[e.jsx(i,{children:"Contact Person"}),e.jsx(l,{children:e.jsx(d,{placeholder:"Enter contact person",...r})}),e.jsx(c,{})]})}),e.jsx(o,{control:a.control,name:"email",render:({field:r})=>e.jsxs(n,{children:[e.jsxs(i,{children:["Email ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(l,{children:e.jsx(d,{placeholder:"Enter email address",...r})}),e.jsx(c,{})]})}),e.jsx(o,{control:a.control,name:"website",render:({field:r})=>e.jsxs(n,{children:[e.jsx(i,{children:"Website"}),e.jsx(l,{children:e.jsx(d,{placeholder:"Enter website URL",...r})}),e.jsx(c,{})]})}),e.jsx(o,{control:a.control,name:"mobile",render:({field:r})=>e.jsxs(n,{children:[e.jsx(i,{children:"Mobile Number"}),e.jsx(l,{children:e.jsx(d,{placeholder:"Enter mobile number",...r})}),e.jsx(c,{})]})}),e.jsx(o,{control:a.control,name:"country",render:({field:r})=>e.jsxs(n,{children:[e.jsxs(i,{children:["Country ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(g,{onValueChange:s=>{r.onChange(s),A(s)},value:r.value,children:[e.jsx(l,{children:e.jsx(S,{children:e.jsx(C,{placeholder:"Select country"})})}),e.jsx(N,{children:F.map(s=>e.jsx(w,{value:s.name,children:s.name},s.code))})]}),e.jsx(c,{})]})}),e.jsx(o,{control:a.control,name:"city",render:({field:r})=>e.jsxs(n,{children:[e.jsxs(i,{children:["City ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(g,{onValueChange:r.onChange,value:r.value,disabled:!a.watch("country"),children:[e.jsx(l,{children:e.jsx(S,{children:e.jsx(C,{placeholder:"Select city"})})}),e.jsx(N,{children:P.map(s=>e.jsx(w,{value:s,children:s},s))})]}),e.jsx(c,{})]})})]}),e.jsx(o,{control:a.control,name:"address",render:({field:r})=>e.jsxs(n,{children:[e.jsxs(i,{children:["Address ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(l,{children:e.jsx(O,{placeholder:"Enter address",...r})}),e.jsx(c,{})]})}),e.jsx(o,{control:a.control,name:"image",render:({field:r})=>e.jsxs(n,{children:[e.jsx(i,{children:"Upload Image"}),e.jsx(l,{children:e.jsx(d,{type:"file",...r,onChange:B})}),e.jsx(c,{})]})}),j&&e.jsxs("div",{className:"mt-4",children:[e.jsx("img",{src:j,alt:"Image preview",className:"w-32 h-32 object-cover rounded-lg"}),e.jsx(b,{type:"button",onClick:()=>u(null),className:"absolute top-0 right-0 bg-red-500 text-white p-1 rounded-full",children:e.jsx(Y,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex gap-4",children:e.jsx(b,{type:"submit",className:"bg-green-500 w-1/4 font-medium hover:bg-green-600 text-lg",disabled:E,children:"Save"})})]})})})]})]})}export{Ae as default};
