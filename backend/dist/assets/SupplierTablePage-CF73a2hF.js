import{r as e,j as s,a}from"./react-BfBsRgn0.js";import{F as r,l,D as i,i as n,j as t,k as c,I as d,B as o,K as m,p as h,o as x,M as u}from"./index-mCSb4W1J.js";import{T as j,a as p,b,c as g,d as f,e as v}from"./table-C5KT2_Ve.js";import{A as N,a as y,b as w,c as C,d as S,e as k,f as L,g as D}from"./alert-dialog-CsAXk-6Q.js";import{j as _,E as A,h as I}from"./lucide-D6BDVLHE.js";import{B as O}from"./badge-BCgjqnTR.js";import{D as P,a as F,b as T,c as $}from"./dropdown-menu-BSEIa4ap.js";import{a as z,L as E}from"./react-router-DUJjWq5j.js";import{B as M}from"./BreadCrumb-DisBzgy2.js";import"./classnames-C3ovBj6j.js";import"./react-dom-DwrudmHt.js";import"./scheduler-BFk34ZWe.js";import"./react-redux-DbBiFgqA.js";import"./use-sync-external-store-DdeJV4gQ.js";import"./@reduxjs-UCSEaN3g.js";import"./redux-C5Huw2aR.js";import"./immer-DgfQkf_7.js";import"./redux-thunk-B3S1iNVp.js";import"./reselect-BSOs5pU1.js";import"./js-cookie-BXEMiIsG.js";import"./@radix-ui-BWjeGzol.js";import"./aria-hidden-BHUiN-rI.js";import"./react-remove-scroll-yauc81_r.js";import"./tslib-Bc9CN1Ef.js";import"./react-remove-scroll-bar-BcxDecei.js";import"./react-style-singleton-C1QVuB2c.js";import"./get-nonce-BYiZHLe3.js";import"./use-sidecar-BA4C4RS7.js";import"./use-callback-ref-Cvx1xcTX.js";import"./@floating-ui-BSChQBl3.js";import"./class-variance-authority-DeOWI0hf.js";import"./clsx-BeLtu-UY.js";import"./tailwind-merge-D2VJQb_v.js";import"./axios-BoylL8Pu.js";import"./cookie-BUTH-fPQ.js";const B=({open:a,onClose:m,chemicalName:h,supplier:x,supplierId:u,refetch:j,allData:p})=>{const[b,g]=e.useState(""),[f,v]=e.useState([]),{data:N,isLoading:y,error:w}=r(b,{skip:!b||b.length<2}),[C,{isLoading:S}]=l();return s.jsx(i,{open:a,onOpenChange:e=>!e&&m(),children:s.jsxs(n,{className:"max-w-lg p-6",children:[s.jsx(t,{children:s.jsxs(c,{className:"text-lg font-semibold text-[#3b1f91]",children:["Add Chemicals for ",x]})}),s.jsxs("div",{className:"mt-4",children:[s.jsx(d,{placeholder:`Search ${x}`,value:b,onChange:e=>g(e.target.value),className:"w-full mb-4"}),y?s.jsx("div",{children:"Loading..."}):b&&N&&N.length>0&&s.jsx("ul",{className:"border bg-white rounded max-h-40 overflow-y-auto",children:N.map((e=>s.jsx("li",{onClick:()=>(e=>{v((s=>{const a=[...s,e];return g(""),a}))})(e),className:"p-2 hover:bg-gray-200 cursor-pointer",children:e.name},e._id)))}),0===(null==N?void 0:N.length)&&!y&&b&&s.jsx("div",{className:"p-2 text-gray-500",children:"No chemicals found"}),s.jsx("div",{className:"mt-4",children:f.length>0&&s.jsx("div",{className:"space-y-2",children:f.map((e=>s.jsxs("div",{className:"flex justify-between items-center bg-gray-100 p-2 rounded",children:[s.jsx("span",{children:e.name}),s.jsx(o,{variant:"outline",size:"sm",onClick:()=>{return s=e._id,void v((e=>e.filter((e=>e._id!==s))));var s},className:"text-red-500",children:"Remove"})]},e._id)))})}),s.jsxs("div",{className:"flex justify-between mt-4",children:[s.jsx(o,{onClick:async()=>{const e=f.map((e=>e._id));try{await C({supplierId:u,chemical_ids:e}).unwrap(),await j(),m(),p()}catch(s){}},className:"bg-[#3b1f91] hover:bg-purple-700",disabled:S||0===f.length,children:S?"Adding...":"+ Add"}),s.jsx(o,{onClick:m,className:"bg-red-600 hover:bg-red-700",children:"Cancel"})]})]})]})})};function W({supplier:a,supplierName:r,allData:l}){const[i,n]=e.useState(10),[d,x]=e.useState(1),[u,A]=e.useState(1),[I,O]=e.useState(!1),[P,F]=e.useState(null),[T,$]=e.useState(null),[z,E]=e.useState(!1),[M,W]=e.useState(null),{data:K,isLoading:R,isError:Y,refetch:Z}=m(a,{skip:(d-1)*i,limit:i}),[q,{isLoading:G}]=h();e.useEffect((()=>{K&&A(Math.ceil(K.chemicals.length/i))}),[K,i]);if(R)return s.jsx("div",{children:"Loading..."});if(Y)return s.jsx("div",{children:"Error loading chemicals"});const H=Array.isArray(null==K?void 0:K.chemicals)?K.chemicals:[];return s.jsxs("div",{className:"w-full overflow-auto",children:[s.jsx(t,{children:s.jsxs("div",{className:"flex justify-between items-center mr-5",children:[s.jsxs(c,{children:["Chemicals for ",r]}),s.jsx(o,{onClick:()=>(F(H),O(!0),void $("supplier")),className:"bg-purple-600 hover:bg-purple-700",children:"+ Add Chemical"})]})}),s.jsx("div",{className:"mt-5 ",children:s.jsxs(j,{children:[s.jsx(p,{children:s.jsxs(b,{children:[s.jsx(g,{className:"p-2",children:"Name"}),s.jsx(g,{className:"p-2",children:"CAS Number"}),s.jsx(g,{className:"p-2 w-[100px]",children:"Action"})]})}),s.jsx(f,{children:H.map(((e,a)=>s.jsxs(b,{className:"p-2",children:[s.jsx(v,{className:"px-2 py-1",children:e.name}),s.jsx(v,{className:"px-2 py-1",children:e.cas_number}),s.jsx(v,{className:"px-2 py-1",children:s.jsx(o,{variant:"ghost",size:"icon",className:"text-red-500",onClick:()=>(e=>{W(e),E(!0)})(e),disabled:G,children:G?"Deleting...":s.jsx(_,{className:"h-4 w-4"})})})]},a)))})]})}),I&&P&&s.jsx(B,{open:I,onClose:()=>O(!1),chemicalName:P.name,supplier:r,supplierId:a,refetch:Z,allData:l}),s.jsx(N,{open:z,onOpenChange:E,children:s.jsxs(y,{children:[s.jsxs(w,{children:[s.jsx(C,{children:"Are you sure?"}),s.jsxs(S,{children:["This action cannot be undone. This will permanently delete the chemical",M&&` "${M.name}"`," from this supplier."]})]}),s.jsxs(k,{children:[s.jsx(L,{children:"Cancel"}),s.jsx(D,{onClick:async()=>{try{await q({supplierId:a,chemicalId:M._id}).unwrap(),Z()}catch(e){}finally{E(!1),W(null)}},className:"bg-red-500 hover:bg-red-600",children:"Delete"})]})]})}),s.jsxs("div",{className:"flex items-center justify-between mt-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-sm",children:"Items per page:"}),s.jsxs("select",{className:"border p-1 rounded",value:i,onChange:e=>n(Number(e.target.value)),children:[s.jsx("option",{value:5,children:"5"}),s.jsx("option",{value:10,children:"10"}),s.jsx("option",{value:20,children:"20"})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(o,{variant:"outline",size:"sm",onClick:()=>{d>1&&x(d-1)},disabled:1===d,children:"Previous"}),s.jsxs("span",{children:[d," of ",u]}),s.jsx(o,{variant:"outline",size:"sm",onClick:()=>{d<u&&x(d+1)},disabled:d===u,children:"Next"})]})]})]})}const K=()=>{const{data:r=[],isLoading:l,error:t}=x(),[c,d]=e.useState(1),[m,h]=e.useState(10),[N,y]=e.useState(!1),[w,C]=e.useState(null),[S,k]=e.useState({name:"",email:"",mobile:"",country:"",website:""}),L=z(),[D,_]=e.useState(null),[I,E]=e.useState(!1),{refetch:M}=x(),[K]=u(),R=(e,s)=>{k((a=>({...a,[e]:s}))),d(1)},Y=r.filter((e=>{const s=S.name.toLowerCase();return(!S.name||e.name.toLowerCase().includes(s)||e.email.toLowerCase().includes(s)||e.mobile.toLowerCase().includes(s))&&(!S.country||e.country.toLowerCase().includes(S.country.toLowerCase()))&&(!S.website||e.website.toLowerCase().includes(S.website.toLowerCase()))})),Z=Math.ceil(Y.length/m),q=Y.slice((c-1)*m,c*m);return l?s.jsx("div",{children:"Loading..."}):t?s.jsxs("div",{children:["Error loading suppliers: ",t.message]}):s.jsxs("div",{children:[s.jsx("div",{className:"rounded-md shadow-sm bg-white",children:s.jsxs(j,{className:"w-full text-left border-collapse",children:[s.jsxs(p,{className:"bg-gray-100 border-b border-gray-300",children:[s.jsxs(b,{className:"text-gray-600 font-semibold",children:[s.jsx(g,{className:"w-10"}),s.jsx(g,{children:"Info"}),s.jsx(g,{children:"Chemicals"}),s.jsx(g,{children:"Country"}),s.jsx(g,{children:"Website"})]}),s.jsxs(b,{className:"bg-gray-50",children:[s.jsx(v,{}),s.jsx(v,{children:s.jsx("input",{type:"text",placeholder:"Filter by name, email or mobile",className:"p-2 rounded w-full border border-gray-300",value:S.name,onChange:e=>R("name",e.target.value)})}),s.jsx(v,{}),s.jsx(v,{children:s.jsx("input",{type:"text",placeholder:"Filter by country",className:"p-2 rounded w-full border border-gray-300",value:S.country,onChange:e=>R("country",e.target.value)})}),s.jsx(v,{children:s.jsx("input",{type:"text",placeholder:"Filter by website",className:"p-2 rounded w-full border border-gray-300",value:S.website,onChange:e=>R("website",e.target.value)})})]})]}),s.jsx(f,{children:q.map((e=>s.jsx(a.Fragment,{children:s.jsxs(b,{className:"hover:bg-gray-50 border-b border-gray-300",children:[s.jsx(v,{className:"p-2",children:s.jsxs(P,{children:[s.jsx(F,{asChild:!0,children:s.jsx("button",{className:"p-3",children:s.jsx(A,{className:"w-4 h-4"})})}),s.jsxs(T,{align:"end",children:[s.jsx($,{onClick:()=>(e=>{C(e),y(!0)})(e),children:"Add Chemical"}),s.jsx($,{onClick:()=>L(`/edit-supplier-form/${e._id}`),children:"Edit"}),s.jsx($,{onClick:()=>(async e=>{try{await K(e)}catch(s){}})(e._id),children:"Delete"})]})]})}),s.jsx(v,{children:s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{className:"font-medium",children:e.name}),s.jsx("span",{className:"text-sm text-gray-600",children:e.email}),s.jsx("span",{className:"text-sm text-gray-600",children:e.mobile})]})}),s.jsx(v,{children:s.jsxs(o,{variant:"default",size:"sm",onClick:()=>(e=>{_(e),E(!0)})(e),className:"bg-[#3b1f91] text-white px-4 py-2 rounded hover:bg-[#3b1f91] transition-colors duration-300",children:["Chemicals",s.jsx(O,{variant:"secondary",className:"ml-2 bg-gray-200 text-black px-2 py-1 rounded",children:e.totalChemicalIds||0})]})}),s.jsx(v,{children:e.country}),s.jsx(v,{children:s.jsx(Link,{to:e.website,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:e.website})})]})},e._id)))})]})}),s.jsxs("div",{className:"flex justify-between items-center mt-4",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"items-per-page",className:"mr-2",children:"Items per page:"}),s.jsxs("select",{id:"items-per-page",className:"p-2  border border-gray-300 rounded",value:m,onChange:e=>{h(parseInt(e.target.value)),d(1)},children:[s.jsx("option",{value:10,children:"10"}),s.jsx("option",{value:20,children:"20"}),s.jsx("option",{value:30,children:"30"}),s.jsx("option",{value:40,children:"40"}),s.jsx("option",{value:50,children:"50"})]})]}),s.jsxs("div",{children:[s.jsx("button",{onClick:()=>d((e=>Math.max(e-1,1))),className:"px-3 py-1 border border-gray-300 rounded mr-2",disabled:1===c,children:"Previous"}),s.jsxs("span",{children:["Page ",c," of ",Z]}),s.jsx("button",{onClick:()=>d((e=>Math.min(e+1,Z))),className:"px-3 py-1 border border-gray-300 rounded ml-2",disabled:c===Z,children:"Next"})]})]}),N&&s.jsx(B,{open:N,onClose:()=>y(!1),supplier:w,supplierId:null==w?void 0:w._id,chemicalName:null==w?void 0:w.name}),s.jsx(i,{open:I,onOpenChange:E,children:s.jsx(n,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:I&&D&&s.jsx(W,{supplier:D._id,supplierName:D.name,allData:M})})})]})},R=({purchaseOrders:e})=>s.jsxs(j,{children:[s.jsx(p,{children:s.jsxs(b,{children:[s.jsx(g,{children:"Created Date"}),s.jsx(g,{children:"Order Number"}),s.jsx(g,{children:"Payment Status"}),s.jsx(g,{children:"Total Tax"}),s.jsx(g,{children:"Total Discount"}),s.jsx(g,{children:"Total Amount"})]})}),s.jsx(f,{children:e.map(((e,a)=>s.jsxs(b,{children:[s.jsx(v,{children:e.createdDate}),s.jsx(v,{children:e.orderNumber}),s.jsx(v,{children:e.paymentStatus}),s.jsxs(v,{children:["$",e.totalTax]}),s.jsxs(v,{children:["$",e.totalDiscount]}),s.jsxs(v,{children:["$",e.totalAmount]})]},a)))})]}),Y=[{label:"Dashboard",href:"/dashboard"},{label:"Supplier Table",href:null}];function Z(){const[a,r]=e.useState({}),[l,t]=e.useState(!1),[c,d]=e.useState(null),[m,h]=e.useState(1),[u,j]=e.useState(5),{data:p=[],isLoading:b,error:g,refetch:f}=x(),[v,N]=e.useState({});if(b)return s.jsx("p",{children:"Loading suppliers..."});if(g)return s.jsx("p",{children:"Failed to load suppliers"});return s.jsxs("div",{className:"",children:[s.jsx(M,{items:Y}),s.jsxs("div",{className:"flex justify-between mt-4 items-center mb-6",children:[s.jsx("h1",{className:"text-2xl font-medium text-[#3b1f91] ",children:"Suppliers"}),s.jsx(E,{to:"/supplier-form",children:s.jsxs(o,{children:[s.jsx(I,{className:"w-4 h-4 mr-2"}),"Add Supplier"]})})]}),s.jsx(K,{suppliers:p,showPurchaseOrders:a,setShowPurchaseOrders:r,setSelectedSupplier:d,setShowChemicalsModal:t,filters:v,handleFilterChange:(e,s)=>{N((a=>({...a,[e]:s})))},currentPage:m,itemsPerPage:u,paginatedData:p.slice((m-1)*u,m*u),selectedSupplier:c,refetch:f,onChemicalClick:e=>{d(e),t(!0)}}),a[null==c?void 0:c.id]&&c&&s.jsxs("div",{className:"mt-6",children:[s.jsxs("h2",{className:"text-xl font-bold mb-4",children:["Purchase Orders for ",c.name]}),s.jsx(R,{purchaseOrders:[]}),"  "]}),s.jsx(i,{open:l,onOpenChange:e=>{t(e)},children:s.jsx(n,{className:"max-w-2xl h-1/2",children:s.jsx(W,{supplier:null==c?void 0:c._id,supplierName:null==c?void 0:c.name,allData:f})})})]})}export{Z as default};
