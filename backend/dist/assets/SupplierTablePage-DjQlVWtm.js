import{K as U,p as X,j as e,D as R,m as z,n as W,o as K,I as Y,B as S,Q as Z,t as ee,s as $,R as se}from"./main-CHwjN9ww.js";import{c as l,f as ae,b as le,L as re}from"./vendor-CgeupRFx.js";import{T as H,a as Q,b as T,c as u,d as G,e as t}from"./table-DGz3_gET.js";import{A as te,a as ne,b as ie,c as ce,d as de,e as oe,f as he,g as me}from"./alert-dialog-BnHNubXc.js";import{T as ue}from"./trash-2-BAd3O4QY.js";import{B as xe}from"./badge-dVuTi65y.js";import{D as pe,a as je,b as ge,c as B}from"./dropdown-menu-0a0mVlUH.js";import{E as be}from"./ellipsis-vertical-D_kNUZep.js";import{B as fe}from"./BreadCrumb-Da9YCv3o.js";import{P as Ce}from"./plus-BZbZkXNM.js";import"./Combination-ChaMfiN7.js";import"./chevron-right-CVtm6TB0.js";import"./check-CYzfL35a.js";const V=({open:x,onClose:c,chemicalName:v,supplier:n,supplierId:d,refetch:i,allData:b})=>{const[h,j]=l.useState(""),[p,f]=l.useState([]),{data:r,isLoading:D,error:k}=U(h,{skip:!h||h.length<2}),[y,{isLoading:P}]=X(),C=async()=>{const a=p.map(o=>o._id);try{await y({supplierId:d,chemical_ids:a}).unwrap(),await i(),c(),b()}catch(o){console.error("Error adding chemicals:",o)}},N=a=>{f(o=>{const A=[...o,a];return j(""),A})},m=a=>{f(o=>o.filter(A=>A._id!==a))};return e.jsx(R,{open:x,onOpenChange:a=>!a&&c(),children:e.jsxs(z,{className:"max-w-lg p-6",children:[e.jsx(W,{children:e.jsxs(K,{className:"text-lg font-semibold text-[#3b1f91]",children:["Add Chemicals for ",n]})}),e.jsxs("div",{className:"mt-4",children:[e.jsx(Y,{placeholder:`Search ${n}`,value:h,onChange:a=>j(a.target.value),className:"w-full mb-4"}),D?e.jsx("div",{children:"Loading..."}):h&&r&&r.length>0&&e.jsx("ul",{className:"border bg-white rounded max-h-40 overflow-y-auto",children:r.map(a=>e.jsx("li",{onClick:()=>N(a),className:"p-2 hover:bg-gray-200 cursor-pointer",children:a.name},a._id))}),r?.length===0&&!D&&h&&e.jsx("div",{className:"p-2 text-gray-500",children:"No chemicals found"}),e.jsx("div",{className:"mt-4",children:p.length>0&&e.jsx("div",{className:"space-y-2",children:p.map(a=>e.jsxs("div",{className:"flex justify-between items-center bg-gray-100 p-2 rounded",children:[e.jsx("span",{children:a.name}),e.jsx(S,{variant:"outline",size:"sm",onClick:()=>m(a._id),className:"text-red-500",children:"Remove"})]},a._id))})}),e.jsxs("div",{className:"flex justify-between mt-4",children:[e.jsx(S,{onClick:C,className:"bg-[#3b1f91] hover:bg-purple-700",disabled:P||p.length===0,children:P?"Adding...":"+ Add"}),e.jsx(S,{onClick:c,className:"bg-red-600 hover:bg-red-700",children:"Cancel"})]})]})]})})};function q({supplier:x,supplierName:c,allData:v}){const[n,d]=l.useState(10),[i,b]=l.useState(1),[h,j]=l.useState(1),[p,f]=l.useState(!1),[r,D]=l.useState(null),[k,y]=l.useState(null),[P,C]=l.useState(!1),[N,m]=l.useState(null),{data:a,isLoading:o,isError:A,refetch:L}=Z(x,{skip:(i-1)*n,limit:n}),[_,{isLoading:I}]=ee();l.useEffect(()=>{a&&j(Math.ceil(a.chemicals.length/n))},[a,n]);const F=g=>{D(g),f(!0),y("supplier")},E=()=>{i>1&&b(i-1)},O=()=>{i<h&&b(i+1)},s=g=>{m(g),C(!0)},w=async()=>{try{await _({supplierId:x,chemicalId:N._id}).unwrap(),L()}catch(g){console.error("Error deleting chemical:",g)}finally{C(!1),m(null)}};if(o)return e.jsx("div",{children:"Loading..."});if(A)return e.jsx("div",{children:"Error loading chemicals"});const M=Array.isArray(a?.chemicals)?a.chemicals:[];return e.jsxs("div",{className:"w-full overflow-auto",children:[e.jsx(W,{children:e.jsxs("div",{className:"flex justify-between items-center mr-5",children:[e.jsxs(K,{children:["Chemicals for ",c]}),e.jsx(S,{onClick:()=>F(M),className:"bg-purple-600 hover:bg-purple-700",children:"+ Add Chemical"})]})}),e.jsx("div",{className:"mt-5 ",children:e.jsxs(H,{children:[e.jsx(Q,{children:e.jsxs(T,{children:[e.jsx(u,{className:"p-2",children:"Name"}),e.jsx(u,{className:"p-2",children:"CAS Number"}),e.jsx(u,{className:"p-2 w-[100px]",children:"Action"})]})}),e.jsx(G,{children:M.map((g,J)=>e.jsxs(T,{className:"p-2",children:[e.jsx(t,{className:"px-2 py-1",children:g.name}),e.jsx(t,{className:"px-2 py-1",children:g.cas_number}),e.jsx(t,{className:"px-2 py-1",children:e.jsx(S,{variant:"ghost",size:"icon",className:"text-red-500",onClick:()=>s(g),disabled:I,children:I?"Deleting...":e.jsx(ue,{className:"h-4 w-4"})})})]},J))})]})}),p&&r&&e.jsx(V,{open:p,onClose:()=>f(!1),chemicalName:r.name,supplier:c,supplierId:x,refetch:L,allData:v}),e.jsx(te,{open:P,onOpenChange:C,children:e.jsxs(ne,{children:[e.jsxs(ie,{children:[e.jsx(ce,{children:"Are you sure?"}),e.jsxs(de,{children:["This action cannot be undone. This will permanently delete the chemical",N&&` "${N.name}"`," from this supplier."]})]}),e.jsxs(oe,{children:[e.jsx(he,{children:"Cancel"}),e.jsx(me,{onClick:w,className:"bg-red-500 hover:bg-red-600",children:"Delete"})]})]})}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"Items per page:"}),e.jsxs("select",{className:"border p-1 rounded",value:n,onChange:g=>d(Number(g.target.value)),children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{variant:"outline",size:"sm",onClick:E,disabled:i===1,children:"Previous"}),e.jsxs("span",{children:[i," of ",h]}),e.jsx(S,{variant:"outline",size:"sm",onClick:O,disabled:i===h,children:"Next"})]})]})]})}const Ne=()=>{const{data:x=[],isLoading:c,error:v}=$(),[n,d]=l.useState(1),[i,b]=l.useState(10),[h,j]=l.useState(!1),[p,f]=l.useState(null),[r,D]=l.useState({name:"",email:"",mobile:"",country:"",website:""}),k=ae(),[y,P]=l.useState(null),[C,N]=l.useState(!1),{refetch:m}=$(),[a]=se(),o=(s,w)=>{D(M=>({...M,[s]:w})),d(1)},A=x.filter(s=>{const w=r.name.toLowerCase();return(!r.name||s.name.toLowerCase().includes(w)||s.email.toLowerCase().includes(w)||s.mobile.toLowerCase().includes(w))&&(!r.country||s.country.toLowerCase().includes(r.country.toLowerCase()))&&(!r.website||s.website.toLowerCase().includes(r.website.toLowerCase()))}),L=Math.ceil(A.length/i),_=A.slice((n-1)*i,n*i),I=async s=>{try{await a(s)}catch(w){console.error("Error deleting supplier:",w)}},F=s=>{b(parseInt(s.target.value)),d(1)},E=s=>{f(s),j(!0)},O=s=>{P(s),N(!0)};return c?e.jsx("div",{children:"Loading..."}):v?e.jsxs("div",{children:["Error loading suppliers: ",v.message]}):e.jsxs("div",{children:[e.jsx("div",{className:"rounded-md shadow-sm bg-white",children:e.jsxs(H,{className:"w-full text-left border-collapse",children:[e.jsxs(Q,{className:"bg-gray-100 border-b border-gray-300",children:[e.jsxs(T,{className:"text-gray-600 font-semibold",children:[e.jsx(u,{className:"w-10"}),e.jsx(u,{children:"Info"}),e.jsx(u,{children:"Chemicals"}),e.jsx(u,{children:"Country"}),e.jsx(u,{children:"Website"})]}),e.jsxs(T,{className:"bg-gray-50",children:[e.jsx(t,{}),e.jsx(t,{children:e.jsx("input",{type:"text",placeholder:"Filter by name, email or mobile",className:"p-2 rounded w-full border border-gray-300",value:r.name,onChange:s=>o("name",s.target.value)})}),e.jsx(t,{}),e.jsx(t,{children:e.jsx("input",{type:"text",placeholder:"Filter by country",className:"p-2 rounded w-full border border-gray-300",value:r.country,onChange:s=>o("country",s.target.value)})}),e.jsx(t,{children:e.jsx("input",{type:"text",placeholder:"Filter by website",className:"p-2 rounded w-full border border-gray-300",value:r.website,onChange:s=>o("website",s.target.value)})})]})]}),e.jsx(G,{children:_.map(s=>e.jsx(le.Fragment,{children:e.jsxs(T,{className:"hover:bg-gray-50 border-b border-gray-300",children:[e.jsx(t,{className:"p-2",children:e.jsxs(pe,{children:[e.jsx(je,{asChild:!0,children:e.jsx("button",{className:"p-3",children:e.jsx(be,{className:"w-4 h-4"})})}),e.jsxs(ge,{align:"end",children:[e.jsx(B,{onClick:()=>E(s),children:"Add Chemical"}),e.jsx(B,{onClick:()=>k(`/edit-supplier-form/${s._id}`),children:"Edit"}),e.jsx(B,{onClick:()=>I(s._id),children:"Delete"})]})]})}),e.jsx(t,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.name}),e.jsx("span",{className:"text-sm text-gray-600",children:s.email}),e.jsx("span",{className:"text-sm text-gray-600",children:s.mobile})]})}),e.jsx(t,{children:e.jsxs(S,{variant:"default",size:"sm",onClick:()=>O(s),className:"bg-[#3b1f91] text-white px-4 py-2 rounded hover:bg-[#3b1f91] transition-colors duration-300",children:["Chemicals",e.jsx(xe,{variant:"secondary",className:"ml-2 bg-gray-200 text-black px-2 py-1 rounded",children:s.totalChemicalIds||0})]})}),e.jsx(t,{children:s.country}),e.jsx(t,{children:e.jsx(Link,{to:s.website,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:s.website})})]})},s._id))})]})}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"items-per-page",className:"mr-2",children:"Items per page:"}),e.jsxs("select",{id:"items-per-page",className:"p-2  border border-gray-300 rounded",value:i,onChange:F,children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:30,children:"30"}),e.jsx("option",{value:40,children:"40"}),e.jsx("option",{value:50,children:"50"})]})]}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>d(s=>Math.max(s-1,1)),className:"px-3 py-1 border border-gray-300 rounded mr-2",disabled:n===1,children:"Previous"}),e.jsxs("span",{children:["Page ",n," of ",L]}),e.jsx("button",{onClick:()=>d(s=>Math.min(s+1,L)),className:"px-3 py-1 border border-gray-300 rounded ml-2",disabled:n===L,children:"Next"})]})]}),h&&e.jsx(V,{open:h,onClose:()=>j(!1),supplier:p,supplierId:p?._id,chemicalName:p?.name}),e.jsx(R,{open:C,onOpenChange:N,children:e.jsx(z,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:C&&y&&e.jsx(q,{supplier:y._id,supplierName:y.name,allData:m})})})]})},ve=({purchaseOrders:x})=>e.jsxs(H,{children:[e.jsx(Q,{children:e.jsxs(T,{children:[e.jsx(u,{children:"Created Date"}),e.jsx(u,{children:"Order Number"}),e.jsx(u,{children:"Payment Status"}),e.jsx(u,{children:"Total Tax"}),e.jsx(u,{children:"Total Discount"}),e.jsx(u,{children:"Total Amount"})]})}),e.jsx(G,{children:x.map((c,v)=>e.jsxs(T,{children:[e.jsx(t,{children:c.createdDate}),e.jsx(t,{children:c.orderNumber}),e.jsx(t,{children:c.paymentStatus}),e.jsxs(t,{children:["$",c.totalTax]}),e.jsxs(t,{children:["$",c.totalDiscount]}),e.jsxs(t,{children:["$",c.totalAmount]})]},v))})]}),ye=[{label:"Dashboard",href:"/dashboard"},{label:"Supplier Table",href:null}];function Oe(){const[x,c]=l.useState({}),[v,n]=l.useState(!1),[d,i]=l.useState(null),[b,h]=l.useState(1),[j,p]=l.useState(5),{data:f=[],isLoading:r,error:D,refetch:k}=$(),[y,P]=l.useState({});if(r)return e.jsx("p",{children:"Loading suppliers..."});if(D)return e.jsx("p",{children:"Failed to load suppliers"});const C=(m,a)=>{P(o=>({...o,[m]:a}))},N=m=>{console.log("Opening chemical modal for supplier:",m),i(m),n(!0)};return e.jsxs("div",{className:"",children:[e.jsx(fe,{items:ye}),e.jsxs("div",{className:"flex justify-between mt-4 items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-medium text-[#3b1f91] ",children:"Suppliers"}),e.jsx(re,{to:"/supplier-form",children:e.jsxs(S,{children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Add Supplier"]})})]}),e.jsx(Ne,{suppliers:f,showPurchaseOrders:x,setShowPurchaseOrders:c,setSelectedSupplier:i,setShowChemicalsModal:n,filters:y,handleFilterChange:C,currentPage:b,itemsPerPage:j,paginatedData:f.slice((b-1)*j,b*j),selectedSupplier:d,refetch:k,onChemicalClick:N}),x[d?.id]&&d&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4",children:["Purchase Orders for ",d.name]}),e.jsx(ve,{purchaseOrders:[]}),"  "]}),e.jsx(R,{open:v,onOpenChange:m=>{console.log("Modal state changing to:",m),n(m)},children:e.jsx(z,{className:"max-w-2xl h-1/2",children:e.jsx(q,{supplier:d?._id,supplierName:d?.name,allData:k})})})]})}export{Oe as default};
