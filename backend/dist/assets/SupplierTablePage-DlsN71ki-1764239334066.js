import{r as l,W as U,w as X,j as e,D as z,s as R,t as G,v as V,I as Y,B as S,a0 as Z,A as ee,z as $,f as se,a1 as ae,R as le,L as re}from"./index-BNYnXiCH-1764239334066.js";import{T as H,a as Q,b as T,c as u,d as W,e as n}from"./table-IO1-MoIC-1764239334066.js";import{A as te,a as ne,b as ie,c as ce,d as oe,e as de,f as he,g as me}from"./alert-dialog-BmEsU2LL-1764239334066.js";import{T as xe}from"./trash-2-DkcI5GHX-1764239334066.js";import{B as ue}from"./badge-PeNCImGP-1764239334066.js";import{D as je,a as pe,b as ge,c as B}from"./dropdown-menu-CGrV4gHS-1764239334066.js";import{E as be}from"./ellipsis-vertical-C5pOckG9-1764239334066.js";import{B as Ce}from"./BreadCrumb-BrhUn5qN-1764239334066.js";import{P as fe}from"./plus-C4C-S8ut-1764239334066.js";import"./Combination-Gk3_F5yv-1764239334066.js";import"./chevron-right-PmFhtEsk-1764239334066.js";import"./check-DC0gRKa2-1764239334066.js";const q=({open:j,onClose:o,chemicalName:v,supplier:i,supplierId:r,refetch:c,allData:b})=>{const[m,p]=l.useState(""),[d,C]=l.useState([]),{data:t,isLoading:D,error:k}=U(m,{skip:!m||m.length<2}),[y,{isLoading:A}]=X(),f=async()=>{const a=d.map(h=>h._id);try{await y({supplierId:r,chemical_ids:a}).unwrap(),await c(),o(),b()}catch(h){console.error("Error adding chemicals:",h)}},N=a=>{C(h=>{const P=[...h,a];return p(""),P})},x=a=>{C(h=>h.filter(P=>P._id!==a))};return e.jsx(z,{open:j,onOpenChange:a=>!a&&o(),children:e.jsxs(R,{className:"max-w-lg p-6",children:[e.jsx(G,{children:e.jsxs(V,{className:"text-lg font-semibold text-[#304a8a]",children:["Add Chemicals for ",i]})}),e.jsxs("div",{className:"mt-4",children:[e.jsx(Y,{placeholder:`Search ${i}`,value:m,onChange:a=>p(a.target.value),className:"w-full mb-4"}),D?e.jsx("div",{children:"Loading..."}):m&&t&&t.length>0&&e.jsx("ul",{className:"border bg-white rounded max-h-40 overflow-y-auto",children:t.map(a=>e.jsx("li",{onClick:()=>N(a),className:"p-2 hover:bg-gray-200 cursor-pointer",children:a.name},a._id))}),(t==null?void 0:t.length)===0&&!D&&m&&e.jsx("div",{className:"p-2 text-gray-500",children:"No chemicals found"}),e.jsx("div",{className:"mt-4",children:d.length>0&&e.jsx("div",{className:"space-y-2",children:d.map(a=>e.jsxs("div",{className:"flex justify-between items-center bg-gray-100 p-2 rounded",children:[e.jsx("span",{children:a.name}),e.jsx(S,{variant:"outline",size:"sm",onClick:()=>x(a._id),className:"text-red-500",children:"Remove"})]},a._id))})}),e.jsxs("div",{className:"flex justify-between mt-4",children:[e.jsx(S,{onClick:f,className:"bg-[#304a8a] hover:bg-purple-700",disabled:A||d.length===0,children:A?"Adding...":"+ Add"}),e.jsx(S,{onClick:o,className:"bg-red-600 hover:bg-red-700",children:"Cancel"})]})]})]})})};function J({supplier:j,supplierName:o,allData:v}){const[i,r]=l.useState(10),[c,b]=l.useState(1),[m,p]=l.useState(1),[d,C]=l.useState(!1),[t,D]=l.useState(null),[k,y]=l.useState(null),[A,f]=l.useState(!1),[N,x]=l.useState(null),{data:a,isLoading:h,isError:P,refetch:L}=Z(j,{skip:(c-1)*i,limit:i}),[_,{isLoading:I}]=ee();l.useEffect(()=>{a&&p(Math.ceil(a.chemicals.length/i))},[a,i]);const F=g=>{D(g),C(!0),y("supplier")},E=()=>{c>1&&b(c-1)},O=()=>{c<m&&b(c+1)},s=g=>{x(g),f(!0)},w=async()=>{try{await _({supplierId:j,chemicalId:N._id}).unwrap(),L()}catch(g){console.error("Error deleting chemical:",g)}finally{f(!1),x(null)}};if(h)return e.jsx("div",{children:"Loading..."});if(P)return e.jsx("div",{children:"Error loading chemicals"});const M=Array.isArray(a==null?void 0:a.chemicals)?a.chemicals:[];return e.jsxs("div",{className:"w-full overflow-auto",children:[e.jsx(G,{children:e.jsxs("div",{className:"flex justify-between items-center mr-5",children:[e.jsxs(V,{children:["Chemicals for ",o]}),e.jsx(S,{onClick:()=>F(M),className:"bg-purple-600 hover:bg-purple-700",children:"+ Add Chemical"})]})}),e.jsx("div",{className:"mt-5 ",children:e.jsxs(H,{children:[e.jsx(Q,{children:e.jsxs(T,{children:[e.jsx(u,{className:"p-2",children:"Name"}),e.jsx(u,{className:"p-2",children:"CAS Number"}),e.jsx(u,{className:"p-2 w-[100px]",children:"Action"})]})}),e.jsx(W,{children:M.map((g,K)=>e.jsxs(T,{className:"p-2",children:[e.jsx(n,{className:"px-2 py-1",children:g.name}),e.jsx(n,{className:"px-2 py-1",children:g.cas_number}),e.jsx(n,{className:"px-2 py-1",children:e.jsx(S,{variant:"ghost",size:"icon",className:"text-red-500",onClick:()=>s(g),disabled:I,children:I?"Deleting...":e.jsx(xe,{className:"h-4 w-4"})})})]},K))})]})}),d&&t&&e.jsx(q,{open:d,onClose:()=>C(!1),chemicalName:t.name,supplier:o,supplierId:j,refetch:L,allData:v}),e.jsx(te,{open:A,onOpenChange:f,children:e.jsxs(ne,{children:[e.jsxs(ie,{children:[e.jsx(ce,{children:"Are you sure?"}),e.jsxs(oe,{children:["This action cannot be undone. This will permanently delete the chemical",N&&` "${N.name}"`," from this supplier."]})]}),e.jsxs(de,{children:[e.jsx(he,{children:"Cancel"}),e.jsx(me,{onClick:w,className:"bg-red-500 hover:bg-red-600",children:"Delete"})]})]})}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"Items per page:"}),e.jsxs("select",{className:"border p-1 rounded",value:i,onChange:g=>r(Number(g.target.value)),children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{variant:"outline",size:"sm",onClick:E,disabled:c===1,children:"Previous"}),e.jsxs("span",{children:[c," of ",m]}),e.jsx(S,{variant:"outline",size:"sm",onClick:O,disabled:c===m,children:"Next"})]})]})]})}const Ne=()=>{const{data:j=[],isLoading:o,error:v}=$(),[i,r]=l.useState(1),[c,b]=l.useState(10),[m,p]=l.useState(!1),[d,C]=l.useState(null),[t,D]=l.useState({name:"",email:"",mobile:"",country:"",website:""}),k=se(),[y,A]=l.useState(null),[f,N]=l.useState(!1),{refetch:x}=$(),[a]=ae(),h=(s,w)=>{D(M=>({...M,[s]:w})),r(1)},P=j.filter(s=>{const w=t.name.toLowerCase();return(!t.name||s.name.toLowerCase().includes(w)||s.email.toLowerCase().includes(w)||s.mobile.toLowerCase().includes(w))&&(!t.country||s.country.toLowerCase().includes(t.country.toLowerCase()))&&(!t.website||s.website.toLowerCase().includes(t.website.toLowerCase()))}),L=Math.ceil(P.length/c),_=P.slice((i-1)*c,i*c),I=async s=>{try{await a(s)}catch(w){console.error("Error deleting supplier:",w)}},F=s=>{b(parseInt(s.target.value)),r(1)},E=s=>{C(s),p(!0)},O=s=>{A(s),N(!0)};return o?e.jsx("div",{children:"Loading..."}):v?e.jsxs("div",{children:["Error loading suppliers: ",v.message]}):e.jsxs("div",{children:[e.jsx("div",{className:"rounded-md shadow-sm bg-white",children:e.jsxs(H,{className:"w-full text-left border-collapse",children:[e.jsxs(Q,{className:"bg-gray-100 border-b border-gray-300",children:[e.jsxs(T,{className:"text-gray-600 font-semibold",children:[e.jsx(u,{className:"w-10"}),e.jsx(u,{children:"Info"}),e.jsx(u,{children:"Chemicals"}),e.jsx(u,{children:"Country"}),e.jsx(u,{children:"Website"})]}),e.jsxs(T,{className:"bg-gray-50",children:[e.jsx(n,{}),e.jsx(n,{children:e.jsx("input",{type:"text",placeholder:"Filter by name, email or mobile",className:"p-2 rounded w-full border border-gray-300",value:t.name,onChange:s=>h("name",s.target.value)})}),e.jsx(n,{}),e.jsx(n,{children:e.jsx("input",{type:"text",placeholder:"Filter by country",className:"p-2 rounded w-full border border-gray-300",value:t.country,onChange:s=>h("country",s.target.value)})}),e.jsx(n,{children:e.jsx("input",{type:"text",placeholder:"Filter by website",className:"p-2 rounded w-full border border-gray-300",value:t.website,onChange:s=>h("website",s.target.value)})})]})]}),e.jsx(W,{children:_.map(s=>e.jsx(le.Fragment,{children:e.jsxs(T,{className:"hover:bg-gray-50 border-b border-gray-300",children:[e.jsx(n,{className:"p-2",children:e.jsxs(je,{children:[e.jsx(pe,{asChild:!0,children:e.jsx("button",{className:"p-3",children:e.jsx(be,{className:"w-4 h-4"})})}),e.jsxs(ge,{align:"end",children:[e.jsx(B,{onClick:()=>E(s),children:"Add Chemical"}),e.jsx(B,{onClick:()=>k(`/edit-supplier-form/${s._id}`),children:"Edit"}),e.jsx(B,{onClick:()=>I(s._id),children:"Delete"})]})]})}),e.jsx(n,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.name}),e.jsx("span",{className:"text-sm text-gray-600",children:s.email}),e.jsx("span",{className:"text-sm text-gray-600",children:s.mobile})]})}),e.jsx(n,{children:e.jsxs(S,{variant:"default",size:"sm",onClick:()=>O(s),className:"bg-[#304a8a] text-white px-4 py-2 rounded hover:bg-[#304a8a] transition-colors duration-300",children:["Chemicals",e.jsx(ue,{variant:"secondary",className:"ml-2 bg-gray-200 text-black px-2 py-1 rounded",children:s.totalChemicalIds||0})]})}),e.jsx(n,{children:s.country}),e.jsx(n,{children:e.jsx(Link,{to:s.website,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:s.website})})]})},s._id))})]})}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"items-per-page",className:"mr-2",children:"Items per page:"}),e.jsxs("select",{id:"items-per-page",className:"p-2  border border-gray-300 rounded",value:c,onChange:F,children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:30,children:"30"}),e.jsx("option",{value:40,children:"40"}),e.jsx("option",{value:50,children:"50"})]})]}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>r(s=>Math.max(s-1,1)),className:"px-3 py-1 border border-gray-300 rounded mr-2",disabled:i===1,children:"Previous"}),e.jsxs("span",{children:["Page ",i," of ",L]}),e.jsx("button",{onClick:()=>r(s=>Math.min(s+1,L)),className:"px-3 py-1 border border-gray-300 rounded ml-2",disabled:i===L,children:"Next"})]})]}),m&&e.jsx(q,{open:m,onClose:()=>p(!1),supplier:d,supplierId:d==null?void 0:d._id,chemicalName:d==null?void 0:d.name}),e.jsx(z,{open:f,onOpenChange:N,children:e.jsx(R,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:f&&y&&e.jsx(J,{supplier:y._id,supplierName:y.name,allData:x})})})]})},ve=({purchaseOrders:j})=>e.jsxs(H,{children:[e.jsx(Q,{children:e.jsxs(T,{children:[e.jsx(u,{children:"Created Date"}),e.jsx(u,{children:"Order Number"}),e.jsx(u,{children:"Payment Status"}),e.jsx(u,{children:"Total Tax"}),e.jsx(u,{children:"Total Discount"}),e.jsx(u,{children:"Total Amount"})]})}),e.jsx(W,{children:j.map((o,v)=>e.jsxs(T,{children:[e.jsx(n,{children:o.createdDate}),e.jsx(n,{children:o.orderNumber}),e.jsx(n,{children:o.paymentStatus}),e.jsxs(n,{children:["$",o.totalTax]}),e.jsxs(n,{children:["$",o.totalDiscount]}),e.jsxs(n,{children:["$",o.totalAmount]})]},v))})]}),ye=[{label:"Dashboard",href:"/dashboard"},{label:"Supplier Table",href:null}];function Ee(){const[j,o]=l.useState({}),[v,i]=l.useState(!1),[r,c]=l.useState(null),[b,m]=l.useState(1),[p,d]=l.useState(5),{data:C=[],isLoading:t,error:D,refetch:k}=$(),[y,A]=l.useState({});if(t)return e.jsx("p",{children:"Loading suppliers..."});if(D)return e.jsx("p",{children:"Failed to load suppliers"});const f=(x,a)=>{A(h=>({...h,[x]:a}))},N=x=>{console.log("Opening chemical modal for supplier:",x),c(x),i(!0)};return e.jsxs("div",{className:"",children:[e.jsx(Ce,{items:ye}),e.jsxs("div",{className:"flex justify-between mt-4 items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-medium text-[#304a8a] ",children:"Suppliers"}),e.jsx(re,{to:"/supplier-form",children:e.jsxs(S,{children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"Add Supplier"]})})]}),e.jsx(Ne,{suppliers:C,showPurchaseOrders:j,setShowPurchaseOrders:o,setSelectedSupplier:c,setShowChemicalsModal:i,filters:y,handleFilterChange:f,currentPage:b,itemsPerPage:p,paginatedData:C.slice((b-1)*p,b*p),selectedSupplier:r,refetch:k,onChemicalClick:N}),j[r==null?void 0:r.id]&&r&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4",children:["Purchase Orders for ",r.name]}),e.jsx(ve,{purchaseOrders:[]}),"  "]}),e.jsx(z,{open:v,onOpenChange:x=>{console.log("Modal state changing to:",x),i(x)},children:e.jsx(R,{className:"max-w-2xl h-1/2",children:e.jsx(J,{supplier:r==null?void 0:r._id,supplierName:r==null?void 0:r.name,allData:k})})})]})}export{Ee as default};
