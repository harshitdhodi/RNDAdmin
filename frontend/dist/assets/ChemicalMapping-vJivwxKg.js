import{r as u,j as e,a as f}from"./react-DKICu8bO.js";import{F as w,m as I,I as N,B as A,V as _,R as B,s as P}from"./index-Bbo1zcj1.js";import{F as k,S as F,a as L,B as j}from"./antd-mtWlDmqY.js";import{B as b}from"./react-toastify-CMp5zawu.js";import{B as R}from"./BreadCrumb-P1oQ4p-m.js";import"./classnames-Bv6oJzD9.js";import"./react-dom-BBS6HuAW.js";import"./scheduler-CKyTKYc2.js";import"./react-redux-BrRfTdeB.js";import"./use-sync-external-store-D0ivhzzy.js";import"./@reduxjs-B5J9SSA5.js";import"./redux-DITMfSWq.js";import"./immer-fBqQtvEc.js";import"./redux-thunk-ClJT1hhx.js";import"./reselect-C27TLnWV.js";import"./js-cookie-Cz0CWeBA.js";import"./react-router-B9QVkYva.js";import"./cookie--_YQFYBD.js";import"./@radix-ui-BlrBCj0C.js";import"./aria-hidden-DQ5UC2Eg.js";import"./react-remove-scroll-fXbmorz6.js";import"./tslib-CDuPK5Eb.js";import"./react-remove-scroll-bar-C9fmXXva.js";import"./react-style-singleton-DKBZmuKg.js";import"./get-nonce-C-Z93AgS.js";import"./use-sidecar-C10EJNOT.js";import"./use-callback-ref-BoKxM4XI.js";import"./@floating-ui-8J-daYO3.js";import"./class-variance-authority-Dp3B9jqt.js";import"./clsx-B-dksMZM.js";import"./tailwind-merge-D696Ktp4.js";import"./lucide-D7hRWJEP.js";import"./axios-DXsv3KKR.js";import"./@syncfusion-BIAkhmGL.js";import"./@ant-design-jkdqJqTn.js";import"./rc-util-C9ihiQ8l.js";import"./@babel-C_xKm-6V.js";import"./react-is-NfUKNnIv.js";import"./@emotion-CW87jbl0.js";import"./stylis-OW4gUFyn.js";import"./@ctrl-DOFZgDuz.js";import"./rc-motion-D0k58WYE.js";import"./@rc-component-DJY3KRXL.js";import"./rc-resize-observer-h7CJ_t66.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./ant-design-icons-CNhZ1eT-.js";import"./rc-dialog-CfVZmZCG.js";import"./rc-table-BJAsEMDh.js";import"./rc-virtual-list-OMMR-gr8.js";import"./rc-tree-aGCJh_41.js";import"./rc-checkbox-nRYcjTPl.js";import"./rc-pagination-ZKXeAm0h.js";import"./rc-select-RmeC3WgB.js";import"./rc-overflow-DEivB5rv.js";import"./throttle-debounce-CUWDS_la.js";import"./rc-input-CIUXRVU8.js";import"./rc-tooltip-Oavn6yow.js";import"./rc-notification-0md6QYDj.js";import"./rc-image-ClDwiN-j.js";import"./rc-textarea-CijmdGy3.js";import"./copy-to-clipboard-0rP7DRqq.js";import"./toggle-selection-DGa8lynz.js";import"./rc-upload-DlrdHvh1.js";import"./rc-progress-BVn0ZmF4.js";import"./rc-dropdown-D4AwxsUk.js";import"./rc-menu-MHhKtfoG.js";import"./rc-field-form-CVOtFEQA.js";import"./scroll-into-view-if-needed-BZeNfFF0.js";import"./compute-scroll-into-view-DWa9QgjM.js";import"./rc-picker-D0kXf0IF.js";import"./rc-tabs-XmQY-w_1.js";function M({chemicals:t,onRemoveChemical:h}){const[i,s]=u.useState(1),[o,r]=u.useState(10),c=Math.ceil(((t==null?void 0:t.length)||0)/o),l=(i-1)*o,n=l+o,g=t==null?void 0:t.slice(l,n),x=[{title:"Action",dataIndex:"action",render:(d,C)=>e.jsx(j,{type:"primary",danger:!0,size:"small",onClick:()=>h(C),children:"Delete"})},{title:"Chemical Name",dataIndex:"name"},{title:"CAS Number",dataIndex:"cas_number"}];return e.jsxs("div",{className:"border rounded-md mt-4 p-4",children:[e.jsx(k,{columns:x,dataSource:g,rowKey:"_id",pagination:!1}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Items per page:"," ",e.jsx(F,{value:o,onChange:d=>{r(d),s(1)},options:[{value:10,label:"10"},{value:20,label:"20"},{value:50,label:"50"}],style:{width:80}})]}),e.jsxs(L,{children:[e.jsx(j,{type:"default",size:"small",onClick:()=>s(i-1),disabled:i===1,children:"Previous"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[l+1," - ",Math.min(n,(t==null?void 0:t.length)||0)," of"," ",(t==null?void 0:t.length)||0]}),e.jsx(j,{type:"default",size:"small",onClick:()=>s(i+1),disabled:i===c,children:"Next"})]})]})]})}function Q({selectedCustomer:t,refetchCustomer:h}){const[i,s]=u.useState(""),[o,r]=u.useState(""),[c,l]=u.useState(null),{data:n,isLoading:g}=w(o.charAt(0),{skip:o.length===0}),[x,{isLoading:d}]=I(),C=a=>{const p=a.target.value;s(p),r(p)},y=a=>{l(a),s(a.name),r("")},S=async()=>{if(!c||!t){b.error("Please select both customer and chemical");return}try{const a=c.id||c._id,p=t._id;await x({customerId:p,chemicalId:a}).unwrap(),s(""),l(null),await h(),b.success("Chemical added successfully")}catch(a){b.error(a.message||"Failed to add chemical")}};return e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(N,{placeholder:"Search Chemical",value:i,onChange:C,className:"w-full mb-4",disabled:!t}),g&&e.jsx("div",{className:"absolute top-2 right-4 text-sm text-gray-500",children:"Loading..."})]}),o&&(n==null?void 0:n.length)>0&&e.jsx("ul",{className:"border bg-white rounded max-h-40 overflow-y-auto",children:n.map(a=>e.jsx("li",{onClick:()=>y(a),className:"p-2 hover:bg-gray-200 cursor-pointer",children:a.name},a._id))}),e.jsx(A,{onClick:S,disabled:d||!c||!t,className:"mt-4 w-[10%] py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:d?"Adding...":"Add "})]})}function T({onSelectCustomer:t}){const[h,i]=u.useState(""),[s,o]=u.useState(""),[r,c]=u.useState(null),{data:l,isLoading:n,refetch:g}=_(s.charAt(0),{skip:s.length===0}),{data:x,refetch:d}=B(r==null?void 0:r._id,{skip:!(r!=null&&r._id)}),[C]=P(),y=m=>{c(m),i(m.name),o(""),t(m)},S=m=>{const v=m.target.value;i(v),o(v)},a=async m=>{try{await C({customerId:r._id,chemicalId:m._id}).unwrap(),await Promise.all([d(),g()]),b.success("Chemical removed successfully")}catch(v){console.error("Error removing chemical:",v),b.error("Failed to remove chemical")}},p=(x==null?void 0:x.data)||r;return e.jsxs("div",{className:"mt-4",children:[e.jsx(N,{placeholder:"Search Customer",value:h,onChange:S,className:"w-full mb-4"}),n?e.jsx("div",{children:"Loading..."}):s&&l&&l.length>0&&e.jsx("ul",{className:"border bg-white rounded max-h-40 overflow-y-auto",children:l.map(m=>e.jsx("li",{onClick:()=>y(m),className:"p-2 hover:bg-gray-200 cursor-pointer",children:m.name},m._id))}),e.jsx(Q,{selectedCustomer:p,refetchCustomer:async()=>{await Promise.all([d(),g()])}}),p&&e.jsx(M,{chemicals:p.chemicalId||[],onRemoveChemical:a})]})}const z=[{label:"Dashboard",href:"/dashboard"},{label:"Chemical Mapping",href:null}];function rt(){const[t,h]=f.useState(null),[i,s]=f.useState([]),o=r=>{h(r),s([])};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"ml-1",children:e.jsx(R,{items:z})}),e.jsxs("div",{className:"py-4 space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-purple-700",children:"Assign Chemicals to Customer"}),e.jsx("div",{className:"space-y-4",children:e.jsx(T,{onSelectCustomer:o})})]})]})}export{rt as default};
