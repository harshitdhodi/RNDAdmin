import{i as Ne,k as ye,j as e,D as Q,l as ve,B as p,m as G,n as se,o as le,I as H,p as Ae,q as Le,C as ae,r as Te,s as te,t as Fe,v as re,w as ke,x as De,y as Ee,z as Me,b as Z,S as _e,A as Pe}from"./main-Dqjs8KFu.js";import{c as l,f as Ie,L as Be}from"./vendor-DNXw0_ws.js";import{T as q,a as Y,b as L,c as o,d as J,e as c}from"./table-ClCspb0r.js";import{S as ie,a as ne,b as oe,c as ce,d as P}from"./select-5TNptwF3.js";import{D as $e,a as Re,b as ze,c as O}from"./dropdown-menu-B0iHGqFX.js";import{C as de}from"./checkbox-C3MmvOrK.js";import"./textarea-DQR8dwWp.js";import{S as R}from"./sweetalert2.esm.all-CIewtpap.js";import{R as Oe}from"./index-CZ4jclvw.js";/* empty css                   */import{M as Qe}from"./mail-CI7trYGv.js";import{A as Ge,a as He,b as Ue,c as Ve,d as qe,e as Ye,f as Je,g as We}from"./alert-dialog-ClwbOofj.js";import{P as me}from"./plus-CRq7CWPy.js";import{T as W}from"./trash-2-_xS6d-Js.js";import{C as Ke}from"./chevron-left-C6x8DOf-.js";import{C as Xe}from"./chevron-right-NQLtojSi.js";import{C as Ze}from"./circle-plus-2cE8BrC9.js";import{E as es}from"./ellipsis-vertical-BLliFg-L.js";import"./Combination-B3ZBIzZt.js";import"./index-Uuqq7LOu.js";import"./chevron-up-D4Ahgufn.js";import"./check-DzXQN_fY.js";import"./isEqual-SRXYztYb.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=Ne("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),he=({selectedSupplier:k,supplier:m,email:g,name:x,type:i,chemicalName:f})=>{var S,M;console.log("Type:",i),console.log("Supplier Array:",m),console.log("Supplier Email:",(S=m[0])==null?void 0:S.email),console.log("Condition Check:",i==="Customer",m.length>0);const[h,C]=l.useState(""),[w,N]=l.useState(""),[d,y]=l.useState(!1),[j,D]=l.useState(null),{data:T,isLoading:E,error:v}=ye(),t=(T==null?void 0:T.data)||[],n=i==="Customer"&&Array.isArray(m)&&((M=m[0])!=null&&M.email)?m[0].email:g;console.log("Recipient Email:",n),l.useEffect(()=>{console.log("Supplier updated:",m)},[m]);const A=async()=>{try{y(!0);const u={subject:w,message:h,recipients:Array.isArray(n)?n:[n],chemicalNames:Array.isArray(f)?f:[f]},a=await fetch("/api/chemicalMail/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)}),b=await a.json();if(!a.ok)throw new Error(b.message||"Failed to send email");alert("Email sent successfully!"),C(""),N("")}catch(u){console.log("Error sending email:",u),alert("Failed to send email: "+u.message)}finally{y(!1)}},_=u=>{const a=t.find(b=>b._id===u);D(a),C((a==null?void 0:a.body)||""),N((a==null?void 0:a.subject)||"")};return e.jsx("div",{children:e.jsxs(Q,{children:[e.jsx(ve,{asChild:!0,children:e.jsxs(p,{variant:"secondary",children:[e.jsx(Qe,{className:"w-4 h-4 mr-2"}),"Send Email (",k.length,")"]})}),e.jsxs(G,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[e.jsx(se,{children:e.jsx(le,{children:"Send Email to Selected Suppliers"})}),e.jsxs("div",{className:"grid gap-4 ",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2 text-sm font-medium",children:"Selected Suppliers"}),e.jsx("div",{className:"p-2 border rounded-lg max-h-[100px] overflow-y-auto",children:n})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2 text-sm font-medium",children:"Selected Chemicals"}),e.jsx("div",{className:"p-2 border rounded-lg max-h-[100px] overflow-y-auto",children:e.jsx("div",{className:"text-sm py-1",children:f})})]})]}),e.jsxs(ie,{onValueChange:_,children:[e.jsx(ne,{children:e.jsx(oe,{placeholder:"Select email template"})}),e.jsx(ce,{children:E?e.jsx(P,{value:"",disabled:!0,children:"Loading..."}):v?e.jsx(P,{value:"",disabled:!0,children:"Error loading templates"}):t.map(u=>e.jsx(P,{value:u._id,children:u.name},u._id))})]}),e.jsx(H,{placeholder:"Subject",value:w,onChange:u=>N(u.target.value)}),e.jsx("div",{className:"max-h-[300px] overflow-y-auto",children:e.jsx(Oe,{value:h,onChange:C,placeholder:"Write your message here...",theme:"snow",className:"bg-white rounded-lg"})}),e.jsx(p,{className:"bg-[#3b1f91] hover:bg-purple-700",onClick:A,disabled:d,children:d?"Sending...":"Send Email"})]})]})]})})},K=({refetch:k,open:m,onClose:g,chemicalName:x,fetchChemicals:i,chemicalId:f,supplier:h,onAddSupplier:C=[]})=>{const[w,N]=l.useState(""),[d,y]=l.useState(null);l.useEffect(()=>{m&&(N(""),y(null))},[m]);const[j,{isLoading:D}]=h==="Supplier"?Ae():Le(),T=Array.isArray(C)?C.filter(t=>{var n;return(n=t.name)==null?void 0:n.toLowerCase().includes(w.toLowerCase())}):[],E=async()=>{if(!d){console.log("No supplier or customer selected");return}try{let t;h==="Supplier"?t=await j({chemical_ids:[x._id],supplierId:d._id}).unwrap():t=await j({chemicalId:[x._id],customerId:d._id}).unwrap(),console.log(`${h} ${d.name} added to ${x.name}`),await k(),i(),g()}catch(t){console.error(`Failed to add ${h.toLowerCase()}:`,t),alert(`Failed to add ${h.toLowerCase()}. Please try again.`)}},v=t=>{y(t),N(t.name)};return e.jsx(Q,{open:m,onOpenChange:t=>!t&&g(),children:e.jsxs(G,{className:"max-w-lg p-6",children:[e.jsx(se,{children:e.jsxs(le,{className:"text-lg font-semibold text-[#3b1f91]",children:["Add ",h," for ",x.name]})}),e.jsxs("div",{className:"mt-4",children:[e.jsx(H,{placeholder:`Search ${h}`,value:w,onChange:t=>N(t.target.value),className:"w-full mb-2"}),w&&!d&&e.jsx("div",{className:"bg-white border border-gray-300 rounded shadow max-h-40 overflow-y-auto",children:T.length>0?T.map(t=>e.jsx("div",{onClick:()=>v(t),className:"p-2 cursor-pointer hover:bg-gray-100",children:t.name},t.id)):e.jsxs("div",{className:"p-2 text-gray-500",children:["No matching ",h.toLowerCase(),"s"]})}),e.jsxs("div",{className:"flex justify-between mt-4",children:[e.jsx(p,{onClick:E,className:"bg-[#3b1f91] hover:bg-purple-700",disabled:D||!d,children:D?"Adding...":"+ Add"}),e.jsx(p,{onClick:g,className:"bg-red-600 hover:bg-red-700",children:"Cancel"})]})]})]})})};function ss({chemicalName:k,supplier:m,fetchChemicals:g,chemicalId:x}){console.log(x);const[i,f]=l.useState([]),[h,C]=l.useState(!1),[w,N]=l.useState(""),[d,y]=l.useState(""),[j,D]=l.useState(""),[T,E]=l.useState(""),[v,t]=l.useState(null),{selectedItem:n}=l.useContext(ae),{data:A=[],isLoading:_,error:S,refetch:M}=Te(x),{data:u}=te(),[a,{isLoading:b}]=Fe(),z=A.filter(r=>r.name.toLowerCase().includes(w.toLowerCase())&&r.email.toLowerCase().includes(d.toLowerCase())&&r.mobile.toLowerCase().includes(j.toLowerCase())&&r.country.toLowerCase().includes(T.toLowerCase())),X=r=>{f(F=>F.includes(r)?F.filter(I=>I!==r):[...F,r])},U=r=>{t(r)},V=async()=>{if(v)try{await a({supplierId:v,chemicalId:x}).unwrap(),M()}catch(r){console.error("Failed to delete chemical:",r),alert("Failed to delete chemical")}t(null)};return e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h1",{className:"text-xl font-semibold text-[#3b1f91]",children:[m," for ",(n==null?void 0:n.name)||"Chemical"]}),e.jsxs(p,{className:"bg-[#3b1f91] hover:bg-purple-700",onClick:()=>C(!0),children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Add Supplier"]}),k&&e.jsx(K,{open:h,onClose:()=>C(!1),chemicalName:n||"Unknown Chemical",supplier:"Supplier",onAddSupplier:u,chemicalId:x,refetch:M,fetchChemicals:g})]}),i.length>0&&e.jsx("div",{className:"p-4 border-b",children:e.jsx(he,{selectedSupplier:i,supplier:A,email:A.filter(r=>i.includes(r._id)).map(r=>r.email).join(", "),name:A.filter(r=>i.includes(r._id)).map(r=>r.name).join(", "),chemicalName:n==null?void 0:n.name})}),e.jsxs(q,{children:[e.jsx(Y,{children:e.jsxs(L,{children:[e.jsx(o,{className:"w-12"}),e.jsx(o,{children:"Name"}),e.jsx(o,{children:"Email"}),e.jsx(o,{children:"Mobile"}),e.jsx(o,{children:"Action"})]})}),e.jsxs(J,{children:[_&&e.jsx(L,{children:e.jsx(c,{colSpan:6,className:"text-center py-8",children:"Loading suppliers..."})}),S&&e.jsx(L,{children:e.jsx(c,{colSpan:6,className:"text-center py-8 text-red-500/60",children:"No suppliers available."})}),!_&&!S&&z.map(r=>e.jsxs(L,{children:[e.jsx(c,{children:e.jsx(de,{checked:i.includes(r._id),onCheckedChange:()=>X(r._id)})}),e.jsx(c,{children:r.name}),e.jsx(c,{children:r.email}),e.jsx(c,{children:r.mobile}),e.jsx(c,{children:e.jsx(p,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-600",onClick:()=>U(r._id),disabled:b,children:e.jsx(W,{className:"w-4 h-4"})})})]},r._id))]})]}),e.jsx(Ge,{open:!!v,onOpenChange:()=>t(null),children:e.jsxs(He,{children:[e.jsxs(Ue,{children:[e.jsx(Ve,{children:"Are you sure?"}),e.jsx(qe,{children:"This action cannot be undone. This will permanently delete the supplier from this chemical."})]}),e.jsxs(Ye,{children:[e.jsx(Je,{children:"Cancel"}),e.jsx(We,{onClick:V,children:"Delete"})]})]})})]})}function ls({chemicalName:k,supplier:m}){const[g,x]=l.useState([]),{selectedItem:i}=l.useContext(ae),[f,h]=l.useState(!1),[C,w]=l.useState(""),[N,d]=l.useState(""),[y,j]=l.useState(""),[D,T]=l.useState(""),{data:E=[]}=re(),{data:v=[],isLoading:t,error:n,refetch:A}=ke(i._id),[_]=De(),S=v.filter(a=>a.name.toLowerCase().includes(C.toLowerCase())&&a.email.toLowerCase().includes(N.toLowerCase())&&a.mobile.toLowerCase().includes(y.toLowerCase())&&a.country.toLowerCase().includes(D.toLowerCase())),M=a=>{x(b=>b.includes(a)?b.filter(z=>z!==a):[...b,a])};console.log(g);const u=async a=>{try{await _({customerId:a,chemicalId:i._id})}catch(b){console.error("Failed to remove customer:",b)}};return e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h1",{className:"text-xl font-semibold text-[#3b1f91]",children:[m," for ",i.name]}),e.jsxs(p,{className:"bg-[#3b1f91] hover:bg-purple-700",onClick:()=>h(!0),children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Add Customer"]})]}),e.jsx(K,{open:f,onClose:()=>h(!1),chemicalName:i,supplier:"Customer",onAddSupplier:E,refetch:A}),g.length>0&&e.jsx("div",{className:"p-4 border-b",children:e.jsx(he,{selectedSupplier:g,supplier:v,chemicalName:k.name,type:m})}),e.jsxs("div",{className:"border rounded-lg",children:[e.jsxs(q,{children:[e.jsx(Y,{children:e.jsxs(L,{children:[e.jsx(o,{className:"w-12"}),e.jsx(o,{children:"Name"}),e.jsx(o,{children:"Email"}),e.jsx(o,{children:"Mobile"}),e.jsx(o,{children:"Country"}),e.jsx(o,{children:"Action"})]})}),e.jsxs(J,{children:[t&&e.jsx(L,{children:e.jsx(c,{colSpan:6,className:"text-center py-8",children:"Loading customers..."})}),n&&e.jsx(L,{children:e.jsx(c,{colSpan:6,className:"text-center py-8 text-red-500",children:"Error loading customers."})}),!t&&!n&&S.length===0&&e.jsx(L,{children:e.jsx(c,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No Data Found"})}),!t&&!n&&S.map(a=>e.jsxs(L,{children:[e.jsx(c,{children:e.jsx(de,{checked:g.includes(a.id),onCheckedChange:()=>M(a.id)})}),e.jsx(c,{children:a.name}),e.jsx(c,{children:a.email}),e.jsx(c,{children:a.mobile}),e.jsx(c,{children:a.country}),e.jsx(c,{children:e.jsx(p,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-600",onClick:()=>u(a._id),children:e.jsx(W,{className:"w-4 h-4"})})})]},a.id))]})]}),e.jsxs("div",{className:"flex items-center justify-between border-t p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{children:"Items per page: 10"}),e.jsxs("span",{children:["1 - ",S.length," of ",S.length]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{variant:"outline",size:"icon",disabled:!0,children:e.jsx(Ke,{className:"w-4 h-4"})}),e.jsx(p,{variant:"outline",size:"icon",disabled:!0,children:e.jsx(Xe,{className:"w-4 h-4"})})]})]})]})]})}function As(){Ee();const[k,m]=l.useState(!1),[g,x]=l.useState(!1),[i,f]=l.useState(null),[h,C]=l.useState(""),[w,N]=l.useState(""),[d,y]=l.useState(1),[j,D]=l.useState(20),[T,E]=l.useState(!1);l.useState(null);const[v,t]=l.useState(!1),[n,A]=l.useState(null),[_,S]=l.useState([]),{data:M=[],isLoading:u,error:a}=te(),{data:b=[],isLoading2:z,error2:X}=re();Me(i==null?void 0:i._id);const U=Ie(),[V,r]=l.useState(0);l.useEffect(()=>{F()},[V]);const F=async()=>{try{const s=await Z.get("/api/chemical/get");S(s.data)}catch(s){console.error("Error fetching chemicals:",s)}},I=_.filter(s=>{const B=s.name||"",$=s.casNumber||"";return B.toLowerCase().includes(h.toLowerCase())&&$.includes(w)}),ue=I.slice((d-1)*j,d*j),xe=()=>{d*j<I.length&&y(s=>s+1)},je=()=>{d>1&&y(s=>s-1)},pe=s=>{D(Number(s)),y(1)},ge=s=>{console.log("Edit",s),U(`/edit-chemical-form/${s._id}`)},fe=s=>{f(s),E(!0),A("supplier")},Ce=s=>{f(s),t(!0),A("customer")},Se=async s=>{try{if((await R.fire({title:"Are you sure?",text:"This action cannot be undone!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed){const $=await Z.delete(`/api/chemical/delete?id=${s._id}`);if($.data.success||$.data.message==="Chemical deleted successfully")S(be=>be.filter(we=>we._id!==s._id)),await F(),await R.fire({title:"Deleted!",text:"The chemical has been deleted.",icon:"success",timer:2e3,showConfirmButton:!1});else throw new Error($.data.message||"Failed to delete the chemical")}else R.fire({title:"Cancelled",text:"Your chemical is safe!",icon:"info",timer:1500,showConfirmButton:!1})}catch(B){console.error("Error deleting chemical:",B),B.message==="Chemical deleted successfully"?R.fire({title:"Deleted!",text:"The chemical has been deleted.",icon:"success",timer:2e3,showConfirmButton:!1}):R.fire({title:"Error!",text:B.message||"An error occurred while deleting the chemical.",icon:"error",confirmButtonText:"Ok"})}};return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-5",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-lg font-bold text-[#3b1f91]",children:"Chemical List"})}),e.jsx("div",{children:e.jsx(Be,{to:"/chemical-form",children:e.jsxs(p,{className:"bg-[#3b1f91] hover:bg-[#2a1664]",children:[e.jsx(Ze,{})," Add Chemical"]})})})]}),e.jsx("div",{className:"mb-5",children:e.jsx("hr",{})}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(q,{children:[e.jsxs(Y,{children:[e.jsxs(L,{children:[e.jsx(o,{className:"w-[50px]"}),e.jsx(o,{children:"Name"}),e.jsx(o,{children:"CAS Number"}),e.jsx(o,{children:"Molecular Formula"}),e.jsx(o,{children:"Suppliers"}),e.jsx(o,{children:"Customers"}),e.jsx(o,{children:"Unit Name"})]}),e.jsxs(L,{children:[e.jsx(o,{className:"w-[50px]"}),e.jsx(o,{children:e.jsx(H,{placeholder:"Filter by Name",value:h,onChange:s=>C(s.target.value)})}),e.jsx(o,{children:e.jsx(H,{placeholder:"Filter by CAS Number",value:w,onChange:s=>N(s.target.value)})}),e.jsx(o,{}),e.jsx(o,{}),e.jsx(o,{}),e.jsx(o,{})]})]}),e.jsx(J,{children:ue.map(s=>e.jsxs(L,{children:[e.jsx(c,{children:e.jsxs($e,{children:[e.jsx(Re,{asChild:!0,children:e.jsx("button",{className:"p-3",children:e.jsx(es,{className:"h-4 w-4"})})}),e.jsxs(ze,{children:[e.jsxs(O,{onClick:()=>ge(s),children:[e.jsx(_e,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(O,{onClick:()=>fe(s),children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),"Add Supplier"]}),e.jsxs(O,{onClick:()=>Ce(s),children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),"Add Customer"]}),e.jsxs(O,{onClick:()=>Se(s),children:[e.jsx(W,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})}),e.jsx(c,{children:s.name}),e.jsx(c,{children:s.cas_number}),e.jsx(c,{children:s.molecular_formula}),e.jsx(c,{children:e.jsxs(p,{variant:"default",className:"bg-[#3b1f91] hover:bg-[#3b1f91]",onClick:()=>{f(s),m(!0)},children:["Suppliers (",s.supplierCount,")"]})}),e.jsx(c,{children:e.jsxs(p,{variant:"default",className:"bg-[#3b1f91] hover:bg-[#3b1f91]",onClick:()=>{f(s),x(!0)},children:["Customers(",s.customerCount,")"]})}),e.jsx(c,{children:s.unit})]},s.id))}),i&&e.jsx(K,{open:n==="supplier"?T:v,onClose:()=>{n==="supplier"?E(!1):t(!1),A(null),r(s=>s+1),F()},chemicalName:i.name,supplier:n==="supplier"?"Supplier":"Customer",onAddSupplier:n==="supplier"?M:b,chemicalId:i._id,fetchChemicals:F})]})}),e.jsxs("div",{className:"flex items-center justify-between space-x-2 py-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Items per page:"}),e.jsxs(ie,{defaultValue:j.toString(),onValueChange:pe,children:[e.jsx(ne,{className:"w-[70px]",children:e.jsx(oe,{placeholder:j.toString()})}),e.jsxs(ce,{children:[e.jsx(P,{value:"10",children:"10"}),e.jsx(P,{value:"20",children:"20"}),e.jsx(P,{value:"30",children:"30"}),e.jsx(P,{value:"40",children:"40"}),e.jsx(P,{value:"50",children:"50"})]})]}),e.jsx("div",{className:"text-sm font-medium",children:`${(d-1)*j+1} - ${Math.min(d*j,I.length)} of ${I.length}`})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(p,{variant:"outline",size:"icon",onClick:je,disabled:d===1,children:"<"}),e.jsx(p,{variant:"outline",size:"icon",onClick:xe,disabled:d*j>=I.length,children:">"})]})]}),e.jsx(Pe,{selectedItem:i,children:i&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{open:k,onOpenChange:m,children:e.jsx(G,{className:"max-w-6xl",children:e.jsx(ss,{chemicalName:i,chemicalId:i._id,supplier:"Supplier",fetchChemicals:F})})}),e.jsx(Q,{open:g,onOpenChange:x,children:e.jsx(G,{className:"max-w-6xl",children:e.jsx(ls,{selectedItems:i,supplier:"Customer",chemicalName:i,chemicalId:i._id,onUpdate:()=>{F(),r(s=>s+1)}})})})]})})]})}export{As as default};
