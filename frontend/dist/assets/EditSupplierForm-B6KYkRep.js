import{r as n,j as e}from"./react-DKICu8bO.js";import{c as k}from"./react-hook-form-BpvdonxZ.js";import{Q as z,aK as Q,I as p,T as E,B as W}from"./index-Bbo1zcj1.js";import{C as G,b as H,c as K,a as $}from"./card-D0ajdvoE.js";import{F as q,a as o,b as l,c,d,e as m}from"./form-CcwpV_gP.js";import{B as J}from"./BreadCrumb-P1oQ4p-m.js";import{S as F,a as I,b as L,c as D,d as U}from"./select-CnTZk46j.js";import{C as X,a as V}from"./country-state-city-BYZIyAdR.js";import{a as Y,b as Z}from"./react-router-B9QVkYva.js";import"./classnames-Bv6oJzD9.js";import"./react-dom-BBS6HuAW.js";import"./scheduler-CKyTKYc2.js";import"./react-redux-BrRfTdeB.js";import"./use-sync-external-store-D0ivhzzy.js";import"./@reduxjs-B5J9SSA5.js";import"./redux-DITMfSWq.js";import"./immer-fBqQtvEc.js";import"./redux-thunk-ClJT1hhx.js";import"./reselect-C27TLnWV.js";import"./js-cookie-Cz0CWeBA.js";import"./@radix-ui-BlrBCj0C.js";import"./aria-hidden-DQ5UC2Eg.js";import"./react-remove-scroll-fXbmorz6.js";import"./tslib-CDuPK5Eb.js";import"./react-remove-scroll-bar-C9fmXXva.js";import"./react-style-singleton-DKBZmuKg.js";import"./get-nonce-C-Z93AgS.js";import"./use-sidecar-C10EJNOT.js";import"./use-callback-ref-BoKxM4XI.js";import"./@floating-ui-8J-daYO3.js";import"./class-variance-authority-Dp3B9jqt.js";import"./clsx-B-dksMZM.js";import"./tailwind-merge-D696Ktp4.js";import"./lucide-D7hRWJEP.js";import"./axios-DXsv3KKR.js";import"./@syncfusion-BIAkhmGL.js";import"./cookie--_YQFYBD.js";const ee=()=>e.jsx("div",{className:"flex items-center justify-center p-4",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900"})}),re=[{label:"Dashboard",href:"/dashboard"},{label:"Supplier Table",href:"/supplier-table"},{label:"Edit Supplier Form",href:null}];function Ae(){const B=Y(),{id:j}=Z(),{data:i,isLoading:P}=z(j),[f]=Q(),[C,S]=n.useState(!1),[y,b]=n.useState(null),[N,v]=n.useState(null),[u,T]=n.useState([]),[M,R]=n.useState([]),[_,h]=n.useState(!0),s=k({defaultValues:{name:"",mobile:"",email:"",website:"",contact_person:"",address:"",country:"",city:"",description:"",image:null}});n.useEffect(()=>{(async()=>{h(!0);const t=V.getAllCountries();T(t),h(!1)})()},[]);const w=n.useCallback(r=>{h(!0);const t=X.getCitiesOfCountry(r)||[];R(t),s.setValue("city",""),h(!1)},[s]);n.useEffect(()=>{if(i&&(s.reset({name:i.name||"",mobile:i.mobile||"",email:i.email||"",website:i.website||"",contact_person:i.contact_person||"",address:i.address||"",country:i.country||"",city:i.city||"",description:i.description||""}),i.image&&v(`/api/image/download/${i.image}`),i.country)){const r=u.find(t=>t.name===i.country);r&&w(r.isoCode)}},[i,s,u]);async function A(r){var t;if(!j){b("No supplier ID found");return}S(!0),b(null);try{let a={...r};if(delete a.image,r.image&&r.image[0]){const x=new FormData;Object.keys(a).forEach(g=>{x.append(g,a[g])}),x.append("image",r.image[0]),await f({updatedSupplier:x,id:j}).unwrap()}else await f({updatedSupplier:a,id:j}).unwrap();B("/supplier-table")}catch(a){console.error("Error updating supplier:",a),b(((t=a.data)==null?void 0:t.message)||"Failed to update supplier. Please try again.")}finally{S(!1)}}const O=r=>{const t=r.target.files[0];t&&v(URL.createObjectURL(t)),s.setValue("image",r.target.files)};return n.useMemo(()=>V.getAllCountries(),[]),P||_?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"ml-1",children:e.jsx(J,{items:re})}),e.jsxs(G,{className:"max-w-8xl mt-3 mx-auto",children:[e.jsx(H,{children:e.jsx(K,{className:"text-xl font-semibold",children:"Update Supplier"})}),e.jsxs($,{children:[y&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:y}),e.jsx(q,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(A),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsx(o,{control:s.control,name:"name",render:({field:r})=>e.jsxs(l,{children:[e.jsxs(c,{children:["Supplier Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{children:e.jsx(p,{placeholder:"Enter supplier name",...r})}),e.jsx(m,{})]})}),e.jsx(o,{control:s.control,name:"contact_person",render:({field:r})=>e.jsxs(l,{children:[e.jsx(c,{children:"Contact Person"}),e.jsx(d,{children:e.jsx(p,{placeholder:"Enter contact person",...r})}),e.jsx(m,{})]})}),e.jsx(o,{control:s.control,name:"email",render:({field:r})=>e.jsxs(l,{children:[e.jsxs(c,{children:["Email ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{children:e.jsx(p,{placeholder:"Enter email address",...r})}),e.jsx(m,{})]})}),e.jsx(o,{control:s.control,name:"website",render:({field:r})=>e.jsxs(l,{children:[e.jsx(c,{children:"Website"}),e.jsx(d,{children:e.jsx(p,{placeholder:"Enter website URL",...r})}),e.jsx(m,{})]})}),e.jsx(o,{control:s.control,name:"mobile",render:({field:r})=>e.jsxs(l,{children:[e.jsxs(c,{children:["Mobile Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(d,{children:e.jsx(p,{placeholder:"Enter mobile number",...r})}),e.jsx(m,{})]})})]}),e.jsx(o,{control:s.control,name:"address",render:({field:r})=>e.jsxs(l,{children:[e.jsx(c,{children:"Address"}),e.jsx(d,{children:e.jsx(E,{placeholder:"Enter address",...r})}),e.jsx(m,{})]})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsx(o,{control:s.control,name:"country",render:({field:r})=>{var t;return e.jsxs(l,{children:[e.jsx(c,{children:"Country"}),e.jsxs(F,{onValueChange:a=>{const x=u.find(g=>g.isoCode===a);r.onChange(x.name),w(a)},value:((t=u.find(a=>a.name===r.value))==null?void 0:t.isoCode)||"",children:[e.jsx(d,{children:e.jsx(I,{children:e.jsx(L,{placeholder:"Select country"})})}),e.jsx(n.Suspense,{fallback:e.jsx(ee,{}),children:e.jsx(D,{children:u.map(a=>e.jsx(U,{value:a.isoCode,children:a.name},a.isoCode))})})]}),e.jsx(m,{})]})}}),e.jsx(o,{control:s.control,name:"city",render:({field:r})=>e.jsxs(l,{children:[e.jsx(c,{children:"City"}),e.jsxs(F,{onValueChange:r.onChange,value:r.value||"",disabled:!s.watch("country"),children:[e.jsx(d,{children:e.jsx(I,{children:e.jsx(L,{placeholder:"Select city"})})}),e.jsx(D,{children:M.map(t=>e.jsx(U,{value:t.name,children:t.name},t.name))})]}),e.jsx(m,{})]})})]}),e.jsx(o,{control:s.control,name:"description",render:({field:r})=>e.jsxs(l,{children:[e.jsx(c,{children:"Description"}),e.jsx(d,{children:e.jsx(E,{placeholder:"Enter description",...r})}),e.jsx(m,{})]})}),e.jsx(o,{control:s.control,name:"image",render:({field:r})=>e.jsxs(l,{children:[e.jsx(c,{children:"Upload Image"}),e.jsx(d,{children:e.jsx(p,{type:"file",onChange:O,accept:"image/*"})}),e.jsx(m,{}),N&&e.jsx("div",{className:"mt-4",children:e.jsx("img",{src:N,alt:"Preview",className:"h-32 w-32 object-cover border"})})]})}),e.jsx("div",{className:"flex gap-4",children:e.jsx(W,{type:"submit",className:"bg-green-500 hover:bg-green-600",disabled:C,children:C?"Saving...":"Save Changes"})})]})})]})]})]})}export{Ae as default};
