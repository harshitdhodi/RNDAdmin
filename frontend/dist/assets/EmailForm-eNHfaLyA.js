import{r,j as e}from"./react-DKICu8bO.js";import{c as X}from"./react-hook-form-BpvdonxZ.js";import{t as H}from"./@hookform-DUkwi3xb.js";import{o as J,s as m,a as K,b as O}from"./zod-B_haSLVu.js";import{ac as W,g as Y,am as Z,I as b,B as N}from"./index-Bbo1zcj1.js";import{S as F,a as T,b as _,c as L,d as c}from"./select-CnTZk46j.js";import{C as $,a as ee}from"./card-D0ajdvoE.js";import{R as te}from"./react-quill-BTfuOY7l.js";import{X as B,G as ae}from"./lucide-D7hRWJEP.js";import"./classnames-Bv6oJzD9.js";import"./react-dom-BBS6HuAW.js";import"./scheduler-CKyTKYc2.js";import"./react-redux-BrRfTdeB.js";import"./use-sync-external-store-D0ivhzzy.js";import"./@reduxjs-B5J9SSA5.js";import"./redux-DITMfSWq.js";import"./immer-fBqQtvEc.js";import"./redux-thunk-ClJT1hhx.js";import"./reselect-C27TLnWV.js";import"./js-cookie-Cz0CWeBA.js";import"./react-router-B9QVkYva.js";import"./cookie--_YQFYBD.js";import"./@radix-ui-BlrBCj0C.js";import"./aria-hidden-DQ5UC2Eg.js";import"./react-remove-scroll-fXbmorz6.js";import"./tslib-CDuPK5Eb.js";import"./react-remove-scroll-bar-C9fmXXva.js";import"./react-style-singleton-DKBZmuKg.js";import"./get-nonce-C-Z93AgS.js";import"./use-sidecar-C10EJNOT.js";import"./use-callback-ref-BoKxM4XI.js";import"./@floating-ui-8J-daYO3.js";import"./class-variance-authority-Dp3B9jqt.js";import"./clsx-B-dksMZM.js";import"./tailwind-merge-D696Ktp4.js";import"./axios-DXsv3KKR.js";import"./@syncfusion-BIAkhmGL.js";import"./lodash-BLBAyiDt.js";import"./quill-BGoone1_.js";const se=J({category:m().min(1,"Please select a category"),template:m().min(1,"Please select a template"),email:m().min(1,"To field is required").email("Invalid email format"),cc_email:K(m()).optional(),subject:m().min(1,"Subject is required"),body:m().min(1,"Body is required"),attachment:O().optional()});function Me({defaultTo:h="",onSuccess:x}){const[v,C]=r.useState(!1),{data:u,isLoading:I}=W(),{data:l,isLoading:A}=Y(),[P,{isLoading:S}]=Z(),[n,j]=r.useState(null),[p,g]=r.useState([]),[E,R]=r.useState([]);console.log(l.data);const{register:w,handleSubmit:V,formState:{errors:s},reset:k,watch:f,setValue:i}=X({resolver:H(se)}),o=f("category"),y=f("template"),q=f("body");r.useEffect(()=>{if(y&&(l!=null&&l.data)){const t=l.data.find(a=>a._id===y);t&&(i("subject",t.subject),i("body",t.body))}},[y,l,i]),r.useEffect(()=>{h&&i("email",h)},[h,i]);const z=t=>{const a=t.target.files[0];j(a)},D=()=>{j(null)},G=t=>{t&&!p.includes(t)&&g(a=>[...a,t])},Q=t=>{g(a=>a.filter((d,U)=>U!==t))},M=async t=>{const a=new FormData;a.append("email",t.email),a.append("cc_email",p),a.append("subject",t.subject),a.append("body",t.body),n&&a.append("attachment",n),C(!0);try{await P(a).unwrap(),alert("Email sent successfully!"),k(),j(null),g([]),x==null||x()}catch(d){console.error("Error sending email:",d),alert("Failed to send email. Please try again.")}finally{C(!1)}};return r.useEffect(()=>{if(o&&(l!=null&&l.data)){const t=l.data.filter(a=>{var d;return((d=a.category)==null?void 0:d.emailCategory)===o});R(t),i("template","")}},[o,l,i]),e.jsx($,{className:"w-full mx-auto max-h-[80vh] flex flex-col",children:e.jsx(ee,{className:"p-6 overflow-y-auto",children:e.jsxs("form",{onSubmit:V(M),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"category",className:"text-sm font-medium",children:"Select Category"}),e.jsxs(F,{onValueChange:t=>i("category",t),children:[e.jsx(T,{id:"category",children:e.jsx(_,{placeholder:"Select Category"})}),e.jsx(L,{children:I?e.jsx(c,{disabled:!0,children:"Loading categories..."}):u&&u.length>0?u.map(t=>e.jsx(c,{value:t.emailCategory,children:t.emailCategory},t._id)):e.jsx(c,{disabled:!0,children:"No categories available"})})]}),s.category&&e.jsx("p",{className:"text-sm text-red-500",children:s.category.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"template",className:"text-sm font-medium",children:"Select Email Template"}),e.jsxs(F,{onValueChange:t=>i("template",t),disabled:!o,children:[e.jsx(T,{id:"template",children:e.jsx(_,{placeholder:o?"Select Email Template":"Please select a category first"})}),e.jsx(L,{children:A?e.jsx(c,{disabled:!0,children:"Loading templates..."}):E.length===0?e.jsx(c,{disabled:!0,children:"No templates in this category"}):E.map(t=>e.jsx(c,{value:t._id,children:t.name},t._id))})]}),s.template&&e.jsx("p",{className:"text-sm text-red-500",children:s.template.message})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"email",className:"text-sm font-medium",children:"To*"}),e.jsx(b,{id:"email",type:"text",placeholder:"Recipient email",...w("email"),"aria-invalid":s.email?"true":"false"}),s.email&&e.jsx("p",{className:"text-sm text-red-500",children:s.email.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"cc_email",className:"text-sm font-medium",children:"CC"}),e.jsxs("div",{className:"relative",children:[e.jsx(b,{id:"cc_email",type:"text",placeholder:"Enter CC email",onBlur:t=>{G(t.target.value),t.target.value=""}}),p.length>0&&e.jsx("div",{className:"absolute top-full mt-1 z-10 bg-white border rounded-md p-2 w-full shadow-sm",children:p.map((t,a)=>e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsx("span",{className:"text-sm",children:t}),e.jsx(N,{type:"button",variant:"ghost",size:"sm",onClick:()=>Q(a),children:e.jsx(B,{className:"h-3 w-3"})})]},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"subject",className:"text-sm font-medium",children:"Subject*"}),e.jsx(b,{id:"subject",type:"text",placeholder:"Subject",...w("subject"),"aria-invalid":s.subject?"true":"false"}),s.subject&&e.jsx("p",{className:"text-sm text-red-500",children:s.subject.message})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"body",className:"text-sm font-medium",children:"Body*"}),e.jsx(te,{value:q||"",onChange:t=>i("body",t),className:"bg-white"}),s.body&&e.jsx("p",{className:"text-sm text-red-500",children:s.body.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"file-upload",className:"text-sm font-medium",children:"Attachments"}),e.jsxs("div",{className:"border-2 border-dashed rounded-lg p-6 text-center",children:[e.jsx("input",{type:"file",onChange:z,className:"hidden",id:"file-upload"}),e.jsxs("label",{htmlFor:"file-upload",className:"cursor-pointer",children:[e.jsx(ae,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Drag and drop files here or click to browse"})]})]}),n&&e.jsx("div",{className:"mt-2",children:e.jsxs("div",{className:"flex items-center justify-between bg-gray-100 p-2 rounded",children:[e.jsx("span",{className:"text-sm truncate",children:n.name}),e.jsx(N,{type:"button",variant:"ghost",size:"sm",onClick:D,children:e.jsx(B,{className:"h-4 w-4"})})]})})]}),e.jsx(N,{type:"submit",className:"w-full",disabled:v||S,children:v||S?"Sending...":"Send Email"})]})})})}export{Me as default};
