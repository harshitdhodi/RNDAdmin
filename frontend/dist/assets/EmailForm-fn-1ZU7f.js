import{i as H,b2 as X,k as J,bc as K,j as e,I as f,B as N,X as F}from"./main-Dqjs8KFu.js";import{c as r}from"./vendor-DNXw0_ws.js";import{b as O}from"./index.esm-D3l3UFIY.js";import{o as W,s as c,a as Y,b as Z,t as $}from"./index-DxUJh4X-.js";import{S as T,a as _,b as L,c as k,d as m}from"./select-5TNptwF3.js";import{C as ee,a as ae}from"./card-OAwBx9GD.js";/* empty css                   */import{R as se}from"./index-CZ4jclvw.js";import"./Combination-B3ZBIzZt.js";import"./index-Uuqq7LOu.js";import"./chevron-up-D4Ahgufn.js";import"./check-DzXQN_fY.js";import"./isEqual-SRXYztYb.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=H("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),le=W({category:c().min(1,"Please select a category"),template:c().min(1,"Please select a template"),email:c().min(1,"To field is required").email("Invalid email format"),cc_email:Y(c()).optional(),subject:c().min(1,"Subject is required"),body:c().min(1,"Body is required"),attachment:Z().optional()});function ye({defaultTo:h="",onSuccess:x}){const[v,C]=r.useState(!1),{data:u,isLoading:I}=X(),{data:l,isLoading:B}=J(),[A,{isLoading:S}]=K(),[o,j]=r.useState(null),[p,g]=r.useState([]),[E,P]=r.useState([]);console.log(l.data);const{register:w,handleSubmit:R,formState:{errors:t},reset:V,watch:y,setValue:i}=O({resolver:$(le)}),d=y("category"),b=y("template"),q=y("body");r.useEffect(()=>{if(b&&(l!=null&&l.data)){const a=l.data.find(s=>s._id===b);a&&(i("subject",a.subject),i("body",a.body))}},[b,l,i]),r.useEffect(()=>{h&&i("email",h)},[h,i]);const z=a=>{const s=a.target.files[0];j(s)},D=()=>{j(null)},Q=a=>{a&&!p.includes(a)&&g(s=>[...s,a])},G=a=>{g(s=>s.filter((n,U)=>U!==a))},M=async a=>{const s=new FormData;s.append("email",a.email),s.append("cc_email",p),s.append("subject",a.subject),s.append("body",a.body),o&&s.append("attachment",o),C(!0);try{await A(s).unwrap(),alert("Email sent successfully!"),V(),j(null),g([]),x==null||x()}catch(n){console.error("Error sending email:",n),alert("Failed to send email. Please try again.")}finally{C(!1)}};return r.useEffect(()=>{if(d&&(l!=null&&l.data)){const a=l.data.filter(s=>{var n;return((n=s.category)==null?void 0:n.emailCategory)===d});P(a),i("template","")}},[d,l,i]),e.jsx(ee,{className:"w-full mx-auto max-h-[80vh] flex flex-col",children:e.jsx(ae,{className:"p-6 overflow-y-auto",children:e.jsxs("form",{onSubmit:R(M),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"category",className:"text-sm font-medium",children:"Select Category"}),e.jsxs(T,{onValueChange:a=>i("category",a),children:[e.jsx(_,{id:"category",children:e.jsx(L,{placeholder:"Select Category"})}),e.jsx(k,{children:I?e.jsx(m,{disabled:!0,children:"Loading categories..."}):u&&u.length>0?u.map(a=>e.jsx(m,{value:a.emailCategory,children:a.emailCategory},a._id)):e.jsx(m,{disabled:!0,children:"No categories available"})})]}),t.category&&e.jsx("p",{className:"text-sm text-red-500",children:t.category.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"template",className:"text-sm font-medium",children:"Select Email Template"}),e.jsxs(T,{onValueChange:a=>i("template",a),disabled:!d,children:[e.jsx(_,{id:"template",children:e.jsx(L,{placeholder:d?"Select Email Template":"Please select a category first"})}),e.jsx(k,{children:B?e.jsx(m,{disabled:!0,children:"Loading templates..."}):E.length===0?e.jsx(m,{disabled:!0,children:"No templates in this category"}):E.map(a=>e.jsx(m,{value:a._id,children:a.name},a._id))})]}),t.template&&e.jsx("p",{className:"text-sm text-red-500",children:t.template.message})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"email",className:"text-sm font-medium",children:"To*"}),e.jsx(f,{id:"email",type:"text",placeholder:"Recipient email",...w("email"),"aria-invalid":t.email?"true":"false"}),t.email&&e.jsx("p",{className:"text-sm text-red-500",children:t.email.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"cc_email",className:"text-sm font-medium",children:"CC"}),e.jsxs("div",{className:"relative",children:[e.jsx(f,{id:"cc_email",type:"text",placeholder:"Enter CC email",onBlur:a=>{Q(a.target.value),a.target.value=""}}),p.length>0&&e.jsx("div",{className:"absolute top-full mt-1 z-10 bg-white border rounded-md p-2 w-full shadow-sm",children:p.map((a,s)=>e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsx("span",{className:"text-sm",children:a}),e.jsx(N,{type:"button",variant:"ghost",size:"sm",onClick:()=>G(s),children:e.jsx(F,{className:"h-3 w-3"})})]},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"subject",className:"text-sm font-medium",children:"Subject*"}),e.jsx(f,{id:"subject",type:"text",placeholder:"Subject",...w("subject"),"aria-invalid":t.subject?"true":"false"}),t.subject&&e.jsx("p",{className:"text-sm text-red-500",children:t.subject.message})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"body",className:"text-sm font-medium",children:"Body*"}),e.jsx(se,{value:q||"",onChange:a=>i("body",a),className:"bg-white"}),t.body&&e.jsx("p",{className:"text-sm text-red-500",children:t.body.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"file-upload",className:"text-sm font-medium",children:"Attachments"}),e.jsxs("div",{className:"border-2 border-dashed rounded-lg p-6 text-center",children:[e.jsx("input",{type:"file",onChange:z,className:"hidden",id:"file-upload"}),e.jsxs("label",{htmlFor:"file-upload",className:"cursor-pointer",children:[e.jsx(te,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Drag and drop files here or click to browse"})]})]}),o&&e.jsx("div",{className:"mt-2",children:e.jsxs("div",{className:"flex items-center justify-between bg-gray-100 p-2 rounded",children:[e.jsx("span",{className:"text-sm truncate",children:o.name}),e.jsx(N,{type:"button",variant:"ghost",size:"sm",onClick:D,children:e.jsx(F,{className:"h-4 w-4"})})]})})]}),e.jsx(N,{type:"submit",className:"w-full",disabled:v||S,children:v||S?"Sending...":"Send Email"})]})})})}export{ye as default};
