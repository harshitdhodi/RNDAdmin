import{r as l,j as e,a as U}from"./react-DKICu8bO.js";import{F as X,l as Y,D as z,i as R,j as W,k as K,I as Z,B as S,K as ee,p as se,o as $,M as ae}from"./index-Bbo1zcj1.js";import{T as H,a as Q,b as T,c as u,d as G,e as i}from"./table-nX7BFFdz.js";import{A as le,a as re,b as te,c as ie,d as ne,e as ce,f as oe,g as de}from"./alert-dialog-D3FD_J_w.js";import{j as he,E as me,h as xe}from"./lucide-D7hRWJEP.js";import{B as ue}from"./badge-DMbiZYSq.js";import{D as pe,a as je,b as ge,c as B}from"./dropdown-menu-D0AUj5Dk.js";import{a as be,L as fe}from"./react-router-B9QVkYva.js";import{B as Ce}from"./BreadCrumb-P1oQ4p-m.js";import"./classnames-Bv6oJzD9.js";import"./react-dom-BBS6HuAW.js";import"./scheduler-CKyTKYc2.js";import"./react-redux-BrRfTdeB.js";import"./use-sync-external-store-D0ivhzzy.js";import"./@reduxjs-B5J9SSA5.js";import"./redux-DITMfSWq.js";import"./immer-fBqQtvEc.js";import"./redux-thunk-ClJT1hhx.js";import"./reselect-C27TLnWV.js";import"./js-cookie-Cz0CWeBA.js";import"./@radix-ui-BlrBCj0C.js";import"./aria-hidden-DQ5UC2Eg.js";import"./react-remove-scroll-fXbmorz6.js";import"./tslib-CDuPK5Eb.js";import"./react-remove-scroll-bar-C9fmXXva.js";import"./react-style-singleton-DKBZmuKg.js";import"./get-nonce-C-Z93AgS.js";import"./use-sidecar-C10EJNOT.js";import"./use-callback-ref-BoKxM4XI.js";import"./@floating-ui-8J-daYO3.js";import"./class-variance-authority-Dp3B9jqt.js";import"./clsx-B-dksMZM.js";import"./tailwind-merge-D696Ktp4.js";import"./axios-DXsv3KKR.js";import"./@syncfusion-BIAkhmGL.js";import"./cookie--_YQFYBD.js";const V=({open:p,onClose:o,chemicalName:v,supplier:n,supplierId:r,refetch:c,allData:b})=>{const[m,j]=l.useState(""),[d,f]=l.useState([]),{data:t,isLoading:D,error:k}=X(m,{skip:!m||m.length<2}),[y,{isLoading:A}]=Y(),C=async()=>{const a=d.map(h=>h._id);try{await y({supplierId:r,chemical_ids:a}).unwrap(),await c(),o(),b()}catch(h){console.error("Error adding chemicals:",h)}},N=a=>{f(h=>{const P=[...h,a];return j(""),P})},x=a=>{f(h=>h.filter(P=>P._id!==a))};return e.jsx(z,{open:p,onOpenChange:a=>!a&&o(),children:e.jsxs(R,{className:"max-w-lg p-6",children:[e.jsx(W,{children:e.jsxs(K,{className:"text-lg font-semibold text-[#3b1f91]",children:["Add Chemicals for ",n]})}),e.jsxs("div",{className:"mt-4",children:[e.jsx(Z,{placeholder:`Search ${n}`,value:m,onChange:a=>j(a.target.value),className:"w-full mb-4"}),D?e.jsx("div",{children:"Loading..."}):m&&t&&t.length>0&&e.jsx("ul",{className:"border bg-white rounded max-h-40 overflow-y-auto",children:t.map(a=>e.jsx("li",{onClick:()=>N(a),className:"p-2 hover:bg-gray-200 cursor-pointer",children:a.name},a._id))}),(t==null?void 0:t.length)===0&&!D&&m&&e.jsx("div",{className:"p-2 text-gray-500",children:"No chemicals found"}),e.jsx("div",{className:"mt-4",children:d.length>0&&e.jsx("div",{className:"space-y-2",children:d.map(a=>e.jsxs("div",{className:"flex justify-between items-center bg-gray-100 p-2 rounded",children:[e.jsx("span",{children:a.name}),e.jsx(S,{variant:"outline",size:"sm",onClick:()=>x(a._id),className:"text-red-500",children:"Remove"})]},a._id))})}),e.jsxs("div",{className:"flex justify-between mt-4",children:[e.jsx(S,{onClick:C,className:"bg-[#3b1f91] hover:bg-purple-700",disabled:A||d.length===0,children:A?"Adding...":"+ Add"}),e.jsx(S,{onClick:o,className:"bg-red-600 hover:bg-red-700",children:"Cancel"})]})]})]})})};function q({supplier:p,supplierName:o,allData:v}){const[n,r]=l.useState(10),[c,b]=l.useState(1),[m,j]=l.useState(1),[d,f]=l.useState(!1),[t,D]=l.useState(null),[k,y]=l.useState(null),[A,C]=l.useState(!1),[N,x]=l.useState(null),{data:a,isLoading:h,isError:P,refetch:M}=ee(p,{skip:(c-1)*n,limit:n}),[_,{isLoading:I}]=se();l.useEffect(()=>{a&&j(Math.ceil(a.chemicals.length/n))},[a,n]);const F=g=>{D(g),f(!0),y("supplier")},E=()=>{c>1&&b(c-1)},O=()=>{c<m&&b(c+1)},s=g=>{x(g),C(!0)},w=async()=>{try{await _({supplierId:p,chemicalId:N._id}).unwrap(),M()}catch(g){console.error("Error deleting chemical:",g)}finally{C(!1),x(null)}};if(h)return e.jsx("div",{children:"Loading..."});if(P)return e.jsx("div",{children:"Error loading chemicals"});const L=Array.isArray(a==null?void 0:a.chemicals)?a.chemicals:[];return e.jsxs("div",{className:"w-full overflow-auto",children:[e.jsx(W,{children:e.jsxs("div",{className:"flex justify-between items-center mr-5",children:[e.jsxs(K,{children:["Chemicals for ",o]}),e.jsx(S,{onClick:()=>F(L),className:"bg-purple-600 hover:bg-purple-700",children:"+ Add Chemical"})]})}),e.jsx("div",{className:"mt-5 ",children:e.jsxs(H,{children:[e.jsx(Q,{children:e.jsxs(T,{children:[e.jsx(u,{className:"p-2",children:"Name"}),e.jsx(u,{className:"p-2",children:"CAS Number"}),e.jsx(u,{className:"p-2 w-[100px]",children:"Action"})]})}),e.jsx(G,{children:L.map((g,J)=>e.jsxs(T,{className:"p-2",children:[e.jsx(i,{className:"px-2 py-1",children:g.name}),e.jsx(i,{className:"px-2 py-1",children:g.cas_number}),e.jsx(i,{className:"px-2 py-1",children:e.jsx(S,{variant:"ghost",size:"icon",className:"text-red-500",onClick:()=>s(g),disabled:I,children:I?"Deleting...":e.jsx(he,{className:"h-4 w-4"})})})]},J))})]})}),d&&t&&e.jsx(V,{open:d,onClose:()=>f(!1),chemicalName:t.name,supplier:o,supplierId:p,refetch:M,allData:v}),e.jsx(le,{open:A,onOpenChange:C,children:e.jsxs(re,{children:[e.jsxs(te,{children:[e.jsx(ie,{children:"Are you sure?"}),e.jsxs(ne,{children:["This action cannot be undone. This will permanently delete the chemical",N&&` "${N.name}"`," from this supplier."]})]}),e.jsxs(ce,{children:[e.jsx(oe,{children:"Cancel"}),e.jsx(de,{onClick:w,className:"bg-red-500 hover:bg-red-600",children:"Delete"})]})]})}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"Items per page:"}),e.jsxs("select",{className:"border p-1 rounded",value:n,onChange:g=>r(Number(g.target.value)),children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{variant:"outline",size:"sm",onClick:E,disabled:c===1,children:"Previous"}),e.jsxs("span",{children:[c," of ",m]}),e.jsx(S,{variant:"outline",size:"sm",onClick:O,disabled:c===m,children:"Next"})]})]})]})}const Ne=()=>{const{data:p=[],isLoading:o,error:v}=$(),[n,r]=l.useState(1),[c,b]=l.useState(10),[m,j]=l.useState(!1),[d,f]=l.useState(null),[t,D]=l.useState({name:"",email:"",mobile:"",country:"",website:""}),k=be(),[y,A]=l.useState(null),[C,N]=l.useState(!1),{refetch:x}=$(),[a]=ae(),h=(s,w)=>{D(L=>({...L,[s]:w})),r(1)},P=p.filter(s=>{const w=t.name.toLowerCase();return(!t.name||s.name.toLowerCase().includes(w)||s.email.toLowerCase().includes(w)||s.mobile.toLowerCase().includes(w))&&(!t.country||s.country.toLowerCase().includes(t.country.toLowerCase()))&&(!t.website||s.website.toLowerCase().includes(t.website.toLowerCase()))}),M=Math.ceil(P.length/c),_=P.slice((n-1)*c,n*c),I=async s=>{try{await a(s)}catch(w){console.error("Error deleting supplier:",w)}},F=s=>{b(parseInt(s.target.value)),r(1)},E=s=>{f(s),j(!0)},O=s=>{A(s),N(!0)};return o?e.jsx("div",{children:"Loading..."}):v?e.jsxs("div",{children:["Error loading suppliers: ",v.message]}):e.jsxs("div",{children:[e.jsx("div",{className:"rounded-md shadow-sm bg-white",children:e.jsxs(H,{className:"w-full text-left border-collapse",children:[e.jsxs(Q,{className:"bg-gray-100 border-b border-gray-300",children:[e.jsxs(T,{className:"text-gray-600 font-semibold",children:[e.jsx(u,{className:"w-10"}),e.jsx(u,{children:"Info"}),e.jsx(u,{children:"Chemicals"}),e.jsx(u,{children:"Country"}),e.jsx(u,{children:"Website"})]}),e.jsxs(T,{className:"bg-gray-50",children:[e.jsx(i,{}),e.jsx(i,{children:e.jsx("input",{type:"text",placeholder:"Filter by name, email or mobile",className:"p-2 rounded w-full border border-gray-300",value:t.name,onChange:s=>h("name",s.target.value)})}),e.jsx(i,{}),e.jsx(i,{children:e.jsx("input",{type:"text",placeholder:"Filter by country",className:"p-2 rounded w-full border border-gray-300",value:t.country,onChange:s=>h("country",s.target.value)})}),e.jsx(i,{children:e.jsx("input",{type:"text",placeholder:"Filter by website",className:"p-2 rounded w-full border border-gray-300",value:t.website,onChange:s=>h("website",s.target.value)})})]})]}),e.jsx(G,{children:_.map(s=>e.jsx(U.Fragment,{children:e.jsxs(T,{className:"hover:bg-gray-50 border-b border-gray-300",children:[e.jsx(i,{className:"p-2",children:e.jsxs(pe,{children:[e.jsx(je,{asChild:!0,children:e.jsx("button",{className:"p-3",children:e.jsx(me,{className:"w-4 h-4"})})}),e.jsxs(ge,{align:"end",children:[e.jsx(B,{onClick:()=>E(s),children:"Add Chemical"}),e.jsx(B,{onClick:()=>k(`/edit-supplier-form/${s._id}`),children:"Edit"}),e.jsx(B,{onClick:()=>I(s._id),children:"Delete"})]})]})}),e.jsx(i,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.name}),e.jsx("span",{className:"text-sm text-gray-600",children:s.email}),e.jsx("span",{className:"text-sm text-gray-600",children:s.mobile})]})}),e.jsx(i,{children:e.jsxs(S,{variant:"default",size:"sm",onClick:()=>O(s),className:"bg-[#3b1f91] text-white px-4 py-2 rounded hover:bg-[#3b1f91] transition-colors duration-300",children:["Chemicals",e.jsx(ue,{variant:"secondary",className:"ml-2 bg-gray-200 text-black px-2 py-1 rounded",children:s.totalChemicalIds||0})]})}),e.jsx(i,{children:s.country}),e.jsx(i,{children:e.jsx("a",{href:s.website,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:s.website})})]})},s._id))})]})}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"items-per-page",className:"mr-2",children:"Items per page:"}),e.jsxs("select",{id:"items-per-page",className:"p-2  border border-gray-300 rounded",value:c,onChange:F,children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:30,children:"30"}),e.jsx("option",{value:40,children:"40"}),e.jsx("option",{value:50,children:"50"})]})]}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>r(s=>Math.max(s-1,1)),className:"px-3 py-1 border border-gray-300 rounded mr-2",disabled:n===1,children:"Previous"}),e.jsxs("span",{children:["Page ",n," of ",M]}),e.jsx("button",{onClick:()=>r(s=>Math.min(s+1,M)),className:"px-3 py-1 border border-gray-300 rounded ml-2",disabled:n===M,children:"Next"})]})]}),m&&e.jsx(V,{open:m,onClose:()=>j(!1),supplier:d,supplierId:d==null?void 0:d._id,chemicalName:d==null?void 0:d.name}),e.jsx(z,{open:C,onOpenChange:N,children:e.jsx(R,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:C&&y&&e.jsx(q,{supplier:y._id,supplierName:y.name,allData:x})})})]})},ve=({purchaseOrders:p})=>e.jsxs(H,{children:[e.jsx(Q,{children:e.jsxs(T,{children:[e.jsx(u,{children:"Created Date"}),e.jsx(u,{children:"Order Number"}),e.jsx(u,{children:"Payment Status"}),e.jsx(u,{children:"Total Tax"}),e.jsx(u,{children:"Total Discount"}),e.jsx(u,{children:"Total Amount"})]})}),e.jsx(G,{children:p.map((o,v)=>e.jsxs(T,{children:[e.jsx(i,{children:o.createdDate}),e.jsx(i,{children:o.orderNumber}),e.jsx(i,{children:o.paymentStatus}),e.jsxs(i,{children:["$",o.totalTax]}),e.jsxs(i,{children:["$",o.totalDiscount]}),e.jsxs(i,{children:["$",o.totalAmount]})]},v))})]}),ye=[{label:"Dashboard",href:"/dashboard"},{label:"Supplier Table",href:null}];function is(){const[p,o]=l.useState({}),[v,n]=l.useState(!1),[r,c]=l.useState(null),[b,m]=l.useState(1),[j,d]=l.useState(5),{data:f=[],isLoading:t,error:D,refetch:k}=$(),[y,A]=l.useState({});if(t)return e.jsx("p",{children:"Loading suppliers..."});if(D)return e.jsx("p",{children:"Failed to load suppliers"});const C=(x,a)=>{A(h=>({...h,[x]:a}))},N=x=>{console.log("Opening chemical modal for supplier:",x),c(x),n(!0)};return e.jsxs("div",{className:"",children:[e.jsx(Ce,{items:ye}),e.jsxs("div",{className:"flex justify-between mt-4 items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-medium text-[#3b1f91] ",children:"Suppliers"}),e.jsx(fe,{to:"/supplier-form",children:e.jsxs(S,{children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Add Supplier"]})})]}),e.jsx(Ne,{suppliers:f,showPurchaseOrders:p,setShowPurchaseOrders:o,setSelectedSupplier:c,setShowChemicalsModal:n,filters:y,handleFilterChange:C,currentPage:b,itemsPerPage:j,paginatedData:f.slice((b-1)*j,b*j),selectedSupplier:r,refetch:k,onChemicalClick:N}),p[r==null?void 0:r.id]&&r&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4",children:["Purchase Orders for ",r.name]}),e.jsx(ve,{purchaseOrders:[]}),"  "]}),e.jsx(z,{open:v,onOpenChange:x=>{console.log("Modal state changing to:",x),n(x)},children:e.jsx(R,{className:"max-w-2xl h-1/2",children:e.jsx(q,{supplier:r==null?void 0:r._id,supplierName:r==null?void 0:r.name,allData:k})})})]})}export{is as default};
